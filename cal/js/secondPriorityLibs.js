/*
 * jQuery UI Touch Punch 0.2.3w - WPXP Edition
 *
 * Copyright 2011â€“2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * WPXP Edition - by Manuel Gumpinger
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */

define("models/TestStateModel",[],function(){"use strict";var e=function(e){"undefined"==typeof e&&TN8.throw("testStateModel structure has problem.",TN8.errorType.TESTSTATE_FAILED)},t=function(e,t){var n,i,o=$.extend(!0,{},e);for(n in t)i=t[n],o&&void 0!==o[i.minName]&&(o[i.fullName]=o[i.minName],delete o[i.minName]);return o},n=function(e,t){var n,i,o=$.extend(!0,{},e);for(n in t)i=t[n],o&&void 0!==o[i.fullName]&&(o[i.minName]=o[i.fullName],delete o[i.fullName]);return o},i=function(e,t,n){void 0!==e[n]&&(t[n]=e[n])},o=function(o,r,s){return function(){return this.attributes=$.extend(!0,{},o),this.childrenClass=$.extend(!0,{},r),this.conversion=$.extend(!0,[],s),this.children={},this.getAll=function(e){var t=this,i=this.attributes;return _.keys(this.children).forEach(function(n){var o=t.children[n];if(i[n]=[],_.isArray(o))for(var r=0;r<o.length;r++)i[n].push(o[r].getAll(e));else _.isObject(o)&&o.getAll&&(i[n]=o.getAll(e))}),e?n(i,this.conversion):i},this.getClass=function(t){var n=null,i=t[0];if(_.isEmpty(i))return null;if(i.length>1){var o,r=i.shift(),s=this.children[_.keys(r)[0]];e(s),o=s.getClass?s:1===s.length?s[0]:this.find(i,s),o&&o.getClass?n=o.getClass(t):console.log("tree structure is different than your traverse input.")}else{if(t.length>1)return t.shift(),this.getClass(t);n=this}return n},this.get=function(e){return this.attributes[e]},this.set=function(e,t){"undefined"!==this.attributes[e]&&"undefined"!==t&&(this.attributes[e]=t)},this.isMatch=function(e){var t=$.extend(!0,[],e);if(0===t.length)return!1;var n=_.keys(t[0])[0],i=t[0][n];return 1===t.length?"undefined"!==this.attributes[n]&&this.attributes[n]===i:t.length>1?(t.shift(),this.children[n].isMatch(t)):void 0},this.find=function(e,t){for(var n=$.extend(!0,[],e),i=!1,o=null,r=0;r<t.length&&(o=t[r],!(i=o.isMatch(n)));r++);return i?o:null},this.restore=function(e){e=$.extend(!0,{},e),e=t(e,this.conversion);var n=this;_.keys(this.attributes).forEach(function(t){i(e,n.attributes,t)}),_.keys(this.childrenClass).forEach(function(t){var i=e[t];if(_.isArray(i)){n.children[t]=[];for(var o=0;o<i.length;o++){var r=new n.childrenClass[t];r.restore(i[o]),n.children[t].push(r)}}else if(_.isObject(i)){var s=new n.childrenClass[t];s.restore(i),n.children[t]=s}})},this}};return o}),define("models/TestStateFactory",["models/TestStateModel"],function(e){"use strict";var t=function(){var t=TestEngine.getEngineTestStateAttrs(),n={id:"",flagged:!1,answered:!1,visited:!1,locked:!1,wc:!1,jwPlayerState:{}};n=$.extend(!0,t.itemAttrs,n);var i={id:"",sealCode:!1,timeRemaining:null,timer:0,sOvertime:null,sOvertimeStatistics:null,visited:!1,timeStart:null,timeEnd:null};i=$.extend(!0,t.sectionAttrs,i);var o={id:"",cumulativeItemSequencing:!0,time:null,pOvertime:null,pOvertimeStatistics:null,globals:null,partStatus:null,resumeLocation:null,ttsVoice:null,ttsSpeed:null,ttsVolume:null,adaptive_state:null,globalToolState:{}};o=$.extend(!0,t.testPartAttrs,o);var r={cumulativeItemSequencing:!0,time:null,overtime:null,overtimeStatistics:null,globals:null,resumeLocation:null,catData:null,ttsVoice:null,ttsSpeed:null,ttsVolume:null,adaptive_state:null,tutorialOpened:null,termsConditionAccepted:!1,globalToolState:{}};r=$.extend(!0,t.root,r);var s=[{fullName:"cumulativeItemSequencing",minName:"cis"},{fullName:"overtime",minName:"ot"},{fullName:"overtimeStatistics",minName:"ots"},{fullName:"time",minName:"t"},{fullName:"parts",minName:"ps"},{fullName:"globals",minName:"gs"},{fullName:"resumeLocation",minName:"rl"},{fullName:"catData",minName:"cat"},{fullName:"ttsVoice",minName:"ttsv"},{fullName:"ttsVolume",minName:"ttsvl"},{fullName:"ttsSpeed",minName:"ttss"},{fullName:"tutorialOpened",minName:"tutO"},{fullName:"globalToolState",minName:"gts"},{fullName:"termsConditionAccepted",minName:"tca"}],a=[{fullName:"part",minName:"p"}],l=[{fullName:"cumulativeItemSequencing",minName:"cis"},{fullName:"pOvertime",minName:"pot"},{fullName:"pOvertimeStatistics",minName:"pots"},{fullName:"time",minName:"t"},{fullName:"sections",minName:"sts"},{fullName:"globals",minName:"gs"},{fullName:"partStatus",minName:"ps"},{fullName:"resumeLocation",minName:"rl"},{fullName:"ttsVoice",minName:"ttsv"},{fullName:"ttsVolume",minName:"ttsvl"},{fullName:"ttsSpeed",minName:"ttss"},{fullName:"globalToolState",minName:"gts"}],c=[{fullName:"section",minName:"st"}],d=[{fullName:"timeRemaining",minName:"tr"},{fullName:"sOvertime",minName:"sot"},{fullName:"sOvertimeStatistics",minName:"sots"},{fullName:"items",minName:"i"},{fullName:"timeStart",minName:"ts"},{fullName:"timeEnd",minName:"te"}],u=[{fullName:"itemRef",minName:"ir"}],h=[{fullName:"flagged",minName:"f"},{fullName:"answered",minName:"a"},{fullName:"locked",minName:"lck"},{fullName:"visited",minName:"v"},{fullName:"jwPlayerState",minName:"jw"}],p=new e(n,{},h),m={itemRef:p},f=new e({},m,u),g={items:f},v=new e(i,g,d),T={section:v},b=new e({},T,c),w={sections:b},y=new e(o,w,l),S={part:y},C=new e({},S,a),N={parts:C},_=new e(r,N,s);return _};return t}),define("controllers/ResumeRestrictionController",[],function(){var e=function(){return{_unavailableItems:[],inititialize:function(e){e&&$.extend(!0,this,_.pick(e,"lockItem","isItemLocked","isItemAnswered")),this._startEndTestListener()},_startEndTestListener:function(){TN8.fnOn("cleanup.betweenTest",$.proxy(this._testFinish,this))},_testFinish:function(){this.cleanUp()},_getAllItems:function(){for(var e=[],t=this._getTestDefParts(),n=0;n<t.parts.length;n++)for(var i=t.parts[n].part,o=i.sections,r=0;r<o.length;r++)for(var s=o[r].section,a=s.items,l=0;l<a.length;l++){var c=a[l].itemRef;e.push({partId:i.id,sectionId:s.id,itemId:c.id})}return e},lockItems:function(){for(var e=this._getAllItems(),t=0;t<e.length;t++){var n=e[t];this.isItemAnswered(n.partId,n.sectionId,n.itemId)&&this.lockItem(n.partId,n.sectionId,n.itemId)}},_setUnavailableItems:function(e){this._unavailableItems=e},setCalculatedUnavailableItems:function(){this._setUnavailableItems(this.getCalculateUnavailableItems())},getUnavailableItems:function(e){return _.filter(this._unavailableItems,function(t){return t.sectionId===e})},_getLockedItems:function(e){var t=this;return _.filter(e,function(e){return t.isItemLocked(e.partId,e.sectionId,e.itemId)})},_getFirstUnansweredItem:function(e){for(var t=this._getAllItems(),n=0;n<t.length;n++){var i=t[n];if(e===i.sectionId&&!this.isItemAnswered(i.partId,i.sectionId,i.itemId))return i.itemId}},_getFirstUnblockedItem:function(e){for(var t=this._getAllItems(),n=0;n<t.length;n++){var i=t[n];if(e===i.sectionId&&!this.isItemLocked(i.partId,i.sectionId,i.itemId))return i.itemId}},_getItemToLand:function(e){var t=this._getFirstUnansweredItem(e);return t?t:this._getFirstUnblockedItem(e)},_getTestDefParts:function(){return TestEngine.getTestDefine().getTestPartsForTestState()},getCalculateUnavailableItems:function(){var e=this,t=this._getAllItems(),n=this._getLockedItems(t);return _.filter(n,function(t){return e.isItemAnswered(t.partId,t.sectionId,t.itemId)})},getResumeLocation:function(e){if(!e)return null;var t=TN8.utils.getResumeSection(e),n=this._getItemToLand(t._identifier);if(n)return{lastItem:n,location:"item"};var i=TN8.utils.isLastSection(t)?"endtest":"endSection";return{lastItem:e.lastItem,location:i}},cleanUp:function(){this._setUnavailableItems([])}}};return e}),define("controllers/AuthenticationController",["controllers/CleanupController"],function(e){"use strict";var t=function(){var e={};return{init:function(){_.bindAll(this),this._registerEvents()},_registerEvents:function(){TN8.fnOn("inform.testSubmitted",this._testSubmitted),TN8.fnOn("navigate.availableTest",this._refreshShowAvailable),TN8.fnOn("perform.AfterAuthSuccessful",this._afterAuthSuccessfulHandler),TN8.fnOn("navigate.secondWindowRefreshForm",this._refreshFormSecondWin),TN8.fnOn("nagivate.startTest",this._startTestIfUnlockSchedule)},_unregisterEvents:function(){$(document).off("inform.testSubmitted",this._testSubmitted),$(document).off("navigate.availableTest",this._refreshShowAvailable),$(document).off("perform.AfterAuthSuccessful",this._afterAuthSuccessfulHandler),$(document).off("navigate.AfterAuthSuccessfulSecondWindow",this._refreshFormIE),$(document).off("nagivate.startTest",this._startTestIfUnlockSchedule)},_testSubmitted:function(){TN8.Application.DataProvider.isSingleUser()?$(document).trigger("tn.route.to","logout"):this._refreshAfrerSubmit()},_afterAuthSuccessfulHandler:function(e,t){this._afterAuthSuccessful(t)},_refreshFormSecondWin:function(e,t){e={},e.forms=[t],this._startTestWithForm(t,e)},_refreshShowAvailable:function(){this._refreshForms(this._showAvailableTestPage)},_refreshAfrerSubmit:function(){this._refreshForms(this._isAnytestLeft)},_startTestIfUnlockSchedule:function(e,t){this._refreshForms(this._isUnlockSchedule.bind(this,t.formId))},_refreshForms:function(e){var t=this;if($(document).trigger("tn.loadingModal.on"),"function"==typeof e){var n=function(n){t._isAuthSuccess(n)&&e.call(t,n)};TestEngine.getAuthentication().refreshForms(n)}},_showAvailableTestPage:function(e){TN8.Application.availableTests(this._getCompleteForms(e),this._getIncompleteForms(e))},_isAnytestLeft:function(e){TN8.Application.DataProvider.isTestFinished(this._getFormsFromEvent(e))?$(document).trigger("tn.route.to","logout"):TN8.Application.DataProvider.isSingleUser()?TN8.Application.loadTest(this._getIncompleteForms(e)[0]):this._showAvailableTestPage(e)},_isUnlockSchedule:function(e,t){if(this._isAuthSuccess(t)){var n=t.forms&&t.forms[e];if(n&&n.unlockTest&&n.validSchedule&&"E"!==n.testStatusInd)TN8.Application.loadTest(n);else if(n&&"E"!==n.testStatusInd){var i=n.validSchedule?TN8.errorType.TEST_LOCKED:TN8.errorType.TEST_UNSCHEDULED;TN8.throw("",i),this._showAvailableTestPage(t)}else n&&"E"===n.testStatusInd?(TN8.throw("",TN8.errorType.TEST_EXITED),this._showAvailableTestPage(t)):(TN8.throw("",TN8.errorType.TEST_NO_LONGER_AVAILABLE),this._showAvailableTestPage(t))}},_startTestWithForm:function(e,t){TN8.log("authenticationController._startTestWithForm  . ",TN8.CRITICAL),$(document).trigger("tn.login.successful",t),this._setSealCodes(this._getFormsFromEvent(t)),TN8.Application.loadTest(e)},_afterAuthSuccessful:function(e){this._isAuthSuccess(e)&&(TN8.log("authenticationController._afterAuthSuccessful  . ",TN8.CRITICAL),$(document).trigger("tn.login.successful",e),this._setSealCodes(this._getFormsFromEvent(e)),TN8.Application.DataProvider.isSingleUser()?TN8.Application.loadTest(this._getIncompleteForms(e)[0]):TN8.Application.availableTests(this._getCompleteForms(e),this._getIncompleteForms(e)))},_setSealCodes:function(t){for(var n=0;n<t.length;n++){var i=t[n];i.sealCodes&&(e[i.formId]=i.sealCodes.split(","))}},getSealCodes:function(t){return e[t]},_isAuthSuccess:function(e){var t=this._getDataFromEvent(e);return!!TN8.Application.error.successCheck(t,this._handler_refreshSuccessNo)||($(document).trigger("perform.logoutCleanup"),$(document).trigger("tn.route.to","login"),!1)},_handler_refreshSuccessNo:function(e){TN8.log("authenticationController._handler_refreshSuccessNo  . ",TN8.CRITICAL),$(document).trigger("perform.logoutCleanup"),$(document).trigger("tn.route.to","login")},_isComplete:function(e){return"C"===e.testStatusInd},_getIncompleteForms:function(e){var t=this._getFormsFromEvent(e);return _.reject(t,this._isComplete)},_getCompleteForms:function(e){var t=this._getFormsFromEvent(e);return _.filter(t,this._isComplete)},_getFormsFromEvent:function(e){var t=this._getDataFromEvent(e);return _.toArray(t.forms)},_getDataFromEvent:function(e){return e.getTarget?e.getTarget():e}}};return new t}),define("controllers/SealCodeController",["util/Dispatcher","controllers/AuthenticationController"],function(e,t){"use strict";function n(){o={};var e=TestEngine.getAuthentication().getFormId(),n=t.getSealCodes(e);if(n=n&&n.slice(),n&&!(n.length<1))for(var i=TestEngine.getTestDefine().getTestParts(),r=0;r<i.length;r++)for(var s=i[r].getAssessmentSections(),a=0;a<s.length;a++)s[a].getSealCode()&&n.length>0&&(o[s[a].getIdentifier()]=n.shift())}function i(e){return o[e]||""}e.on("test.state.ready",n);var o={};return{getSealCode:i}}),define("controllers/TestStateController",["models/TestStateFactory","controllers/ResumeRestrictionController","controllers/SealCodeController"],function(e,t){"use strict";var n=function(){return{init:function(){_.bindAll(this,"lockItem","isSpecificItemAnswered","isSpecificItemLocked","getUnavailableItemsInSection"),this.testStateModel=null,this.resumeRestrictionController=new t,this.resumeRestrictionController.inititialize({lockItem:this.lockItem,isItemLocked:this.isSpecificItemLocked,isItemAnswered:this.isSpecificItemAnswered}),TestEngine.getTestState(this.restoreTestState,this),this.registerEvents(),$(document).one("cleanup.betweenTest",this.cleanup.bind(this))},restoreTestState:function(t){var n;TN8.log("TestStateController.restoreTestState  ",TN8.IMPORTANT);var i=new e;if(TN8.Application.error.successCheck(t)){if(n=t.state?t.state:TestEngine.getTestDefine().getTestPartsForTestState(),t.state&&this.hasCAT()){var o=new i;o.restore(n);var r=o.getAll(!0),s=new i;s.restore(TestEngine.getTestDefine().getTestPartsForTestState());var a=s.getAll(!0);this.testStateModel=new i;var l=this.getMergedTS(r,a);this.testStateModel.restore(l)}else this.testStateModel=new i,this.testStateModel.restore(n);this.fixOldTestPartState(),TestEngine.getAuthentication().getSession().getResumeRestriction()&&this.resumeRestrictionController.lockItems(),this.resumeRestrictionController.setCalculatedUnavailableItems(),this.restoreGlobalsToState(),TN8.Dispatcher.trigger("test.state.ready"),$(document).trigger("test.state.ready"),$(document).trigger("tn.timer.init",{testId:this.testId})}},fixOldTestPartState:function(){var e=this.getAllParts();if(1===e.length&&""===e[0].id&&(this.setCurrentPartId(),!this.getResumeLocation())){var t=this.getTestStateRoot(),n=t.get("resumeLocation");n&&this.setPartResumeLocation(n)}},getMergedTS:function(e,t){for(var n=0;n<e.ps.length;n++){for(var i=e.ps[n].p.sts,o=t.ps[n].p.sts,r=_.map(o,function(e){return e.st}),s=0;s<i.length;s++){for(var a=i[s].st,l=_.indexOf(_.pluck(r,"id"),a.id),c=o[l].st.i,d=_.map(c,function(e){return e.ir}),u=_.map(a.i,function(e){return e.ir}),h=0;h<u.length;h++){var p=u[h],m=_.indexOf(_.pluck(d,"id"),p.id);c[m].ir=p}var f=i[s].st;f.i=c,t.ps[n].p.sts[l].st=f}var g=e.ps[n].p;g.sts=t.ps[n].p.sts,t.ps[n].p=g}return $.extend(!0,{},t,e)},restoreGlobalsToState:function(){var e=this.getGlobals();$.isArray(e)?TN8.VariableFactory.globalVars.odVars=void 0!==e?e:[]:e&&e.odVars&&e.opBehaviors&&(TN8.VariableFactory.globalVars.odVars=void 0!==e.odVars?e.odVars:[],TN8.VariableFactory.globalVars.opBehaviors=void 0!==e.opBehaviors?e.opBehaviors:[])},saveGlobalsToState:function(){this.setGlobals({odVars:TN8.VariableFactory.globalVars.odVars,opBehaviors:TN8.VariableFactory.globalVars.opBehaviors})},assembleTestState:function(){return $(document).trigger("testState.assemble"),this.saveGlobalsToState(),this.hasCAT()?this.getCATTestState():this.getTestStateModel().getAll(!0)},hasCAT:function(){return TestEngine.getNavigation().getCurrentTestPart().getAssessmentSections().some(function(e){return!e.isLinear()})},getCATTestState:function(){var e=this.getTestStateModel().getAll(!0);return e.ps.forEach(function(e){var t=TestEngine.getTestDefine().getPartById(e.p.id);e.p.sts.forEach(function(e){t.getChildById(e.st.id).isLinear()||(e.st.i=e.st.i.filter(function(e){return e.ir.v}))})}),e},setGlobalToolState:function(e,t,n){var i=this.getGlobalTool(),o=t.getItemSet(),r=e.getIdentifier();""!==o&&(i||(i={}),"undefined"==typeof i[r]&&(i[r]={}),i[r][o]=n,this.setGlobalTools(i))},getGlobalToolState:function(e,t){var n=[],i=this.getGlobalTool(),o=t.getItemSet(),r=e.getIdentifier();return""!==o&&i&&i[r]&&i[r][o]&&(n=i[r][o]),n},initializeTimer:function(){$(document).trigger("tn.timer.init",{testId:this.testId})},getTestStateModel:function(){return this.testStateModel},getCurrentPartId:function(){if(TestEngine.getNavigation())return TestEngine.getNavigation().getCurrentTestPart().getIdentifier()},getCurrentSectionId:function(){if(TestEngine.getNavigation())return TestEngine.getNavigation().getCurrentSection().getIdentifier()},getCurrentItemId:function(){if(TestEngine.getNavigation())return TestEngine.getNavigation().getCurrentItem().getIdentifier()},getCurrentItemState:function(){var e=this.getCurrentItemClass();return e?e.getAll():null},getSectionState:function(e){var t=this.getCurrentPartId(),n=this.getSectionClass(t,e);return n?n.getAll():null},getSectionOvertimeTime:function(){var e,t,n,i=this.getCurrentSectionClass();return i&&(e=i.get("sOvertimeStatistics"),null!==e)?(t=e[e.length-1],n="U"===t.sotg?t.sotu:t.sotg-t.sotu):null},getLastSectionOvertime:function(){var e,t=this.getCurrentSectionClass();return t&&(e=t.get("sOvertimeStatistics"))?e[e.length-1]:null},getResumeLocation:function(){var e=this.getCurrentPartClass();return e?e.get("resumeLocation"):null},getCATData:function(){var e=this.getTestStateRoot();return e?e.get("catData"):null},getTestOvertime:function(){var e=this.getTestStateRoot();return e?e.get("overtime"):null},getTestOvertimeTime:function(){var e,t,n,i=this.getTestStateRoot();return i?(e=i.get("overtimeStatistics"),t=e[e.length-1],n="U"===t.otg?t.otu:t.otg-t.otu):null},getLastTestOvertime:function(){var e,t=this.getTestStateRoot();return t&&(e=t.get("overtimeStatistics"))?e[e.length-1]:null},getTestTime:function(){var e=this.getTestStateRoot();return e?e.get("time"):null},getTutorialOpened:function(){var e=this.getTestStateRoot();return e?e.get("tutorialOpened"):null},getGlobalTool:function(){var e=this.getTestStateRoot();return e?e.get("globalToolState"):null},getGlobals:function(){var e=this.getTestStateRoot();return e?e.get("globals"):null},getTermsConditionAccepted:function(){var e=this.getTestStateRoot();return!!e&&e.get("termsConditionAccepted")},registerEvents:function(){this.unregisterEvents(),$(document).on("testState.setSectionSealCode",this.setSectionSealCode.bind(this)),$(document).on("testState.setSectionVisited",this.setSectionVisited.bind(this)),$(document).on("testState.setSectionTimeRemaining",this.setSectionTimeRemaining.bind(this)),$(document).on("testState.setSectionOvertime",this.setSectionOvertime.bind(this)),$(document).on("testState.setSectionOvertimeStatistic",this.setSectionOvertimeStatistic.bind(this)),$(document).on("testState.setSectionOvertimeTime",this.setSectionOvertimeTime.bind(this)),$(document).on("testState.setSectionStartTime",this.setSectionStartTime.bind(this)),$(document).on("testState.setSectionEndTime",this.setSectionEndTime.bind(this)),$(document).on("testState.setTTSspeed",this.setSectionTTSspeed.bind(this)),$(document).on("testState.setTTSvoice",this.setSectionTTSvoice.bind(this)),$(document).on("testState.setTTSvolume",this.setSectionTTSvolume.bind(this)),$(document).on("testState.setItemVisited",this.setItemVisited.bind(this)),$(document).on("testState.setItemFlagged",this.setItemFlagged.bind(this)),$(document).on("testState.setItemAnswered",this.setItemAnswered.bind(this)),$(document).on("testState.setTestTime",this.setTestTime.bind(this)),$(document).on("testState.setOverTime",this.setOverTime.bind(this)),$(document).on("testState.setOverTimeStatistic",this.setOverTimeStatistic.bind(this)),$(document).on("testState.setOverTimeTime",this.setOverTimeTime.bind(this)),$(document).on("testState.setResumeLocation",this.setResumeLocation.bind(this)),$(document).on("testState.setCATData",this.setCATData.bind(this)),$(document).on("testState.setTutorialOpened",this.setTutorialOpened.bind(this)),$(document).on("testState.setPartTime",this.setPartTime.bind(this)),$(document).on("testState.setPartOverTime",this.setPartOverTime.bind(this)),$(document).on("testState.setPartOverTimeStatistic",this.setPartOverTimeStatistic.bind(this)),$(document).on("testState.setPartOverTimeTime",this.setPartOverTimeTime.bind(this)),$(document).on("testState.setPartStarted",this.setPartStarted.bind(this)),$(document).on("testState.setPartExited",this.setPartExited.bind(this)),$(document).on("testState.setPartComplete",this.setPartComplete.bind(this))},unregisterEvents:function(){$(document).off("testState.setSectionSealCode"),$(document).off("testState.setSectionVisited"),$(document).off("testState.setSectionTimeRemaining"),$(document).off("testState.setSectionOvertime"),$(document).off("testState.setSectionOvertimeStatistic"),$(document).off("testState.setSectionOvertimeTime"),$(document).off("testState.setSectionStartTime"),$(document).off("testState.setSectionEndTime"),$(document).off("testState.setTTSspeed"),$(document).off("testState.setTTSvoice"),$(document).off("testState.setItemVisited"),$(document).off("testState.setItemFlagged"),$(document).off("testState.setItemAnswered"),$(document).off("testState.setTestTime"),$(document).off("testState.setOverTime"),$(document).off("testState.setOverTimeStatistic"),$(document).off("testState.setOverTimeTime"),$(document).off("testState.setResumeLocation"),$(document).off("testState.setCATData"),$(document).off("testState.setTutorialOpened"),$(document).off("testState.setPartTime"),$(document).off("testState.setPartOverTime"),$(document).off("testState.setPartOverTimeStatistic"),$(document).off("testState.setPartOverTimeTime"),$(document).off("testState.setPartStarted"),$(document).off("testState.setPartExited"),$(document).off("testState.setPartComplete")},cleanTestStateModel:function(){this.testStateModel=null},cleanup:function(){this.unregisterEvents(),this.cleanTestStateModel()},getCurrentSectionClass:function(){var e=this.getCurrentPartId(),t=this.getCurrentSectionId();return this.getSectionClass(e,t)},getCurrentSectionState:function(){return this.getCurrentSectionClass().getAll()},getCurrentSectionItems:function(){return this.getCurrentSectionState().items.map(function(e){return e.itemRef})},setSectionSealCode:function(e,t){var n=this.getCurrentSectionClass();n&&n.set("sealCode",t)},setSectionVisited:function(e,t){var n=this.getCurrentSectionClass();n&&n.set("visited",t)},setSectionTimeRemaining:function(e,t){var n=this.getCurrentSectionClass();n&&n.set("timeRemaining",t)},setSectionOvertime:function(e,t){var n=this.getCurrentSectionClass();n&&n.set("sOvertime",t)},setSectionOvertimeStatistic:function(e,t){var n,i,o=this.getCurrentSectionClass();o&&(n=o.get("sOvertimeStatistics"),null===n&&(n=[]),i={sotts:t.timeStamp,sotg:t.timeGiven,sotu:null},n.push(i),o.set("sOvertimeStatistics",n))},setSectionOvertimeTime:function(e,t){var n,i,o=this.getCurrentSectionClass();o&&(n=o.get("sOvertimeStatistics"),i=n.pop(),i.sotu="U"===i.sotg?t:i.sotg-t,n.push(i),o.set("sOvertimeStatistics",n))},setSectionStartTime:function(e,t){var n=this.getCurrentSectionClass();n&&null==n.get("timeStart")&&n.set("timeStart",t)},setSectionEndTime:function(e,t){var n=this.getCurrentSectionClass();n&&n.set("timeEnd",t)},getCurrentItemClass:function(){var e=this.getCurrentPartId(),t=this.getCurrentSectionId(),n=this.getCurrentItemId();return this.getItemClass(e,t,n)},getCurrentSectionItemClass:function(e){var t=this.getCurrentPartId(),n=this.getCurrentSectionId();return this.getItemClass(t,n,e)},getJwPlayerState:function(){var e=this.getCurrentItemClass();return e&&e.get("jwPlayerState")},setJwPlayerState:function(e){var t=this.getCurrentItemClass();t&&t.set("jwPlayerState",e)},setItemVisited:function(e,t){var n=this.getCurrentItemClass();n&&n.set("visited",t)},setItemFlagged:function(e,t){var n=this.getCurrentItemClass();n&&n.set("flagged",t)},setItemAnswered:function(e,t){var n=this.getCurrentItemClass();n&&n.set("answered",t)},getItemAnswered:function(e){var t=this.getCurrentItemClass();return t&&t.get("answered")},isSpecificItemAnswered:function(e,t,n){var i=this.getItemClass(e,t,n);return i&&i.get("answered")},isSpecificItemLocked:function(e,t,n){var i=this.getItemClass(e,t,n);return i&&i.get("locked")},lockItem:function(e,t,n){var i=this.getItemClass(e,t,n);return i&&i.set("locked",!0)},setTestTime:function(e,t){var n=this.getTestStateRoot();"undefined"!=typeof t?n&&n.set("time",t):n&&n.set("time",null)},setSectionTTSspeed:function(e,t){var n=this.getTestStateRoot();n&&n.set("ttsSpeed",t)},setSectionTTSvoice:function(e,t){var n=this.getTestStateRoot();n&&n.set("ttsVoice",t)},setSectionTTSvolume:function(e,t){var n=this.getTestStateRoot();n&&n.set("ttsVolume",t)},setOverTime:function(e,t){var n=this.getTestStateRoot();n&&n.set("overtime",t)},setOverTimeStatistic:function(e,t){var n,i,o=this.getTestStateRoot();o&&(n=o.get("overtimeStatistics"),null===n&&(n=[]),i={otts:t.timeStamp,otg:t.timeGiven,otu:null},n.push(i),o.set("overtimeStatistics",n))},setOverTimeTime:function(e,t){var n,i,o=this.getTestStateRoot();o&&(n=o.get("overtimeStatistics"),i=n.pop(),i.otu="U"===i.otg?t:i.otg-t,n.push(i),o.set("overtimeStatistics",n))},setResumeLocation:function(e,t){var n=this.getTestStateRoot();n&&n.set("resumeLocation",t),this.setPartResumeLocation(t)},setCATData:function(e,t){var n=this.getTestStateRoot();n&&n.set("catData",t)},setTutorialOpened:function(e,t){var n=this.getTestStateRoot();n&&n.set("tutorialOpened",t)},setGlobalTools:function(e){var t=this.getTestStateRoot();t&&t.set("globalToolState",e)},setGlobals:function(e){var t=this.getTestStateRoot();t&&t.set("globals",e)},getCurrentPartClass:function(){var e=this.getCurrentPartId();return this.getTestPartClass(e)},setCurrentPartId:function(){var e=this.getCurrentPartId(),t=this.getTestPartClass(e);return""===t.get("id")&&t.set("id",e),t},getCurrentPartState:function(){return this.getCurrentPartClass().getAll()},setPartStatus:function(e){var t=this.getCurrentPartClass();t&&t.set("partStatus",e)},setPartStarted:function(e,t){t&&this.setPartStatus("I")},setPartComplete:function(e,t){t&&this.setPartStatus("C")},setPartExited:function(e,t){t&&this.setPartStatus("E")},getPartStatus:function(e){var t=this.getCurrentPartClass();return t&&t.get("partStatus")||"N"},setPartTime:function(e,t){var n=this.getCurrentPartClass();"undefined"!=typeof t?n&&n.set("time",t):n&&n.set("time",null)},getPartTime:function(){var e=this.getCurrentPartClass();return e?e.get("time"):null},getPartOvertime:function(){var e=this.getCurrentPartClass();return e?e.get("pOvertime"):null},setPartOverTime:function(e,t){var n=this.getCurrentPartClass();n&&n.set("pOvertime",t)},setPartOverTimeStatistic:function(e,t){var n,i,o=this.getCurrentPartClass();o&&(n=o.get("pOvertimeStatistics"),null===n&&(n=[]),i={potts:t.timeStamp,potg:t.timeGiven,potu:null},n.push(i),o.set("pOvertimeStatistics",n))},setPartOverTimeTime:function(e,t){var n,i,o=this.getCurrentPartClass();o&&(n=o.get("pOvertimeStatistics"),i=n.pop(),i.potu="U"===i.potg?t:i.potg-t,n.push(i),o.set("pOvertimeStatistics",n))},getPartOvertimeTime:function(){var e,t,n,i=this.getCurrentPartClass();return i?(e=i.get("pOvertimeStatistics"),t=e[e.length-1],n="U"===t.potg?t.potu:t.potg-t.potu):null},getLastPartOvertime:function(){var e,t=this.getCurrentPartClass();return t&&(e=t.get("pOvertimeStatistics"))?e[e.length-1]:null},setPartTTSspeed:function(e,t){var n=this.getTestStateRoot();n&&n.set("ttsSpeed",t)},setPartTTSvoice:function(e,t){var n=this.getTestStateRoot();n&&n.set("ttsVoice",t)},setPartTTSvolume:function(e,t){var n=this.getTestStateRoot();n&&n.set("ttsVolume",t)},setPartResumeLocation:function(e){var t=this.getCurrentPartClass();t&&t.set("resumeLocation",e)},setPartGlobalTools:function(e){var t=this.getTestStateRoot();t&&t.set("globalToolState",e)},setPartGlobals:function(e){var t=this.getTestStateRoot();t&&t.set("globals",e)},setTermsConditionAccepted:function(){var e=this.getTestStateRoot();e&&e.set("termsConditionAccepted",!0)},getTestStateRoot:function(){var e=[["root"]];return this.getClass(e)},getTestPartClass:function(e){var t=[[{parts:""},{part:""},{id:e}]];return this.getClass(t)},getSectionClass:function(e,t){var n=[[{parts:""},{part:""},{id:e}],[{sections:""},{section:""},{id:t}]];return this.getClass(n)},getItemClass:function(e,t,n){var i=[[{parts:""},{part:""},{id:e}],[{sections:""},{section:""},{id:t}],[{items:""},{itemRef:""},{id:n}]];return this.getClass(i)},getSectionsState:function(e){var t=[[{parts:""},{part:""},{id:e}],[{sections:""}]],n=this.getClass(t);return n?n.getAll():null},getAllSections:function(){var e=this.getCurrentPartId(),t=this.getSectionsState(e);return t&&t.sections.map(function(e){return e.section})},getPartsState:function(){var e=[[{parts:""}]],t=this.getClass(e);return t?t.getAll():null},getAllParts:function(){var e=this.getPartsState();return e&&e.parts.map(function(e){return e.part})},getClass:function(e){var t=this.getTestStateModel();return t?t.getClass(e):null},isResumeLocationBlocked:function(e){return e&&this.isSpecificItemLocked(TN8.utils.getResumeSection(e).getIdentifier(),e.lastItem)},getResumeLocationOverall:function(){var e=window.TestEngine.getAuthentication().getSession().getResumeOverride(),t=this.getResumeLocation();return t&&!e&&(TestEngine.isResumeRestrictionApplicable()||TN8.Application.testDefProperties.hasResumeRestriction()&&this.isResumeLocationBlocked(t))&&"startSection"!==t.location?this.resumeRestrictionController.getResumeLocation(t):((this.checkSkipEndRL(t)||this.checkSkipStartRL(t))&&(t.location="item"),t)},checkSkipEndRL:function(e){return e&&("endtest"===e.location||"endSection"===e.location)&&TN8.utils.getResumeSection(e)&&TN8.utils.getResumeSection(e)._skipEnd},checkSkipStartRL:function(e){return e&&"startSection"===e.location&&TN8.utils.getResumeSection(e)&&TN8.utils.getResumeSection(e)._skipStart},getUnavailableItemsInSection:function(e){return window.TestEngine.getAuthentication().getSession().getResumeOverride()?[]:this.resumeRestrictionController.getUnavailableItems(e)}}},i=new n;return i}),define("util/InteractiveObjectRegister",[],function(){"use strict";var e={interactions:new Array,htmlNodes:new Array,configurations:new Array,register:function(e){this.interactions.push(e)},reset:function(){if($(document).off("tn.nav.start",$.proxy(this.interactionEndSession,this)),this.interactions.length>0){for(var e=0;e<this.interactions.length;e++){var t=this.interactions[e];t.hasOwnProperty("interactionFinished")&&"function"==typeof t.interactionFinished&&t.interactionFinished(),this.interactions[t.id]&&(this.interactions[t.id]=null),this.htmlNodes[t.id]&&(this.htmlNodes[t.id]=null),this.configurations[t.id]&&(this.configurations[t.id]=null)}this.interactions.splice(0,this.interactions.length)}this.htmlNodes.length>0&&this.htmlNodes.splice(0,this.htmlNodes.length),this.configurations.length>0&&this.configurations.splice(0,this.configurations.length)},setConfiguration:function(e,t){this.configurations[e]?$.extend(this.configurations[e],t):this.configurations[e]=t},getConfiguration:function(e){return this.configurations[e]},getConfigurationByIdentifier:function(e){for(var t,n=0;n<this.interactions.length;n++)if(t=this.interactions[n],t.identifier==e)return t;return null},initialize:function(){for(var e=new Object,t=0;t<this.interactions.length;t++){var n=this.interactions[t];if(!e[n.getTypeIdentifier()]){var i;i=document.getElementsByClassName?document.getElementsByClassName(n.getTypeIdentifier()):$("."+n.getTypeIdentifier());var o=i[0].id;this.htmlNodes[o]=i[0],this.interactions[o]=n,e[n.getTypeIdentifier()]=1,n.initialize(o,i[0]),$(document).on("tn.nav.start",$.proxy(this.interactionEndSession,this));for(var r=1;r<i.length;r++){var s=$.extend({},n),a=i[r].id;this.interactions[a]=s,this.htmlNodes[a]=i[r],s.initialize(a,i[r])}}}},interactionEndSession:function(){if(this.interactions.length>0)for(var e=0;e<this.interactions.length;e++){var t=this.interactions[e];t.hasOwnProperty("interactionEndSession")&&"function"==typeof t.interactionEndSession&&t.interactionEndSession()}},notifyReady:function(e){var t=this.interactions[e],n=t.identifier+"_pciLoaded",i={pciIdentifier:t.getTypeIdentifier()};TN8.log("interactiveObjectRegister.notifyReady id:"+e,TN8.IMPORTANT),$(document).trigger(n,i)},notifyDone:function(e){}};return e}),define("util/SupportMediaForm",[],function(){
"use strict";var e={getSupportedMediaFormats:function(e){var t=navigator.userAgent,n=[],i=function(){var e=!1;return t.indexOf("MSIE")===-1&&t.indexOf("IE 11")===-1&&t.indexOf("Trident")===-1||(e=!0),e};switch(e){case"audio":n=/TestNavDesktopApp/.test(t)||i()?[".mp3",".m4a",".ogg"]:[".m4a",".mp3",".ogg"];break;case"video":var o=function(){if(window.TestEngine.isJXBrowserApp())return!0;if(t.indexOf("Firefox")!=-1){var e=navigator.oscpu;if(e.indexOf("Windows")!=-1){var n=0;if(n=e.indexOf(";")!=-1?parseFloat(e.substring(11,e.indexOf(";",11))):parseFloat(e.substring(11)),n<6)return!0}}return!1};navigator.oscpu;n=o()?[".webm",".mp4",".m4v",".f4v",".mov",".flv"]:[".mp4",".m4v",".f4v",".mov",".webm",".flv"]}return n}};return e}),define("controllers/CommandCenter",["controllers/ApplicationStatusController"],function(e){"use strict";var t=function(){var t=null;return{thisClassName:"CommandCenter",CommandCenterStatus:{BUSY:1,IDLE:2},init:function(){return t=this,_.bindAll(this,"_registerEvents","_unregisterEvents","_handleScoreMe"),this._startEndTestListener(),this},_applicationStatusInit:function(){e.registerEvent(e.actionNames.obeyCommand,"DoObeyCommand","ErrObeyCommand",TN8.Dispatcher),TN8.Dispatcher.off("DoObeyCommand").on("DoObeyCommand",this.obeyCommand,this),TN8.Dispatcher.off("ErrObeyCommand").on("ErrObeyCommand",this.obeyCommandFailed,this),e.subscribeCondition(e.actionNames.obeyCommand,this.thisClassName,this.CommandCenterStatus.IDLE),this.idleStatus()},_startEndTestListener:function(){TN8.fnOn("tn.test.start",this._registerEvents),TN8.fnOn("cleanup.betweenTest",this._unregisterEvents)},_registerEvents:function(){TN8.fnOn("TN8.Application.NavNext",this._handleNavNext),TN8.fnOn("TN8.Application.NavPrev",this._handleNavPrev),TN8.fnOn("TN8.Application.NavTo",this._handleNavTo),TN8.fnOn("TN8.Application.ScoreMe",this._handleScoreMe),TN8.fnOn("tn.scoreController.ScoreDone",this._handleScoreDone),TN8.fnOn("TN8.Application.IsItemAnswered",this._handleIsItemAnswered),TN8.fnOn("tn.dataProvider.IsItemAnsweredDone",this._handleIsItemAnsweredDone),this._applicationStatusInit()},_unregisterEvents:function(){$(document).off("TN8.Application.NavNext"),$(document).off("TN8.Application.NavPrev"),$(document).off("TN8.Application.NavTo"),$(document).off("TN8.Application.ScoreMe"),$(document).off("tn.scoreController.ScoreDone"),$(document).off("tn.dataProvider.IsItemAnsweredDone"),$(document).off("TN8.Application.IsItemAnswered")},_handleNavNext:function(){$(document).trigger("tn.do.nav.next")},_handleNavPrev:function(){$(document).trigger("tn.do.nav.prev")},_handleNavTo:function(e,t){$(document).trigger("tn.do.nav.toItem",t)},_handleScoreMe:function(){var e=function(){t.busyStatus(),$(document).trigger("tn.score.me")};t.execute(e)},_handleScoreDone:function(e,n){t.idleStatus(),$(document).trigger("TN8.Application.ScoreDone",n)},_handleIsItemAnswered:function(e,n){var i=function(){t.busyStatus(),$(document).trigger("tn.dataProvider.IsItemAnswered",n)};t.execute(i)},_handleIsItemAnsweredDone:function(e,n){t.idleStatus(),$(document).trigger("TN8.Application.IsItemAnsweredDone",n)},execute:function(t){e.execute(e.actionNames.obeyCommand,t)},obeyCommand:function(e){e.call(this)},obeyCommandFailed:function(e){var t=e&&e.toString();TN8.Application.error.logError("CommandCenter.obeyCommandFailed  "+t,TN8.Application.error.logLevel.IMPORTANT)},busyStatus:function(){e.statusChange(this.thisClassName,this.CommandCenterStatus.BUSY)},idleStatus:function(){e.statusChange(this.thisClassName,this.CommandCenterStatus.IDLE)}}};return t}),define("util/StateJSONBuilder",["controllers/TestStateController","util/Dispatcher"],function(e,t){var n=function(){function n(){function n(){c=e,d=TN8.Application.itemController.get("itemIndex"),u=TN8.Application.itemController.get("controllers")||[],h=TN8.Application.itemController.stateObj}function i(){n(),TN8.log("SavingObjGenerator.saveAllControllersResponse  controllers.length : "+u.length,TN8.IMPORTANT);var e=u.length,t=0;0===e&&$(document).trigger("itemState.ready",null);var i=function(n,r){t++,t===e&&($(document).off("controller.saveState.done",i),o())};$(document).off("controller.saveState.done",i).on("controller.saveState.done",i);for(var r=u&&u.length,s=0;s<r;s++){var a=u[s];a.getModuleController?a.storeFromEval():a.stateTemplate&&a.retrieveState&&a.moduleView.saveState()}}function o(){var e=h.toRequestJSON();$(document).trigger("itemState.ready",e)}function r(e){var t=s(e.itemJSON);if(t)return!d&&e.fullData&&(d=parseInt(e.fullData.item)),{savingObject:t,itemId:d}}function s(e){if($("input[data-module='TextEntry']").siblings(".tooltip").remove(),e.tools=TN8.Application.itemController.toolLoader?TN8.Application.itemController.toolLoader.getToolState():{},TN8.VariableFactory.globalVars.odVars!==[]){var t=TestEngine.getNavigation();TN8.VariableFactory.globalVars.setGlobalVars(t.getCurrentSection(),t.getCurrentItem(),e.mods)}$(document).trigger("testState.setSectionEndTime",(new Date).toUTCString());var n=c?c.assembleTestState():TN8.TestStateController.assembleTestState();return{test_state:$.extend(!0,{},n),state:e}}function a(){TN8.log("ItemSaver.destroyResponseChangeListener . Listener Off",TN8.IMPORTANT),l()}function l(){c=null,d=null,u=null,h=null}var c,d,u,h;return t.off("ItemController.cleanUpProcessStart",a),t.on("ItemController.cleanUpProcessStart",a),{getStateJSON:function(e){return r(e)},getScoredResponse:function(e){var t=e.response;return"undefined"!=typeof e.score&&null!==e.score&&(t.score=e.score),t},getResponses:function(){TN8.log("SavingObjGenerator.getResponses  ",TN8.IMPORTANT),i()}}}var i;return i=n(),{getInstance:function(){return i||(i=n()),i}}};return n()}),define("controllers/DataProvider",["util/TestDefProperties","util/StateJSONBuilder","controllers/ReviewRangeController","timer/TimerUtils","controllers/PnpController"],function(e,t,n,i,o){"use strict";var r=function(){return{init:function(){_.bindAll(this,"_registerEvents","_unregisterEvents","_isItemAnswered"),this._startEndTestListener()},_startEndTestListener:function(){TN8.fnOn("tn.test.start",this._registerEvents),TN8.fnOn("cleanup.betweenTest",this._unregisterEvents)},_registerEvents:function(){var e=this;TN8.fnOn("tn.dataProvider.IsItemAnswered",function(){e.getResponses(e._isItemAnswered)})},_unregisterEvents:function(){$(document).off("tn.dataProvider.IsItemAnswered")},_getItemByExternalId:function(e){return window.TestEngine.getNavigation().getCurrentSection().getItemByName(e)},_getItemStateByItemId:function(e){if("undefined"!=typeof e&&null!==e){var t=TestEngine.getAllItemResponses();for(var n in t){var i=t[n],o=_.keys(i)[0];if(e===o)return i[o]}}},getResponses:function(e){$(document).trigger("tn.prepare.item.response"),$(document).off("itemState.ready").one("itemState.ready",e),t.getInstance().getResponses()},getResponsesArr:function(){var e=[],n=function(t,n){if(n&&n.mods&&n.mods.length>0)for(var i=0;i<n.mods.length;i++){var o=n.mods[i],r={identifier:o.did,value:o.r};e.push(r)}};return $(document).off("itemState.ready").one("itemState.ready",n),t.getInstance().getResponses(),e},_isItemAnswered:function(){var e=TN8.Application.itemController.isItemAnswered();$(document).trigger("tn.dataProvider.IsItemAnsweredDone",e)},getItemState:function(e){var t=this._getItemByExternalId(e);if(t){var n=t.getIdentifier();return this._getItemStateByItemId(n)}},getTestState:function(){return TN8.TestStateController.assembleTestState()},getTestInfo:function(){var e=0,t=0,n=0,i=TN8.utils.isLastSection(),o=TN8.TestStateController.getAllSections(),r=1===o.length||o.slice(0,-1).every(function(e){return e.visited});TN8.TestStateController.getCurrentSectionItems().forEach(function(i){e+=!i.answered&&!i.wc,t+=!i.wc,n+=!!i.flagged});var s=0===e;return{done:s,meta:s?t+" Answered":e+" Not Answered",finishedLastSection:s&&i,testComplete:r,flagMeta:1===n?"1 Question":n+" Questions"}},getStartTestInfo:function(){var e=TestEngine.getTestDefine(),t=TestEngine.getNavigation().getCurrentTestPart().getAssessmentSections(),n=e._sourceJson.vsr,r=TN8.utils.isK2(),s=TestEngine.isResumeRestrictionApplicable(),a=TestEngine.getAuthentication().getSession().getResumeOverride(),l=e.getReviewRestrictionTime(),c=TN8.TestStateController.getResumeLocation(),d=c&&c.lastItem&&c.location?c:null,u=0;if(!i.isPart()&&!i.isSection())if(d)u=TN8.TestStateController.getTestTime();else{var h=e.getCountdown(),p="undefined"!=typeof h&&null!==h?h:120;u=60*p,u*=o.getTimeMultiplier()}var m=_.flatten(_.pluck(t,"_assessmentItemRefs"),!0).filter(function(e){return!e._wc}).length;return{title:TestEngine.getAuthentication().getCurrentForm().getTestName(),parts:TN8.TestStateController.getAllParts(),sections:t.length,isShowQuestion:t.every(function(t){var n=t.isLinear(),i=e&&e.getChrome()&&"aimsweb"===e.getChrome().toLowerCase();return n&&!i}),questions:m,timeString:i.buildTimeString(u),resumed:d,vsr:n,isK2:r,hasRR:s,hasOR:a,RRtime:l}},getStartPartInfo:function(e){var t=TN8.TestStateController.getAllParts();for(var n in t)if(t[n].id===e){var r,s=TestEngine.getTestDefine(),a=s.getPartById(t[n].id),l=a.getAssessmentSections(),c=TN8.TestStateController.getResumeLocation(),d=c&&c.lastItem&&c.location?c:null;if(i.isPart())if(d)r=TN8.TestStateController.getPartTime();else{var u=a.getCountdown(),h="undefined"!=typeof u&&null!==u?u:120;r=60*h,r*=o.getTimeMultiplier()}return{title:a.getTitle(),sections:l.length,isShowQuestion:l.every(function(e){var t=e.isLinear(),n=s&&s.getChrome()&&"aimsweb"===s.getChrome().toLowerCase();return t&&!n}),questions:_.flatten(_.pluck(l,"_assessmentItemRefs"),!0).filter(function(e){return!e._wc}).length,timeString:i.buildTimeString(r),resumed:d}}},getOverviewRows:function(){var t=TN8.utils.isCat(),n=new e(window);return t?this.getCatOverviewRows():this.getSeqOverviewRows(n.isMustAnswerToContinue())},getSeqOverviewRows:function(e){var t=TN8.Application.currentContent,n=TestEngine.getNavigation().getCurrentTestPart(),i=TestEngine.getNavigation().getCurrentSection(),o=TN8.TestStateController.getCurrentItemId(),r=TN8.TestStateController.getCurrentSectionItems(),s=TN8.TestStateController.getUnavailableItemsInSection(TestEngine.getNavigation().getCurrentSection().getIdentifier()),a=r.length,l=[];if(e){var c=TN8.Application.itemController.isItemAnswered();r=r.filter(function(e){return e.id===o&&"endSection"!==t&&"endtest"!==t&&"epatReport"!==t&&(e.answered=c),e.answered||e.visited})}return r.forEach(function(e){var r=n.getItemById(e.id),a=i.getIndexOfQuestionItem(r);a="undefined"!=typeof a?a:"";var c={id:e.id,flagged:e.flagged,blocked:s.filter(function(t){return t.itemId===e.id}).length>0,answered:e.answered,unanswered:!e.answered&&!e.wc,visited:e.visited,wc:e.wc,title:e.wc?r.getTitle():$.i18n.t("generalWords:question")+" "+a,all:!0,selected:e.id===o&&"item"===t,onSelected:function(){$(document).trigger("tn.reviewdropdown.nav"),$(document).trigger("tn.do.nav.toItem",e.id)}};l.push(c)}),e&&r.length!==a||l.push({id:"endsection",title:$.i18n.t("header:endOfSection"),selected:"endSection"===t||"endtest"===t,onSelected:function(){$(document).trigger("tn.reviewdropdown.nav"),$(document).trigger("tn.do.nav.endSection")}}),l},getCatOverviewRows:function(){var e=TestEngine.getNavigation().getCurrentSection(),t=n.getCurrentRange(),i=n.getRangeDisplayLabel(),o=TN8.TestStateController.getCurrentSectionItems(),r=TN8.TestStateController.getCurrentItemId(),s=n.getReviewRestricted(),a=[];return t?(t.forEach(function(t,n){var l=_.find(o,function(e){return e.id===t}),c="P"===i[n]?e.getChildById(t).getTitle():$.i18n.t("generalWords:question")+" "+i[n],d={id:l.id,flagged:l.flagged,blocked:s[n],answered:l.answered,unanswered:!l.answered&&!l.wc,visited:l.visited,wc:l.wc,title:c,all:!0,selected:l.id===r&&"item"===TN8.Application.currentContent,onSelected:function(){$(document).trigger("tn.do.nav.toItem",l.id)}};a.push(d)}),a):a},getEndData:function(e){var t=TN8.TestStateController.getCurrentSectionItems(),n=t.filter(function(e){return!e.answered&&!e.wc}).length,i=t.filter(function(e){return e.flagged}).length,o=$.i18n.t("header:reviewTabbookmarked",{count:i}),r=TN8.TestStateController.getAllSections(),s=1===r.length||r.slice(0,-1).every(function(e){return e.visited}),a=TestEngine.getNavigation().getCurrentSection(),l=!a.isLinear()||a.hideSectionReview(),c=a.getMustAnswerToContinue()&&0!==n&&!l,d=a.getDisableExit(),u=$.i18n.t("endSection:endOf",{sectionTitle:TestEngine.getNavigation().getCurrentSection().getTitle()}),h=$.i18n.t("endSection:endBanner"),p=l?"":$.i18n.t("endSection:reviewMessage"),m=n?"unanswered":"answered",f=n?$.i18n.t("endSection:notAnswered"):$.i18n.t("endSection:allQuestionsAnswered"),g=$.i18n.t("header:reviewTabunanswered",{count:n}),v=$.i18n.t("endSection:endSection"),T=$.i18n.t("endSection:endSectionButton"),b=c&&!d;e&&(v=$.i18n.t("endTest"),T=$.i18n.t("endSection:endTestButton"),b=(!s||c)&&!d);var w=$.i18n.t("endSection:endMessage",{reviewMsg:p,btnText:T}),y=e&&!s&&!c&&!d;return{ariaTitle:v,endBanner:h,endTitle:u,endMessage:w,noReview:l,answered:m,unansweredCount:n,unansweredLabel:f,unansweredAriaLabel:g,bookmarkedAriaLabel:o,bookmarkCount:i,buttonText:T,endTest:e,mustAnswer:c,disabledSubmit:b,showWarning:y}},isTestFinished:function(e){for(var t=!0,n=0;n<e.length;n++)"C"!==e[n].testStatusInd&&(t=!1);return t},isSingleUser:function(){return"multi-test"!==TestEngine.getAuthentication().getLoginType()},isMultiPartUser:function(){return!!this.isSingleUser()&&(TestEngine.getTestDefine()&&TestEngine.getTestDefine().getTestParts().length>1)},checkAllPartsComplete:function(){for(var e=TN8.TestStateController.getAllParts(),t=0;t<e.length;t++)if("C"!==e[t].partStatus)return!1;return!0},getUnfinishedParts:function(){for(var e=TN8.TestStateController.getAllParts(),t=[],n=0;n<e.length;n++)"C"!==e[n].partStatus&&t.push(e[n].id);return t}}},s=new r;return s.init(),s}),define("controllers/ScoreController",["controllers/DataProvider"],function(e){"use strict";var t=function(){return{score:null,init:function(){_.bindAll(this,"_registerEvents","_unregisterEvents","sendToScore","_getResponses","sendScoreBack","requestFailed","clearScore"),this._startEndTestListener()},_startEndTestListener:function(){TN8.fnOn("tn.test.start",this._registerEvents),TN8.fnOn("cleanup.betweenTest",this._unregisterEvents)},_getResponses:function(){e.getResponses(this.sendToScore)},_registerEvents:function(){TN8.fnOn("tn.score.me",this._getResponses),TN8.Dispatcher.on("performNavigation",this.clearScore)},_unregisterEvents:function(){$(document).off("tn.score.me"),TN8.Dispatcher.off("performNavigation",this.clearScore)},clearScore:function(){this.score=null},sendScoreBack:function(e){TN8.Application.error.successCheck(e)?(this.score=e,delete e.success,$(document).trigger("tn.scoreController.ScoreDone",this.score)):this.logAndThrowError(e)},sendToScore:function(e,t){var n=this._isSubScore();TestEngine.scoreItem(t,n,this.sendScoreBack,this.requestFailed)},_isSubScore:function(){var e=TestEngine.getTestDefine();return!(!e.getChrome()||"aimsweb"!==e.getChrome().toLowerCase())},requestFailed:function(e){this.logAndThrowError(e)},logAndThrowError:function(e){if(TN8.Application.error.logError("ScoreController.sendToScore failed. Original error: "+JSON.stringify(e.msg),TN8.Application.error.logLevel.IMPORTANT),e.msg&&504===e.msg.errorNum){var t=3134;TN8.throw(e.msg.command+" request timed out.",t)}else e.msg&&e.msg.msg&&e.msgCode?TN8.throw(e.msg.msg,e.msg.msgCode):TN8.throw("ScoreController.sendToScore failed",TN8.errorType.SCORE_ERROR);TN8.apip&&TN8.apip.ttsObject&&TN8.apip.ttsObject.ttsController&&TN8.apip.ttsObject.ttsController.stop()}}},n=new t;return n.init(),n}),define("controllers/globalController",["utils"],function(e){return{VARIABLE_TYPE_TOOLS:"tools",checkDataAuthoring:function(e,t){e>1&&TN8.log("VariableFactory...checkDataAuthoring: "+t,TN8.CRITICAL)},globalVars:{odVars:[],opBehaviors:[],getSetBehavior:function(t,n,i){for(var o=[],r=0;r<this.opBehaviors.length;r++)"setoutcomeval"===this.opBehaviors[r].behavior&&o.push(this.opBehaviors[r]);for(var s,a=t.getIdentifier(),l=n.getItemSet(),c=!1,r=0;r<o.length;r++)if(s=o[r],(""===s.sectionIdentifier||s.sectionIdentifier===a)&&!(""!==s.includeCat&&s.includeCat!==l||""!==s.excludeCat&&s.excludeCat===l))for(var d=0;d<i.length;d++)this.opBehaviors[r].variableIdentifier==e.trimID(i[d].did)&&(c||(c=[]),c.push(s));return c},setGlobalVars:function(t,n,i){for(var o=this.getSetBehavior(t,n,i),r=0;r<o.length;r++){var s=o[r];if(i.type&&i.type===TN8.VariableFactory.VARIABLE_TYPE_TOOLS)this.setTool(s.identifier,i.state);else for(var a=0;a<i.length;a++)if(e.trimID(i[a].did)===s.variableIdentifier){this.setVar(s.identifier,i[a].r);break}}},setVar:function(e,t){for(var n=0;n<this.odVars.length;n++)if(this.odVars[n].identifier===e){this.odVars[n].value=t;break}},getVar:function(e){for(var t=[],n=0;n<this.odVars.length;n++)this.odVars[n].identifier===e&&t.push(this.odVars[n]);return TN8.VariableFactory.checkDataAuthoring(t.length,"A tpl behavior's gid mapped to more than one."),t[0].value},setTool:function(e,t){for(var n=0;n<this.odVars.length;n++)this.odVars[n].identifier===e&&(this.odVars[n].tool=t)}},templateVars:{tdVars:[],tplBehaviors:[],loadVar:function(e){this.tdVars.push(e)},loadBehavior:function(e){this.tplBehaviors.push(e)},applyGetDataBehaviors:function(){for(var e=0;e<this.tplBehaviors.length;e++)"behavior-getglobal"==this.tplBehaviors[e].behavior&&this.setVar(this.tplBehaviors[e].tplIdent,TN8.VariableFactory.globalVars.getVar(this.tplBehaviors[e].gblIdent))},setVar:function(e,t){for(var n=0;n<this.tdVars.length;n++)if(this.tdVars[n].identifier===e){this.tdVars[n].value=t;break}},checkGetGlobalState:function(t){var n=this.getBehaviorByIdentifier("behavior-setdata",e.trimID(t));return n.length>0?this.getVar(n[0].tplIdent):[]},getBehaviorByIdentifier:function(e,t){for(var n=[],i=null,o=0;o<this.tplBehaviors.length;o++)i=this.tplBehaviors[o],i.behavior===e&&i.respIdent===t&&n.push(i);return TN8.VariableFactory.checkDataAuthoring(n.length,"An interaction's id mapped to more than one template behavior"),n},getVar:function(e){for(var t=[],n=0;n<this.tdVars.length;n++)this.tdVars[n].identifier===e&&t.push(this.tdVars[n]);return TN8.VariableFactory.checkDataAuthoring(t.length,"An interaction's id mapped to more than one globalVar."),t},reset:function(){for(;this.tdVars.length>0;)this.tdVars.pop();for(;this.tplBehaviors.length>0;)this.tplBehaviors.pop()}}}}),define("text!tpl/sectionExitWarning.html",[],function(){return'\n\n<div class="modal-header custom-modal-header">\n    <h1 id="section-exit-warning-label" class="modal-title" style="float:left; font-weight:normal;margin:5px 0; white-space:nowrap; color: red;" aria-hidden="true">\n        <%= $.i18n.t("endSection:sectionExitWarning")%>\n    </h1>\n    <div style="clear:both; width:40px;"></div>\n</div>\n\n<div id="section-exit-text" class="custom-modal-body modal-body">\n    <span class="visuallyhidden" aria-hidden="true"><%= $.i18n.t(\'endSection:sectionExitWarning\')%></span>\n    <div >\n        <%= $.i18n.t("endSection:sectionExitWarningMsg")%>\n    </div>\n    <div >\n        <%= $.i18n.t("endSection:sectionExitWarningPrompt")%>\n    </div>\n</div>\n\n<div class="modal-footer custom-modal-footer">\n    <div>\n        <button class="btn btn-primary btn-large continue-yes" aria-label="<%= $.i18n.t(\'endSection:nextSection\')%>"><%= $.i18n.t("generalWords:capitalYes")%></button>\n        <button class="btn btn-large continue-no" aria-label="<%= $.i18n.t(\'endSection:cancelAndDismiss\')%>"><%= $.i18n.t("generalWords:capitalNo")%></button>\n    </div>\n</div>'}),define("views/SectionExitWarningView",["javascripts/backbone-min","text!tpl/sectionExitWarning.html"],function(e,t){"use strict";return e.View.extend({template:_.template(t),el:'<div id="section-exit-warning" class="modal hide table-bordered" aria-live="assertive" role="dialog"></div>',modalId:"section-exit-warning",initialize:function(e,t){_.bindAll(this)},render:function(){this.$el.html(this.template());var e=this;return TestEngine.isIdevice()?setTimeout(function(){e.showModal()},0):this.showModal(),$(document).trigger("deepZoomLayer.getStatus",$.proxy(this._handleDeepZoomStatus,this)),this.addListeners(),this},events:{},_handleDeepZoomStatus:function(e){e&&this._doDeepZoomCoupling()},_doDeepZoomCoupling:function(){$(document).trigger("deepZoomLayer.setCoupling",{title:$.i18n?$.i18n.t("endSection:sectionExitWarning"):"Section Exit Warning",html:"#section-exit-warning",hideCloseButton:!0,closeButtons:["button.continue-no","button.continue-yes"]})},addListeners:function(){this.$el.find(".continue-yes").click(this.nextSection),this.$el.find(".continue-no").click(this.removeModal),$(document).one("inform.timeoutModalOn",this.removeModal),$(document).one("cleanup.betweenTest",this.removeModal),$(document).on("deepZoomLevel.enter",this.removeModal)},showModal:function(){$(document).trigger("tn.loadingModal.off"),this.$el.modal({backdrop:"static",keyboard:!1,show:!0}).tabRing()},removeModal:function(){$(document).off("inform.timeoutModalOn",this.removeModal),$(document).off("cleanup.betweenTest",this.removeModal),$(document).off("deepZoomLevel.enter",this.removeModal),this.$el.modal("hide").tabRing("off").remove()},nextSection:function(e){this.removeModal(),$(document).trigger("navigate.loadNextSection",e)}})}),define("util/ResponseValidator",[],function(){"use strict";var e=function(){return{isItemStateValid:function(e){var t=[],n=[];$("[data-module]","#itemCanvas").each(function(){n.push($(this).attr("data-identifier"))});for(var i=$.extend(!0,[],n),o=_.invoke([n],"sort"),r=TN8.Application.itemController.dataIdArray,s=0;s<e.mods.length;s++){var a=!0;switch(e.mods[s].it){case"CustomInteraction-equationeditor":a=this.checkEquationEditor(e.mods[s]),a||TN8.log("ItemSaver._isItemStateValid EE has problem"+JSON.stringify(e)+" ; "+JSON.stringify(n)+" ; "+JSON.stringify(t)+" ; "+JSON.stringify(r),TN8.CRITICAL);break;case"MatchInteraction":case"GapMatchInteraction":case"GraphicGapMatchInteraction":a=this.checkMatchInteractions(e.mods[s]),a||TN8.log("ItemSaver._isItemStateValid "+e.mods[s].it+" has problem"+JSON.stringify(e)+" ; "+JSON.stringify(n)+" ; "+JSON.stringify(t)+" ; "+JSON.stringify(r),TN8.CRITICAL)}if(!a)return!1;t.push(e.mods[s].did)}if(_.contains(t,"RESPONSE_WC"))return TN8.Application.itemController.clearDataId(),!0;var l=_.invoke([t],"sort"),c=_.isEqual(l,o);return(c=c&&_.isEqual(r,i))?(TN8.Application.itemController.clearDataId(),!0):(TN8.log("ItemSaver._isItemStateValid DIDs are not equal"+JSON.stringify(e)+" ; "+JSON.stringify(n)+" ; "+JSON.stringify(t)+" ; "+JSON.stringify(r),TN8.CRITICAL),!1)},checkEquationEditor:function(e){return!(!e.r||"undefined"==typeof e.r.location)},checkMatchInteractions:function(e){var t=!0;return $("#interaction_"+e.did).find(".gap, .target").each(function(e,n){var i=$(this).data("matchgroup"),o=$(this).find(".choice");if(o.length>0)for(var r=0;r<o.length;r++)if(o.eq(r).data("matchgroup")!==i)return t=!1,!1}),t},isResponseValid:function(e,t,n){return 2!==this.checkFixWrongResponse(e,t,n)||(TN8.throw("Wrong response was being saved to this item.",TN8.errorType.WRONG_RESPONSE_ERROR),TN8.log("ItemSaver.sendSaveRequest . Wrong response was being saved, we caught it.",TN8.CRITICAL),!1)},checkFixWrongResponse:function(){var e=TN8.Application.itemController.get("itemIndex"),t=TN8.Application.itemController.get("controllers")||[],n=[];t.forEach(function(e){e.getModuleController?n.push(e.getModuleController().itemType):e.itemType&&n.push(e.itemType)});var i=TN8.Application.itemController.stateObj,o=i.getModules(),r=null;if(o){r=o.models;for(var s=0;s<r.length;s++){var a=r[s];if(a.get("itemId")!==e)for(var l=t,c=0,d=t.length,u="",h=null,p="ItemSaver::checkFixWrongResponse controllers: ";c<d;c++)return h=l[c],u+=h&&h.getModuleName?h.getModuleName()+"; ":"unidentified; ",TN8.log(p+u),TN8.log("Wrong response was being saved to this item. ItemController is in item "+e+" while response itemId is "+a.get("itemId"),TN8.CRITICAL),2;if(n.indexOf(a.get("itemType"))===-1)return TN8.log("Expected item types: "+n.join(",")),TN8.log('Wrong response was being saved to this item. One response is for itemType "'+a.get("itemType")+'" which is not in this item.',TN8.CRITICAL),2}}},checkJSONValidity:function(e){var t=!0,n=e.state;if(t=!_.isUndefined(n)&&t,t&&(t=!_.isUndefined(n.mods)&&"function"!=typeof n.mods&&t,t=!_.isUndefined(n.cv)&&"function"!=typeof n.cv&&t,t=!_.isUndefined(n.v)&&"function"!=typeof n.v&&t,t=!_.isUndefined(n.t)&&"function"!=typeof n.t&&t,t=_.isArray(n.mods)&&t)){var i=n.mods;t=0!==i.length&&t,_.each(i,function(e){t=!_.isUndefined(e.did)&&"function"!=typeof e.did&&t,t=!_.isUndefined(e.id)&&"function"!=typeof e.id&&t,t=!_.isUndefined(e.sid)&&"function"!=typeof e.sid&&t,t=!_.isUndefined(e.r)&&"function"!=typeof e.r&&t,t=!_.isUndefined(e.a)&&"boolean"==typeof e.a&&t})}return t}}};return e()}),define("controllers/NavigationController",["util/StateJSONBuilder","utils","views/SectionExitWarningView","controllers/ScoreController","controllers/ApplicationStatusController","util/ResponseValidator"],function(e,t,n,i,o,r){"use strict";var s=function(){return{warningView:new n,nav:null,navTarget:null,navHandler:null,_resetVariables:function(){this.navTarget=null,this.navHandler=null,this.nav=TestEngine.getNavigation()},thisClassName:"NavigationController",status:{NAVIGATING:1,IDLE:2},_preNavSetup:function(e){TN8.Dispatcher.off("performNavigation",this.handler_PerformNavigation).once("performNavigation",this.handler_PerformNavigation),TN8.Dispatcher.off("performCatNavigation",this.handler_PerformCatNavigation).once("performCatNavigation",this.handler_PerformCatNavigation),TN8.Dispatcher.trigger("tn.request.start")},applicationStatusInit:function(){o.registerEvent(o.actionNames.NavigateSubmitTest,"DoNavigateSubmitTest","ErrNavigateSubmitTest",TN8.Dispatcher),TN8.Dispatcher.off("DoNavigateSubmitTest").on("DoNavigateSubmitTest",this._navigate,this),TN8.Dispatcher.off("ErrNavigateSubmitTest").on("ErrNavigateSubmitTest",this._submitTestFailure,this),o.registerEvent(o.actionNames.NavigateLoadNextSection,"DoNavigateLoadNextSection","ErrNavigateLoadNextSection",TN8.Dispatcher),TN8.Dispatcher.off("DoNavigateLoadNextSection").on("DoNavigateLoadNextSection",this._navigate,this),TN8.Dispatcher.off("ErrNavigateLoadNextSection").on("ErrNavigateLoadNextSection",this._navigateNextSectionFailure,this),o.registerEvent(o.actionNames.NavigateTo,"DoNavigateTo","ErrNavigateTo",TN8.Dispatcher),TN8.Dispatcher.off("DoNavigateTo").on("DoNavigateTo",this._navigate,this),TN8.Dispatcher.off("ErrNavigateTo").on("ErrNavigateTo",this._didAutoSavePreventNavigation,this),o.registerEvent(o.actionNames.QueueNavigate,"DoQueueNavigate","ErrQueueNavigate",TN8.Dispatcher),TN8.Dispatcher.off("DoQueueNavigate").on("DoQueueNavigate",this._queueNavigate,this),TN8.Dispatcher.off("ErrQueueNavigate").on("ErrQueueNavigate",this._navigationPrevented,this),o.registerEvent(o.actionNames.NavigateStartSection,"DoNavigateStartSection","ErrNavigateStartSection",TN8.Dispatcher),TN8.Dispatcher.off("DoNavigateStartSection").on("DoNavigateStartSection",this._loadSection,this),TN8.Dispatcher.off("ErrNavigateStartSection").on("ErrNavigateStartSection",this._resetNavigationValues,this),o.registerEvent(o.actionNames.NavigateAvailableParts,"DoNavigateAvailableParts","ErrNavigateAvailableParts",TN8.Dispatcher),TN8.Dispatcher.off("DoNavigateAvailableParts").on("DoNavigateAvailableParts",this._toAvailableParts,this),TN8.Dispatcher.off("ErrNavigateAvailableParts").on("ErrNavigateAvailableParts",this._resetNavigationValues,this),o.subscribeCondition(o.actionNames.NavigateNext,this.thisClassName,this.status.IDLE),o.subscribeCondition(o.actionNames.NavigatePrev,this.thisClassName,this.status.IDLE),o.subscribeCondition(o.actionNames.NavigateTo,this.thisClassName,this.status.IDLE),o.subscribeCondition(o.actionNames.NavigateSubmitTest,this.thisClassName,this.status.IDLE),o.subscribeCondition(o.actionNames.NavigateLoadNextSection,this.thisClassName,this.status.IDLE),o.subscribeCondition(o.actionNames.NavigateStartSection,this.thisClassName,this.status.IDLE),o.subscribeCondition(o.actionNames.TurnOffModal,this.thisClassName,this.status.IDLE),o.subscribeCondition(o.actionNames.TurnOffProgressModal,this.thisClassName,this.status.IDLE),o.subscribeCondition(o.actionNames.NavigateAvailableParts,this.thisClassName,this.status.IDLE)},_startEndTestListener:function(){_.bindAll(this),TN8.fnOn("inform.testSubmittedSuccessfully",this._testSubmitedSuccessfully),TN8.fnOn("TestEngineSaveIncomplete",this._callTestEngineSave),TN8.fnOn("navigated.startTest",this._registerEvents),TN8.fnOn("cleanup.betweenTest",this._unregisterEvents)},_unregisterEvents:function(){$(document).off("tn.do.nav.endSection",this._navEnd),$(document).off("tn.do.nav.toItem",this._requestNavigateToItem),$(document).off("ItemController.ItemLoaded",this._navigationDone),$(document).off("tn.do.nav.next",this._requestLoadNextItem),$(document).off("tn.do.nav.prev",this._requestLoadPreviousItem),$(document).off("tn.do.nav.lastItem",this._requestloadLastItem),$(document).off("navigate.logoutTest",this._requestLogoutTest),$(document).off("navigate.submitTest",this._requestSubmitTest),$(document).off("navigate.nextStartSection",this._requestLoadSectionStart),$(document).off("navigate.loadNextSection",this._requestLoadNextSection),$(document).off("navigate.submitFinalResults",this._callTestEngineSubmit),$(document).off("navigate.availableParts",this._requestAvailableParts)},_registerEvents:function(){TN8.fnOn("tn.do.nav.endSection",this._requestEndSection),TN8.fnOn("tn.do.nav.toItem",this._requestNavigateToItem),TN8.fnOn("ItemController.ItemLoaded tn.endsection.loaded tn.startsection.loaded tn.endtest.loaded cleanup.betweenTest",this._navigationDone),TN8.fnOn("tn.do.nav.next",this._requestLoadNextItem),TN8.fnOn("tn.do.nav.prev",this._requestLoadPreviousItem),TN8.fnOn("tn.do.nav.lastItem",this._requestloadLastItem),TN8.fnOn("navigate.logoutTest",this._requestLogoutTest),TN8.fnOn("navigate.submitTest",this._requestSubmitTest),TN8.fnOn("navigate.submitFinalResults",this._callTestEngineSubmit),TN8.fnOn("navigate.nextStartSection",this._requestLoadSectionStart),TN8.fnOn("navigate.loadNextSection",this._requestLoadNextSection),TN8.fnOn("navigate.availableParts",this._requestAvailableParts),this.applicationStatusInit()},_requestLoadSectionStart:function(e,t){TN8.log("NavigationController._requestLoadSectionStart .",TN8.CRITICAL),o.execute(o.actionNames.NavigateStartSection,t)},_requestLoadNextItem:function(e){TN8.log("NavigationController._requestLoadNextItem .",TN8.CRITICAL),o.execute(o.actionNames.NavigateTo,{nav:"next"})},_requestNavigateToItem:function(e,t){TN8.log("NavigationController._requestNavigateToItem .",TN8.CRITICAL),o.execute(o.actionNames.NavigateTo,{nav:"toItem",itemId:t})},_requestLoadPreviousItem:function(e){TN8.log("NavigationController._requestLoadPreviousItem .",TN8.CRITICAL),o.execute(o.actionNames.NavigateTo,{nav:"prev"})},_requestloadLastItem:function(e){TN8.log("NavigationController._requestLoadPreviousItem .",TN8.CRITICAL),o.execute(o.actionNames.NavigateTo,{nav:"lastItem"})},_requestLogoutTest:function(e){TN8.log("NavigationController._requestLogoutTest .",TN8.CRITICAL),o.execute(o.actionNames.NavigateTo,{nav:"logoutTest"}),o.subscribeCondition(o.actionNames.EWS)},_requestSubmitTest:function(e){TN8.log("NavigationController._requestSubmitTest .",TN8.CRITICAL),o.execute(o.actionNames.NavigateSubmitTest,{nav:"submitTest"})},_requestEndSection:function(e){TN8.log("NavigationController._requestEndSection .",TN8.CRITICAL),o.execute(o.actionNames.NavigateTo,{nav:"endSection"})},_requestLoadNextSection:function(e,t){TN8.log("NavigationController._requestLoadNextSection .",TN8.CRITICAL),o.execute(o.actionNames.NavigateLoadNextSection,$.extend({nav:"loadNextSection"},t))},_requestAvailableParts:function(e,t){TN8.log("NavigationController._requestAvailableParts .",TN8.CRITICAL),
o.execute(o.actionNames.NavigateAvailableParts,$.extend({nav:"availableParts"},t))},_navigate:function(e){TN8.log("NavigationController._navigate .",TN8.CRITICAL),$(document).off("tn.save.success",this.tryNavigateAgain),o.statusChange(this.thisClassName,this.status.NAVIGATING),$(document).trigger("do.disableInteraction"),$(document).trigger("tn.nav.start"),this.informNavTarget(e.nav),TN8.Application.DataProvider.getResponses(this._setItemCallback.bind(this,e))},informNavTarget:function(e){switch(e){case"toItem":"endSection"===TN8.Application.currentContent||"endtest"===TN8.Application.currentContent?$(document).trigger("inform.navToFirstItem"):$(document).trigger("inform.navToItem");break;case"next":var t=TN8.utils.isCat(),n=TestEngine.getNavigation().getCurrentSection().getAssessmentItemRefs().length;!t&&TN8.utils.getCurrentItemOrder()!==n||t?$(document).trigger("inform.navToItem"):o.execute(o.actionNames.TurnOnModal);break;case"prev":$(document).trigger("inform.navToItem");break;case"lastItem":$(document).trigger("inform.navToFirstItem");break;default:o.execute(o.actionNames.TurnOnModal)}},_isResponseValid:function(e,n){var i=n.nav;return null!==e&&(!t.isCat()||"item"!==TN8.Application.getCurrentContent()||"submitTest"===i||"logoutTest"===i||n.timerForceMove||t.isCat()&&"item"===TN8.Application.getCurrentContent()&&TN8.Application.itemController.isItemAnswered())},_resetNavigationValues:function(){o.statusChange(this.thisClassName,this.status.IDLE),TN8.Dispatcher.restart(),$(document).trigger("tn.loadingModal.off")},_navigationPrevented:function(){TN8.log("NavigationController._navigationPrevented",TN8.CRITICAL)},_didAutoSavePreventNavigation:function(e){o.execute(o.actionNames.QueueNavigate,e)},_queueNavigate:function(e){this._resetVariables(),this._preNavSetup(),o.execute(o.actionNames.TurnOnModal),this.navHandler=this.tryNavigateAgain,this.navTarget={args:e}},tryNavigateAgain:function(e){o.execute(o.actionNames.NavigateTo,this.navTarget.args)},_setItemCallback:function(e,t,n){return $(document).trigger("inform.gotCurResponse"),this._isResponseValid(n,e)?!TN8.Application.getCurrentContentView()||!TN8.Application.getCurrentContentView().getSaveToLocation||"saveAllModules"!==TN8.Application.getCurrentContentView().getSaveToLocation()||r.isItemStateValid(n)&&r.isResponseValid()?!TN8.utils.isCat()||"toItem"!==e.nav&&"next"!==e.nav&&"prev"!==e.nav?void("toItem"===e.nav?TestEngine.setItemIdCallback(n,e.itemId,this._loadItemSuccess):"next"===e.nav?TestEngine.setNextItemIdCallback(n,this._loadItemSuccess):"prev"===e.nav?TestEngine.setPrevItemIdCallback(n,this._loadItemSuccess):"lastItem"===e.nav?TestEngine.setLastItemIdCallback(n,this._loadItemSuccess):"logoutTest"===e.nav?this._logoutTest(n):"submitTest"===e.nav?this._submitTest(n):"endSection"===e.nav?this._checkSkipEnd(n,$.proxy(this._navEnd,this,{itemJSON:n})):"loadNextSection"===e.nav&&this._loadNextSection(e)):void TestEngine.prepNavigateData(n,this._loadItemSuccess,e.nav,e.itemId):(TN8.throw("getResponses.getResponses . "+JSON.stringify(n),TN8.errorType.WRONG_RESPONSE_ERROR3),void this._resetNavigationValues()):(TN8.log("NavigationController._setItemCallback response was not valid, maybe cat with empty response, or response is null because validation didnt pass.",TN8.CRITICAL),void this._resetNavigationValues())},_loadItemSuccess:function(n,i){var o=n?n.msgCode:null,r=n.item;if(i||this.addScore(n),TN8.log("NavigationController._loadItemSuccess . ",TN8.CRITICAL),TN8.Application.error.successCheck(n,null,o)){if(r&&!t.checkIdInCurrentSection(r))return;var s=e.getInstance().getScoredResponse(n);if(r)if(this._resetVariables(),this._preNavSetup(),this.navHandler=this._triggerNavToItem,this.navTarget=r,i){var a=TestEngine.getNavigation().getCurrentSection().getCATData();a&&(delete a.prevItems,$(document).trigger("testState.setCATData",a)),TN8.Dispatcher.trigger("sendToEngine",{fullData:n,itemJSON:s,overrideSaveTo:"saveAllModules"})}else TN8.Dispatcher.trigger("sendToEngine",{itemJSON:s});else this._checkSkipEnd(s,$.proxy(this._navEnd,this,{itemJSON:s}));this.sendCatInfo(n)}else this._navigationDone()},_loadFirstItem:function(e){TN8.log("NavigationController._loadFirstItem .",TN8.IMPORTANT),this._resetVariables(),$(document).trigger("inform.loadFirstItem");var t=this.nav.getCurrentSection(),n=TN8.TestStateController.getUnavailableItemsInSection(t.getIdentifier()),i=window.TestEngine.getAuthentication().getSession().getResumeOverride(),o=i?null:TN8.TestStateController.resumeRestrictionController._getFirstUnansweredItem(t.getIdentifier());TestEngine.setFirstItemCallback(t,this._loadFirstItemSuccessful,n,o)},_loadFirstItemSuccessful:function(e){var n=e?e.msgCode:null;TN8.log("NavigationController._loadFirstItemSuccessful . ",TN8.IMPORTANT);var i=TN8.Application.error.successCheck(e,null,n);i&&e.item&&t.checkIdInCurrentSection(e.item)?(this._preNavSetup(),this.navTarget=e.item,this.navHandler=this._triggerNavToItem,TN8.Dispatcher.trigger("performNavigation"),this.sendCatInfo(e)):i&&!e.item&&this._endSectionTest()},_loadSectionStart:function(){TN8.log("NavigationController._loadSectionStart .",TN8.IMPORTANT),TestEngine.getNavigation().getCurrentSection()._skipStart?($(document).trigger("testState.setSectionStartTime",(new Date).toUTCString()),$(document).trigger("inform.nextStartSection"),this._loadFirstItem()):(this._resetVariables(),this._preNavSetup(),this.navTarget="startSection",this.navHandler=this._navigateToRoute,TN8.Dispatcher.trigger("performNavigation"))},_forceSectionStart:function(e){TN8.log("NavigationController._forceSectionStart .",TN8.IMPORTANT),this._resetVariables(),this.navTarget=e,this._navSectionLoadStart()},_loadNextSection:function(e){TN8.log("NavigationController._loadNextSection .",TN8.IMPORTANT),o.statusChange(this.thisClassName,this.status.NAVIGATING),this._resetVariables(),this._preNavSetup(),$(document).trigger("caliper.sectionSubmitted"),$(document).trigger("testState.setSectionVisited",!0),$(document).trigger("testState.setSectionEndTime",(new Date).toUTCString()),$(document).trigger("tn.section.next"),this.navTarget=this.nav.getCurrentSection().getNextSibling(),this.navHandler=this._navSectionLoadStart,TN8.Application.setCurrentContent(TN8.Application.CONTENT_SECTION_START),TN8.Application.setResumeLocation(this.navTarget.getFirstItem().getIdentifier()),TN8.Dispatcher.trigger("sendToEngine",$.extend({nextSection:!0},e))},_navSectionLoadStart:function(){$(document).trigger("tn.endsection.exit"),this.nav.navigateSection(this.navTarget),this._loadSectionStart()},_loadSection:function(e){TN8.log("NavigationController._loadSection .",TN8.IMPORTANT),t.preventDefault(e),o.statusChange(this.thisClassName,this.status.NAVIGATING),this._resetVariables(),this._preNavSetup();this.nav.getCurrentSection();this.navTarget=e.data.section||this.nav.getCurrentSection(),this.navHandler=this._navigateToSection,e.sectionLoaded=!0,TN8.Dispatcher.trigger("performNavigation",e)},beginTest:function(){var e=TestEngine.getForcedResumedSection();if(e)this._forceSectionStart(e);else{var t=this._getResumelocation();t?this._loadResumeLocation(t):this._loadSectionStart()}},_loadResumeLocation:function(e){TN8.log("NavigationController._loadResumeLocation .",TN8.IMPORTANT),this._resetVariables(),this._preNavSetup(),$(document).trigger("tn.test.resume");var t=TN8.utils.getResumeSection(e);if(!t)return void TN8.log("NavigationController._loadResumeLocation . section is invalid"+typeof t,TN8.IMPORTANT);if(e&&"item"!==e.location)$(document).trigger("tn.loadingModal.on"),this.nav.navigateSection(t),this.navTarget=e.location,this.navHandler=this._navigateToRoute,TN8.Dispatcher.trigger("performNavigation");else{var n=TN8.TestStateController.getUnavailableItemsInSection(t.getIdentifier());$(document).trigger("inform.navToRL"),this.nav.navigateSection(t);var i=TN8.utils.isCat()?TestEngine.checkForResponseToBeScored(n,TN8.TestStateController.getResumeLocation()):{};i.shouldSendResponse?(t.getCATData()||t.setCATData(TN8.TestStateController.getCATData()),TestEngine.resumeAndPrepNavigateData(t,this._loadResumeLocationSuccessful,n,i.response,"next",i.itemId)):TestEngine.setResumedItemIdCallback(t,this._loadResumeLocationSuccessful,n)}},_loadResumeLocationSuccessful:function(n,i){var o=n?n.msgCode:null,r=n.item,s=n.section;if(TN8.log("NavigationController._loadResumeLocationSuccessful . ",TN8.IMPORTANT),TN8.Application.error.successCheck(n,null,o)){if(i&&n.response){var a=e.getInstance().getScoredResponse(n);return TN8.Dispatcher.trigger("sendToEngine",{fullData:n,itemJSON:a,overrideSaveTo:"saveAllModules"}),void this.sendCatInfo(n)}if(null!==r){if(this.nav.navigateSection(s),!t.checkIdInCurrentSection(r))return;this.navHandler=this._triggerNavToItem,this.navTarget=r}else this.nav.navigateSection(s),this.navHandler=this._endSectionTest;TN8.Dispatcher.trigger("performNavigation")}this.sendCatInfo(n)},_logoutTest:function(e){TN8.log("NavigationController._logoutTest .  ",TN8.CRITICAL),this._resetVariables(),this._preNavSetup(),$(document).trigger("testState.setPartExited",!0),this.navHandler=this._callTestEngineSave;var t=TestEngine.getNavigation().getCurrentSection().getCATData();t&&(delete t.prevItems,$(document).trigger("testState.setCATData",t)),TN8.Dispatcher.trigger("sendToEngine",{isLastCall:!0,itemJSON:e})},_submitTest:function(e){TN8.log("NavigationController._submitPart .  ",TN8.CRITICAL),this._resetVariables(),this._preNavSetup(),$(document).trigger("testState.setSectionVisited",!0),$(document).trigger("testState.setSectionEndTime",(new Date).toUTCString()),$(document).trigger("testState.setPartComplete",!0),$(document).trigger("testState.setPartEndTime",(new Date).toUTCString()),$(document).trigger("caliper.sectionSubmitted");var t=TN8.Application.DataProvider.getUnfinishedParts(),n=0===t.length;this.navHandler=n?this._callTestEngineSubmit:this._callTestEnginePartSubmit,e&&e.overrideSaveTo?TN8.Dispatcher.trigger("sendToEngine",{isLastCall:n,itemJSON:e,overrideSaveTo:e.overrideSaveTo}):TN8.Dispatcher.trigger("sendToEngine",{isLastCall:n,itemJSON:e})},_submitAllTest:function(e){this.navHandler=this._callTestEngineSubmit,TN8.Dispatcher.trigger("sendToEngine",{isLastCall:!0,itemJSON:e})},_submitTestFailure:function(){TN8.throw("Submit Test Failure",TN8.errorType.SUBMIT_TEST_FAILURE)},_navigateNextSectionFailure:function(){TN8.throw("Navigate Next Section Failure",TN8.errorType.NAVIGATE_NEXT_SECTION)},_callTestEngineSave:function(e,t,n){var i=n||this._toLogout;TN8.log("NavigationController.callTestEngineSave .  ",TN8.CRITICAL),$(document).trigger("inform.engineLogout"),TestEngine.saveIncompleteTestResults(i,this._testEngineFailure,t)},_callTestEnginePartSave:function(){TN8.log("NavigationController.callTestEnginePartSave .  ",TN8.CRITICAL),$(document).trigger("inform.testSubmitted")},_callTestEngineSubmit:function(){TN8.log("NavigationController.callTestEngineSubmit .  ",TN8.CRITICAL),$(document).trigger("inform.engineSubmit"),TestEngine.submitFinalTestResults(this._testSubmitedSuccessfully,this._testEngineFailure)},_callTestEnginePartSubmit:function(){TN8.log("NavigationController.callTestEnginePartSave part only.  ",TN8.CRITICAL),TN8.Application.testLoaded()},_testEngineFailure:function(){$(document).trigger("tn.loadingModal.off"),TN8.throw("Connection Lost",TN8.errorType.LOST_CONNECTION_IN_TEST)},_toLogout:function(){$(document).trigger("tn.route.to","logout")},_toAvailableParts:function(){TN8.Application.testLoaded()},_testSubmitedSuccessfully:function(e,t){t?$(document).trigger("perform.exitApplication"):($(document).trigger("perform.betweenTestCleanup"),$(document).trigger("inform.testSubmitted"))},_checkSkipEnd:function(e,t){TestEngine.getNavigation().getCurrentSection()._skipEnd?TN8.utils.isLastSection()?($(document).trigger("testState.setPartComplete",!0),$(document).trigger("testState.setPartEndTime",(new Date).toUTCString()),TN8.Application.DataProvider.checkAllPartsComplete()?this._submitTest(e):this._triggerAvailableParts()):this._loadNextSection(e):t()},_triggerAvailableParts:function(){TN8.log("NavigationController._triggerAvailableParts .  ",TN8.CRITICAL),o.statusChange(this.thisClassName,this.status.IDLE),$(document).trigger("navigate.availableParts")},_navEnd:function(e){this._resetVariables(),this._preNavSetup(),this.navHandler=this._endSectionTest,TN8.Dispatcher.trigger("sendToEngine",e)},_endSectionTest:function(){$(document).trigger("tn.endsection.show"),TN8.utils.isLastSection()?this.navTarget="endtest":this.navTarget="endSection",this._navigateToRoute()},_callbackWrapper:function(e){TN8.Dispatcher.once("tn.request.queue.clear",e),TN8.Dispatcher.trigger("tn.request.complete")},_triggerNavToItem:function(){$(document).trigger("tn.header.nav.toItem",this.navTarget)},_navigateToSection:function(){this.nav.navigateSection(this.navTarget),this._loadFirstItem()},_navigateToRoute:function(){$(document).trigger("tn.route.to",this.navTarget)},handler_PerformCatNavigation:function(e){TN8.Dispatcher.off("performCatNavigation",this.handler_PerformCatNavigation),TN8.Dispatcher.off("performNavigation",this.handler_PerformNavigation),e.item?(this.navHandler=this._triggerNavToItem,this.navTarget=e.item):this.navHandler=$.proxy(this._checkSkipEnd,this,{overrideSaveTo:"saveTestState"},this._endSectionTest),this.sendCatInfo(e),this._callbackWrapper(this.navHandler)},handler_PerformNavigation:function(){TN8.Dispatcher.off("performNavigation",this.handler_PerformNavigation),this._callbackWrapper(this.navHandler)},sendCatInfo:function(e){this.sendTestLength(e),this.sendReviewRange(e)},sendTestLength:function(e){var t={min:e.minSectionLength,max:e.maxSectionLength,label:e.onScreenAdaptiveLabel};$(document).trigger("tn.test.cat.length",t)},sendReviewRange:function(e){$(document).trigger("tn.test.cat.range",e)},_navigationDone:function(){o.statusChange(this.thisClassName,this.status.IDLE),$(document).trigger("nav.done")},addScore:function(e){return e.score||null===i.score||(e.score=i.score),e},_getResumelocation:function(){return TN8.TestStateController.getResumeLocationOverall()}}},a=s();return a._startEndTestListener(),a}),define("text!tpl/combined.html",[],function(){return'\n<script type="text/template" id="ac-template">\n    <div id="ac-running" class="modal hide loading" data-backdrop="static" role="dialog">\n        <div class="modal-header">\n            <div id="ac-title" class="modal-title" aria-hidden="true" role="alert"></div>\n        </div>\n        <div class="modal-body">\n            <div id="indeterminateProgressDiv">\n                <div id="indeterminateProgressBar"></div>\n            </div>\n        </div>\n        <div class="modal-footer"></div>\n    </div>\n</script>\n\n<script type="text/template" id="checkAnswer-template">\n<div id="feedbackDraggable" class="tn8-draggable-modal">\n    <div class="modal-focus-anchor visuallyhidden" tabindex="-1" aria-label="<%= $.i18n.t(\'checkAnswer:checkAnswer\')%>"></div>\n    <button id="feedbackClose" type="button" class="close" aria-label="<%= $.i18n.t(\'generalWords:close\')%>">x</button>\n    <h2 class="tn8-draggable-modal-header"><%= $.i18n.t(\'checkAnswer:checkAnswer(s)\')%></h2>\n    <div id="feedbackResizable" role="dialog" aria-labelledby="checkAnswerTitle" aria-hidden="true">\n      <div class="checkAnswer-body" disabled="disabled"> \n      </div>\n    </div>\n</div>\n</script>\n\n<script type="text/template" id="practicetemplate">\n    <h1 id="itemCanvasTitle" class="sr-only visuallyhidden" tabindex="-1"><%= $.i18n.t(\'generalWords:practiceTest\')%></h1>\n    <button id="sign-in-btn" class="btn btn-medium"><%= $.i18n.t(\'logout:backToSignIn\')%></button><br><br>\n    <div id="practiceTestContainer">\n        <iframe id="practice-test-iframe" name="practice-test-iframe" frameborder="0" scrolling="yes"></iframe>\n        <div class="iframe-shadow shadow-top"></div>\n        <div class="iframe-shadow shadow-bottom"></div>\n    </div>\n</script>\n\n<script type="text/template" id="appchecktemplate">\n    <div class="appCheckWrapper">\n        <button id="sign-in-btn" class="btn btn-medium"><%= $.i18n.t(\'logout:backToSignIn\')%></button>\n        <h2 class="appCheckTitle"><%= $.i18n.t(\'appCheck:appCheckTitle\')%></h2>\n        <div id="appCheckContainer" class="account-container appCheckContainer">\n            <div class="wrapper">\n                <div><%= $.i18n.t(\'appCheck:enterIdentifier\')%></div><br>\n                <label for="configIdentifier"><%= $.i18n.t(\'appCheck:configIdentifierLabel\')%>:</label>\n                <input id="configIdentifier" type="text" maxlength="36" placeholder="<%= $.i18n.t(\'appCheck:configIdentifier\')%>" autocapitalize="none" autocomplete="off"/ >\n                <span class="configErrorIcon"><i class="icon-exclamation-sign"></i></span>\n                <div class="configErrorMsg" tabindex="-1" role="alert"></div><br>\n                <button id="runAppCheck" class="button btn btn-primary btn-large"><%= $.i18n.t(\'appCheck:runAppCheck\')%></button>\n                <div id="appCheckResultsContainer"></div>\n            </div>\n        </div>\n    </div>\n</script>\n\n\n\n<script type="text/template" id="timerDiv">\n        <div id="timerDiv" class="hidden  <% if(isK2) { %> "k2-timer" <% } %>"  aria-hidden="true" ></div>\n</script>\n\n\n\n<script type="text/template" id="header_toggleTimer">\n    <div class="timerApparatus">\n        <div id="testTimer" class="timeDisplay timer-display-elem"> </div>\n        <button aria-label="<%= $.i18n.t(\'header:showTimer\') %>" aria-controls="timeDisplay" aria-expanded="false" class="toggleTimerButton btn" id="toggleButton" data-toggle="tooltip" title="<%= $.i18n.t(\'header:showTimer\') %>">\n            <i class="tn8-icon-clock"></i>\n        </button>\n    </div>\n</script>\n\n<script type="text/template" id="header_standardTimer">\n    <div id="testTimerDiv" style="display:inline-block">\n        <span id="testTimer" class="test-timer-display-elem"></span>\n        <span class="test-timer-display-elem"> | </span>\n    </div>\n</script>\n\n\n<script type="text/template" id="multibuttontemplate">\n    <div id="<%= tool %>Multi" class="btn-group multiButton" data-toggle="buttons-radio" role="menubar">\n    <% _.each(buttons, function(button) { %>\n        <a id="<%= button.tool %>Tool" href="#<%= button.tool %>" class="btn" data-toggle="tooltip" title="<%= button.toolTip %>" role="menuitem" aria-disabled="<%= button.buttonEnabled %>" aria-pressed="false">\n        <i class="<%= button.iconClass %>"></i></a>\n    <% }); %>\n    </div>\n</script>\n\n<script type="text/template" id="ti_calculator">\n    <div id="calculatorDiv" class = "calculatorDiv" style="position:fixed; top:10%; left:50%; z-index:1040;" tabIndex="0">\n        <div class="displayDiv" id="displayDiv">\n            <canvas id="display" class="display" width="288" height="192"></canvas>\n        </div>\n    </div>\n</script>\n\n<script type="text/template" id="teststemplate">\n    <div class="row available-tests">\n        <div class="row span10 offset1">\n            <h1 id="itemCanvasTitle" class="sr-only visuallyhidden" tabindex="-1"><%= $.i18n.t(\'availableTest:availableTests\')%></h1>\n            <h1 class="available-tests-title pull-left" aria-hidden="true"><%= $.i18n.t("availableTest:availableTests") %></h1>\n            <button class="btn refresh-available-tests pull-right" aria-label="<%= $.i18n.t(\'availableTest:refresh\') %>" title="<%= $.i18n.t(\'availableTest:refresh\') %>" ><i class="icon-refresh"></i><%= $.i18n.t("availableTest:refresh") %></button>\n        </div>\n        <div class="row span10 offset1">\n            <ul id="tableTests" class="table-tests">\n            </ul>\n            <span class="completed-tests-message pull-right" aria-label="<%= $.i18n.t(\'availableTest:completedTestsMessage\') %>"><%= $.i18n.t("availableTest:completedTestsMessage") %></span>\n        </div>\n    </div>\n</script>\n\n<script type="text/template" id="agreementtemplate">\n    <div id="agreementModal" class="modal hide fade" role="dialog" aria-labelledby="agreementModalLabel" aria-hidden="true" role="dialog">\n\t<div class="modal-header custom-modal-header">\n\t    <button type="button" role="button" class="btn custom-modal-cancel icon-remove" data-dismiss="modal"><%= $.i18n.t("cancel")%></button>\n\t    <h1 id="agreementModalLabel" class="modal-title" aria-hidden="true" style=" padding-top: 10px;padding-bottom: 10px;color:"><%= $.i18n.t("termsAndConditions:termsandconditions")%></h1>\n\t</div>\n\t<div class=" custom-modal-body modal-body">\n\n\n\t    <span class="custom-modal-title"><%= $.i18n.t("actTandC:readStatement")%></span></br>\n\t    <p class="custom-modal-para" >\n\t\t<%= $.i18n.t("actTandC:actTermsAndConditions")%>\n\t    </p>\n\t    <p>\n\t\t<span class="custom-modal-title"><%= $.i18n.t("actTandC:enterName")%></span></br>\n\t\t<input id="agreementName" class="custom-modal-text" type="text"/>\n\t    </p>\n\t    <p>\n\n\t\t<span class="custom-modal-right" ><%= $.i18n.t("actTandC:actRightsReserved")%></span>\n\n\t    </p>\n\t</div>\n\n\t<div class="modal-footer custom-modal-footer">\n\t    <button id="agreementBtn" class="btn btn-primary btn-large " disabled="disabled" ><%= $.i18n.t("accept")%>   <span class="icon-arrow-right"></span></button>\n\t</div>\n    </div>\n\n</script>\n\n\n<script type="text/template" id="logouttemplate">\n\n    <div class="row" style="margin-top: 28px;">\n    <h1 id="itemCanvasTitle" class="sr-only visuallyhidden" tabindex="-1"><%= $.i18n.t(\'generalWords:logout\')%></h1>\n\n\t<div class="span8 signoutpage">\n        <h4 aria-label="<%= $.i18n.t(\'logout:logoutText\')%>"><%= $.i18n.t(\'logout:logoutText\') %></h4>\n        <button id="login-link" class="btn" aria-label="<%= $.i18n.t(\'logout:backToSignIn\')%>" data-toggle="tooltip" title="<%= $.i18n.t(\'logout:backToSignIn\')%>"><%= $.i18n.t(\'logout:backToSignIn\')%></button>\n\t</div>\n    </div>\n\n</script>\n\n\n<script type="text/template" id="exittemplate">\n    <div class="modal-header custom-modal-header">\n        <span id="exitModalLabel" class="modal-title" aria-hidden="true" style="padding-top:10px;padding-bottom:10px;font-size:24px;margin:0;padding:0;line-height:30px;font-weight:bold;"><%= $.i18n.t("exitTestModal:exitTest")%></span>\n        <button id="dismissModal" role="button" aria-label="<%= $.i18n.t(\'exitTestModal:cancelAndCloseDialog\')%>" style="position:absolute;top:14px;right:14px">\n            <span class="bold" style="font-size:16px;" role="presentation">Ã—</span>\n            <%= $.i18n.t("generalWords:cancel")%>\n        </button>\n    </div>\n\n    <div class="custom-modal-body modal-body">\n        <div>\n            <% if ( hasRR ) { %>\n                <h4 aria-hidden="false"><%= $.i18n.t("exitTestModal:resumeRestriction",{ min: RRtime }) %></h4>\n            <% } else { %>\n                <h4 aria-hidden="false"><%= $.i18n.t("exitTestModal:exitMsg")%></h4>\n            <% } %> \n        </div>\n    </div>\n\n    <div class="modal-footer custom-modal-footer">\n        <button class="btn btn-primary btn-large" id="returnLater" aria-label="<%= $.i18n.t(\'exitTestModal:saveAndReturn\')%>"><%= $.i18n.t("exitTestModal:saveAndReturn")%></button>\n    </div>\n</script>\n\n<script type="text/template" id="exitalerttemplate">\n    <div class=\'modal hide in\' id=\'exitAlertModal\' role=\'dialog\' aria-live="assertive" aria-hidden=\'false\' data-backdrop="static">\n        <div class="modal-header">\n            <h1 aria-hidden=\'true\' class="modal-title" style="float:left; font-weight:normal;margin:5px 0; white-space:nowrap;">\n                <%= section ? $.i18n.t("endSection:sectionSubmitWarning") : $.i18n.t("endSection:testSubmitWarning") %>\n            </h1>\n            <div style="clear:both; width:40px;"></div>\n        </div>\n        <div class="custom-modal-body modal-body" style=\'padding:20px\' id="exit-alert-label">\n            <span class="visuallyhidden"><%= section ? $.i18n.t("endSection:sectionSubmitWarning") : $.i18n.t("endSection:testSubmitWarning") %></span>\n            <div>\n                <%= section ? $.i18n.t("endSection:verifySectionSubmit") : $.i18n.t("endSection:verifyTestSubmit") %>\n            </div>\n            <div>\n                <%= section ? $.i18n.t("endSection:noReturnSection") : $.i18n.t("endSection:noReturnTest") %>\n            </div>\n        </div>\n        <div class="modal-footer custom-modal-footer">\n            <div>\n                <button class="btn btn-large continue-no" style=\'float:left\' aria-label="<%= $.i18n.t(\'endSection:noCancel\') %>"><%= $.i18n.t("endSection:noCancel") %></button>\n                <button class="btn btn-success btn-large continue-yes" aria-label="<%= section ? $.i18n.t(\'endSection:yesSubmitSection\') : $.i18n.t(\'endSection:yesSubmitFinalAnswers\') %>"><%= section ? $.i18n.t("endSection:yesSubmitSection") : $.i18n.t("endSection:yesSubmitFinalAnswers") %></button>\n            </div>\n        </div>\n    </div>\n</script>\n\n<script type="text/template" id="startsectiontemplate">\n    <div class="row-fluid">\n        <% if ( sectionRubrick ) { %>\n            <div id="skipToInstructions" class="lang<%= $.i18n.lng()%>">\n                <a href="#sectionRubric" ><%= $.i18n.t("header:skipToInstructions") %></a>\n            </div>\n        <% } %>\n        <h1 id="itemCanvasTitle" class="sr-only visuallyhidden" tabindex="-1"><%= $.i18n.t("startTest:startSection") %></h1>\n        <div class="span12">\n            <div class="span8 offset2 bordered gradient round4 well">\n                <div class="span8 offset2 bordered round4" style="background-color: #FFF">\n                    <div class="row-fluid" style="padding-top: 20px; padding-bottom: 10px;">\n                        <h2 class="text-center" style="word-wrap: break-word;"><span class="sr-only"><%= $.i18n.t("start") %></span><%= sectionTitle %></h2>\n                    </div>\n                    <div class="row-fluid" style="border-bottom: 2px #ccc dashed; padding-bottom: 20px;">\n\n                        <% if (isNumQuestions || totalSectionTime) {%>\n\n                        <%if(totalSectionTime && totalSectionTime.length > 10)\n                        {%>\n                        <div class="alert alert-info" style="width: 60%; margin-left: auto; margin-right: auto; font-size: 18px; padding-right: 14px;text-align:center">\n                            <% if (isNumQuestions) {%>\n                            <p style="margin-bottom: 0;"><%=  $.i18n.t("startSection:numQuestions",{"count":numQuestions}) %></p>\n                            <% } %>\n                            <% if (totalSectionTime) {%>\n                            <p style="margin-bottom: 0;"><%= totalSectionTime %></p>\n                            <% } %>\n                        </div>\n                        <%}else{%>\n                        <div class="alert alert-info" style="width: 35%; margin-left: auto; margin-right: auto; font-size: 18px; padding-right: 14px;text-align:center">\n                            <% if (isNumQuestions) {%>\n                            <p style="margin-bottom: 0;"><%=  $.i18n.t("startSection:numQuestions",{"count":numQuestions}) %></p>\n                            <% } %>\n                            <% if (totalSectionTime) {%>\n                            <p style="margin-bottom: 0;"><%= totalSectionTime %></p>\n                            <% } %>\n                        </div>\n                        <%}%>\n                        <% } %>\n                        <div id="startSectionError" class="alert alert-block alert-error fade in hidden" role="alert" aria-live="assertive"></div>\n\n                        <div id="sectionRubric" style="width: 81%; margin-left: auto; margin-right: auto;" tabindex="-1">\n                            <% if ( sectionRubrick ) { %>\n                                <p style="font-size: 16px;"><%= sectionRubrick %></p>\n                            <% } %>\n                            <%= (section.getSealCode() && sealCode !== "") ? "<div class=\'center\'><input id=\'sealCode\' style=\'text-align:center\' class=\'lang" + $.i18n.lng()+"\' type=\'text\' placeholder=\'" + $.i18n.t("startSection:enterSealCode") + "\' maxlength=\'4\' autocorrect=\'off\' autocomplete=\'off\' autocapitalize=\'off\'/></div>" : "" %>\n                        </div>\n                    </div>\n                    <div class="row-fluid" style="background-color: #efefef; padding-top: 20px; padding-bottom: 30px;">\n                        <div style="width: 81%; margin-left: auto; margin-right: auto; font-size:16px;">\n                            <% if (totalSectionTime && totalSectionTime !== $.i18n.t("startSection:notTimed") && totalSectionTime !== \'\') { %>\n                            <p style="padding-bottom: 5px;"><%= $.i18n.t("startSection:timedSectionMessage")%></p>\n                            <% } %>\n                            <div class="center">\n                                <button id="startSectionBtn" class="btn btn-primary btn-large" aria-label=\'<%=  $.i18n.t("startSection:startsectionBtn") %>\'><%=  $.i18n.t("startSection:startsectionBtn") %></button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</script>\n\n<script type="text/template" id="itemtemplate">\n    <div id="itemCanvas" class="itemCanvas">\n    <h1 id="itemCanvasTitle" class="sr-only visuallyhidden" tabindex="-1"></h1>\n\t<div id="itemCanvasBody" class="itemCanvas-body">\n\t    <%= item.itemBodyHtml %>\n\t</div>\n\n\t<div class="itemCanvas-footer">\n\t</div>\n\t</div>\n\n    <% if ( item.itemBodyExtraHtml ) { %>\n    <div id="extraHtml" aria-hidden="true"><%= item.itemBodyExtraHtml %></div>\n    <% } %>\n\n</script>\n\n<script type="text/template" id="itemstemtemplate">\n    <%= itemBodyStemHtml %>\n</script>\n\n\n<script type="text/template" id="teststabletemplate">\n    <span class="test-title"><%= name %></span>\n    <button class="<%= btnClasses %>" <%= (disabled === \'disabled\' ? \'aria-disabled="true" tabindex="-1"\' : \'\') %> data-testid="<%= testId %>">\n    <%= btnText %>\n    <% if ( locked === true ) { %>\n    <span class="sr-only"><%= lockIconSRText %></span>\n    <div class="startTest-locked">\n        <i class="icon-lock"></i>\n    </div>\n    <% } %>\n    </button>\n</script>\n\n<script type="text/template" id="introtemplate">\n <% if ( !isK2 ) { %>\n <div class="row">\n    <div id="skipToInstructions" class="lang<%= $.i18n.lng()%>">\n        <a href="#" ><%= $.i18n.t("header:skipToInstructions") %></a>\n    </div>\n\n\t<div class="span12">\n    <h1 id="itemCanvasTitle" class="sr-only visuallyhidden" tabindex="-1"><%= $.i18n.t("startTest:startTest") %></h1>\n\t<div class="alert alert-info center" style="width:644px;margin:28px auto 18px auto;">\n        <% if ( hasRR && !hasOR ) { %>\n            <h2><%= $.i18n.t("startTest:resumeRestriction",{ min: RRtime }) %></h2>\n        <% } else { %>\n            <h2><%= welcomeMsg %></h2>\n        <% } %>\n    </div>\n    <div class="testcommence-container clearfix startTest-flex" style="margin:28px auto;">\n        <div class="pad8 startTestCell gradient">\n            <span><%= title %></span>\n            <p><%= totalSections %></p>\n\n            <% if ( isShowQuestion ) { %>\n                <p><%= totalQuestions %></p>\n            <% } %>\n\n            <% if ( timeString ) { %>\n                <p style="margin-bottom:0;"><%= $.i18n.t("startTest:timedTestMsg",{"time":timeString})%></p>\n            <% } %>\n        </div>\n        <div class="pad8 startTestCell gradient">\n            <% if ( vsr ) { %>\n                <div class="scorable-epat-name-container">\n                   <h4><%= $.i18n.t("startTest:enterYourName") %></h4>\n                   <%= $.i18n.t("startTest:name") %><input type="text" name="studentName" id="studentName" aria-label="<%= $.i18n.t(\'startTest:studentName\') %>" placeholder="<%= $.i18n.t(\'startTest:studentName\') %>" maxlength="100" value="<%= $.i18n.t(\'epat:guest\')%>"/>\n                </div>\n            <% } %>\n            <button id="startTestBtn" aria-label="<%= startBtnText%>" class="btn btn-primary btn-large"><%= startBtnText%> &raquo;</button>\n        </div>\n    </div>\n\n     </div>\n</div>\n<% } else { %>\n<div class="k2-startTest">\n    <div id="startTestText"><%=startText%></div>\n    <div style="padding: 70px;">\n        <button id="startTestBtn" aria-label="<%= startBtnText%>" class="btn btn-primary btn-large k2-button">\n            <i role="presentation" style="font-size:44px; line-height:60px;" class="icon-arrow-right"></i>\n        </button>\n    </div>\n</div>\n<% } %>\n</script>\n\n<script type="text/template" id="termsAndConditions">\n<div id="TermDialog" role="dialog">\n    <div class="tn8-fixed-modal modal fade modal-document" id="TermModal" role="document" aria-live="assertive" aria-hidden="true" tabindex="-1" data-backdrop="static" data-keyboard="false">\n        <div class="modal-header terms-header" id="TermsHeader" tabindex="-1">\n            <div class=\'modal-focus-anchor visuallyhidden\' tabindex=\'-1\'><%=$.i18n.t("termsAndConditions:termsandconditions") %></div>\n            <button id="declineTerms" type="button" role="button" class="close" data-dismiss="modal" aria-label="<%= $.i18n.t(\'generalWords:close\') %>" tabindex="0"><i class="icon-remove" /></button>\n            <h2 class="modal-title" id="TermModalLabel" aria-hidden="true">\n                <%=  $.i18n.t("termsAndConditions:termsandconditions") %>\n            </h2>\n        </div>\n        <div class="modal-body" id="term-modalbody">\n            <p id="termsCondMain"></p>\n            <p class="termsCondFootNote" id="termsCondFootNote"></p>\n            <div id="termsModalCheck">\n                <input id="term-check" type="checkbox"></input><label for="term-check" class="term-check-label"></label>\n            </div>\n        </div>\n        <div class="term-buttons">\n            <button type="button" id="acceptTerms" class="btn btn-large btn-primary">\n                <%=  $.i18n.t("continue") %>\n            </button>\n        </div>\n    </div>\n</div>\n</script>\n\n<script type="text/template" id="lineReaderTemplate">\n    <div class="acc-lineReader-container">\n        <div class="acc-lineReader-topBar"></div>\n        <div class="acc-lineReader-centerBar">\n            <div class="acc-lineReader-sideBar acc-lineReader-leftBar"></div>\n            <div class="acc-lineReader-viewport"></div>\n            <div class="acc-lineReader-sideBar acc-lineReader-rightBar"></div>\n        </div>\n        <div class="acc-lineReader-bottomBar">\n            <div style="position:absolute; height: 40px; width: 100%; bottom: 0px; text-align: center;">\n                <div class="acc-lineReader-stretchButton"><img src="public/images/linereader/expand.svg" /></div>\n            </div>\n            <span class="acc-lineReader-resizeButton"><img src="public/images/linereader/resize2.svg" /></span>\n        </div>\n    </div>\n</script>\n\n<script type="text/template" id="micCheckTemplate">\n    <div class="tn8-mic-set-up-container">\n        <div class="tn8-mic-set-up-header"><h2><%= $.i18n.t("micCheck:setupMic") %></h2></div>\n        <div class="tn8-mic-set-up-steps-container">\n            <div class="tn8-mic-error-unsupported tn8-mic-alert alert alert-error hidden lang<%= $.i18n.lng()%>">\n                <%= $.i18n.t("micCheck:error2009") %><div class="tn8-errorNumber">MSG 2009</div>\n            </div>\n            <div class="tn8-mic-error-dc tn8-mic-alert alert alert-error hidden lang<%= $.i18n.lng()%>">\n                <%= $.i18n.t("micCheck:micDisconnectMsg") %>\n            </div>\n            <div class="tn8-mic-set-up-step-box">\n                <div class="tn8-mic-set-up-icon notn8-mic"></div>\n                <button type="button" class="tn8-mic-set-up-btn btn btn-primary btn-large"><%= $.i18n.t("micCheck:enableMic") %></button>\n                <div class ="tn8-mic-set-up-complete-text hidden"><%= $.i18n.t("micCheck:micEnabled") %></div>\n            </div>\n        </div>\n    </div>\n    <div class="tn8-mic-check-diag hidden" role="dialog" aria-labelledby="Test Your Microphone" aria-hidden="true">\n        <h3 class="tn8-mic-check-header" aria-hidden="true"><%= $.i18n.t("micCheck:testMic") %></h3>\n        <div class="tn8-mic-check-diag-body">\n            <div class="tn8-mic-error-checksys tn8-mic-alert alert alert-error hidden lang<%= $.i18n.lng()%>">\n                <%= $.i18n.t("micCheck:checkSystemMsg") %>\n            </div>\n            <div class="tn8-mic-check-gethelp hidden">\n                <h4><%= $.i18n.t("micCheck:getHelpMsg") %></h4>\n                <div class="tn8-mic-check-gethelp-icon"/>\n                <div class="tn8-mic-check-linkgroup">\n                    <button class="tn8-mic-check-reset btn btn-link hidden"><i class="icon-repeat"></i> <%= $.i18n.t("reset") %></button>\n                    <button class="tn8-mic-check-goback btn btn-link"><%= $.i18n.t("micCheck:goBack") %></button>\n                </div>\n            </div>\n            <div class="tn8-mic-check-container hidden">\n                <span class="tn8-mic-select-label"><%= $.i18n.t("micCheck:availMics") %></span>\n                <select class="tn8-mic-check-mics"/>\n                <div class="tn8-mic-check-tryagain hidden">\n                    <%= $.i18n.t("micCheck:tryAgainMsg") %>\n                </div>\n                <div class="tn8-mic-check-box well">\n                    <div class="tn8-mic-check-recorder-instruction">\n                        <div class="tn8-mic-check-speak-icon"/>\n                        <span class="tn8-mic-check-headphones-icon hidden">\n                            <div class="tn8-mic-check-headphones-svg"/>\n                        </span>\n                        <span class="tn8-mic-check-question-icon hidden">\n                            <div class="tn8-mic-check-question-svg"/>\n                        </span>\n                        <div class="tn8-mic-check-prompt record">\n                            <div class="tn8-mic-check-text">\n                                <%= $.i18n.t("micCheck:click") %> <strong><%= $.i18n.t("micCheck:record") %> </strong> ( <div class="btn-icon record"/> ) <%= $.i18n.t("micCheck:countMsg") %>\n                            </div>\n                            <div class="tn8-mic-check-text">\n                                <%= $.i18n.t("micCheck:click") %> <strong><%= $.i18n.t("micCheck:stop") %> </strong> ( <div class="btn-icon stop"/> ) <%= $.i18n.t("micCheck:stopMsg") %>\n                            </div>\n                        </div>\n                        <div class="tn8-mic-check-prompt stop hidden">\n                            <div class="tn8-mic-check-text">\n                                <%= $.i18n.t("micCheck:click") %> <strong><%= $.i18n.t("micCheck:play") %> </strong> ( <div class="btn-icon play"/> ) <%= $.i18n.t("micCheck:playMsg") %>\n                            </div>\n                        </div>\n                        <div class="tn8-mic-check-prompt play hidden">\n                            <div class="tn8-mic-check-text">\n                                <%= $.i18n.t("micCheck:soundQuestion") %>\n                            </div>\n                        </div>\n                    </div>\n                    <div id="tn8-recorder-miccheck" class="recorder"></div>\n                </div>\n                <div class="tn8-mic-check-btns-container hidden">\n                    <button type="button" class="btn btn-large tn8-mic-check-no"><i class="icon-x-mark icon-2x"/> <%= $.i18n.t("micCheck:soundsBad") %></button>\n                    <button type="button" class="btn btn-large tn8-mic-check-yes"><i class="icon-check-mark icon-2x"/> <%= $.i18n.t("micCheck:soundsGood") %></button>\n                </div>\n                <div class="tn8-mic-check-linkgroup">\n                    <button class="tn8-mic-check-reset btn btn-link"><i class="icon-repeat"></i> <%= $.i18n.t("reset") %></button> |\n                    <button class="tn8-mic-check-help btn btn-link"><%= $.i18n.t("micCheck:help") %></button>\n                </div>\n            </div>\n        </div>\n    </div>\n</script>\n';
}),define("views/StemView",["javascripts/backbone-min","utils","text!tpl/combined.html"],function(e,t,n){"use strict";var i=e.View.extend({template:_.template($(n).filter("#itemstemtemplate").html()),content:null,initialize:function(e){this.el=e.el},getItemStemModel:function(){var e={itemBodyStemHtml:""};return e},setContent:function(e){this.content=e},render:function(){this.model=this.getItemStemModel(),this.model.itemBodyStemHtml=this.content.html();var e=$(this.template(this.model));this.$el.html(e)}});return i}),define("views/LayoutView",["javascripts/backbone-min","utils","text!tpl/combined.html","views/StemView"],function(e,t,n,i){"use strict";var o=e.View.extend({el:"#content",content:null,template:_.template($(n).filter("#itemtemplate").html()),initialize:function(){},getItemContextString:function(){var e=0,t=0,n=TestEngine.getNavigation();if(n){var i=n.getCurrentItem(),o=n.getCurrentSection();e=o.getIndexOfItem(i),t=o.getNumberOfItems()}return e+" of "+t},getTestName:function(){return TestEngine.getTestDefine().getTitle()},getTestSection:function(){var e=TestEngine.getNavigation();return e.getCurrentSection().getTitle()},getModel:function(){var e={itemContext:this.getItemContextString(),testName:this.getTestName(),testSection:this.getTestSection(),item:{itemBodyHtml:""}};return e},refreshMarkup:function(){var e=this.template(this.getModel());this.$el.html(e),$("#itemCanvasBody").append(this.content)},render:function(e){if(e){var t=$("#stem",this.el),n=$("#stem",this.content);if(0===t.length||0===n.length)this.refreshMarkup();else{t.empty();var o=new i({el:t});o.setContent(n),o.render()}}else this.refreshMarkup();return $("#itemCanvasBody")}});return o}),define("models/InteractionState",["javascripts/backbone-min"],function(e){"use strict";var t=e.Model.extend({defaults:{itemId:"",dataId:"",sectionId:"",response:[],answered:!1},isEqualTo:function(e){var t=_.pick(this.attributes,"itemId","sectionId","dataId"),n=_.pick(e.attributes||e,"itemId","sectionId","dataId");return!!_.isEqual(t,n)}});return t}),define("controllers/ModuleController",["javascripts/backbone-min","utils","models/InteractionState","util/Dispatcher"],function(e,t,n,i){"use strict";var o=e.Model.extend({node:null,moduleView:null,moduleId:null,_moduleName:null,config:null,stateTemplate:{},defaults:{answered:!1},init:function(e){this.node=e,this.moduleId=$(e).attr("data-identifier"),this.itemType=$(e).attr("data-module");var t=$(e).attr("data-ignoreanswered");t?this.ignoreAnswered="true"===t.toLowerCase():this.ignoreAnswered=$(e).hasClass("ignore-answered")||$(e).children().hasClass("ignore-answered"),void 0===this.moduleId&&(this.moduleId=$("[data-identifier]",e).attr("data-identifier")),this.config={},this.initializeInteractionState()},initializeInteractionState:function(){var e=TestEngine.getNavigation(),t=e.getCurrentSection(),i=e.getCurrentItem();this.stateTemplate=new n({itemId:i.getIdentifier(),dataId:this.moduleId,itemType:this.itemType,sectionId:t.getIdentifier()})},retrieveState:function(){var t=TN8.VariableFactory.templateVars.checkGetGlobalState(this.moduleId);if(t.length>0){var n=e.Model.extend({response:null});return n=new n,n.set("response",t[0].value),n}var i=TN8.Application.itemController.getModuleState(this.stateTemplate);return i&&i!==-1?i:null},storeState:function(){var e=$.extend({},this.stateTemplate);TN8.Application.itemController.setModuleState(e)},setAnswered:function(e){e=!!this.ignoreAnswered||e,this.set("answered",e),this.stateTemplate.set("answered",e)},isAnswered:function(){return!!this.ignoreAnswered||this.get("answered")},getItemId:function(){var e=TestEngine.getNavigation(),t=e.getCurrentItem();return t.getIdentifier()},enableAutoSave:function(){i.setupAutoSave()},setModuleName:function(e){this._moduleName=e},getModuleName:function(){return this._moduleName},cleanUp:function(){this.moduleView&&this.moduleView.remove()}});return o});var JWPlayerController=function(){return{_playerIds:[],_state:{},_LANGS:{Chinese:"zh",Dutch:"nl",English:"en",French:"fr",German:"de",Italian:"it",Japanese:"ja",Portuguese:"pt",Russian:"ru",Spanish:"es"},onReady:function(){var e=this;$(document).ready(function(){e._onReady()})},_onReady:function(){var e=this;this.playersNotReady=this._playerIds.length,0===this.playersNotReady?$(document).trigger("JWReady","JWPlayerSuccess"):($(document).one("JWPlayerError",e.loadErrorHandler),this._playerIds.forEach(function(t){jwplayer(t).on("ready",$.proxy(e._setupJWPlayer,e,t)).on("setupError",$.proxy(e.loadErrorHandler,e)),jwplayer(t).on("error",$.proxy(e.loadErrorHandler,e))}),$(document).on("jwPlayer.captionsAttached",$.proxy(this.updateCaptions,this)))},_setupJWPlayer:function(e){jwplayer(e).on("play pause idle",$.proxy(this._propagateJwEvents,this)),jwplayer(e).on("complete",$.proxy(this._handleComplete,this,e)),this.handler_onReady(e)},_propagateJwEvents:function(e){this._shouldTriggerEvent(e)&&$(document).trigger("JW."+e.type)},_shouldTriggerEvent:function(e){var t=!0;return"pause"!==e.type&&"idle"!==e.type||this._playerIds.forEach(function(e){"playing"===jwplayer(e).getState()&&(t=!1)}),t},_setFocus:function(e){jwplayer(e).getContainer&&jwplayer(e).getContainer().focus()},_timeoutFocus:function(e,t){$(t.target).hasClass("jwclickable")||setTimeout($.proxy(this._setFocus,this,e),200)},loadErrorHandler:function(){TN8.throw("Failed to load JWplayer",3033)},fixSkin:function(e){$("#"+e).removeClass("jw-skin-/client/public/javascripts/jwplayer/six/six"),$("#"+e).addClass("jw-skin-seven")},handler_onReady:function(e){this.playersNotReady--,$("#"+e).removeClass("jw-flag-small-player"),$("#"+e+" .jw-controls").on("click",$.proxy(this._timeoutFocus,this,e)),this.fixSkin(e),0===this.playersNotReady&&(this.beginLogging(),$(".jw-icon-rewind").remove(),$(".jw-icon-fullscreen").remove(),$(".jw-display-icon-rewind").remove(),$(document).trigger("JWReady","JWPlayerSuccess"))},cleanup:function(){this._state={},$(document).off("JWPlayerError",this.loadErrorHandler),$(document).off("JWPlayerCloseSettings"),$(document).off("jwPlayer.captionsAttached",$.proxy(this.updateCaptions,this));try{this._playerIds.forEach(function(e){jwplayer(e).stop(),jwplayer(e).setCurrentCaptions(0),jwplayer(e).remove()})}catch(e){TN8.log("jwplayer cleanup failed"+e,TN8.IMPORTANT)}},beginLogging:function(){if("undefined"!=typeof window.TestEngine&&window.TestEngine.getNativeComponent()){var e=function(e){return function(){TN8.log("ItemController.logJW  JWplayer log : "+e,TN8.IMPORTANT)}};this._playerIds.forEach(function(t){e(t+" Rendering Mode is "+jwplayer(t).getRenderingMode()+". Initial State is "+jwplayer(t).getState()+". Buffer is set at "+jwplayer(t).getBuffer()),jwplayer(t).on("play",e(t+" playing")),jwplayer(t).on("pause",e(t+" paused")),jwplayer(t).on("buffer",e(t+" buffering")),jwplayer(t).on("idle",e(t+" idle")),jwplayer(t).on("complete",e(t+" playback complete"))})}},setPlayers:function(e){function t(e){return e.match(/"([^"']+)"/)[1]}if(this._playerIds=[],this.languages=[],/var pid ?= ?"[^"']+"/g.test(e)&&(this._playerIds=this._playerIds.concat(e.match(/var pid ?= ?"[^"']+"/g).map(t))),/jwplayer\("(.*)"\)/g.test(e)&&(this._playerIds=this._playerIds.concat(e.match(/jwplayer\("(.*)"\)/g).map(t))),this._playerIds.length>0&&/tracks ?: ?\[{[^]*label ?: ?"[^"']+"[^]*}\]/g.test(e)){var n=e.match(/tracks ?: ?\[{[^]*label ?: ?"[^"']+"[^]*}\]/g);for(i=0;i<n.length;i++)this.languages=this.languages.concat(n[i].match(/label ?: ?"[^"']+"/g).map(t))}this._initializeState()},_initializeState:function(){for(var e=0;e<this._playerIds.length;e++)this._initializePlayerState(this._playerIds[e])},_initializePlayerState:function(e){var t=$("#"+e);this._state[e]={},this._state[e].maxPlays=t.attr("data-max-plays")?parseInt(t.attr("data-max-plays")):0,this._state[e].completedPlays=0},_handleComplete:function(e){this._state[e].completedPlays++,this._processPlayerCompletedPlays(e)},_processPlayerCompletedPlays:function(e){this._state[e].maxPlays>0&&this._state[e].completedPlays>=this._state[e].maxPlays&&this._notifyPlayerOfMaxPlays(e)},_processAllCompletedPlays:function(){for(var e in this._state)this._processPlayerCompletedPlays(e)},_notifyPlayerOfMaxPlays:function(e){$(document).trigger("jwPlayer.maxPlays",e)},_updateInternalState:function(e){if(e)for(var t in e)this._state[t].completedPlays=e[t].completed},setState:function(e){this._updateInternalState(e),this._processAllCompletedPlays(this._state)},getState:function(){var e={};for(var t in this._state)this._state[t].maxPlays>0&&(e[t]={},e[t].completed=this._state[t].completedPlays);return e},updateCaptions:function(e,t){var n=t.getCaptionsList(),i=this.checkForClosedCaptionsPnp();if("undefined"!=typeof i){for(var o="",r=0;r<this.languages.length;r++)if(this._LANGS[this.languages[r]]&&this._LANGS[this.languages[r]].toLowerCase()===i.toLowerCase()){o=this.languages[r];break}var s=this.getIndexForPnp(n,o);s>-1&&$(document).trigger("jwController.updatePnpSelectedCC",[t.id,s])}},checkForClosedCaptionsPnp:function(){var e;return"undefined"!=typeof TN8.PnpController&&TN8.PnpController.checkForClosedCaption&&(e=TN8.PnpController.checkForClosedCaption()),e},getIndexForPnp:function(e,t){var n=-1;t=""!==t?t:"off";for(var i=0;i<e.length;i++)if(e[i].label.toLowerCase()===t.toLowerCase())return n=i;return n}}};define("controllers/JWPlayerController",function(){}),define("controllers/JWPlayerControllerWrapper",["controllers/JWPlayerController"],function(){return new JWPlayerController});var defaultOpts,PopupController=function(e){return defaultOpts={content:{title:"Glossary Definition"},hide:{event:"click unfocus focusout mouseleave",leave:!1},position:{at:"bottom center",my:"top center"},prerender:!0,show:{delay:1,event:"click focus touchend"},style:{classes:"qtip-bootstrap"},target:"event"},this.pnpCntrl=e,this.$container,this.isChromeApp=!1,this.chromeAppDebounce,this.displayTimestamp=0,this.preventMouseHide=!1,this.supportedLanguages=["es","so","hmn","ar","cmn","ht","kar","km","ko","lo","om","ru","vi"],this.lang="",this.popups={},this.initialized=!1,this};PopupController.prototype.setPopups=function(e){var t=this;e.each(function(e,n){t.popups[n.id]={keyword:!1,rendered:!1,qtipID:"",visible:!1}})},PopupController.prototype.showPopup=function(e,t){if(this.isChromeApp){var n=this;clearTimeout(this.chromeAppDebounce),this.preventMouseHide=!0,this.chromeAppDebounce=setTimeout(function(){n.preventMouseHide=!1},300)}return t.elements.shadowContent||(t.elements.shadowContent=this.createShadowPopup(t.options.content),t.elements.shadowContent.attr("id","qtip-"+t.id+"-shadow-popup"),t.target.after(t.elements.shadowContent)),t.elements.shadowContent.attr("aria-hidden","false"),t.plugins.tip.update(),document.activeElement!==t.target[0]&&t.target.focus(),this.popups[t.target.attr("id")].visible||(this.displayTimestamp=performance.now()),!0},PopupController.prototype.popupVisible=function(e,t){this.popups[t.target.attr("id")].visible||this.recordAnalytics("totalDisplays",1),this.popups[t.target.attr("id")].visible=!0,t.target.trigger("popup.visible",t)},PopupController.prototype.triggerVisible=function(e){if(this.popups[e.currentTarget.id].visible){var t=$(e.currentTarget).qtip("api");t.target.trigger("popup.visible",t)}},PopupController.prototype.hidePopup=function(e,t){if(this.isChromeApp&&("mouseout"===e.originalEvent.type||"mouseleave"===e.originalEvent.type)&&this.preventMouseHide)return!1;if(e.originalEvent&&e.originalEvent.relatedTarget&&t.elements.shadowContent&&(e.originalEvent.relatedTarget===t.elements.shadowContent[0]||t.elements.shadowContent[0].contains(e.originalEvent.relatedTarget)))return!1;if(t.elements.shadowContent&&t.elements.shadowContent.attr("aria-hidden","true"),this.popups[t.target.attr("id")].rendered&&this.displayTimestamp>0){var n=performance.now();this.recordAnalytics("timeOpen",(n-this.displayTimestamp)/1e3),this.displayTimestamp=0}return $(document).trigger("magnifier.refresh"),this.popups[t.target.attr("id")].visible=!1,!0},PopupController.prototype.popupHidden=function(e,t){this.popups[t.target.attr("id")].visible=!1,t.target.trigger("popup.hidden",t)},PopupController.prototype.keydownListener=function(e){if(27===e.keyCode){var t=$(e.currentTarget);if(t.hasClass("shadow-popup")&&(t=t.prev("[data-hasqtip]")),this.popups[t.attr("id")].visible){t.focus();var n=t.qtip("api");n.hide.call(n,e)}}else if(13===e.keyCode){var t=$(e.target);if(!this.popups[t.attr("id")].visible){var n=t.qtip("api");n.show.call(n,e)}}else if(9===e.keyCode){var t=$(e.currentTarget);if(t.hasClass("shadow-popup")){if(t=t.prev("[data-hasqtip]"),this.popups[t.attr("id")].visible){var n=t.qtip("api");n.hide.call(n,e)}return!0}}},PopupController.prototype.renderedPopup=function(e,t){this.popups[t.target[0].id]&&!this.popups[t.target[0].id].rendered&&(this.popups[t.target[0].id].rendered=!0,this.popups[t.target[0].id].qtipID=t.id,t.target.attr("tabindex",0),$('[data-module="ChoiceInteraction"]').each(function(e,n){n.contains(t.target[0])&&t.target.attr("onclick","return false;")}),t.target.click($.proxy(this.triggerVisible,this)),t.tooltip.on("tooltipshow",$.proxy(this.showPopup,this)),t.tooltip.on("tooltipvisible",$.proxy(this.popupVisible,this)),t.tooltip.on("tooltiphide",$.proxy(this.hidePopup,this)),t.tooltip.on("tooltiphidden",$.proxy(this.popupHidden,this))),$(document).trigger("popupReady","Popup rendered "+t.id)},PopupController.prototype.createShadowPopup=function(e){var t=$("<div>",{class:"visuallyhidden shadow-popup","aria-hidden":!0}).append($("<div/>",{class:"shadow-popup-content"}).append("string"==typeof e.text?e.text:e.text.clone().removeAttr("id")));return e.title&&t.prepend($("<div/>",{class:"shadow-popup-title",text:e.title})),t},PopupController.prototype.init=function(e){"undefined"!=typeof e&&0!==e.length||(e=$("#itemCanvasBody")),this.$container=e,this.isChromeApp=window.TestEngine&&TestEngine.isChromeApp();var t=this.$container.find(".glossary-term, .keyword-translation"),n=t.length;if("undefined"!=typeof this.pnpCntrl&&this.pnpCntrl.checkforOnScreenRegularPopup()===!1&&(t=this.$container.find(".keyword-translation")),!this.initialized&&n&&(this.extendQtip(),this.initialized=!0),defaultOpts.content.title=$.i18n?$.i18n.t("generalWords:glossary"):"Glossary Definition",this.lang="","undefined"!=typeof this.pnpCntrl&&this.pnpCntrl.getKeywordLang()){var i=this.pnpCntrl.getKeywordLang().toLowerCase();this.supportedLanguages.indexOf(i)>-1&&(this.lang=i)}$(document).off("cleanup.betweenTest",$.proxy(this.cleanupBetweenTests,this)).on("cleanup.betweenTest",$.proxy(this.cleanupBetweenTests,this)),this.setPopups(t);var o=this;return t.each(function(e,t){o.addKeywordPopup($(t))}),t.length&&this.attachListeners(),this},PopupController.prototype.addKeywordPopup=function(e){var t=e.attr("data-content");if(t&&1===t.split(" ").length){var n=$('.keyword-translation-element[data-apip-id="'+t+'"]');if(0===n.length&&(n=$('.keyword-translation-element[id="'+t+'"]')),n.length){this.popups[e.attr("id")].keyword=!0;var i=this.pickLanguage(n);if(!i)return $(document).trigger("popupReady","Popup don't render \""+e.attr("id")+'"'),!1;e.qtip({content:{title:!1,text:i.clone().removeAttr("id")}})}else e.hasClass("keyword-translation")&&!n.length&&$(document).trigger("popupReady",'Popup no content "'+e.attr("id")+'"')}},PopupController.prototype.pickLanguage=function(e){var t,n=this;return e.find("[data-lang]").each(function(e,i){if($(i).data("lang")&&n.lang===$(i).data("lang").toLowerCase())return t=$(i),!1}),t},PopupController.prototype.cleanup=function(){this.removeListeners();for(var e in this.popups)this.removePopup(e);this.popups={},delete this.analytics},PopupController.prototype.removePopup=function(e){var t=$("#"+e);if(t.length&&this.popups[e].rendered){var n=t.qtip().elements;n.shadowContent&&n.shadowContent.remove(),n.tooltip.off("tooltipshow tooltipvisible tooltiphide tooltiphidden"),t.qtip("destroy",!0),t.removeClass("glossary-plugin").removeAttr("tabindex"),this.popups[e].rendered=!1}},PopupController.prototype.recordAnalytics=function(e,t){this.analytics||(this.analytics={totalDisplays:0,timeOpen:0}),this.analytics[e]+=t},PopupController.prototype.sendAnalytics=function(){if(this.analytics){var e=Math.floor(this.analytics.timeOpen),t=this.analytics.totalDisplays;this.triggerAnalyticsEvent("totalDisplays",t),this.triggerAnalyticsEvent("timeOpen",e)}},PopupController.prototype.triggerAnalyticsEvent=function(e,t){$(document).trigger("Used.Popup",{attr:e,op:"add",val:t})},PopupController.prototype.updatePNP=function(e,t){return t=t.toLowerCase&&t.toLowerCase(),t!==this.lang&&(this.supportedLanguages.indexOf(t)>-1||""===t)&&(this.lang=t,this.updateKeywords()),this.lang},PopupController.prototype.updateKeywords=function(){for(var e in this.popups)this.popups[e].keyword&&(this.removePopup(e),this.addKeywordPopup($("#"+e)))},PopupController.prototype.attachListeners=function(){$(document).on("tooltiprender",".qtip",$.proxy(this.renderedPopup,this)),$(document).on("keydown",".qtip, .glossary-plugin, .shadow-popup",$.proxy(this.keydownListener,this)),$(document).on("pnpUpdate.keyword",$.proxy(this.updatePNP,this)),$(document).on("tn.nav.start",$.proxy(this.sendAnalytics,this))},PopupController.prototype.removeListeners=function(){$(document).off("tooltiprender",".qtip",$.proxy(this.renderedPopup,this)),$(document).off("keydown",".qtip, .glossary-plugin, .shadow-popup",$.proxy(this.keydownListener,this)),$(document).off("pnpUpdate.keyword",$.proxy(this.updatePNP,this)),$(document).off("tn.nav.start",$.proxy(this.sendAnalytics,this))},PopupController.prototype.cleanupBetweenTests=function(){$(document).off("cleanup.betweenTest",$.proxy(this.cleanupBetweenTests,this)),this.initialized=!1,this.lang="",this._qtip&&$.fn.qtip&&($.fn.qtip=this._qtip,this._qtip=null)},PopupController.prototype.extendQtip=function(){var e=this;!function(t){e._qtip=t.fn.qtip,t.fn.qtip=function(){if(!(arguments.length>0&&"object"==typeof arguments[0]&&void 0===e.popups[this.id]))return e._qtip.apply(this,arguments);if(arguments[0].content&&(arguments[0].content.attr||arguments[0].content.text)&&(!t(this).hasClass("glossary-plugin")||"undefined"==typeof e.pnpCntrl||e.pnpCntrl.checkforOnScreenRegularPopup()!==!1)){var n={content:{}};return arguments[0].content.title===!1&&(n.content.title=arguments[0].content.title),arguments[0].content.text?n.content.text=arguments[0].content.text:arguments[0].content.attr&&(n.content.attr=arguments[0].content.attr),arguments[0]=t.extend(!0,{},defaultOpts,n),t(this).addClass("glossary-plugin").attr("tabindex",0),e._qtip.apply(this,arguments)}return t(this).hasClass("glossary-plugin")&&"undefined"!=typeof e.pnpCntrl&&e.pnpCntrl.checkforOnScreenRegularPopup()===!1?(t(this).removeClass("glossary-plugin").removeAttr("tabindex"),arguments[0].show="",t(this)):void 0}}($)},define("controllers/PopupController",function(){}),define("controllers/PopupControllerWrapper",["controllers/PnpController","controllers/PopupController"],function(e){return new PopupController(e)}),define("controllers/CalculatorController",[],function(){return{init:function(){!$("#divCalculator").length&&$("#lastTabbable").before('<div id="divCalculator"></div>')}}}),define("tools/passageScrollCarry",[],function(){var e="div.passage-scrolling,div.tab-scrolling",t=function(){var t=$(e).hasClass("scrollbar-iscroll");return t&&TN8.utils.isMobile};return{getScrollPosition:function(){var n={},i=$(e).parents(".tab-pane");return 0===i.length?t()?n[e]=$(e).attr("data-scrollTop"):n[e]=$(e).scrollTop():$(".tabbed-passages").length>0&&(n=$(".tabbed-passages").tabbedPassage("getScrollState")),n},setScrollPosition:function(n){n&&("undefined"!=typeof n[e]?t()?($(e).attr("data-scrollTop",n[e]),$(e).trigger("inform.iscrollChanged")):$(e).scrollTop(n[e]):$(".tabbed-passages").length>0&&$(".tabbed-passages").tabbedPassage("setScrollState",n))},getTabPosition:function(){var e={};return $(".tabbed-passages").length>0&&(e=$(".tabbed-passages").tabbedPassage("getActiveTab")),e},setTabPosition:function(e){e&&$(".tabbed-passages").length>0&&$(".tabbed-passages").tabbedPassage("setActiveTab",e)}}}),define("tools/ToolLoader",["util/Waiter","controllers/CalculatorController","tools/passageScrollCarry","controllers/PnpController","controllers/LanguageController"],function(e,t,n,i,o){"use strict";var r={QUARTER_INCH_RULER:5,EIGTH_INCH_RULER:6,PROTRACTER:7,PROTRACTER_2:21,SCIENTIFIC_CALC:9,FOUR_FUNCTION_CALC:10,CENTIMETER_RULER:11,CENTIMETER_RULER_2:19,FIVE_FUNCTION_CALC:12,TI84_CALC:13,ANSWER_ELIMINATOR:14,HIGHLIGHTER:15,TI30_CALC:16,TI108_CALC:17,STRAIGHTEDGE:20,DESMOS_FOUR_FUNC:22,DESMOS_SCIENTIFIC:23,DESMOS_GRAPHING:24,EXPANDED_VIEW:25,DYNAMIC_TTS:26,DICTIONARY_ELEM:27,DICTIONARY_MID:28,DICTIONARY_HIGH:29,DICTIONARY_SPAN:30,NOTEPAD:9001,SCRATCHPAD:9002},s={CONTRAST_SETTINGS:1001,MAGNIFIER:1003,LINEREADER:1005,TTS:1006,ANSWER_MASKING:1007},a=function(e){this.testView=null,this.toolController=null,this.toolIds=[],_.bindAll(this)};return a.prototype.setTestView=function(e){this.testView=e},a.prototype.loadToolLibs=function(){this.toolIds=this._getCurItemToolList(TestEngine,TN8.Application.accommodationTools);var e=this._buildToolLibList();TN8.utils.loadLibraries(e,this.initializeTools,this.toolFailure)},a.prototype.initializeTools=function(){for(var e=!1,n=0;n<this.toolIds.length;n++)switch(this.toolIds[n]){case r.SCIENTIFIC_CALC:case r.FOUR_FUNCTION_CALC:case r.FIVE_FUNCTION_CALC:!e&&t.init(),e=!0}this.handler_ToolLibLoad()},a.prototype.handler_ToolLibLoad=function(){$(document).trigger("inform.loadToolLibsReady")},a.prototype.toolFailure=function(e){TN8.throw("scriptInjector.injectScripts failed. tools failed . Error message : "+JSON.stringify(e),TN8.errorType.INJECTION_SCRIPT_ERROR)},a.prototype._buildToolLibList=function(){for(var e=[],t="",n=0;n<this.toolIds.length;n++){switch(this.toolIds[n]){case r.QUARTER_INCH_RULER:case r.EIGTH_INCH_RULER:case r.PROTRACTER:case r.PROTRACTER_2:case r.CENTIMETER_RULER:case r.CENTIMETER_RULER_2:t=["javascripts/tools/measurementToolbox-lib"];break;case r.SCIENTIFIC_CALC:case r.FOUR_FUNCTION_CALC:case r.FIVE_FUNCTION_CALC:t=["javascripts/tools/calculatorToolbox-lib"];break;case r.ANSWER_ELIMINATOR:t=["javascripts/tools/answereliminator-lib"];break;case r.HIGHLIGHTER:t=["javascripts/rangy/rangy-core","javascripts/tools/highlightertool-lib"];break;case r.TI84_CALC:case r.TI30_CALC:case r.TI108_CALC:t=["javascripts/tools/ticalccontroller-lib"];break;case r.STRAIGHTEDGE:t=["javascripts/tools/straightedge-lib"];break;case r.DESMOS_FOUR_FUNC:case r.DESMOS_SCIENTIFIC:case r.DESMOS_GRAPHING:t=["javascripts/tools/desmos-lib"];break;case r.DYNAMIC_TTS:t=["javascripts/yahoo/yui-sb.min","javascripts/sbutils/util","javascripts/rangy/rangy-core","javascripts/rangy/rangy-classapplier","javascripts/sbtts"];break;case r.DICTIONARY_ELEM:case r.DICTIONARY_MID:case r.DICTIONARY_HIGH:case r.DICTIONARY_SPAN:t=["util/modalize","javascripts/tools/dictionary-lib","models/DictionaryTrackerModel"];break;case r.NOTEPAD:t=["javascripts/tools/notepad-lib"];break;case r.SCRATCHPAD:t=["javascripts/literallycanvas-core","javascripts/tools/notepad-lib"]}for(var i=0;i<t.length;i++)$.inArray(t[i],e)===-1&&e.push(t[i])}return e.length>0&&e.push("javascripts/tools/toolcontroller-lib"),e},a.prototype._getNonDefaultPnpToolsIdArrayFromEngine=function(){var e=TN8.utils.getNonDefaultPnpToolsFromEngine();return this._filterToolListPNP(e)},a.prototype.displayToolBar=function(){new e({expectedEvents:2,incomingReadyEvents:"TTSDOMReady ASLDOMReady",outgoingReadyEvents:"AllToolsLoadedAndReady"});if($(document).one("AllToolsLoadedAndReady",this.loadDeepZoomToolMenu),window.ToolControllerAPI){$(document).one("AllToolSetStateDone",this._addAccommodations),$(document).one("ToolControllerReady",this.loadToolState);new e({expectedEvents:1,incomingReadyEvents:"toolControllerComplete",outgoingReadyEvents:"ToolControllerReady"});this.appendToolsCss()}else this.loadToolState(),this._addAccommodations()},a.prototype.appendToolsCss=function(){var e=TestEngine.getAuthentication().getCurrentForm().getTestSecurityLevel();"1"!==e&&"2"!==e||!$("#tools_css_link").length?this.initializeToolbar():TN8.utils.createRebasedCss("tools_css_link","public/javascripts/tools/css/",this.initializeToolbar)},a.prototype.initializeToolbar=function(){TN8.clearOn("ToolControllerInitialized",function(){$(document).trigger("toolControllerComplete","toolControllerInitialized")});var e=[];try{e=this._getCurItemToolList(TestEngine,[]),this.toolController=ToolControllerAPI.createToolController({contentContainerId:"main_panel",buttonContainerId:"drawingToolBar",toolIds:e}),this.toolController.initialize()}catch(t){$(document).trigger("toolControllerComplete","toolControllerInitNot"),TN8.throw("ToolController failed to initialize. "+t.message+". with tool list: ["+e.toString()+"]"+JSON.stringify(t.stack),TN8.errorType.TOOL_LOAD_ERROR),TN8.log(t.message+". with tool list: ["+e.toString()+"]",TN8.CRITICAL)}},a.prototype.addAccessories=function(t){var n=[];t.exhibits=!!(TN8.exhibits&&TN8.exhibits.length>0),(t.asl||t.dtts||t.tts||t.exhibits)&&(n.push("accomSidebar.ready"),TN8.utils.loadLibraries(["javascripts/accomSidebar"],$.proxy(this.addAccomSidebar,this,t),this.toolFailure));var i=this.toolIds.indexOf(r.HIGHLIGHTER)>-1;if(i||t.dtts||t.tts){n.push("contextMenu.ready");var o=["javascripts/rangy/rangy-core","javascripts/tools/contextMenu"];t.dtts&&o.push("javascripts/rangy/rangy-classapplier");var s=t.tts?"tts":!!t.dtts&&"dtts";"tts"===s&&void 0!==TN8.Application.config&&TN8.Application.config.disableSelectToListen===!0&&(s=!1),TN8.utils.loadLibraries(o,$.proxy(this.addContextMenu,this,s,i),this.toolFailure)}n.length>0?new e({expectedEvents:n.length,incomingReadyEvents:n.join(" "),outgoingReadyEvents:"AccessoriesReady"}):$(document).trigger("AccessoriesReady")},a.prototype.addContextMenu=function(e,t){this.menu=(new ContextMenu).init($("#main_panel"),$("#lastTabbable"),{tts:e,highlighter:t}),$(document).off("tn.error.fatal navigate.EmergencyExit",$.proxy(this.menu.destroy,this.menu)).one("tn.error.fatal navigate.EmergencyExit",$.proxy(this.menu.destroy,this.menu))},a.prototype.addAccomSidebar=function(e){this.sidebar=(new AccomSidebar).init($("#tn8-sidebar"),e)},a.prototype.loadDeepZoomToolMenu=function(){TN8.utils.loadLibraries(["javascripts/DeepZoomToolMenu"],$.proxy(this.addDeepZoomToolMenu),this.toolFailure)},a.prototype.addDeepZoomToolMenu=function(){this.deepZoomToolMenu=new DeepZoomToolMenu(TN8.deepZoomLayer)},a.prototype.loadToolState=function(){var t=this._getGlobals(),n=t.otherStates;this.setOtherGlobalStates(n);var i=this._getStatefulToolsCount();if(i>0){new e({expectedEvents:i,incomingReadyEvents:"AccommodationSetStateDone",outgoingReadyEvents:"AllToolSetStateDone"});this.toolController&&this.toolController.setToolState(t.toolState),this._loadAccomToolState(t.toolState)}else $(document).trigger("AllToolSetStateDone","ToolStateLengthIsZero");TN8.log("ItemController.loadToolState() end!",TN8.HELPFUL)},a.prototype._loadAccomToolState=function(e){if("undefined"!=typeof answerMaskingAPI&&void 0!=answerMaskingAPI.toolbox&&void 0!=answerMaskingAPI.toolbox.answerMaskingController&&answerMaskingAPI.toolbox.answerMaskingController.isAvailable()){for(var t,n=0;n<e.length;n++)e[n].id==s.ANSWER_MASKING&&(t=e[n]);"undefined"!=typeof t?(t.s.i.length>1&&TN8.log("AnswerMasker has more than one state to restore - this is probably an error.",TN8.IMPORTANT),answerMaskingAPI.toolbox.answerMaskingController.setState(t)):$(document).trigger("AccommodationSetStateDone","AnswerMaskerStateUnavailable")}},a.prototype.getToolState=function(){for(var e=this.toolController&&this.toolController.getToolState()||[],t=TestEngine.getNavigation().getCurrentSection(),n=TestEngine.getNavigation().getCurrentItem(),i=TN8.TestStateController.getGlobalToolState(t,n),o=this._getStateToolIds(i),r=this._getStateToolIds(e),s=this._findMissingSharedTools(r,o),a=0;a<s.length;a++)e.push(this._getToolStateWithID(i,s[a]));return"undefined"!=typeof answerMaskingAPI&&void 0!=answerMaskingAPI.toolbox&&void 0!=answerMaskingAPI.toolbox.answerMaskingController&&answerMaskingAPI.toolbox.answerMaskingController.isAvailable()&&answerMaskingAPI.toolbox.answerMaskingController.hasMaskers()&&e.push(answerMaskingAPI.toolbox.answerMaskingController.getState()),this._saveGlobals(e),e},a.prototype._getStateToolIds=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].id);return t},a.prototype._findMissingSharedTools=function(e,t){var n,i=[r.HIGHLIGHTER,r.NOTEPAD,r.SCRATCHPAD],o=[],s=!1,a=!1;for(n=0;n<i.length;n++)s=$.inArray(i[n],e)!=-1,a=$.inArray(i[n],t)!=-1,a&&!s&&o.push(i[n]);return o},a.prototype._getToolStateWithID=function(e,t){for(var n=null,i=0;i<e.length&&null==n;i++)e[i].id==t&&(n=e[i]);return n},a.prototype.cleanup=function(){null!==this.toolController&&this.toolController.cleanup(),this.menu&&(this.menu.destroy(),this.menu=void 0),this.sidebar&&(this.sidebar.destroy(),this.sidebar=void 0),this.deepZoomToolMenu&&(this.deepZoomToolMenu.destroy(),this.deepZoomToolMenu=void 0),"undefined"!=typeof SBTTSAPI&&SBTTSAPI.cleanup(),"undefined"!=typeof answerMaskingAPI&&void 0!=answerMaskingAPI.toolbox&&void 0!=answerMaskingAPI.toolbox.answerMaskingController&&answerMaskingAPI.toolbox.answerMaskingController.destroy()},a.prototype.resetToolLoaded=function(){this.toolLoaded=!1},a.prototype._getStatefulToolsCount=function(){var e=this._getGlobals(),t=0,n={},i=[r.ANSWER_ELIMINATOR,r.HIGHLIGHTER,s.ANSWER_MASKING,r.NOTEPAD,r.SCRATCHPAD];if(e.toolState&&e.toolState.length>0)for(var o=0;o<e.toolState.length;o++)n=e.toolState[o],n&&$.inArray(n.id,i)>-1&&$.inArray(n.id,this.toolIds)>-1&&t++;return t},a.prototype._getCurItemToolList=function(e,t){var n=[],i=[];try{n=e.getNavigation().getCurrentItem().getToolset()||[],i=e.getNavigation().getCurrentSection().getToolset()||[]}catch(e){}var o=Object.keys(t),r={contrastSettings:s.CONTRAST_SETTINGS,magnifier:s.MAGNIFIER,lineReader:s.LINEREADER,tts:s.TTS,masking:s.ANSWER_MASKING},a=$.map(o,function(e){return"undefined"==r[e]?e:r[e]}),l=this.removeDups(n.concat(i).concat(a));return this._filterToolListPNP(l)},a.prototype.removeDups=function(e){var t={},n=[];return e.forEach(function(e){t[e]||(t[e]=!0,n.push(e))}),n},a.prototype._filterToolListPNP=function(e){return e=this._filterMultiTypePNP(e,this._getCalculatorTypes()),e=this._filterMultiTypePNP(e,this._getDictionaryTypes()),e=this._filterNotepadScratchpad(e),e=this._filterSpokenPNP(e),TN8.Application.settings.filterToolset(e,r)},a.prototype._getCalculatorTypes=function(){return{tool:"calcs",scientific:r.SCIENTIFIC_CALC,"four-function":r.FOUR_FUNCTION_CALC,"five-function":r.FIVE_FUNCTION_CALC,"ti-84 graphing":r.TI84_CALC,"ti-30 scientific":r.TI30_CALC,"ti-108 basic":r.TI108_CALC,desmosFourFunction:r.DESMOS_FOUR_FUNC,desmosGraphing:r.DESMOS_GRAPHING,desmosScientific:r.DESMOS_SCIENTIFIC}},a.prototype._getDictionaryTypes=function(){return{tool:"dicts","mw-elementary":r.DICTIONARY_ELEM,"mw-intermediate":r.DICTIONARY_MID,"mw-highschool":r.DICTIONARY_HIGH,"mw-spanish":r.DICTIONARY_SPAN}},a.prototype._getPNPTools=function(e){switch(e){case"calcs":return i.getCalculators();case"dicts":return i.getDictionaries()}},a.prototype._filterNotepadScratchpad=function(e){if(e.indexOf(r.SCRATCHPAD)>-1){var t=e.indexOf(r.NOTEPAD);t>-1&&e.splice(t,1)}return e},a.prototype._filterMultiTypePNP=function(e,t){var n=[],i=[],o=this._getPNPTools(t.tool);if(o){for(var r in o)o[r].assignedSupport===!0?n.push(t[o[r].type]):o[r].assignedSupport===!1&&i.push(t[o[r].type]);e=e.concat(n).filter(function(e){return i.indexOf(e)===-1})}return e},a.prototype._filterSpokenPNP=function(e){var t=i.checkForDynamicTTS(),n=i.checkForTTS(),o=e.indexOf(r.DYNAMIC_TTS);return(void 0!==t&&t!==!0||void 0===t&&n&&o===-1)&&o>-1&&e.splice(o,1),(void 0!==t&&t||TestEngine.getTestDefine().isDynamicTTS())&&o===-1&&e.push(r.DYNAMIC_TTS),e},a.prototype._saveGlobals=function(e){if("item"===TN8.Application.currentContent){var t=TestEngine.getNavigation().getCurrentSection(),n=TestEngine.getNavigation().getCurrentItem(),i=this.getOtherGlobalStates();
TN8.TestStateController.setGlobalToolState(t,n,{toolState:e,otherStates:i})}},a.prototype.getOtherGlobalStates=function(){var e={};return e.scrollPosition=n.getScrollPosition(),e.tabPosition=n.getTabPosition(),e},a.prototype.setOtherGlobalStates=function(e){var t=window.itemBehaviors.applied.every(function(e){return e.behavior.indexOf("scroll")==-1});e&&t&&(n.setTabPosition(e.tabPosition),n.setScrollPosition(e.scrollPosition))},a.prototype._getGlobals=function(){var e=TestEngine.getNavigation().getCurrentSection(),t=TestEngine.getNavigation().getCurrentItem(),n=TN8.TestStateController.getGlobalToolState(e,t),i=TN8.Application.itemController.nextToolState,o=this._mergeToolStateGlobals(i,n.toolState);return{toolState:o,otherStates:n.otherStates}},a.prototype._mergeToolStateGlobals=function(e,t){r.HIGHLIGHTER,r.NOTEPAD,r.SCRATCHPAD;"undefined"==typeof e&&(e=[]);var n=t&&JSON.parse(JSON.stringify(t)),i=e&&JSON.parse(JSON.stringify(e));return this._mergeGlobalHighlighterState(i,n),this._mergeGlobalToolState(i,n),i},a.prototype._mergeGlobalHighlighterState=function(e,t){var n=r.HIGHLIGHTER,i=this._stateHasToolId(t,n);i&&this._addGlobalPassageToToolState(e,t)},a.prototype._mergeGlobalToolState=function(e,t){for(var n=r.NOTEPAD,i=r.SCRATCHPAD,o=[n,i],s=!1,a=0;a<o.length;a++)s=this._stateHasToolId(t,o[a]),s&&(this._removeStateFromCollection(e,o[a]),e.push(this._getStateFromCollection(t,o[a])))},a.prototype._addGlobalPassageToToolState=function(e,t){var n=r.HIGHLIGHTER,i=this._getStateFromCollection(e,n),o=this._getStateFromCollection(t,n),s={};$.extend(!0,s,o),s&&s.s.other&&(i&&i.s.other?s.s.other=i.s.other:s.s.other=[],this._removeStateFromCollection(e,n),e.push(s))},a.prototype._stateHasToolId=function(e,t){var n=!1;if("undefined"!=typeof e)for(var i=0;i<e.length;i++)if(e[i].id===t){n=!0;break}return n},a.prototype._removeStateFromCollection=function(e,t){if("undefined"!=typeof e)for(var n=0;n<e.length;n++)if(e[n].id===t){e.splice(n,1);break}},a.prototype._getStateFromCollection=function(e,t){var n=null;if("undefined"!=typeof e)for(var i=0;i<e.length;i++)if(e[i].id===t){n=e[i];break}return n},a.prototype._addAccommodations=function(){var e=this._pickAccommodations();$(document).on("AccessoriesReady",$.proxy(this._injectAccommodations,this,e)),this.addAccessories(e)},a.prototype._pickAccommodations=function(){var e={asl:!1,tts:!1,dtts:!1};if(this.toolIds.indexOf(r.DYNAMIC_TTS)>-1)e.dtts=!0;else if(TN8.apip&&TN8.apip.apipObject&&TN8.apip.valid&&(TN8.apip.isASL||!TN8.apip.pnp||TN8.apip.pnp.assignedSupport!==("dynamic-tts"===TN8.apip.pnp.type))){var t=i.checkForTTS();"undefined"!=typeof t?e.tts=TextToSpeechAPI.hasTTS(TN8.apip.apipObject)&&t:e.tts=TextToSpeechAPI.hasTTS(TN8.apip.apipObject)}return(TN8.apip.isASL||TN8.CatalogController&&TN8.CatalogController.CatalogASLController&&TN8.CatalogController.CatalogASLController.displayAsl())&&(e.asl=!0),e},a.prototype._injectAccommodations=function(e){e.dtts?(this._initDynamicTTS(),e.dtts=!0):e.tts?this._initTTS():($(document).off("tn.nav.start tn.test.finishing",this._cleanupTTS),$(document).trigger("TTSDOMReady","ButThereIsNoTTS")),!e.tts&&e.asl&&TN8.apip.isASL?this._initASL():TN8.apip.isASL?e.asl||$(document).trigger("ASLDOMReady","ASLDoesNotReallyExist"):$(document).trigger("ASLDOMReady","ASLDOMDone")},a.prototype._initTTS=function(){return TN8.apip.ttsObject=TextToSpeechAPI.init(TN8.apip.apipObject),$(document).off("tn.nav.start tn.test.finishing",this._cleanupTTS).one("tn.nav.start tn.test.finishing",this._cleanupTTS),null!==TN8.apip.ttsObject.ttsController},a.prototype._initASL=function(){for(var e in TN8.apip.apipObject.inclusionOrder)"aslDefaultOrder"!==e&&(TN8.apip.apipObject.inclusionOrder[e]=!1);TN8.apip.ttsObject=TextToSpeechAPI.init(TN8.apip.apipObject)},a.prototype._initDynamicTTS=function(){SBTTSAPI.init({$el:$("#itemCanvasBody"),catalogSupport:TN8.CatalogController?TN8.CatalogController.getCardsBySupport("spoken"):[],language:o.getLanguage(),autoScroll:this.isAutoScrollDefined()}),$(document).off("tn.nav.start tn.test.finishing",SBTTSAPI.cleanup).one("tn.nav.start tn.test.finishing",SBTTSAPI.cleanup)},a.prototype.isAutoScrollDefined=function(){return TestEngine.getTestDefine().getTTSScroll&&TestEngine.getTestDefine().getTTSScroll()},a.prototype._cleanupTTS=function(){TN8.apip&&TN8.apip.ttsObject&&(TN8.apip.ttsObject.finalize(),TN8.apip.ttsObject={finalize:function(){return!0}}),$(document).off("tn.nav.start tn.test.finishing",this._cleanupTTS)},a});var ExpandablePassageView=function(e){this._paneContainer=e,this._hasBidirectionalExpansion=e.hasClass("pane-expansion-dual"),this._leftPane=this._getLeftPane(e),this._rightPane=this._getRightPane(e),this._answerHider=null,this._expandButtonLeft=null,this._expandButtonRight=null,this._expandLabel=$.i18n?$.i18n.t("expand"):"Expand",this._collapseLabel=$.i18n?$.i18n.t("collapse"):"Collapse",this._buttonContainer=null,this._savedScrollTop=0,this.EXPANDED_RIGHT=1,this.EXPANDED_LEFT=2,this.NOT_EXPANDED=3,this._expandedState=this.NOT_EXPANDED,this.CLASS_HIDDEN="hidden",$(document).on("ItemController.cleanUpProcessStart",$.proxy(this._destroy,this)),this._toolsetHasExpandablePassage()&&this._hasExpandablePanes()&&this._setupExpandableView()};ExpandablePassageView.prototype._getLeftPane=function(e){return e.children(".left-pane.questionCell")},ExpandablePassageView.prototype._getRightPane=function(e){return e.children(".right-pane.answerCell")},ExpandablePassageView.prototype._toolsetHasExpandablePassage=function(){return this._getToolsetIds().indexOf(25)!==-1},ExpandablePassageView.prototype._getToolsetIds=function(){return this._hasTestEngine()?this._getTestEngineTools():this._getPreviewerTools()},ExpandablePassageView.prototype._hasTestEngine=function(){return!!window.TestEngine},ExpandablePassageView.prototype._getTestEngineTools=function(){return this._getTestEngineItemTools().concat(this._getTestEngineSectionTools())},ExpandablePassageView.prototype._getTestEngineItemTools=function(){return window.TestEngine.getNavigation().getCurrentItem().getToolset()||[]},ExpandablePassageView.prototype._getTestEngineSectionTools=function(){return window.TestEngine.getNavigation().getCurrentSection().getToolset()||[]},ExpandablePassageView.prototype._getPreviewerTools=function(){for(var e=[],t=app.testmap.attr.toolsets,n=0;n<t.length;n++)e=e.concat(t[n].tools);return e},ExpandablePassageView.prototype._hasExpandablePanes=function(){return 1===this._rightPane.length&&1===this._leftPane.length},ExpandablePassageView.prototype._setupExpandableView=function(){this._paneContainer.addClass("expandableView"),this._buttonContainer=this._setupButtonContainer(),this._paneContainer.prepend(this._buttonContainer),this._answerHider=$('<div id="answerHider"></div>'),this._paneContainer.prepend(this._answerHider),$(window).on("resize",$.proxy(this._onResize,this))},ExpandablePassageView.prototype._setupButtonContainer=function(e){var t=$('<div class="expandControls"><div>');this._expandButtonLeft=this._createButton("expandLeft","right",!1),this._expandButtonLeft.on("click",$.proxy(this._handleExpandLeft,this));var n=!this._hasBidirectionalExpansion;return this._expandButtonRight=this._createButton("expandRight","left",n),this._expandButtonRight.on("click",$.proxy(this._handleExpandRight,this)),t.append(this._expandButtonRight).append(this._expandButtonLeft),this._setupButtonContainerStyles(t),t},ExpandablePassageView.prototype._createButton=function(e,t,n){var i='<svg class="expand-icon" width="26" height="26"><line x1="6" y1="13" x2="20" y2="13"></line><polyline points="16, 8, 21, 13, 16, 18"></polyline><line x1="6" y1="5" x2="6" y2="21"></line></svg>',o='<svg class="collapse-icon" width="26" height="26"><line x1="6" y1="13" x2="20" y2="13"></line><polyline points="16, 8, 21, 13, 16, 18"></polyline><line x1="6" y1="5" x2="6" y2="21"></line></svg>',r=$('<button id="'+e+'" class="btn expandButton">'+i+o+"</button>");return this._addButtonAttributes(r,t),n&&r.addClass(this.CLASS_HIDDEN),r},ExpandablePassageView.prototype._addButtonAttributes=function(e,t){this._setButtonAriaLabel(e,this._expandLabel),e.tooltip({title:this._expandLabel,delay:0,animation:!1,placement:t})},ExpandablePassageView.prototype._setupButtonContainerStyles=function(e){this._leftPane.hasClass("span5")||this._leftPane.hasClass("qti-layout-col5")?e.addClass("split-5-7"):(this._leftPane.hasClass("span7")||this._leftPane.hasClass("qti-layout-col7"))&&e.addClass("split-7-5")},ExpandablePassageView.prototype._handleExpandLeft=function(){this._handleExpandButtonPress(this.EXPANDED_LEFT)},ExpandablePassageView.prototype._handleExpandRight=function(){this._handleExpandButtonPress(this.EXPANDED_RIGHT)},ExpandablePassageView.prototype._handleExpandButtonPress=function(e){this._expandedState===e?this._revertView():this._expandView(e);var t=this._getButtonForState(e);this._updateButtonAttributes(t,this._expandedState===e),$(window).trigger("resize")},ExpandablePassageView.prototype._revertView=function(){var e=this._expandedState===this.EXPANDED_LEFT?this._leftPane:this._rightPane,t=this._hasLostScrolling(e),n=this._getScrollPercent(e);this._removeViewClasses(),this._fixNiceScrollZIndex(this._getNiceScrolls(e),0),t?this._setScrollTop(e,this._savedScrollTop):this._setScrollPercent(e,n),this._expandedState=this.NOT_EXPANDED},ExpandablePassageView.prototype._expandView=function(e){var t,n;e===this.EXPANDED_LEFT?(t=this._leftPane,n="expandLeft"):(t=this._rightPane,n="expandRight");var i=this._getScrollPercent(t);this._savedScrollTop=this._getScrollTop(t),this._paneContainer.addClass("expandedView").addClass(n),this._setScrollPercent(t,i),this._fixNiceScrollZIndex(this._getNiceScrolls(t),2),this._expandedState=e,$(document).trigger("Used.ExpandedPassage")},ExpandablePassageView.prototype._getNiceScrolls=function(e){for(var t,n=[],i=e.find(".tab-scrolling, .passage-scrolling"),o=0;o<i.length;o++)t=$(i[o]).getNiceScroll(),t.length>0&&n.push(t);return n},ExpandablePassageView.prototype._fixNiceScrollZIndex=function(e,t){for(var n=0;n<e.length;n++)$("#"+e[n][0].id).css("z-index",t),$("#"+e[n][0].id+"-hr").css("z-index",t)},ExpandablePassageView.prototype._getButtonForState=function(e){return e===this.EXPANDED_LEFT?this._expandButtonLeft:this._expandButtonRight},ExpandablePassageView.prototype._updateButtonAttributes=function(e,t){var n;t?(n=this._collapseLabel,e.addClass("expanded")):(n=this._expandLabel,e.removeClass("expanded")),this._setButtonAriaLabel(e,n),e.attr("data-original-title",n).tooltip("fixTitle").tooltip("setContent")},ExpandablePassageView.prototype._setButtonAriaLabel=function(e,t){e.attr("aria-label",t)},ExpandablePassageView.prototype._removeViewClasses=function(){this._paneContainer.removeClass("expandedView").removeClass("expandLeft").removeClass("expandRight")},ExpandablePassageView.prototype._hasLostScrolling=function(e){return e.outerHeight()>=e[0].scrollHeight},ExpandablePassageView.prototype._onResize=function(e){this._paneContainer.find(".jwplayer").each(function(e,t){var n=jwplayer(t.id);n.resize("100%",n.getHeight())})},ExpandablePassageView.prototype._getScrollTop=function(e){return e[0].scrollTop},ExpandablePassageView.prototype._getScrollPercent=function(e){return this._getScrollTop(e)/e[0].scrollHeight},ExpandablePassageView.prototype._setScrollPercent=function(e,t){this._setScrollTop(e,e[0].scrollHeight*t)},ExpandablePassageView.prototype._setScrollTop=function(e,t){e.scrollTop(t)},ExpandablePassageView.prototype._destroy=function(){$(document).off("ItemController.cleanUpProcessStart",$.proxy(this._destroy,this)),$(window).off("resize",$.proxy(this._onResize,this)),this._paneContainer=null,this._rightPane=null,this._leftPane=null,this._expandButtonLeft&&this._expandButtonLeft.remove(),this._expandButtonRight&&this._expandButtonRight.remove(),this._buttonContainer&&this._buttonContainer.remove(),this._expandButtonLeft=null,this._expandButtonRight=null,this._buttonContainer=null},define("controllers/ExpandableViewController",function(){}),define("controllers/ExpandableViewControllerWrapper",["controllers/ExpandableViewController"],function(){return ExpandablePassageView}),define("controllers/TwoPaneScrollingController",["controllers/ExpandableViewControllerWrapper"],function(e){function t(t){function n(){$(document).on("ItemController.cleanUpProcessStart",r),$("html").addClass("pane-scrolling"),$(window).off("resize",i).on("resize",i),$(document).off("tn.header.sizeChanged",i).on("tn.header.sizeChanged",i),$(document).off("ItemController.ItemLoaded",i).one("ItemController.ItemLoaded",i),$(document).off("tn.header.sizeChanged",o).one("tn.header.sizeChanged",o),$(".passage-scrolling").parent().addClass("passage-parent"),$(".tab-content").parent().addClass("tabbed-passage-parent");new e(s)}function i(e){var t=$(".navbar").outerHeight(),n=$("#itemCanvas");$("html.pane-scrolling body").css("padding-top",t);var i=$(window).height()-t-parseInt(n.css("margin-top"),10)-parseInt(n.css("margin-bottom"),10)-1;$("html.pane-scrolling #itemCanvas").css("height",i)}function o(){setTimeout(function(){var e=$(".passage-scrolling"),t=$(".tabbed-passages");e.resize&&e.resize(),t.data("tabbedPassage")&&t.data("tabbedPassage").resize()},0)}function r(){$("html").removeClass("pane-scrolling"),$("body").css("padding-top",""),$("#itemCanvas").css("height",""),$(window).off("resize",i),$(document).off("tn.header.sizeChanged ItemController.ItemLoaded",i),$(document).off("tn.header.sizeChanged",o),s=null}var s=t;return{init:n}}return t}),define("models/FeatureUsageTrackerModel",[],function(){"use strict";var e=function(e){this.options=$.extend({},e,!0),this.analytics={}};return e.prototype.init=function(){_.bindAll(this),this.eventToName=this.options.eventToName,this.nameToId=this.options.nameToId,this._registerEvents()},e.prototype.getSnitchAnalytics=function(){if($.isEmptyObject(this.analytics))return null;var e=TestEngine.getNavigation()?TestEngine.getNavigation().getCurrentItem().getItemName():"",t=(new Date).toUTCString();return{itemId:e,timeStamp:t,metrics:this.analytics}},e.prototype._registerEvents=function(){for(var e in this.options.eventToName)$(document).on(e,this._recordAction)},e.prototype._recordAction=function(e,t){var n=this.options.eventToName[e.type+"."+e.namespace];this._setRecord(n,t)},e.prototype._setRecord=function(e,t){!this.analytics[e]&&this.nameToId[e]&&(this.analytics[e]={id:this.nameToId[e]}),t&&this._recordData(e,t)},e.prototype._recordData=function(e,t){t.attr&&(t.val||0===t.val)&&t.op&&("add"===t.op&&"number"==typeof t.val?this._addNumber(e,t.attr,t.val):"add"===t.op&&"string"==typeof t.val?this._addString(e,t.attr,t.val):"push"===t.op?this._pushValue(e,t.attr,t.val):this._defaultIncludeValue(e,t.attr,t.val))},e.prototype._addNumber=function(e,t,n){this.analytics[e][t]||(this.analytics[e][t]=0),this.analytics[e][t]+=n},e.prototype._addString=function(e,t,n){this.analytics[e][t]||(this.analytics[e][t]={}),this.analytics[e][t][n]||(this.analytics[e][t][n]=0),this.analytics[e][t][n]++},e.prototype._pushValue=function(e,t,n){this.analytics[e][t]||(this.analytics[e][t]=[]),this.analytics[e][t].push(n)},e.prototype._defaultIncludeValue=function(e,t,n){this.analytics[e][t]||(this.analytics[e][t]=0),this.analytics[e][t]=n},e.prototype._unregisterEvents=function(){for(var e in this.options.eventToName)$(document).off(e,this._recordAction)},e.prototype.destroy=function(){this._unregisterEvents(),this.analytics={}},e.prototype.restoreState=function(e){for(var t in e)this.analytics[t]=e[t]},e.prototype.toJSON=function(){return this.analytics},e}),define("models/FeatureUsageTrackerFactory",["models/FeatureUsageTrackerModel"],function(e){"use strict";var t,n,i;return{getFeatureUsageTracker:function(){return t},getSnitchUsageTracker:function(){return n},init:function(){return _.bindAll(this),this._startEndTestListener(),this.resetNextState(),this.options={eventToName:{"Used.Exhibit":"Exhibit","Used.Spellcheck":"Spellcheck","Used.TrimWarning":"TrimWarning","Used.TextToSpeech":"TextToSpeech","Used.ASLPlayer":"ASL","Used.JWPlayerAudio":"Audio","Used.JWPlayerVideo":"Video","Used.ExpandedPassage":"ExpandedPassage","Used.Popup":"Popup","Used.RulerQuarter":"RulerQuarter","Used.RulerEighth":"RulerEighth","Used.RulerCentimeter":"RulerCentimeter","Used.RulerMillimeter":"RulerMillimeter","Used.Protractor":"Protractor","Used.SingleDegreeProtractor":"SingleDegreeProtractor","Used.Straightedge":"Straightedge","Used.Dictionary3-5":"Dictionary3-5","Used.Dictionary6-8":"Dictionary6-8","Used.DictionaryHS":"DictionaryHS","Used.DictionarySp-En":"DictionarySp-En","Used.Notepad":"Notepad","Used.Highlighter":"Highlighter","Used.CalcScientific":"CalcScientific","Used.Calc4Func":"Calc4Func","Used.Calc5Func":"Calc5Func","Used.TI84":"TIGraphing","Used.TI30":"TIScientific","Used.TI108":"TIBasic","Used.DesmosCalcFourFunction":"DesmosCalcFourFunction","Used.DesmosCalcScientific":"DesmosCalcScientific","Used.DesmosCalcGraphing":"DesmosCalcGraphing","Used.AnswerEliminator":"AnswerEliminator","Used.ContrastSettings":"ContrastSettings","Used.Magnifier":"Magnifier","Used.LineReader":"LineReader","Used.AnswerMasking":"AnswerMasking","Used.ReadableMode":"ReadableMode","Used.Zoom":"Zoom"},nameToId:{Exhibit:"exhibit",Popup:"popup",Spellcheck:"spellcheck",TrimWarning:"trimwarning",TextToSpeech:"tts",ASL:"asl",Audio:"audio",Video:"video",ExpandedPassage:25,RulerQuarter:5,RulerEighth:6,Protractor:7,SingleDegreeProtractor:21,CalcScientific:9,Calc4Func:10,RulerCentimeter:11,Calc5Func:12,TIGraphing:13,AnswerEliminator:14,Highlighter:15,TIScientific:16,TIBasic:17,RulerMillimeter:19,"Dictionary3-5":27,"Dictionary6-8":28,DictionaryHS:29,"DictionarySp-En":30,Notepad:9001,Straightedge:20,DesmosCalcFourFunction:22,DesmosCalcScientific:23,DesmosCalcGraphing:24,ContrastSettings:1,Magnifier:3,LineReader:5,AnswerMasking:7,ReadableMode:8e3,Zoom:10}},this.splunkOptions={eventToName:{"Used.CharacterCount":"CharacterCount","Used.Formats":"Formats","Used.CharacterMap":"CharacterMap"},nameToId:{CharacterCount:"charactercount",Formats:"formats",CharacterMap:"charactermap"}},$.extend(!0,this.splunkOptions,this.options),this.snitchAnalytics=[],this},_startEndTestListener:function(){TN8.fnOn("tn.test.start",this._registerEvents),TN8.fnOn("cleanup.betweenTest",this._unregisterEvents)},_registerEvents:function(){TN8.fnOn("ItemController.ItemLoaded",this._createTrackers),TN8.fnOn("ItemController.cleanUpProcessStart",this._destroyTracker),TN8.fnOn("collectEndTestData",this.getEndTestAnalytics)},_unregisterEvents:function(){$(document).off("ItemController.ItemLoaded",this._createTrackers),$(document).off("ItemController.cleanUpProcessStart",this._destroyTracker),$(document).off("collectEndTestData",this.getEndTestAnalytics)},_createTrackers:function(){this._createFeatureTracker(),this._createSnitchTracker()},_createFeatureTracker:function(){return t=new e(this.options),t.init(),i&&(t.restoreState(i),this.resetNextState()),t},_createSnitchTracker:function(){return n=new e(this.splunkOptions),n.init(),n},_destroyTracker:function(){t&&(t.destroy(),t=null),n&&(this._addSnitchAnalytics(),n.destroy(),n=null)},_addSnitchAnalytics:function(){var e=n.getSnitchAnalytics();e&&this.snitchAnalytics.push(e)},getEndTestAnalytics:function(e,t){this.snitchAnalytics.length&&t(this.snitchAnalytics,"featureUsageMetrics")},loadState:function(e){return Object.keys(e).length>0&&(i=e),this},getNextState:function(){return i},resetNextState:function(){i=null},toJSON:function(){return t?t.toJSON():{}}}}),define("models/ItemState",["javascripts/backbone-min","models/InteractionState","models/FeatureUsageTrackerFactory"],function(e,t,n){"use strict";var i=function(e,t,n){"undefined"!=typeof e[t]&&(e[n]=e[t]),delete e[t]},o=e.Collection.extend({model:t}),r=e.Model.extend({defaults:{modules:[],analytics:{}},initialize:function(e,t){this.set("modules",new o(e.modules)),this.set("analytics",n.loadState(e.analytics))},toJSON:function(){var e=_.clone(this.attributes);for(var t in e)e[t]&&e[t].toJSON&&(e[t]=e[t].toJSON());return e}}),s=e.Model.extend({defaults:{itemstate:{},views:0,time:0,timeOnReview:0,timeOnUserDude:0,timeOnContrastDialog:0,timePlayingJwplayer:0,timeOnLogoutDialog:0,clientVersion:""},constructor:function(t,n){var i=$.extend(!0,{},t);i=this.fromRequestJSON(i),e.Model.prototype.constructor.call(this,i,n)},initialize:function(e,t){if(e&&e.itemstate){var n=new r(e.itemstate);this.set("itemstate",n)}return!1},getModules:function(){return this.get("itemstate").get("modules")},addModule:function(e){e instanceof t&&this.get("itemstate").get("modules").add(e)},clearModules:function(){var e={modules:[]},t=new r(e);this.set("itemstate",t)},toJSON:function(){var e=_.clone(this.attributes);for(var t in e)e[t]&&e[t].toJSON&&(e[t]=e[t].toJSON());return e},toRequestJSON:function(){var e,t,n,o,r=this.toJSON();for(e in r.itemstate.modules){n=r.itemstate.modules[e];var s=$.extend(!0,{},n);for(t in s){switch(t){case"response":o="r";break;case"sectionId":o="sid";break;case"dataId":o="did";break;case"itemId":o="id";break;case"itemType":o="it";break;case"answered":o="a";break;case"choiceOrder":o="or"}i(n,t,o)}}return i(r.itemstate,"modules","mods"),i(r,"time","t"),i(r,"timeOnReview","tor"),i(r,"timeOnUserDude","toud"),i(r,"timeOnContrastDialog","tocd"),i(r,"timePlayingJwplayer","tpjw"),i(r,"timeOnLogoutDialog","told"),i(r,"views","v"),i(r,"clientVersion","cv"),{mods:r.itemstate.mods,analytics:r.itemstate.analytics,t:r.t,tor:r.tor,toud:r.toud,tocd:r.tocd,tpjw:r.tpjw,told:r.told,v:r.v,cv:r.cv}},fromRequestJSON:function(e){var t,n,o,r;if(e.mods){e={itemstate:{mods:e.mods,analytics:e.analytics},t:e.t,tor:e.tor,toud:e.toud,tocd:e.tocd,tpjw:e.tpjw,told:e.told,v:e.v,cv:e.cv};for(t in e.itemstate.mods){o=e.itemstate.mods[t];var s=$.extend({},o,!0);for(n in s){switch(n){case"r":r="response";break;case"sid":r="sectionId";break;case"did":r="dataId";break;case"id":r="itemId";break;case"it":r="itemType";break;case"a":r="answered";break;case"or":r="choiceOrder"}i(o,n,r)}}i(e.itemstate,"mods","modules"),i(e,"t","time"),i(e,"tor","timeOnReview"),i(e,"toud","timeOnUserDude"),i(e,"tocd","timeOnContrastDialog"),i(e,"tpjw","timePlayingJwplayer"),i(e,"told","timeOnLogoutDialog"),i(e,"v","views"),i(e,"cv","clientVersion")}return e}});return s}),define("views/ModuleView",["javascripts/backbone-min"],function(e){"use strict";var t=e.View.extend({el:null,initialize:function(){_.bindAll(this,"render","saveState"),this.render()},render:function(){this.restoreState()},restoreState:function(){},saveState:function(){this.model.storeState(),$(document).trigger("controller.saveState.done",this.model)},ready:function(){$(document).trigger("ControllerSetReady","ModuleViewSuccess")}});return t}),define("views/ChoiceInteractionView",["javascripts/backbone-min","views/ModuleView","util/Dispatcher"],function(e,t,n){"use strict";var i=t.extend({initialize:function(){this.render(),TN8&&TN8.fnOn("tn.do.nav.next tn.do.nav.lastItem tn.do.nav.prev tn.do.nav.toItem tn.exitmodal.show inform.timeoutModalOn tn.error.fatal tn.ews.on",this.closeGrowls)},render:function(){this._feedbackEl=this.$el.clone().attr("id",this.$el.data("identifier").replace("interaction_",""))[0];var e=this;_.bindAll(this,"saveState"),this.choices=$("li",this.el),this.choices.bind("click",this.saveState),this.inputTag="input[type="+this.getInputType()+"]",this.restoreState(this.model.retrieveState(),this.el),this.model.setAnswered(this.isAnswered(this.getChoices())),$("#main_panel").trigger("ChoiceInteractionCreated",{moduleId:e.model.moduleId,choices:e.choices}),this.choices.find("img").on("load",function(e){$("#main_panel").trigger("ChoiceInteractionImageLoaded")}),$(document).on("getCorrectResponses",$.proxy(this.getCorrectResponse,this)),$(document).on("getFeedbackScore",$.proxy(this.getFeedbackScore,this)),this.setLabels(this.$el),this.ready()},setLabels:function(e){var t=e,n=t.find(".int-choice-label"),i=t.hasClass("labels-numeric")?"nums":t.hasClass("labels-none")?"none":"alpha",o=t.hasClass("suffix-none")?"":".";switch(i){case"alpha":$.each(n,function(e,t){var n=65;$(t).text(String.fromCharCode(e+n)+o)});break;case"nums":$.each(n,function(e,t){$(t).text(e+1+o)});break;case"none":$.each(n,function(e,t){$(t).remove()})}},remove:function(){this.answerMasker&&this.answerMasker.destroy&&(this.answerMasker.destroy(),this.answerMasker=null),this.closeGrowls(),$(document).off("tn.do.nav.next tn.do.nav.lastItem tn.do.nav.prev tn.do.nav.toItem tn.exitmodal.show inform.timeoutModalOn tn.error.fatal tn.ews.on",this.closeGrowls),$(document).off("getCorrectResponses",$.proxy(this.getCorrectResponse,this)),$(document).off("getFeedbackScore",$.proxy(this.getFeedbackScore,this))},getInputType:function(){for(var e=null,t=0;t<this.choices.length;t++)$("input[type=radio]",this.choices[t]).length?e='"radio"':$("input[type=checkbox]",this.choices[t]).length&&(e='"checkbox"');return e},isAnswered:function(e){var t=0,n=1,i=this.$el.data("maxchoices"),o=this.$el.data("minchoices");void 0==o||isNaN(parseInt(o))||(n=parseInt(o),i&&i>0&&n>i&&(n=i)),n<1&&(n=1);for(var r=0;r<e.length;r++)e[r].selected&&t++;return t>=n},getChoices:function(){for(var e=[],t=this,n=0;n<this.choices.length;n++){var i={};i.id=$(t.inputTag,this.choices[n]).attr("value"),i.selected=$(t.inputTag,this.choices[n]).is(":checked"),i.eliminated=!1,e.push(i)}return e},saveState:function(e){e&&this.blockMaxSelection($(e.target));var n=this.getChoices();this.model.setAnswered(this.isAnswered(n));for(var i=[],o=0;o<n.length;o++)n[o].selected&&i.push(n[o].id);this.model.stateTemplate.set("response",i),t.prototype.saveState.call(this)},blockMaxSelection:function(e){var t=e.closest("ul").data("maxchoices"),n=e.closest("ul").data("maxchoices-message");if(n||(n=t>1?$.i18n?$.i18n.t("choiceInteraction:maxChoiceMsg_plural",{count:t}):"You are permitted a <strong>maximum of "+t+" choices</strong> for this question.<br/>Please unselect one of your choices before making another choice.":$.i18n?$.i18n.t("choiceInteraction:maxChoiceMsg",{count:t}):"You are permitted a <strong>maximum of "+t+" choice</strong> for this question.<br/>Please unselect one of your choices before making another choice."),void 0!==t&&t>0){var i=$(this.inputTag+":checked",this.el);i.length>t?(e.prop("checked",!1),$.jGrowl(n,{theme:"warning closechoiceinteraction "+$(this.el).attr("data-identifier"),life:5e3,sticky:!1})):i.length<t&&this.closeGrowlsById()}},closeGrowls:function(){$(".closechoiceinteraction > .jGrowl-close").click()},closeGrowlsById:function(){$(".closechoiceinteraction."+$(this.el).attr("data-identifier")+" > .jGrowl-close").click()},restoreState:function(e,t){var n=$("li",t);if(null!==e){for(var i=this,o=e.response?e.response:e.get("response"),r=0;r<n.length;r++){for(var s=$(i.inputTag,n[r]),a=s.attr("value"),l=!1,c=0;c<o.length;c++)o[c]===a&&(l=!0);s.prop("checked",l)}if(t==this.el&&"cloze"===$(t).attr("data-subtype")){var d="setResponseData_"+this.model.moduleId;if(window[d]&&e){var u,h=e.toJSON();(null===h.response||_.isEmpty(h.response))&&(h.response=""),u=h.response.data?h.response.data:h.response,window[d](u)}}return t}},getFeedbackScore:function(e,t){for(var n=this.getChoices(),i=[],o=0;o<n.length;o++)n[o].selected&&i.push(n[o].id);t.callback&&t.callback({id:this._feedbackEl.id,response:i})},getCorrectResponse:function(e,t){var n=this.findCorrectResponse(t.responses),i=this.restoreState(n,this._feedbackEl);this.setLabels($(i)),$(i).find("[type=radio]").removeAttr("id").removeAttr("name"),$(i).find(".radio, .checkbox").removeAttr("for"),t.callback&&t.callback(i)},findCorrectResponse:function(e){var t=this,n={};return e.some(function(e,i){var o=e.did+"(?!\\d)",r=new RegExp(o,"g"),s=t.$el.data("identifier").match(r);if(s)return n.response=e.r,!0}),n},ready:function(){$(document).trigger("ControllerSetReady","ChoiceInteractionSuccess")}});return i}),define("controllers/ChoiceInteractionController",["javascripts/backbone-min","controllers/ModuleController","views/ModuleView","views/ChoiceInteractionView"],function(e,t,n,i){"use strict";var o=t.extend({init:function(e){t.prototype.init.call(this,e),this.moduleView=new i({model:this,el:$(e)})}});return o}),define("views/InlineChoiceView",["javascripts/backbone-min","views/ModuleView"],function(e,t){"use strict";var n=t.extend({render:function(){_.bindAll(this,"saveState"),$(this.el).on("change",this.saveState),$(this.el).keydown(function(e){if(8===e.keyCode&&(e.preventDefault(),e.stopPropagation()),32===e.keyCode){var t=$(this)[0].selectedIndex;$(this).prop("selectedIndex",t),$(this).blur()}}),this.el=this.restoreState(this.model.retrieveState(),this.el),$(document).on("getCorrectResponses",$.proxy(this.getCorrectResponse,this)),$(document).on("getFeedbackScore",$.proxy(this.getFeedbackScore,this)),this.ready()},saveState:function(e){e&&e.stopPropagation();var n=$("option:not(:first)",this.el).filter(":selected").toArray().map(function(e){return e.value}),i=n.length>0;this.model.setAnswered(i),this.model.stateTemplate.set("response",n),t.prototype.saveState.call(this)},getFeedbackScore:function(e,t){var n=$("option:not(:first)",this.el).filter(":selected").toArray().map(function(e){return e.value});t.callback&&t.callback({id:this._feedbackEl.id,response:n})},getCorrectResponse:function(e,t){this._feedbackEl=this.$el.clone().attr("id",this.$el[0].id.replace("interaction_",""))[0];var n=this.findCorrectResponse(t.responses),i=this.restoreState(n,this._feedbackEl);t.callback&&t.callback(i)},findCorrectResponse:function(e){var t=this,n={};return e.some(function(e,i){var o=e.did+"(?!\\d)",r=new RegExp(o,"g"),s=t.$el[0].id.match(r);if(s)return n.response=e.r,!0}),n},restoreState:function(e,t){if(null!==e){var n=e.response?e.response:e.get("response");if(t==this.el&&this.model.setAnswered(!_.isEmpty(n)),$.isArray(n))for(var i=0;i<n.length;i++)$("option[value='"+n[i]+"']",t).prop("selected",!0);else $("option[value='"+n+"']",t).prop("selected",!0)}if("cloze"===$(t).attr("data-subtype")&&t==this.el){var o="setResponseData_"+this.model.moduleId;if(window[o]&&e){var r,s=e.toJSON();(null===s.response||_.isEmpty(s.response))&&(s.response=""),r=s.response.data?s.response.data:s.response,window[o](r)}}return t},remove:function(){$(document).off("getCorrectResponses",$.proxy(this.getCorrectResponse,this)),$(document).off("getFeedbackScore",$.proxy(this.getFeedbackScore,this))}});return n}),define("controllers/InlineChoiceController",["javascripts/backbone-min","controllers/ModuleController","views/ModuleView","views/InlineChoiceView"],function(e,t,n,i){"use strict";var o=t.extend({init:function(e){t.prototype.init.call(this,e),this.moduleView=new i({model:this,el:$(e)})}});return o}),define("controllers/CustomInteractionController",["javascripts/backbone-min","controllers/ModuleController","require"],function(Backbone,ModuleController,require){"use strict";var CustomInteractionController=function(){return this.moduleController=new ModuleController,this.persistAnswered=!1,this};return CustomInteractionController.prototype.init=function(e){TN8.log("CustomInteractionController.init  "+$(e).attr("data-module"),TN8.IMPORTANT),this.moduleController.init(e);var t=this.moduleController.retrieveState();this.retrieveFromEval(t),this.ready()},CustomInteractionController.prototype.setItemType=function(e){},CustomInteractionController.prototype.retrieveState=function(){return TN8.log("CustomInteractionController.retrieveState",TN8.HELPFUL),this.moduleController.retrieveState()},CustomInteractionController.prototype.testIfAnswered=function(e){return TN8.log("CustomInteractionController.testIfAnswered",TN8.HELPFUL),!(!_.isArray(e)||e.answered||!e.length)||(_.isObject(e)?"undefined"==typeof e.answered||null===e.answered?(TN8.log("response doesnt contain answered property (customInteraction).",TN8.IMPORTANT),console.log("response doesn't contain answered property (customInteraction)."),console.log(e),!1):"boolean"==typeof e.answered?e.answered:!(!e.answered||"true"!==e.answered)||(this.persistAnswered!==!1||e.answered!==!1)&&!$.isEmptyObject(e.data):(TN8.log("CustomInteractionController.testIfAnswered, wrong response is being send back from customInteraction.",TN8.CRITICAL),
console.log(e),!1))},CustomInteractionController.prototype.retrieveFromEval=function(e){try{if(TN8.log("CustomInteractionController.retrieveFromEval try statement",TN8.HELPFUL),e=e||this.moduleController.retrieveState(),null===e)return;var t=e.toJSON();(null===t.response||_.isEmpty(t.response))&&(t.response=""),this.setAnswered(CustomInteractionController.prototype.testIfAnswered(t));var n=this.getJsonMsgFromJsonState(t),i=this.moduleController.moduleId;if(window["setResponseData_"+i]&&!_.isEmpty(n)){window["setResponseData_"+i](n)}}catch(e){TN8.log("CustomInteractionController.retrieveFromEval catch statement. ErroMessage : "+e.message,TN8.CRITICAL),TN8.throw(e.message,TN8.errorType.LIB_RETRIEVE_ERROR)}},CustomInteractionController.prototype.getJsonMsgFromJsonState=function(e){return e.response.data||e.response},CustomInteractionController.prototype.storeState=function(e){TN8.log("CustomInteractionController.storeState",TN8.HELPFUL),this.moduleController.stateTemplate.set("response",e),this.moduleController.storeState()},CustomInteractionController.prototype.storeFromEval=function(){TN8.log("CustomInteractionController.storeFromEval",TN8.HELPFUL);var e,t=this._getResponse();e="undefined"!=typeof t.data?t.data:t,this.setAnswered(this.testIfAnswered(t)),this.storeState(e),$(document).trigger("controller.saveState.done",this)},CustomInteractionController.prototype.setAnswered=function(e){TN8.log("CustomInteractionController.setAnswered",TN8.HELPFUL),this.persistAnswered=!!this.moduleController.ignoreAnswered||e,this.moduleController.setAnswered(e)},CustomInteractionController.prototype._getResponse=function(){TN8.log("CustomInteractionController.getResponse",TN8.HELPFUL);var identifier=this.moduleController.moduleId,JsonMsg=null;try{window["getResponseData_"+identifier]&&(JsonMsg=eval("getResponseData_"+identifier+"()"))}catch(e){TN8.throw(e.message,TN8.errorType.CIC_GET_RESPONSE_FAILED),TN8.log("CustomInteractionController.getResponse catch statement. getResponseData_"+identifier,TN8.CRITICAL)}return JsonMsg},CustomInteractionController.prototype.getModuleController=function(){return this.moduleController},CustomInteractionController.prototype.isAnswered=function(){return this.persistAnswered=!!this.moduleController.ignoreAnswered||this.persistAnswered,this.persistAnswered},CustomInteractionController.prototype.ready=function(){$(document).trigger("ControllerSetReady","CustomInteractionReady")},CustomInteractionController.prototype.cleanUp=function(){TN8.log("CustomInteractionController.cleanUp",TN8.HELPFUL);var e=this;if(window.responseSchema){var t,n;for(t=0;t<window.responseSchema.length;t++)if(n=window.responseSchema[t],n.identifier&&n.identifier===e.moduleController.moduleId){window["interaction_"+n.identifier+"_options"]=null,window["interaction_"+n.identifier]=void 0,window["getResponseData_"+n.identifier]=null,window["setResponseData_"+n.identifier]=null,window["finalize_"+n.identifier]=null,window.responseSchema.splice(t,1);break}}ModuleController.prototype.cleanUp.call(this)},CustomInteractionController.prototype.setModuleName=ModuleController.prototype.setModuleName,CustomInteractionController.prototype.getModuleName=ModuleController.prototype.getModuleName,CustomInteractionController}),define("controllers/MatchInteractionController",["controllers/CustomInteractionController"],function(e){"use strict";var t=function(){return e.call(this),this};return t.prototype=$.extend(!0,{},e.prototype),t.prototype.testIfAnswered=function(e){return this.isAnswered()},t.prototype.isAnswered=function(){var e=$("#interaction_"+this.moduleController.moduleId).matchInteraction("getAnswered");return!!this.moduleController.ignoreAnswered||e},t}),define("controllers/MatchGridInteractionController",["controllers/CustomInteractionController"],function(e){"use strict";var t=function(){return e.call(this),this};return t.prototype=$.extend(!0,{},e.prototype),t.prototype.testIfAnswered=function(e){return this.isAnswered()},t.prototype.isAnswered=function(){var e=$("#interaction_"+this.moduleController.moduleId).matchgridInteraction("getAnswered");return e},t}),define("controllers/OrderInteractionController",["controllers/CustomInteractionController"],function(e){"use strict";var t=function(){return e.call(this),this};return t.prototype=$.extend(!0,{},e.prototype),t.prototype.superInit=function(e){TN8.log("OrderInteractionController.init "+$(e).attr("data-module"),TN8.IMPORTANT),this.moduleController.init(e),$(e).orderInteraction("setBadResponseHandler",this.badResponseHandler);var t=this.moduleController.retrieveState();this.retrieveFromEval(t),$(e).orderInteraction("setAnswered",this.persistAnswered),this.ready()},t.prototype.init=function(e){var t=!0,n=this;if(window.responseSchema&&window.responseSchema.length>0)for(var i=0;i<window.responseSchema.length;i++)if(window.responseSchema[i].identifier===$(e).data("identifier")&&"tei-order"!=window.responseSchema[i].subType){TN8.log("OrderInteractionController.init widgetize interaction "+$(e).attr("data-module"),TN8.IMPORTANT),t=!1;var o=window.responseSchema[i].identifier,r=function(t){window["interaction_"+o]=$("#interaction_"+o).orderInteraction({}),window["getResponseData_"+o]=function(){return window["interaction_"+o].orderInteraction("getResponseData")},window["setResponseData_"+o]=function(e){return window["interaction_"+o].orderInteraction("setResponseData",e)},n.superInit(e)};require(["javascripts/jquery.widget.orderinteraction"],r);break}t&&this.superInit(e)},t.prototype.testIfAnswered=function(e){return this.isAnswered()},t.prototype.isAnswered=function(){var e=window["interaction_"+this.moduleController.moduleId],t=$(e).orderInteraction("getAnswered");return t},t.prototype.badResponseHandler=function(){TN8.throw("Order interaction response was missing options.",TN8.errorType.WRONG_RESPONSE_ERROR)},t}),define("views/passageView",["javascripts/backbone-min","views/ModuleView","javascripts/jquery-ui.min"],function(e,t){"use strict";var n=t.extend({scrolled:!1,scrollbar:null,initialize:function(){_.bindAll(this,"render","isMobile","onResize","cleanUp"),$(window).on("resize",this.onResize),$(document).on("JWReady ProgramStylesApplied TabbedPassageTabChange PCIReady ItemController.ItemLoaded",this.onResize),TN8.Dispatcher.on("ItemController.cleanUpProcessStart",this.cleanUp),this.render()},onResize:function(e){var t=this;setTimeout(function(){$("body").hasClass("readerMode")||t.scrollbar&&t.scrollbar.resize&&t.scrollbar.resize()},0)},isMobile:function(){return/android|iphone|ipad|ipod/i.test(navigator.userAgent.toLowerCase())},render:function(){var e=$(this.el);if(e.find(".poem_body").length>0)if(e.hasClass("scrollbar-new"))this.scrollbar=e.nativeScroll({hEnabled:!0});else if(e.hasClass("scrollbar-iscroll")&&this.isMobile()){var t=this;require(["javascripts/jquery.iscroll"],function(){t.scrollbar=e.iscroll({hEnabled:!0})})}else this.scrollbar=e.niceScroll({touchbehavior:!1,autohidemode:!1,zindex:0,cursorminheight:40});else if(e.hasClass("scrollbar-new"))this.scrollbar=e.nativeScroll();else if(e.hasClass("scrollbar-iscroll")&&this.isMobile()){var t=this;require(["javascripts/jquery.iscroll"],function(){t.scrollbar=e.iscroll()})}else this.scrollbar=e.niceScroll({touchbehavior:!1,autohidemode:!1,zindex:0,cursorminheight:40,horizrailenabled:!1});$("img",e).on("load",function(){e.getNiceScroll().resize(),window.itemBehaviors&&window.itemBehaviors.reapplyAll()});var n=$(".passage-scrolling .int-extended-text");this.isMobile()&&n.each(function(t,n){$(n).on("focus",function(t){var n=$(this).closest(".passage-scrolling"),i=n.position().top,o=$(this),r=e.scrollTop(),s=e.height(),a=o.position().top-i+r,l=o.height();a+l>r+s?e[0].scrollTop=a-s+l+20:r>a&&(e[0].scrollTop=a)})}),n.on("mouseup mouseout touchend",function(e){var t=$(this).closest(".passage-scrolling");t.getNiceScroll().resize()}),n.on("keydown",function(e){if(13==e.keyCode){var t=$(this).closest(".passage-scrolling");t.getNiceScroll().resize()}}),this.onResize()},cleanUp:function(){$(window).off("resize",this.onResize),$(document).off("JWReady ProgramStylesApplied TabbedPassageTabChange PCIReady ItemController.ItemLoaded",this.onResize),TN8.Dispatcher.off("ItemController.cleanUpProcessStart",this.cleanUp)}});return n}),define("controllers/passageController",["javascripts/backbone-min","controllers/ModuleController","views/ModuleView","views/passageView"],function(e,t,n,i){"use strict";var o=t.extend({init:function(e,n){t.prototype.init.call(this,e),this.behaviors=n,this.moduleView=new i({model:this,el:$(e)})}});return o}),!function(e){function t(){var e=document.getElementsByTagName("script"),t=e[e.length-1].src.split("?")[0];return t.split("/").length>0?t.split("/").slice(0,-1).join("/")+"/":""}function n(e,t,n){for(var i=0;i<t.length;i++)n(e,t[i])}var i=!1,o=!1,r=2e3,s=0,l=e,c=t();Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,i=this.length;n<i;++n)e.call(t,this[n],n,this)});var d=["ms","moz","webkit","o"],u=window.requestAnimationFrame||!1,h=window.cancelAnimationFrame||!1;d.forEach(function(e){u||(u=window[e+"RequestAnimationFrame"]),h||(h=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"])});var p=window.MutationObserver||window.WebKitMutationObserver||!1,m={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!1,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:!1,cursordragontouch:!0,preventmultitouchscrolling:!0},f=!1,g=function(){function e(){if(!i.isios){var e=["-moz-grab","-webkit-grab","grab"];(i.ischrome&&!i.ischrome22||i.isie)&&(e=[]);for(var t=0;t<e.length;t++){var o=e[t];if(n.cursor=o,n.cursor==o)return o}return"url(/client/public/images/global/openhand.cur),n-resize"}}if(f)return f;var t=document.createElement("DIV"),n=t.style,i=(navigator.userAgent,navigator.platform,{});i.haspointerlock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.isopera="opera"in window,i.isopera12=i.isopera&&"getUserMedia"in navigator,i.isie="all"in document&&"attachEvent"in t&&!i.isopera,i.isieold=i.isie&&!("msInterpolationMode"in n),i.isie7=i.isie&&!i.isieold&&(!("documentMode"in document)||7==document.documentMode),i.isie8=i.isie&&"documentMode"in document&&8==document.documentMode,i.isie9=i.isie&&"performance"in window&&9==document.documentMode,i.isie10=i.isie&&"performance"in window&&10==document.documentMode,i.isie11="msRequestFullscreen"in t&&document.documentMode>=11,i.isieedge12=navigator.userAgent.match(/Edge\/12\./),i.isieedge=navigator.userAgent.match(/Edge/),i.ismodernie=i.isie11||i.isieedge,i.isie9mobile=/iemobile.9/i.test(navigator.userAgent),i.isie9mobile&&(i.isie9=!1),i.isie7mobile=!i.isie9mobile&&i.isie7&&/iemobile/i.test(navigator.userAgent),i.ismozilla="MozAppearance"in n,i.iswebkit="WebkitAppearance"in n,i.ischrome="chrome"in window,i.ischrome22=i.ischrome&&i.haspointerlock,i.ischrome26=i.ischrome&&"transition"in n,i.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,i.hasmstouch=window.navigator.msPointerEnabled||window.PointerEvent||!1,i.ismac=/^mac$/i.test(navigator.platform),i.isios=i.cantouch&&/iphone|ipad|ipod/i.test(navigator.platform),i.isios4=i.isios&&!("seal"in Object),i.isandroid=/android/i.test(navigator.userAgent),i.trstyle=!1,i.hastransform=!1,i.hastranslate3d=!1,i.transitionstyle=!1,i.hastransition=!1,i.transitionend=!1;for(var o=["transform","msTransform","webkitTransform","MozTransform","OTransform"],r=0;r<o.length;r++)if("undefined"!=typeof n[o[r]]){i.trstyle=o[r];break}i.hastransform=0!=i.trstyle,i.hastransform&&(n[i.trstyle]="translate3d(1px,2px,3px)",i.hastranslate3d=/translate3d/.test(n[i.trstyle])),i.transitionstyle=!1,i.prefixstyle="",i.transitionend=!1;for(var o=["transition","webkitTransition","MozTransition","OTransition","OTransition","msTransition","KhtmlTransition"],s=["","-webkit-","-moz-","-o-","-o","-ms-","-khtml-"],a=["transitionend","webkitTransitionEnd","transitionend","otransitionend","oTransitionEnd","msTransitionEnd","KhtmlTransitionEnd"],r=0;r<o.length;r++)if(o[r]in n){i.transitionstyle=o[r],i.prefixstyle=s[r],i.transitionend=a[r];break}return i.ischrome26&&(i.prefixstyle=s[1]),i.hastransition=i.transitionstyle,i.cursorgrabvalue=e(),i.hasmousecapture="setCapture"in t,i.hasMutationObserver=p!==!1,t=null,f=i,i},v=function(e,t){function n(){var e=b.doc.css(y.trstyle);return!(!e||"matrix"!=e.substr(0,6))&&e.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/)}function a(){var e=b.win;if("zIndex"in e)return e.zIndex();for(;e.length>0;){if(9==e[0].nodeType)return!1;var t=e.css("zIndex");if(!isNaN(t)&&0!=t)return parseInt(t);e=e.parent()}return!1}function d(e,t,n){var i=e.css(t),o=parseFloat(i);if(isNaN(o)){o=S[i]||0;var r=3==o?n?b.win.outerHeight()-b.win.innerHeight():b.win.outerWidth()-b.win.innerWidth():1;return b.isie8&&o&&(o+=1),r?o:0}return o}function f(e,t,n,i){b._bind(e,t,function(i){var i=i?i:window.event,o={original:i,target:i.target||i.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return i.preventDefault?i.preventDefault():i.returnValue=!1,!1},stopImmediatePropagation:function(){i.stopImmediatePropagation?i.stopImmediatePropagation():i.cancelBubble=!0}};return"mousewheel"==t?(o.deltaY=-.025*i.wheelDelta,i.wheelDeltaX&&(o.deltaX=-.025*i.wheelDeltaX)):o.deltaY=i.detail,n.call(e,o)},i)}function v(e,t,n){var i,o;if(0==e.deltaMode?(i=-Math.floor(e.deltaX*(b.opt.mousescrollstep/54)),o=-Math.floor(e.deltaY*(b.opt.mousescrollstep/54))):1==e.deltaMode&&(i=-Math.floor(e.deltaX*b.opt.mousescrollstep),o=-Math.floor(e.deltaY*b.opt.mousescrollstep)),t&&0==i&&o&&(i=o,o=0),i&&(b.scrollmom&&b.scrollmom.stop(),b.lastdeltax+=i,b.debounced("mousewheelx",function(){var e=b.lastdeltax;b.lastdeltax=0,b.rail.drag||b.doScrollLeftBy(e)},120)),o){if(b.opt.nativeparentscrolling&&n&&!b.ispage&&!b.zoomactive)if(o<0){if(b.getScrollTop()>=b.page.maxh)return!0}else if(b.getScrollTop()<=0)return!0;b.scrollmom&&b.scrollmom.stop(),b.lastdeltay+=o,b.debounced("mousewheely",function(){var e=b.lastdeltay;b.lastdeltay=0,b.rail.drag||b.doScrollBy(e)},120)}return e.stopImmediatePropagation(),e.preventDefault()}var b=this;if(this.version="3.4.0",this.name="nicescroll",this.me=t,this.opt={doc:l("body"),win:!1},l.extend(this.opt,m),this.opt.snapbackspeed=80,e)for(var w in b.opt)"undefined"!=typeof e[w]&&(b.opt[w]=e[w]);this.doc=b.opt.doc,this.iddoc=this.doc&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/BODY|HTML/.test(b.opt.win?b.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=b.opt.win!==!1,this.win=b.opt.win||(this.ispage?l(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?l(window):this.win,this.body=l("body"),this.viewport=!1,this.isfixed=!1,this.iframe=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=b.opt.autohidemode,this.onmousedown=!1,this.onmouseup=!1,this.onmousemove=!1,this.onmousewheel=!1,this.onkeypress=!1,this.ongesturezoom=!1,this.onclick=!1,this.onscrollstart=!1,this.onscrollend=!1,this.onscrollcancel=!1,this.onzoomin=!1,this.onzoomout=!1,this.view=!1,this.page=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,this.checkrtlmode=!1,this.scrollrunning=!1,this.scrollmom=!1,this.observer=!1,this.observerremover=!1;do this.id="ascrail"+r++;while(document.getElementById(this.id));this.rail=!1,this.cursor=!1,this.cursorfreezed=!1,this.selectiondrag=!1,this.zoom=!1,this.zoomactive=!1,this.hasfocus=!1,this.hasmousefocus=!1,this.visibility=!0,this.locked=!1,this.hidden=!1,this.cursoractive=!0,this.overflowx=b.opt.overflowx,this.overflowy=b.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltax=0,this.lastdeltay=0,this.detected=g();var y=l.extend({},this.detected);this.canhwscroll=y.hastransform&&b.opt.hwacceleration,this.ishwscroll=this.canhwscroll&&b.haswrapper,this.istouchcapable=!1,y.cantouch&&y.ischrome&&!y.isios&&!y.isandroid&&(this.istouchcapable=!0,y.cantouch=!1),y.cantouch&&y.ismozilla&&!y.isios&&(this.istouchcapable=!0,y.cantouch=!1),b.opt.enablemouselockapi||(y.hasmousecapture=!1,y.haspointerlock=!1),this.delayed=function(e,t,n,i){var o=b.delaylist[e],r=(new Date).getTime();return!(!i&&o&&o.tt)&&(o&&o.tt&&clearTimeout(o.tt),void(o&&o.last+n>r&&!o.tt?b.delaylist[e]={last:r+n,tt:setTimeout(function(){b.delaylist&&(b.delaylist[e].tt=0,t.call())},n)}:o&&o.tt||(b.delaylist[e]={last:r,tt:0},setTimeout(function(){t.call()},0))))},this.debounced=function(e,t,n){var i=b.delaylist[e];(new Date).getTime(),b.delaylist[e]=t,i||(b.debouncedelayed=setTimeout(function(){if(b.delaylist){var t=b.delaylist[e];b.delaylist[e]=!1,t.call()}},n))},this.synched=function(e,t){function n(){b.onsync||(u(function(){b.onsync=!1;for(e in b.synclist){var t=b.synclist[e];t&&t.call(b),b.synclist[e]=!1}}),b.onsync=!0)}return b.synclist[e]=t,n(),e},this.unsynched=function(e){b.synclist[e]&&(b.synclist[e]=!1)},this.css=function(e,t){for(var n in t)b.saved.css.push([e,n,e.css(n)]),e.css(n,t[n])},this.scrollTop=function(e){return"undefined"==typeof e?b.getScrollTop():b.setScrollTop(e)},this.scrollLeft=function(e){return"undefined"==typeof e?b.getScrollLeft():b.setScrollLeft(e)},BezierClass=function(e,t,n,i,o,r,s){this.st=e,this.ed=t,this.spd=n,this.p1=i||0,this.p2=o||1,this.p3=r||0,this.p4=s||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st},BezierClass.prototype={B2:function(e){return 3*e*e*(1-e)},B3:function(e){return 3*e*(1-e)*(1-e)},B4:function(e){return(1-e)*(1-e)*(1-e)},getNow:function(){var e=(new Date).getTime(),t=1-(e-this.ts)/this.spd,n=this.B2(t)+this.B3(t)+this.B4(t);return t<0?this.ed:this.st+Math.round(this.df*n)},update:function(e,t){return this.st=this.getNow(),this.ed=e,this.spd=t,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}},this.ishwscroll?(this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},y.hastranslate3d&&y.isios&&this.doc.css("-webkit-backface-visibility","hidden"),this.getScrollTop=function(e){if(!e){var t=n();if(t)return 16==t.length?-t[13]:-t[5];if(b.timerscroll&&b.timerscroll.bz)return b.timerscroll.bz.getNow()}return b.doc.translate.y},this.getScrollLeft=function(e){if(!e){var t=n();if(t)return 16==t.length?-t[12]:-t[4];if(b.timerscroll&&b.timerscroll.bh)return b.timerscroll.bh.getNow()}return b.doc.translate.x},document.createEvent?this.notifyScrollEvent=function(e){var t=document.createEvent("UIEvents");t.initUIEvent("scroll",!1,!0,window,1),e.dispatchEvent(t)}:document.fireEvent?this.notifyScrollEvent=function(e){var t=document.createEventObject();e.fireEvent("onscroll"),t.cancelBubble=!0}:this.notifyScrollEvent=function(e,t){},y.hastranslate3d&&b.opt.enabletranslate3d?(this.setScrollTop=function(e,t){b.doc.translate.y=e,b.doc.translate.ty=e*-1+"px",b.doc.css(y.trstyle,"translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)"),t||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(e,t){b.doc.translate.x=e,b.doc.translate.tx=e*-1+"px",b.doc.css(y.trstyle,"translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)"),t||b.notifyScrollEvent(b.win[0])}):(this.setScrollTop=function(e,t){b.doc.translate.y=e,b.doc.translate.ty=e*-1+"px",b.doc.css(y.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")"),t||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(e,t){b.doc.translate.x=e,b.doc.translate.tx=e*-1+"px",b.doc.css(y.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")"),t||b.notifyScrollEvent(b.win[0])})):(this.getScrollTop=function(){return b.docscroll&&b.docscroll.scrollTop()},this.setScrollTop=function(e){return b.docscroll&&b.docscroll.scrollTop(e)},this.getScrollLeft=function(){return b.docscroll.scrollLeft()},this.setScrollLeft=function(e){return b.docscroll.scrollLeft(e)}),this.getTarget=function(e){return!!e&&(e.target?e.target:!!e.srcElement&&e.srcElement)},this.hasParent=function(e,t){if(!e)return!1;for(var n=e.target||e.srcElement||e||!1;n&&n.id!=t;)n=n.parentNode||!1;return n!==!1};var S={thin:1,medium:3,thick:5};this.getOffset=function(){if(b.isfixed)return{top:parseFloat(b.win.css("top")),left:parseFloat(b.win.css("left"))};if(!b.viewport)return l(b.win).tnOffset();var e=l(b.win).tnOffset(),t=b.viewport.offset();return{top:e.top-t.top+b.viewport.scrollTop(),left:e.left-t.left+b.viewport.scrollLeft()}},this.updateScrollBar=function(e){if(b.ishwscroll)b.rail.css({height:b.win.innerHeight()}),b.railh&&b.railh.css({width:b.win.innerWidth()});else{var t=b.getOffset(),n={top:t.top,left:t.left};n.top+=d(b.win,"border-top-width",!0),(b.win.outerWidth()-b.win.innerWidth())/2,n.left+=b.rail.align?b.win.outerWidth()-d(b.win,"border-right-width")-b.rail.width:d(b.win,"border-left-width");var i=b.opt.railoffset;if(i&&(i.top&&(n.top+=i.top),b.rail.align&&i.left&&(n.left+=i.left)),b.locked||b.rail.css({top:n.top,left:n.left,height:e?e.h:b.win.innerHeight()}),b.zoom&&b.zoom.css({top:n.top+1,left:1==b.rail.align?n.left-20:n.left+b.rail.width+4}),b.railh&&!b.locked){var n={top:t.top,left:t.left},o=b.railh.align?n.top+d(b.win,"border-top-width",!0)+b.win.innerHeight()-b.railh.height:n.top+d(b.win,"border-top-width",!0),r=n.left+d(b.win,"border-left-width");b.railh.css({top:o,left:r,width:b.railh.width})}}},this.doRailClick=function(e,t,n){var i,o,r,s;b.locked||(b.cancelEvent(e),t?(i=n?b.doScrollLeft:b.doScrollTop,r=n?(e.pageX-b.railh.offset().left-b.cursorwidth/2)*b.scrollratio.x:(e.pageY-b.rail.offset().top-b.cursorheight/2)*b.scrollratio.y,i(r)):(i=n?b.doScrollLeftBy:b.doScrollBy,r=n?b.scroll.x:b.scroll.y,s=n?e.pageX-b.railh.offset().left:e.pageY-b.rail.offset().top,o=n?b.view.w:b.view.h,i(r>=s?o:-o)))},b.hasanimationframe=u,b.hascancelanimationframe=h,b.hasanimationframe?b.hascancelanimationframe||(h=function(){b.cancelAnimationFrame=!0}):(u=function(e){return setTimeout(e,15-Math.floor(+new Date/1e3)%16)},h=clearInterval),this.init=function(){function e(t){if(b.selectiondrag){if(t){var n=b.win.outerHeight(),i=t.pageY-b.selectiondrag.top;i>0&&i<n&&(i=0),i>=n&&(i-=n),b.selectiondrag.df=i}if(0!=b.selectiondrag.df){var o=2*-Math.floor(b.selectiondrag.df/6);b.doScrollBy(o),b.debounced("doselectionscroll",function(){e()},50)}}}function t(e){b.iframexd=!1;try{var t="contentDocument"in this?this.contentDocument:this.contentWindow.document;t.domain}catch(e){b.iframexd=!0,t=!1}if(b.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;if(b.forcescreen=!0,b.isiframe&&(b.iframe={doc:l(t),html:b.doc.contents().find("html")[0],body:b.doc.contents().find("body")[0]},b.getContentSize=function(){return{w:Math.max(b.iframe.html.scrollWidth,b.iframe.body.scrollWidth),h:Math.max(b.iframe.html.scrollHeight,b.iframe.body.scrollHeight)}},b.docscroll=l(b.iframe.body)),!y.isios&&b.opt.iframeautoresize&&!b.isiframe){b.win.scrollTop(0),b.doc.height("");var n=Math.max(t.getElementsByTagName("html")[0].scrollHeight,t.body.scrollHeight);b.doc.height(n)}b.lazyResize(30),y.isie7&&b.css(l(b.iframe.html),{"overflow-y":"hidden"}),b.css(l(b.iframe.body),{"overflow-y":"hidden"}),"contentWindow"in this?b.bind(this.contentWindow,"scroll",b.onscroll):b.bind(t,"scroll",b.onscroll),b.opt.enablemousewheel&&b.bind(t,"mousewheel",b.onmousewheel),b.opt.enablekeyboard&&b.bind(t,y.isopera?"keypress":"keydown",b.onkeypress),(y.cantouch||b.opt.touchbehavior)&&(b.bind(t,"mousedown",b.onmousedown),b.bind(t,"mousemove",function(e){b.onmousemove(e,!0)}),b.opt.grabcursorenabled&&y.cursorgrabvalue&&b.css(l(t.body),{cursor:y.cursorgrabvalue})),b.bind(t,"mouseup",b.onmouseup),b.zoom&&(b.opt.dblclickzoom&&b.bind(t,"dblclick",b.doZoom),b.ongesturezoom&&b.bind(t,"gestureend",b.ongesturezoom))}if(b.saved.css=[],y.isie7mobile)return!0;if(y.hasmstouch&&b.css(b.ispage?l("html"):b.win,{"-ms-touch-action":"none"}),y.isandroid||!y.hasmstouch&&!y.cantouch||b.css(b.ispage?l("html"):b.win,{"touch-action":"none"}),y.ismodernie&&b.css(b.ispage?l("html"):b.win,{"touch-action":"pinch-zoom"}),b.zindex="auto",b.ispage||"auto"!=b.opt.zindex?b.zindex=b.opt.zindex:b.zindex=a()||"auto",b.ispage||"auto"==b.zindex||b.zindex>s&&(s=b.zindex),b.isie&&0==b.zindex&&"auto"==b.opt.zindex&&(b.zindex="auto"),!b.ispage||!y.cantouch&&!y.isieold&&!y.isie9mobile){var n=b.docscroll;b.ispage&&(n=b.haswrapper?b.win:b.doc),y.isie9mobile||b.css(n,{"overflow-y":"hidden"}),b.ispage&&y.isie7&&("BODY"==b.doc[0].nodeName?b.css(l("html"),{"overflow-y":"hidden"}):"HTML"==b.doc[0].nodeName&&b.css(l("body"),{"overflow-y":"hidden"})),!y.isios||b.ispage||b.haswrapper||b.css(l("body"),{"-webkit-transform":"translate3d(0, 0, 0);"});var r=l(document.createElement("div"));r.css({position:"relative",top:0,float:"right",width:b.opt.cursorwidth,height:"0px","background-color":b.opt.cursorcolor,border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius,"-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius}),r.hborder=parseFloat(r.outerHeight()-r.innerHeight()),b.cursor=r;var d=l(document.createElement("div"));d.attr("id",b.id),d.addClass("nicescroll-rails");var u,h,m=["left","right"];for(var f in m)h=m[f],u=b.opt.railpadding[h],u?d.css("padding-"+h,u+"px"):b.opt.railpadding[h]=0;d.append(r),d.width=Math.max(parseFloat(b.opt.cursorwidth),r.outerWidth())+b.opt.railpadding.left+b.opt.railpadding.right,d.css({width:d.width+"px",zIndex:b.zindex,background:b.opt.background,cursor:"default"}),d.visibility=!0,d.scrollable=!0,d.align="left"==b.opt.railalign?0:1,b.rail=d,b.rail.drag=!1;var g=!1;if(!b.opt.boxzoom||b.ispage||y.isieold||(g=document.createElement("div"),b.bind(g,"click",b.doZoom),b.zoom=l(g),b.zoom.css({cursor:"pointer","z-index":b.zindex,backgroundImage:"url("+c+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),b.opt.dblclickzoom&&b.bind(b.win,"dblclick",b.doZoom),y.cantouch&&b.opt.gesturezoom&&(b.ongesturezoom=function(e){return e.scale>1.5&&b.doZoomIn(e),e.scale<.8&&b.doZoomOut(e),b.cancelEvent(e)},b.bind(b.win,"gestureend",b.ongesturezoom))),b.railh=!1,b.opt.horizrailenabled){b.css(n,{"overflow-x":"hidden"});var r=l(document.createElement("div"));r.css({position:"relative",top:0,height:b.opt.cursorwidth,width:"0px","background-color":b.opt.cursorcolor,border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius,"-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius}),r.wborder=parseFloat(r.outerWidth()-r.innerWidth()),b.cursorh=r;var v=l(document.createElement("div"));v.attr("id",b.id+"-hr"),v.addClass("nicescroll-rails"),v.height=Math.max(parseFloat(b.opt.cursorwidth),r.outerHeight()),v.css({height:v.height+"px",zIndex:b.zindex,background:b.opt.background}),v.append(r),v.visibility=!0,v.scrollable=!0,v.align="top"==b.opt.railvalign?0:1,b.railh=v,b.railh.drag=!1}if(b.ispage)d.css({position:"fixed",top:"0px",height:"100%"}),d.align?d.css({right:"0px"}):d.css({left:"0px"}),b.body.append(d),b.railh&&(v.css({position:"fixed",left:"0px",width:"100%"}),v.align?v.css({bottom:"0px"}):v.css({top:"0px"}),b.body.append(v));else{if(b.ishwscroll){"static"==b.win.css("position")&&b.css(b.win,{position:"relative"});var w="HTML"==b.win[0].nodeName?b.body:b.win;b.zoom&&(b.zoom.css({position:"absolute",top:1,right:0,"margin-right":d.width+4}),w.append(b.zoom)),d.css({position:"absolute",top:0}),d.align?d.css({right:0}):d.css({left:0}),w.append(d),v&&(v.css({position:"absolute",left:0,bottom:0}),v.align?v.css({bottom:0}):v.css({top:0}),w.append(v))}else{b.isfixed="fixed"==b.win.css("position");var S=b.isfixed?"fixed":"absolute";b.isfixed||(b.viewport=b.getViewport(b.win[0])),b.viewport&&(b.body=b.viewport,0==/relative|absolute/.test(b.viewport.css("position"))&&b.css(b.viewport,{position:"relative"})),d.css({position:S}),b.zoom&&b.zoom.css({position:S}),b.updateScrollBar(),b.body.append(d),b.zoom&&b.body.append(b.zoom),b.railh&&(v.css({position:S}),b.body.append(v))}y.isios&&b.css(b.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),y.isie&&b.opt.disableoutline&&b.win.attr("hideFocus","true"),y.iswebkit&&b.opt.disableoutline&&b.win.css({outline:"none"})}if(b.opt.autohidemode===!1?(b.autohidedom=!1,b.rail.css({opacity:b.opt.cursoropacitymax}),b.railh&&b.railh.css({opacity:b.opt.cursoropacitymax})):b.opt.autohidemode===!0?(b.autohidedom=l().add(b.rail),y.isie8&&(b.autohidedom=b.autohidedom.add(b.cursor)),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh)),b.railh&&y.isie8&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"scroll"==b.opt.autohidemode?(b.autohidedom=l().add(b.rail),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh))):"cursor"==b.opt.autohidemode?(b.autohidedom=l().add(b.cursor),b.railh&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"hidden"==b.opt.autohidemode&&(b.autohidedom=!1,b.hide(),b.locked=!1),y.isie9mobile){b.scrollmom=new T(b),b.onmangotouch=function(e){var t=b.getScrollTop(),n=b.getScrollLeft();if(t==b.scrollmom.lastscrolly&&n==b.scrollmom.lastscrollx)return!0;var i=t-b.mangotouch.sy,o=n-b.mangotouch.sx,r=Math.round(Math.sqrt(Math.pow(o,2)+Math.pow(i,2)));if(0!=r){var s=i<0?-1:1,a=o<0?-1:1,l=+new Date;if(b.mangotouch.lazy&&clearTimeout(b.mangotouch.lazy),l-b.mangotouch.tm>80||b.mangotouch.dry!=s||b.mangotouch.drx!=a)b.scrollmom.stop(),b.scrollmom.reset(n,t),b.mangotouch.sy=t,b.mangotouch.ly=t,b.mangotouch.sx=n,b.mangotouch.lx=n,b.mangotouch.dry=s,b.mangotouch.drx=a,b.mangotouch.tm=l;else{b.scrollmom.stop(),b.scrollmom.update(b.mangotouch.sx-o,b.mangotouch.sy-i),l-b.mangotouch.tm,b.mangotouch.tm=l;var c=Math.max(Math.abs(b.mangotouch.ly-t),Math.abs(b.mangotouch.lx-n));b.mangotouch.ly=t,b.mangotouch.lx=n,c>2&&(b.mangotouch.lazy=setTimeout(function(){b.mangotouch.lazy=!1,b.mangotouch.dry=0,b.mangotouch.drx=0,b.mangotouch.tm=0,b.scrollmom.doMomentum(30)},100))}}};var C=b.getScrollTop(),N=b.getScrollLeft();b.mangotouch={sy:C,ly:C,dry:0,sx:N,lx:N,drx:0,lazy:!1,tm:0},b.bind(b.docscroll,"scroll",b.onmangotouch)}else{if(y.cantouch||b.istouchcapable||b.opt.touchbehavior||y.hasmstouch){b.scrollmom=new T(b),b.ontouchstart=function(e){var t=e.target||e.srcElement;if(!l(t).hasClass("glossary-term")&&!l(t).hasClass("accordion-toggle")&&"textarea"!=l(t)[0].type){if(e.pointerType&&2!=e.pointerType&&"touch"!=e.pointerType)return!1;if(!b.locked){if(y.hasmstouch)for(var n=!!e.target&&e.target;n;){var i=l(n).getNiceScroll();if(i.length>0&&i[0].me==b.me)break;if(i.length>0)return!1;if("DIV"==n.nodeName&&n.id==b.id)break;n=!!n.parentNode&&n.parentNode}b.cancelScroll();var n=b.getTarget(e);if(n){var o=/INPUT/i.test(n.nodeName)&&/range/i.test(n.type);if(o)return b.stopPropagation(e)}if(!("clientX"in e)&&"changedTouches"in e&&(e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY),b.forcescreen){var r=e,e={original:e.original?e.original:e};e.clientX=r.screenX,e.clientY=r.screenY}if(b.rail.drag={x:e.clientX,y:e.clientY,sx:b.scroll.x,sy:b.scroll.y,st:b.getScrollTop(),sl:b.getScrollLeft(),pt:2,dl:!1},b.ispage||!b.opt.directionlockdeadzone)b.rail.drag.dl="f";else{var s={w:l(window).width(),h:l(window).height()},a={w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),
h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},c=Math.max(0,a.h-s.h),d=Math.max(0,a.w-s.w);!b.rail.scrollable&&b.railh.scrollable?b.rail.drag.ck=c>0&&"v":b.rail.scrollable&&!b.railh.scrollable?b.rail.drag.ck=d>0&&"h":b.rail.drag.ck=!1,b.rail.drag.ck||(b.rail.drag.dl="f")}if(b.opt.touchbehavior&&b.isiframe&&y.isie){var u=b.win.position();b.rail.drag.x+=u.left,b.rail.drag.y+=u.top}if(b.hasmoving=!1,b.lastmouseup=!1,b.scrollmom.reset(e.clientX,e.clientY),!y.cantouch&&!b.istouchcapable&&!y.hasmstouch){var h=!!n&&/INPUT|SELECT|TEXTAREA/i.test(n.nodeName);if(!h)return!b.ispage&&y.hasmousecapture&&n.setCapture(),b.cancelEvent(e);/SUBMIT|CANCEL|BUTTON/i.test(l(n).attr("type"))&&(pc={tg:n,click:!1},b.preventclick=pc)}}}},b.ontouchend=function(e){return(!e.pointerType||2==e.pointerType||"touch"==e.pointerType)&&(b.rail.drag&&2==b.rail.drag.pt&&(b.scrollmom.doMomentum(),b.rail.drag=!1,b.hasmoving&&(b.hasmoving=!1,b.lastmouseup=!0,b.hideCursor(),y.hasmousecapture&&document.releaseCapture(),!y.cantouch))?b.cancelEvent(e):void 0)};var _=b.opt.touchbehavior&&b.isiframe&&!y.hasmousecapture;b.ontouchmove=function(e,t){if(!(e.touches&&b.opt.preventmultitouchscrolling&&e.touches.length>1)){if(e.pointerType&&2!=e.pointerType&&"touch"!=e.pointerType)return!1;if(b.rail.drag&&2==b.rail.drag.pt){if(y.cantouch&&"undefined"==typeof e.original)return!0;y.ischrome&&b.istouchcapable&&e.preventDefault&&e.preventDefault(),b.hasmoving=!0,b.preventclick&&!b.preventclick.click&&(b.preventclick.click=b.preventclick.tg.onclick||!1,b.preventclick.tg.onclick=b.onpreventclick);var n=l.extend({original:e},e);if(e=n,"changedTouches"in e&&(e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY),b.forcescreen){var i=e,e={original:e.original?e.original:e};e.clientX=i.screenX,e.clientY=i.screenY}var o=ofy=0;if(_&&!t){var r=b.win.position();o=-r.left,ofy=-r.top}var s=e.clientY+ofy,a=s-b.rail.drag.y,c=e.clientX+o,d=c-b.rail.drag.x,u=b.rail.drag.st-a;if(b.ishwscroll&&b.opt.bouncescroll?u<0?u=Math.round(u/2):u>b.page.maxh&&(u=b.page.maxh+Math.round((u-b.page.maxh)/2)):(u<0&&(u=0,s=0),u>b.page.maxh&&(u=b.page.maxh,s=0)),b.railh&&b.railh.scrollable){var h=b.rail.drag.sl-d;b.ishwscroll&&b.opt.bouncescroll?h<0?h=Math.round(h/2):h>b.page.maxw&&(h=b.page.maxw+Math.round((h-b.page.maxw)/2)):(h<0&&(h=0,c=0),h>b.page.maxw&&(h=b.page.maxw,c=0))}var p=!1;if(b.rail.drag.dl)p=!0,"v"==b.rail.drag.dl?h=b.rail.drag.sl:"h"==b.rail.drag.dl&&(u=b.rail.drag.st);else{var m=Math.abs(a),f=Math.abs(d),g=b.opt.directionlockdeadzone;if("v"==b.rail.drag.ck){if(m>g&&f<=.3*m)return b.rail.drag=!1,!0;f>g&&(b.rail.drag.dl="f",l("body").scrollTop(l("body").scrollTop()))}else if("h"==b.rail.drag.ck){if(f>g&&m<=.3*g)return b.rail.drag=!1,!0;m>g&&(b.rail.drag.dl="f",l("body").scrollLeft(l("body").scrollLeft()))}}if(b.synched("touchmove",function(){b.rail.drag&&2==b.rail.drag.pt&&(b.prepareTransition&&b.prepareTransition(0),b.rail.scrollable&&b.setScrollTop(u),b.scrollmom.update(c,s),b.railh&&b.railh.scrollable?(b.setScrollLeft(h),b.showCursor(u,h)):b.showCursor(u),y.isie10&&document.selection.clear())}),y.ischrome&&b.istouchcapable&&(p=!1),p)return b.cancelEvent(e)}}},b.ontouchstartCursor=function(e,t){if(!b.rail.drag||3==b.rail.drag.pt){if(b.locked)return b.cancelEvent(e);b.cancelScroll(),b.rail.drag={x:e.touches[0].clientX,y:e.touches[0].clientY,sx:b.scroll.x,sy:b.scroll.y,pt:3,hr:!!t};var n=b.getTarget(e);return!b.ispage&&y.hasmousecapture&&n.setCapture(),b.isiframe&&!y.hasmousecapture&&(b.saved.csspointerevents=b.doc.css("pointer-events"),b.css(b.doc,{"pointer-events":"none"})),b.cancelEvent(e)}},b.ontouchendCursor=function(e){if(b.rail.drag){if(y.hasmousecapture&&document.releaseCapture(),b.isiframe&&!y.hasmousecapture&&b.doc.css("pointer-events",b.saved.csspointerevents),3!=b.rail.drag.pt)return;return b.rail.drag=!1,b.cancelEvent(e)}},b.ontouchmoveCursor=function(e){if(b.rail.drag){if(3!=b.rail.drag.pt)return;if(b.cursorfreezed=!0,b.rail.drag.hr){b.scroll.x=b.rail.drag.sx+(e.touches[0].clientX-b.rail.drag.x),b.scroll.x<0&&(b.scroll.x=0);var t=b.scrollvaluemaxw;b.scroll.x>t&&(b.scroll.x=t)}else{b.scroll.y=b.rail.drag.sy+(e.touches[0].clientY-b.rail.drag.y),b.scroll.y<0&&(b.scroll.y=0);var n=b.scrollvaluemax;b.scroll.y>n&&(b.scroll.y=n)}return b.synched("touchmove",function(){b.rail.drag&&3==b.rail.drag.pt?(b.showCursor(),b.rail.drag.hr?b.doScrollLeft(Math.round(b.scroll.x*b.scrollratio.x),b.opt.cursordragspeed):b.doScrollTop(Math.round(b.scroll.y*b.scrollratio.y),b.opt.cursordragspeed)):b.cursorfreezed=!1}),b.cancelEvent(e)}}}b.onmousedown=function(e,t){if(!b.rail.drag||1==b.rail.drag.pt){if(b.locked)return b.cancelEvent(e);b.cancelScroll(),b.rail.drag={x:e.clientX,y:e.clientY,sx:b.scroll.x,sy:b.scroll.y,pt:1,hr:!!t};var n=b.getTarget(e);return!b.ispage&&y.hasmousecapture&&n.setCapture(),b.isiframe&&!y.hasmousecapture&&(b.saved.csspointerevents=b.doc.css("pointer-events"),b.css(b.doc,{"pointer-events":"none"})),b.cancelEvent(e)}},b.onmouseup=function(e){if(b.rail.drag){if(y.hasmousecapture&&document.releaseCapture(),b.isiframe&&!y.hasmousecapture&&b.doc.css("pointer-events",b.saved.csspointerevents),1!=b.rail.drag.pt)return;return b.rail.drag=!1,b.cancelEvent(e)}},b.onmousemove=function(e){if(b.rail.drag){if(1!=b.rail.drag.pt)return;if(y.ischrome&&0==e.which)return b.onmouseup(e);if(b.cursorfreezed=!0,b.rail.drag.hr){b.scroll.x=b.rail.drag.sx+(e.clientX-b.rail.drag.x),b.scroll.x<0&&(b.scroll.x=0);var t=b.scrollvaluemaxw;b.scroll.x>t&&(b.scroll.x=t)}else{b.scroll.y=b.rail.drag.sy+(e.clientY-b.rail.drag.y),b.scroll.y<0&&(b.scroll.y=0);var n=b.scrollvaluemax;b.scroll.y>n&&(b.scroll.y=n)}return b.synched("mousemove",function(){b.rail.drag&&1==b.rail.drag.pt?(b.showCursor(),b.rail.drag.hr?b.doScrollLeft(Math.round(b.scroll.x*b.scrollratio.x),b.opt.cursordragspeed):b.doScrollTop(Math.round(b.scroll.y*b.scrollratio.y),b.opt.cursordragspeed)):b.cursorfreezed=!1}),b.cancelEvent(e)}},y.cantouch||b.opt.touchbehavior?(b.onpreventclick=function(e){if(b.preventclick)return b.preventclick.tg.onclick=b.preventclick.click,b.preventclick=!1,b.cancelEvent(e)},b.bind(b.win,"mousedown",b.ontouchstart),b.onclick=!y.isios&&function(e){return!b.lastmouseup||0==l(b.win).find(e.target).length||(b.lastmouseup=!1,b.cancelEvent(e))},b.opt.grabcursorenabled&&y.cursorgrabvalue&&(b.css(b.ispage?b.doc:b.win,{cursor:y.cursorgrabvalue}),b.css(b.rail,{cursor:y.cursorgrabvalue}))):("getSelection"in document?b.hasTextSelected=function(){return document.getSelection().rangeCount>0}:"selection"in document?b.hasTextSelected=function(){return"None"!=document.selection.type}:b.hasTextSelected=function(){return!1},b.onselectionstart=function(e){b.ispage||(b.selectiondrag=b.win.offset())},b.onselectionend=function(e){b.selectiondrag=!1},b.onselectiondrag=function(t){b.selectiondrag&&b.hasTextSelected()&&b.debounced("selectionscroll",function(){e(t)},250)}),y.hasmstouch&&(b.css(b.rail,{"-ms-touch-action":"none"}),b.css(b.cursor,{"-ms-touch-action":"none"}),b.bind(b.win,"MSPointerDown",b.ontouchstart),b.bind(document,"MSPointerUp",b.ontouchend),b.bind(document,"MSPointerMove",b.ontouchmove),b.bind(b.cursor,"MSGestureHold",function(e){e.preventDefault()}),b.bind(b.cursor,"contextmenu",function(e){e.preventDefault()}),b.bind(b.win,"pointerdown",b.ontouchstart),b.bind(document,"pointerup",b.ontouchend),b.bind(document,"pointermove",b.ontouchmove)),(y.hasmstouch||y.cantouch)&&(b.css(b.rail,{"touch-action":"none"}),b.css(b.cursor,{"touch-action":"none"}),b.cursorh&&b.css(b.cursorh,{"touch-action":"none"})),this.istouchcapable&&(b.bind(b.win,"touchstart",b.ontouchstart),b.bind(document,"touchend",b.ontouchend),b.bind(document,"touchcancel",b.ontouchend),b.bind(document,"touchmove",b.ontouchmove)),b.bind(b.cursor,"mousedown",b.onmousedown),b.bind(b.cursor,"mouseup",b.onmouseup),b.railh&&(b.bind(b.cursorh,"mousedown",function(e){b.onmousedown(e,!0)}),b.bind(b.cursorh,"mouseup",function(e){if(!b.rail.drag||2!=b.rail.drag.pt)return b.rail.drag=!1,b.hasmoving=!1,b.hideCursor(),y.hasmousecapture&&document.releaseCapture(),b.cancelEvent(e)})),(b.opt.cursordragontouch||!y.cantouch&&!b.opt.touchbehavior)&&(b.rail.css({cursor:"default"}),b.railh&&b.railh.css({cursor:"default"}),b.jqbind(b.rail,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.rail,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&&(b.bind(b.rail,"click",function(e){b.doRailClick(e,!1,!1)}),b.bind(b.rail,"dblclick",function(e){b.doRailClick(e,!0,!1)}),b.bind(b.cursor,"click",function(e){b.cancelEvent(e)}),b.bind(b.cursor,"dblclick",function(e){b.cancelEvent(e)})),b.railh&&(b.jqbind(b.railh,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.railh,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&&(b.bind(b.railh,"click",function(e){b.doRailClick(e,!1,!0)}),b.bind(b.railh,"dblclick",function(e){b.doRailClick(e,!0,!0)}),b.bind(b.cursorh,"click",function(e){b.cancelEvent(e)}),b.bind(b.cursorh,"dblclick",function(e){b.cancelEvent(e)})))),b.opt.cursordragontouch&&(this.istouchcapable||y.cantouch)&&(b.bind(b.cursor,"touchstart",b.ontouchstartCursor),b.bind(b.cursor,"touchmove",b.ontouchmoveCursor),b.bind(b.cursor,"touchend",b.ontouchendCursor),b.cursorh&&b.bind(b.cursorh,"touchstart",function(e){b.ontouchstartCursor(e,!0)}),b.cursorh&&b.bind(b.cursorh,"touchmove",b.ontouchmoveCursor),b.cursorh&&b.bind(b.cursorh,"touchend",b.ontouchendCursor)),y.cantouch||b.opt.touchbehavior?(b.bind(y.hasmousecapture?b.win:document,"mouseup",b.ontouchend),b.bind(document,"mousemove",b.ontouchmove,!1,!0),b.onclick&&b.bind(document,"click",b.onclick),b.opt.cursordragontouch&&(b.bind(b.cursor,"mousedown",b.onmousedown),b.bind(b.cursor,"mousemove",b.onmousemove),b.cursorh&&b.bind(b.cursorh,"mousedown",function(e){b.onmousedown(e,!0)}),b.cursorh&&b.bind(b.cursorh,"mousemove",b.onmousemove))):(b.bind(y.hasmousecapture?b.win:document,"mouseup",b.onmouseup),b.bind(document,"mousemove",b.onmousemove),b.onclick&&b.bind(document,"click",b.onclick),!b.ispage&&b.opt.enablescrollonselection&&(b.bind(b.win[0],"mousedown",b.onselectionstart),b.bind(document,"mouseup",b.onselectionend),b.bind(b.cursor,"mouseup",b.onselectionend),b.cursorh&&b.bind(b.cursorh,"mouseup",b.onselectionend),b.bind(document,"mousemove",b.onselectiondrag)),b.zoom&&(b.jqbind(b.zoom,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.zoom,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}))),b.opt.enablemousewheel&&(b.isiframe||b.bind(y.isie&&b.ispage?document:b.docscroll,"mousewheel",b.onmousewheel),b.bind(b.rail,"mousewheel",b.onmousewheel),b.railh&&b.bind(b.railh,"mousewheel",b.onmousewheelhr)),b.ispage||!y.isandroid&&y.cantouch||/HTML|BODY/.test(b.win[0].nodeName)||(b.win.attr("tabindex")||b.win.attr({tabindex:0}),b.win.attr({role:"document"}),b.jqbind(b.win,"focus",function(e){i=b.getTarget(e).id||!0,b.hasfocus=!0,b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"blur",function(e){i=!1,b.hasfocus=!1}),b.jqbind(b.win,"mouseenter",function(e){o=b.getTarget(e).id||!0,b.hasmousefocus=!0,b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"mouseleave",function(){o=!1,b.hasmousefocus=!1}))}if(b.onkeypress=function(e){if(b.locked&&0==b.page.maxh)return!0;e=e?e:window.e;var t=b.getTarget(e);if(t&&/INPUT|TEXTAREA|SELECT|OPTION/.test(t.nodeName)){var n=t.getAttribute("type")||t.type||!1;if(!n||!/submit|button|cancel/i.tp)return!0}var r=y.isandroid&&9!=e.keyCode&&l(t).getNiceScroll().length;if(b.hasfocus||r||b.ispage&&!i&&!o){var s=e.keyCode;if(b.locked&&27!=s)return b.cancelEvent(e);var a=e.ctrlKey||!1,c=e.shiftKey||!1,d=!1;switch(s){case 38:case 63233:b.doScrollBy(72),d=!0;break;case 40:case 63235:b.doScrollBy(-72),d=!0;break;case 37:case 63232:b.railh&&(a?b.doScrollLeft(0):b.doScrollLeftBy(72),d=!0);break;case 39:case 63234:b.railh&&(a?b.doScrollLeft(b.page.maxw):b.doScrollLeftBy(-72),d=!0);break;case 33:case 63276:b.doScrollBy(b.view.h),d=!0;break;case 34:case 63277:b.doScrollBy(-b.view.h),d=!0;break;case 36:case 63273:b.railh&&a?b.doScrollPos(0,0):b.doScrollTo(0),d=!0;break;case 35:case 63275:b.railh&&a?b.doScrollPos(b.page.maxw,b.page.maxh):b.doScrollTo(b.page.maxh),d=!0;break;case 32:b.opt.spacebarenabled&&(c?b.doScrollBy(b.view.h):b.doScrollBy(-b.view.h),d=!0);break;case 27:b.zoomactive&&(b.doZoom(),d=!0)}if(d)return b.cancelEvent(e)}},b.opt.enablekeyboard&&b.bind(document,y.isopera&&!y.isopera12?"keypress":"keydown",b.onkeypress),b.bind(window,"resize",b.lazyResize),b.bind(window,"orientationchange",b.lazyResize),b.bind(window,"load",b.lazyResize),y.ischrome&&!b.ispage&&!b.haswrapper){var E=b.win.attr("style"),$=parseFloat(b.win.css("width"))+1;b.win.css("width",$),b.synched("chromefix",function(){b.win.attr("style",E)})}b.onAttributeChange=function(e){l.isEmptyObject(b)||b.lazyResize(250)},b.ispage||b.haswrapper||(p!==!1?(b.observer=new p(function(e){e.forEach(b.onAttributeChange)}),b.observer.observe(b.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),b.observerremover=new p(function(e){e.forEach(function(e){if(e.removedNodes.length>0)for(var t in e.removedNodes)if(e.removedNodes[t]==b.win[0])return b.remove()})}),b.observerremover.observe(b.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(b.bind(b.win,y.isie&&!y.isie9?"propertychange":"DOMAttrModified",b.onAttributeChange),y.isie9&&b.win[0].attachEvent("onpropertychange",b.onAttributeChange),b.bind(b.win,"DOMNodeRemoved",function(e){e.target==b.win[0]&&b.remove()}))),!b.ispage&&b.opt.boxzoom&&b.bind(window,"resize",b.resizeZoom),b.istextarea&&b.bind(b.win,"mouseup",b.lazyResize),b.checkrtlmode=!0,b.lazyResize(30)}"IFRAME"==this.doc[0].nodeName&&(this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){t.call(b.doc[0],!1)},500),b.bind(this.doc,"load",t)),b.startListening()},this.startListening=function(){l(document).off("do.disableInteraction",b.disableInteraction).on("do.disableInteraction",b.disableInteraction),l(document).off("do.enableInteraction",b.enableInteraction).on("do.enableInteraction",b.enableInteraction)},this.disableInteraction=function(){b.disableScrolling(),b.hide()},this.enableInteraction=function(){b.show()},this.showCursor=function(e,t){b.cursortimeout&&(clearTimeout(b.cursortimeout),b.cursortimeout=0),b.rail&&(b.autohidedom&&(b.autohidedom.stop().css({opacity:b.opt.cursoropacitymax}),b.cursoractive=!0),b.rail.drag&&1==b.rail.drag.pt||("undefined"!=typeof e&&e!==!1&&(b.scroll.y=Math.round(1*e/b.scrollratio.y)),"undefined"!=typeof t&&(b.scroll.x=Math.round(1*t/b.scrollratio.x))),b.cursor.css({height:b.cursorheight,top:b.scroll.y}),b.cursorh&&(!b.rail.align&&b.rail.visibility?b.cursorh.css({width:b.cursorwidth,left:b.scroll.x+b.rail.width}):b.cursorh.css({width:b.cursorwidth,left:b.scroll.x}),b.cursoractive=!0),b.zoom&&b.zoom.stop().css({opacity:b.opt.cursoropacitymax}))},this.hideCursor=function(e){b.cursortimeout||b.rail&&b.autohidedom&&(b.cursortimeout=setTimeout(function(){b.rail.active&&b.showonmouseevent||(b.autohidedom.stop().animate({opacity:b.opt.cursoropacitymin}),b.zoom&&b.zoom.stop().animate({opacity:b.opt.cursoropacitymin}),b.cursoractive=!1),b.cursortimeout=0},e||b.opt.hidecursordelay))},this.noticeCursor=function(e,t,n){b.showCursor(t,n),b.rail.active||b.hideCursor(e)},this.getContentSize=b.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:b.haswrapper?function(){return{w:b.doc.outerWidth()+parseInt(b.win.css("paddingLeft"))+parseInt(b.win.css("paddingRight")),h:b.doc.outerHeight()+parseInt(b.win.css("paddingTop"))+parseInt(b.win.css("paddingBottom"))}}:function(){return{w:b.docscroll[0].scrollWidth,h:b.docscroll[0].scrollHeight}},this.onResize=function(e,t){if(!b.win)return!1;if(!b.haswrapper&&!b.ispage){if("none"==b.win.css("display"))return b.visibility&&b.hideRail().hideRailHr(),!1;b.hidden||b.visibility||b.showRail().showRailHr()}var n=b.page.maxh,i=b.page.maxw,o={h:b.view.h,w:b.view.w};if(b.view={w:b.ispage?b.win.width():parseInt(b.win[0].clientWidth),h:b.ispage?b.win.height():parseInt(b.win[0].clientHeight)},b.page=t?t:b.getContentSize(),b.page.maxh=Math.max(0,b.page.h-b.view.h),b.page.maxw=Math.max(0,b.page.w-b.view.w),b.page.maxh==n&&b.page.maxw==i&&b.view.w==o.w){if(b.ispage)return b;var r=b.win.offset();if(b.lastposition){var s=b.lastposition;if(s.top==r.top&&s.left==r.left)return b}b.lastposition=r}if(0==b.page.maxh?(b.hideRail(),b.scrollvaluemax=0,b.scroll.y=0,b.scrollratio.y=0,b.cursorheight=0,b.setScrollTop(0),b.rail.scrollable=!1):b.rail.scrollable=!0,0==b.page.maxw?(b.hideRailHr(),b.scrollvaluemaxw=0,b.scroll.x=0,b.scrollratio.x=0,b.cursorwidth=0,b.setScrollLeft(0),b.railh.scrollable=!1):b.railh.scrollable=!0,b.locked=0==b.page.maxh&&0==b.page.maxw,b.locked)return b.ispage||b.updateScrollBar(b.view),!1;b.hidden||b.visibility?b.hidden||b.railh.visibility||b.showRailHr():b.showRail().showRailHr(),b.istextarea&&b.win.css("resize")&&"none"!=b.win.css("resize")&&(b.view.h-=20),b.cursorheight=Math.min(b.view.h,Math.round(b.view.h*(b.view.h/b.page.h))),b.cursorheight=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorheight),b.cursorwidth=Math.min(b.view.w,Math.round(b.view.w*(b.view.w/b.page.w))),b.cursorwidth=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorwidth),b.scrollvaluemax=b.view.h-b.cursorheight-b.cursor.hborder,b.railh&&(b.railh.width=b.page.maxh>0?b.view.w-b.rail.width:b.view.w,b.scrollvaluemaxw=b.railh.width-b.cursorwidth-b.cursorh.wborder),b.checkrtlmode&&b.railh&&(b.checkrtlmode=!1,b.opt.rtlmode&&0==b.scroll.x&&b.setScrollLeft(b.page.maxw)),b.ispage||b.updateScrollBar(b.view),b.scrollratio={x:b.page.maxw/b.scrollvaluemaxw,y:b.page.maxh/b.scrollvaluemax};var a=b.getScrollTop();return a>b.page.maxh?b.doScrollTop(b.page.maxh):(b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x)),b.cursoractive&&b.noticeCursor()),b.scroll.y&&0==b.getScrollTop()&&b.doScrollTo(Math.floor(b.scroll.y*b.scrollratio.y)),b},this.resize=b.onResize,this.lazyResize=function(e){return e=isNaN(e)?30:e,b.delayed("resize",b.resize,e),b},this._bind=function(e,t,n,i,o){b.events.push({e:e,n:t,f:n,b:i,q:!1});var r=!1;try{var s=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("test",null,s)}catch(e){}e.addEventListener?r&&o?e.addEventListener(t,n,{passive:!1,capture:i}):e.addEventListener(t,n,i||!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},this.jqbind=function(e,t,n){b.events.push({e:e,n:t,f:n,q:!0}),l(e).bind(t,n)},this.bind=function(e,t,n,i,o){var r="jquery"in e?e[0]:e;if("mousewheel"==t)if("onwheel"in b.win)b._bind(r,"wheel",n,i||!1,o||!1);else{var s="undefined"!=typeof document.onmousewheel?"mousewheel":"DOMMouseScroll";f(r,s,n,i||!1),"DOMMouseScroll"==s&&f(r,"MozMousePixelScroll",n,i||!1)}else if(r.addEventListener){if(y.cantouch&&/mouseup|mousedown|mousemove/.test(t)){var a="mousedown"==t?"touchstart":"mouseup"==t?"touchend":"touchmove";b._bind(r,a,function(e){if(e.touches){if(e.touches.length<2){var t=e.touches.length?e.touches[0]:e;t.original=e,n.call(this,t)}}else if(e.changedTouches){var t=e.changedTouches[0];t.original=e,n.call(this,t)}},i||!1,o||!1)}b._bind(r,t,n,i||!1,o||!1),y.cantouch&&"mouseup"==t&&b._bind(r,"touchcancel",n,i||!1)}else b._bind(r,t,function(e){return e=e||window.event||!1,e&&e.srcElement&&(e.target=e.srcElement),"pageY"in e||(e.pageX=e.clientX+document.documentElement.scrollLeft,e.pageY=e.clientY+document.documentElement.scrollTop),n.call(r,e)!==!1&&i!==!1||b.cancelEvent(e)})},this._unbind=function(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=!1},this.unbindAll=function(){for(var e=0;e<b.events.length;e++){var t=b.events[e];t.q?t.e.unbind(t.n,t.f):b._unbind(t.e,t.n,t.f,t.b)}},this.cancelEvent=function(e){var e=e.original?e.original:e?e:window.event||!1;return!!e&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventManipulation&&e.preventManipulation(),e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1,!1)},this.stopPropagation=function(e){var e=e.original?e.original:e?e:window.event||!1;return!!e&&(e.stopPropagation?e.stopPropagation():(e.cancelBubble&&(e.cancelBubble=!0),!1))},this.showRail=function(){return 0==b.page.maxh||!b.ispage&&"none"==b.win.css("display")||(b.visibility=!0,b.rail.visibility=!0,b.rail.css("display","block")),b},this.showRailHr=function(){return b.railh?(0==b.page.maxw||!b.ispage&&"none"==b.win.css("display")||(b.railh.visibility=!0,b.railh.css("display","block")),b):b},this.hideRail=function(){return b.visibility=!1,b.rail.visibility=!1,b.rail.css("display","none"),b},this.hideRailHr=function(){return b.railh?(b.railh.visibility=!1,b.railh.css("display","none"),b):b},this.show=function(){return b.hidden=!1,b.locked=!1,b.showRail().showRailHr()},this.hide=function(){return b.hidden=!0,b.locked=!0,b.hideRail().hideRailHr()},this.disableScrolling=function(){b.rail.drag=!1},this.toggle=function(){return b.hidden?b.show():b.hide()},this.remove=function(){b.stop(),b.cursortimeout&&clearTimeout(b.cursortimeout),b.debouncedelayed&&clearTimeout(b.debouncedelayed),b.doZoomOut(),b.unbindAll(),l(document).off("do.disableInteraction",b.disableInteraction),l(document).off("do.enableInteraction",b.enableInteraction),b.observer!==!1&&b.observer.disconnect(),b.observerremover!==!1&&b.observerremover.disconnect(),b.events=[],b.cursor&&(b.cursor.remove(),b.cursor=null),b.cursorh&&(b.cursorh.remove(),b.cursorh=null),b.rail&&(b.rail.remove(),b.rail=null),b.railh&&(b.railh.remove(),b.railh=null),b.zoom&&(b.zoom.remove(),b.zoom=null);for(var e=0;e<b.saved.css.length;e++){var t=b.saved.css[e];t[0].css(t[1],"undefined"==typeof t[2]?"":t[2])}b.saved=!1,b.me.data("__nicescroll","");var n=l.nicescroll;n.each(function(e){if(this&&this.id===b.id){delete n[e];for(var t=e+1;t<n.length;t++,e++)n[e]=n[t];n.length--,n.length&&delete n[n.length]}});for(var i in b)b[i]=null,delete b[i];b.removed=!0},this.scrollstart=function(e){return this.onscrollstart=e,b},this.scrollend=function(e){return this.onscrollend=e,b},this.scrollcancel=function(e){return this.onscrollcancel=e,b},this.zoomin=function(e){return this.onzoomin=e,b},this.zoomout=function(e){return this.onzoomout=e,b},this.isScrollable=function(e){var t=e.target?e.target:e;if("OPTION"==t.nodeName)return!0;for(;t&&1==t.nodeType&&!/BODY|HTML/.test(t.nodeName);){var n=l(t),i=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(i))return Math.abs(t.clientHeight-t.scrollHeight)>5;t=!!t.parentNode&&t.parentNode}return!1},this.getViewport=function(e){for(var t=!(!e||!e.parentNode)&&e.parentNode;t&&1==t.nodeType&&!/BODY|HTML/.test(t.nodeName);){var n=l(t),i=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(i)&&t.clientHeight!=t.scrollHeight)return n;if(n.getNiceScroll().length>0)return n;t=!!t.parentNode&&t.parentNode}return!1},this.onmousewheel=function(e){if(!b.hidden){if(b.locked)return!0;if(b.rail.drag)return b.cancelEvent(e);if(!b.rail.scrollable)return!b.railh||!b.railh.scrollable||b.onmousewheelhr(e);var t=+new Date,n=!1;if(b.opt.preservenativescrolling&&b.checkarea+600<t&&(b.nativescrollingarea=b.isScrollable(e),n=!0),b.checkarea=t,b.nativescrollingarea)return!0;var i=v(e,!1,n);return i&&(b.checkarea=0),i}},this.onmousewheelhr=function(e){if(b.locked||!b.railh.scrollable)return!0;if(b.rail.drag)return b.cancelEvent(e);var t=+new Date,n=!1;return b.opt.preservenativescrolling&&b.checkarea+600<t&&(b.nativescrollingarea=b.isScrollable(e),n=!0),b.checkarea=t,!!b.nativescrollingarea||(b.locked?b.cancelEvent(e):v(e,!0,n))},this.stop=function(){return b.cancelScroll(),b.scrollmon&&b.scrollmon.stop(),b.cursorfreezed=!1,b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.noticeCursor(),b},this.getTransitionSpeed=function(e){var t=Math.round(10*b.opt.scrollspeed),n=Math.min(t,Math.round(e/20*b.opt.scrollspeed));return n>20?n:0},b.opt.smoothscroll?b.ishwscroll&&y.hastransition&&b.opt.usetransition?(this.prepareTransition=function(e,t){var n=t?e>20?e:0:b.getTransitionSpeed(e),i=n?y.prefixstyle+"transform "+n+"ms ease-out":"";return b.lasttransitionstyle&&b.lasttransitionstyle==i||(b.lasttransitionstyle=i,b.doc.css(y.transitionstyle,i)),n},this.doScrollLeft=function(e,t){var n=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var i=b.getScrollTop(),o=b.getScrollLeft();return((b.newscrolly-i)*(t-i)<0||(b.newscrollx-o)*(e-o)<0)&&b.cancelScroll(),0==b.opt.bouncescroll&&(t<0?t=0:t>b.page.maxh&&(t=b.page.maxh),e<0?e=0:e>b.page.maxw&&(e=b.page.maxw)),(!b.scrollrunning||e!=b.newscrollx||t!=b.newscrolly)&&(b.newscrolly=t,b.newscrollx=e,b.newscrollspeed=n||!1,!b.timer&&void(b.timer=setTimeout(function(){var n=b.getScrollTop(),i=b.getScrollLeft(),o={};o.x=e-i,o.y=t-n,o.px=i,o.py=n;var r=Math.round(Math.sqrt(Math.pow(o.x,2)+Math.pow(o.y,2))),s=b.newscrollspeed&&b.newscrollspeed>1?b.newscrollspeed:b.getTransitionSpeed(r);if(b.newscrollspeed&&b.newscrollspeed<=1&&(s*=b.newscrollspeed),b.prepareTransition(s,!0),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),s>0){if(!b.scrollrunning&&b.onscrollstart){var a={type:"scrollstart",current:{x:i,y:n},request:{x:e,y:t},end:{x:b.newscrollx,y:b.newscrolly},speed:s};b.onscrollstart.call(b,a)}y.transitionend?b.scrollendtrapped||(b.scrollendtrapped=!0,b.bind(b.doc,y.transitionend,b.onScrollEnd,!1)):(b.scrollendtrapped&&clearTimeout(b.scrollendtrapped),b.scrollendtrapped=setTimeout(b.onScrollEnd,s));var l=n,c=i;b.timerscroll={bz:new BezierClass(l,b.newscrolly,s,0,0,.58,1),bh:new BezierClass(c,b.newscrollx,s,0,0,.58,1)},b.cursorfreezed||(b.timerscroll.tm=setInterval(function(){b.showCursor(b.getScrollTop(),b.getScrollLeft())},60))}b.synched("doScroll-set",function(){b.timer=0,b.scrollendtrapped&&(b.scrollrunning=!0),b.setScrollTop(b.newscrolly),b.setScrollLeft(b.newscrollx),b.scrollendtrapped||b.onScrollEnd()})},50)))},this.cancelScroll=function(){if(!b.scrollendtrapped)return!0;var e=b.getScrollTop(),t=b.getScrollLeft();return b.scrollrunning=!1,y.transitionend||clearTimeout(y.transitionend),b.scrollendtrapped=!1,b._unbind(b.doc,y.transitionend,b.onScrollEnd),b.prepareTransition(0),b.setScrollTop(e),b.railh&&b.setScrollLeft(t),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),b.timerscroll=!1,b.cursorfreezed=!1,b.showCursor(e,t),b},this.onScrollEnd=function(){b.scrollendtrapped&&b._unbind(b.doc,y.transitionend,b.onScrollEnd),b.scrollendtrapped=!1,b.prepareTransition(0),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),b.timerscroll=!1;var e=b.getScrollTop(),t=b.getScrollLeft();if(b.setScrollTop(e),b.railh&&b.setScrollLeft(t),b.noticeCursor(!1,e,t),b.cursorfreezed=!1,e<0?e=0:e>b.page.maxh&&(e=b.page.maxh),t<0?t=0:t>b.page.maxw&&(t=b.page.maxw),e!=b.newscrolly||t!=b.newscrollx)return b.doScrollPos(t,e,b.opt.snapbackspeed);if(b.onscrollend&&b.scrollrunning){var n={type:"scrollend",current:{x:t,y:e},end:{x:b.newscrollx,y:b.newscrolly}};b.onscrollend.call(b,n)}b.scrollrunning=!1}):(this.doScrollLeft=function(e,t){var n=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){function i(){if(b.cancelAnimationFrame)return!0;if(b.scrollrunning=!0,d=1-d)return b.timer=u(i)||1;var e=0,t=sy=b.getScrollTop();if(b.dst.ay){t=b.bzscroll?b.dst.py+b.bzscroll.getNow()*b.dst.ay:b.newscrolly;var n=t-sy;(n<0&&t<b.newscrolly||n>0&&t>b.newscrolly)&&(t=b.newscrolly),b.setScrollTop(t),t==b.newscrolly&&(e=1)}else e=1;var o=sx=b.getScrollLeft();if(b.dst.ax){o=b.bzscroll?b.dst.px+b.bzscroll.getNow()*b.dst.ax:b.newscrollx;var n=o-sx;(n<0&&o<b.newscrollx||n>0&&o>b.newscrollx)&&(o=b.newscrollx),b.setScrollLeft(o),o==b.newscrollx&&(e+=1)}else e+=1;if(2==e){if(b.timer=0,b.cursorfreezed=!1,b.bzscroll=!1,b.scrollrunning=!1,t<0?t=0:t>b.page.maxh&&(t=b.page.maxh),o<0?o=0:o>b.page.maxw&&(o=b.page.maxw),o!=b.newscrollx||t!=b.newscrolly)b.doScrollPos(o,t);else if(b.onscrollend){var r={type:"scrollend",current:{x:sx,y:sy},end:{x:b.newscrollx,y:b.newscrolly}};b.onscrollend.call(b,r)}}else b.timer=u(i)||1}var t="undefined"==typeof t||t===!1?b.getScrollTop(!0):t;if(b.timer&&b.newscrolly==t&&b.newscrollx==e)return!0;b.timer&&h(b.timer),b.timer=0;var o=b.getScrollTop(),r=b.getScrollLeft();((b.newscrolly-o)*(t-o)<0||(b.newscrollx-r)*(e-r)<0)&&b.cancelScroll(),b.newscrolly=t,b.newscrollx=e,b.bouncescroll&&b.rail.visibility||(b.newscrolly<0?b.newscrolly=0:b.newscrolly>b.page.maxh&&(b.newscrolly=b.page.maxh)),b.bouncescroll&&b.railh.visibility||(b.newscrollx<0?b.newscrollx=0:b.newscrollx>b.page.maxw&&(b.newscrollx=b.page.maxw)),b.dst={},b.dst.x=e-r,b.dst.y=t-o,b.dst.px=r,b.dst.py=o;var s=Math.round(Math.sqrt(Math.pow(b.dst.x,2)+Math.pow(b.dst.y,2)));b.dst.ax=b.dst.x/s,b.dst.ay=b.dst.y/s;var a=0,l=s;0==b.dst.x?(a=o,l=t,b.dst.ay=1,b.dst.py=0):0==b.dst.y&&(a=r,l=e,b.dst.ax=1,b.dst.px=0);var c=b.getTransitionSpeed(s);if(n&&n<=1&&(c*=n),c>0?b.bzscroll=b.bzscroll?b.bzscroll.update(l,c):new BezierClass(a,l,c,0,1,0,1):b.bzscroll=!1,!b.timer){(o==b.page.maxh&&t>=b.page.maxh||r==b.page.maxw&&e>=b.page.maxw)&&b.checkContentSize();var d=1;if(b.cancelAnimationFrame=!1,b.timer=1,b.onscrollstart&&!b.scrollrunning){var p={type:"scrollstart",current:{x:r,y:o},request:{x:e,y:t},end:{x:b.newscrollx,y:b.newscrolly},speed:c};b.onscrollstart.call(b,p)}i(),(o==b.page.maxh&&t>=o||r==b.page.maxw&&e>=r)&&b.checkContentSize(),b.noticeCursor()}},this.cancelScroll=function(){return b.timer&&h(b.timer),b.timer=0,b.bzscroll=!1,b.scrollrunning=!1,b}):(this.doScrollLeft=function(e,t){var n=b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var i=e>b.page.maxw?b.page.maxw:e;i<0&&(i=0);var o=t>b.page.maxh?b.page.maxh:t;o<0&&(o=0),b.synched("scroll",function(){b.setScrollTop(o),b.setScrollLeft(i)})},this.cancelScroll=function(){}),this.doScrollBy=function(e,t){var n=0;if(t)n=Math.floor((b.scroll.y-e)*b.scrollratio.y);else{var i=b.timer?b.newscrolly:b.getScrollTop(!0);n=i-e}if(b.bouncescroll){var o=Math.round(b.view.h/2);n<-o?n=-o:n>b.page.maxh+o&&(n=b.page.maxh+o)}return b.cursorfreezed=!1,py=b.getScrollTop(!0),n<0&&py<=0?b.noticeCursor():n>b.page.maxh&&py>=b.page.maxh?(b.checkContentSize(),b.noticeCursor()):void b.doScrollTop(n)},this.doScrollLeftBy=function(e,t){var n=0;if(t)n=Math.floor((b.scroll.x-e)*b.scrollratio.x);else{var i=b.timer?b.newscrollx:b.getScrollLeft(!0);n=i-e}if(b.bouncescroll){var o=Math.round(b.view.w/2);n<-o?n=-o:n>b.page.maxw+o&&(n=b.page.maxw+o)}return b.cursorfreezed=!1,px=b.getScrollLeft(!0),n<0&&px<=0?b.noticeCursor():n>b.page.maxw&&px>=b.page.maxw?b.noticeCursor():void b.doScrollLeft(n)},this.doScrollTo=function(e,t){var n=t?Math.round(e*b.scrollratio.y):e;n<0?n=0:n>b.page.maxh&&(n=b.page.maxh),b.cursorfreezed=!1,b.doScrollTop(e)},this.checkContentSize=function(){var e=b.getContentSize();e.h==b.page.h&&e.w==b.page.w||b.resize(!1,e)},b.onscroll=function(e){b.rail.drag||b.cursorfreezed||b.synched("scroll",function(){b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.railh&&(b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x))),b.noticeCursor()})},b.bind(b.docscroll,"scroll",b.onscroll),this.doZoomIn=function(e){if(!b.zoomactive){b.zoomactive=!0,b.zoomrestore={style:{}};var t=["position","top","left","zIndex","backgroundColor","marginTop","marginBottom","marginLeft","marginRight"],n=b.win[0].style;
for(var i in t){var o=t[i];b.zoomrestore.style[o]="undefined"!=typeof n[o]?n[o]:""}b.zoomrestore.style.width=b.win.css("width"),b.zoomrestore.style.height=b.win.css("height"),b.zoomrestore.padding={w:b.win.outerWidth()-b.win.width(),h:b.win.outerHeight()-b.win.height()},y.isios4&&(b.zoomrestore.scrollTop=l(window).scrollTop(),l(window).scrollTop(0)),b.win.css({position:y.isios4?"absolute":"fixed",top:0,left:0,"z-index":s+100,margin:"0px"});var r=b.win.css("backgroundColor");return(""==r||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(r))&&b.win.css("backgroundColor","#fff"),b.rail.css({"z-index":s+101}),b.zoom.css({"z-index":s+102}),b.zoom.css("backgroundPosition","0px -18px"),b.resizeZoom(),b.onzoomin&&b.onzoomin.call(b),b.cancelEvent(e)}},this.doZoomOut=function(e){if(b.zoomactive)return b.zoomactive=!1,b.win.css("margin",""),b.win.css(b.zoomrestore.style),y.isios4&&l(window).scrollTop(b.zoomrestore.scrollTop),b.rail.css({"z-index":b.zindex}),b.zoom.css({"z-index":b.zindex}),b.zoomrestore=!1,b.zoom.css("backgroundPosition","0px 0px"),b.onResize(),b.onzoomout&&b.onzoomout.call(b),b.cancelEvent(e)},this.doZoom=function(e){return b.zoomactive?b.doZoomOut(e):b.doZoomIn(e)},this.resizeZoom=function(){if(b.zoomactive){var e=b.getScrollTop();b.win.css({width:l(window).width()-b.zoomrestore.padding.w+"px",height:l(window).height()-b.zoomrestore.padding.h+"px"}),b.onResize(),b.setScrollTop(Math.min(b.page.maxh,e))}},this.init(),l.nicescroll.push(this)},T=function(e){var t=this;this.nc=e,this.lastx=0,this.lasty=0,this.speedx=0,this.speedy=0,this.lasttime=0,this.steptime=0,this.snapx=!1,this.snapy=!1,this.demulx=0,this.demuly=0,this.lastscrollx=-1,this.lastscrolly=-1,this.chkx=0,this.chky=0,this.timer=0,this.time=function(){return+new Date},this.reset=function(e,n){t.stop();var i=t.time();t.steptime=0,t.lasttime=i,t.speedx=0,t.speedy=0,t.lastx=e,t.lasty=n,t.lastscrollx=-1,t.lastscrolly=-1},this.update=function(e,n){var i=t.time();t.steptime=i-t.lasttime,t.lasttime=i;var o=n-t.lasty,r=e-t.lastx,s=t.nc.getScrollTop(),a=t.nc.getScrollLeft(),l=s+o,c=a+r;t.snapx=c<0||c>t.nc.page.maxw,t.snapy=l<0||l>t.nc.page.maxh,t.speedx=r,t.speedy=o,t.lastx=e,t.lasty=n},this.stop=function(){t.nc.unsynched&&t.nc.unsynched("domomentum2d"),t.timer&&clearTimeout(t.timer),t.timer=0,t.lastscrollx=-1,t.lastscrolly=-1},this.doSnapy=function(e,n){var i=!1;n<0?(n=0,i=!0):n>t.nc.page.maxh&&(n=t.nc.page.maxh,i=!0),e<0?(e=0,i=!0):e>t.nc.page.maxw&&(e=t.nc.page.maxw,i=!0),i&&t.nc.doScrollPos(e,n,t.nc.opt.snapbackspeed)},this.doMomentum=function(e){var n=t.time(),i=e?n+e:t.lasttime,o=t.nc.getScrollLeft(),r=t.nc.getScrollTop(),s=t.nc.page.maxh,a=t.nc.page.maxw;t.speedx=a>0?Math.min(60,t.speedx):0,t.speedy=s>0?Math.min(60,t.speedy):0;var l=i&&n-i<=50;(r<0||r>s||o<0||o>a)&&(l=!1);var c=!(!t.speedy||!l)&&t.speedy,d=!(!t.speedx||!l)&&t.speedx;if(c||d){var u=Math.max(16,t.steptime);if(u>50){var h=u/50;t.speedx*=h,t.speedy*=h,u=50}t.demulxy=0,t.lastscrollx=t.nc.getScrollLeft(),t.chkx=t.lastscrollx,t.lastscrolly=t.nc.getScrollTop(),t.chky=t.lastscrolly;var p=t.lastscrollx,m=t.lastscrolly,f=function(){if(!t.nc.removed){var e=t.time()-n>600?.04:.02;t.speedx&&(p=Math.floor(t.lastscrollx-t.speedx*(1-t.demulxy)),t.lastscrollx=p,(p<0||p>a)&&(e=.1)),t.speedy&&(m=Math.floor(t.lastscrolly-t.speedy*(1-t.demulxy)),t.lastscrolly=m,(m<0||m>s)&&(e=.1)),t.demulxy=Math.min(1,t.demulxy+e),t.nc.synched&&t.nc.synched("domomentum2d",function(){if(t.speedx){var e=t.nc.getScrollLeft();e!=t.chkx&&t.stop&&t.stop(),t.chkx=p,t.nc.setScrollLeft(p)}if(t.speedy){var n=t.nc.getScrollTop();n!=t.chky&&t.stop(),t.chky=m,t.nc.setScrollTop(m)}t.timer||(t.nc.hideCursor(),t.doSnapy(p,m))}),t.demulxy<1?t.timer=setTimeout(f,u):(t.stop(),t.nc.hideCursor(),t.doSnapy(p,m))}};f()}else t.doSnapy(t.nc.getScrollLeft(),t.nc.getScrollTop())}},b=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(e,t,n){var i=l.data(e,"__nicescroll")||!1;return i&&i.ishwscroll?i.getScrollTop():b.call(e)},set:function(e,t){var n=l.data(e,"__nicescroll")||!1;return n&&n.ishwscroll?n.setScrollTop(parseInt(t)):b.call(e,t),this}},e.fn.scrollTop=function(e){if("undefined"==typeof e){var t=!!this[0]&&(l.data(this[0],"__nicescroll")||!1);return t&&t.ishwscroll?t.getScrollTop():b.call(this)}return this.each(function(){var t=l.data(this,"__nicescroll")||!1;t&&t.ishwscroll?t.setScrollTop(parseInt(e)):b.call(l(this),e)})};var w=e.fn.scrollLeft;l.cssHooks.pageXOffset={get:function(e,t,n){var i=l.data(e,"__nicescroll")||!1;return i&&i.ishwscroll?i.getScrollLeft():w.call(e)},set:function(e,t){var n=l.data(e,"__nicescroll")||!1;return n&&n.ishwscroll?n.setScrollLeft(parseInt(t)):w.call(e,t),this}},e.fn.scrollLeft=function(e){if("undefined"==typeof e){var t=!!this[0]&&(l.data(this[0],"__nicescroll")||!1);return t&&t.ishwscroll?t.getScrollLeft():w.call(this)}return this.each(function(){var t=l.data(this,"__nicescroll")||!1;t&&t.ishwscroll?t.setScrollLeft(parseInt(e)):w.call(l(this),e)})};var y=function(e){var t=this;if(this.length=0,this.name="nicescrollarray",this.each=function(e){for(var n=0;n<t.length;n++)e.call(t[n]);return t},this.push=function(e){t[t.length]=e,t.length++},this.eq=function(e){return t[e]},e)for(a=0;a<e.length;a++){var n=l.data(e[a],"__nicescroll")||!1;n&&(this[this.length]=n,this.length++)}return this};n(y.prototype,["show","hide","toggle","onResize","resize","remove","stop","doScrollPos","disableScrolling"],function(e,t){e[t]=function(){var e=arguments;return this.each(function(){this[t].apply(this,e)})}}),e.fn.getNiceScroll=function(e){if("undefined"==typeof e)return new y(this);var t=l.data(this[e],"__nicescroll")||!1;return t},e.extend(e.expr[":"],{nicescroll:function(e){return!!l.data(e,"__nicescroll")}}),l.fn.niceScroll=function(e,t){"undefined"==typeof t&&("object"!=typeof e||"jquery"in e||(t=e,e=!1));var n=new y;"undefined"==typeof t&&(t={}),e&&(t.doc=l(e),t.win=l(this));var i=!("doc"in t);return i||"win"in t||(t.win=l(this)),this.each(function(){var e=l(this).data("__nicescroll")||!1;e||(t.doc=i?l(this):t.doc,e=new v(t,l(this)),l(this).data("__nicescroll",e)),n.push(e)}),1==n.length?n[0]:n},window.NiceScroll={getjQuery:function(){return e}},l.nicescroll||(l.nicescroll=new y,l.nicescroll.options=m)}(jQuery),define("javascripts/jquery.nicescroll.min",["javascripts/jquery"],function(){}),define("util/ItemSaver",["javascripts/backbone-min","util/Dispatcher","util/StateJSONBuilder","util/ResponseValidator"],function(e,t,n,i){var o=function(){function e(){function e(e,n,r){var s=!1;if(TN8.log("ItemSaver.sendSaveRequest ",TN8.IMPORTANT),e&&"isLastCall"in e&&e.isLastCall===!0&&(s=!0),0!==n){if(!i.checkJSONValidity(r))return TN8.throw("Response that was going to be sent is missing some fields.",TN8.errorType.WRONG_RESPONSE_ERROR),TN8.log(r),null;e&&e.fullData?(TN8.log("ItemSaver.sendSaveRequest . Sending Combined NavSave call to engine.",TN8.CRITICAL),TestEngine.navigateAndSave(n,e.fullData,r,t.bind(this,s,!0),o)):(TN8.log("ItemSaver.sendSaveRequest . Sending Item Response to engine to be saved.",TN8.CRITICAL),TestEngine.setItemResponse(TestEngine,n,r,t.bind(this,s,!1),o,s))}else TN8.log("ItemSaver.sendSaveRequest . Something went wrong here , itemId "+n,TN8.CRITICAL)}function t(e,t,n){$(document).trigger("inform.itemSaved");var i=n?n.msgCode:null;TN8.log("ItemSaver.handler_saveSuccess . errCode : "+i,TN8.CRITICAL),TN8.Application.error.successCheck(n,null,i)&&($(document).trigger("tn.save.success"),t?TN8.Dispatcher.trigger("performCatNavigation",n):TN8.Dispatcher.trigger("performNavigation"))}function o(e){TN8.throw("Msg 3010:  Unable to save response.",TN8.errorType.SAVE_RESPONSE_ERROR)}return{saveItem:function(t){var i=n.getInstance().getStateJSON(t);i&&e(t,i.itemId,i.savingObject)},checkJSONValidity:i.checkJSONValidity}}var t;return{getInstance:function(){return t||(t=e()),t}}};return o()}),define("controllers/ItemController",["javascripts/backbone-min","views/LayoutView","controllers/ModuleController","require","utils","util/Dispatcher","util/Waiter","controllers/JWPlayerControllerWrapper","controllers/PopupControllerWrapper","tools/scriptInjector","controllers/ApplicationStatusController","tools/ToolLoader","controllers/TwoPaneScrollingController","util/StateJSONBuilder","models/ItemState","models/InteractionState","views/ModuleView","controllers/ChoiceInteractionController","controllers/InlineChoiceController","controllers/MatchInteractionController","controllers/MatchGridInteractionController","controllers/OrderInteractionController","controllers/CustomInteractionController","controllers/passageController","javascripts/jquery.nicescroll.min","controllers/ActionSubscriber","util/ItemSaver"],function(e,t,n,i,o,r,s,a,l,c,d,u,h,p){"use strict";function m(){function e(){$(document).trigger("testState.setItemVisited",!0)}function t(){$(document).trigger("testState.setItemAnswered",!0)}function n(){$(document).trigger("testState.setItemAnswered",!1)}return{setCurrentItemToAnswered:t,setCurrentItemToUnanswered:n,setCurrentItemToVisited:e}}var f=new m,g=e.Model.extend({defaults:{layoutView:new t,itemIndex:null,itemMarkup:null,itemExtraScript:null,controllers:[],itemData:null,itemModel:null,itemSet:null,nextItemIndex:null,hasMath:!1,headerView:null,lastItemResponse:null},controllerMappings:{CHOICE:"ChoiceInteractionController",CUSTOM:"CustomInteractionController",EXTENDEDTEXT:"ExtendedTextInteractionController",GAPMATCH:"GapMatchInteractionController",GRAPHICGAPMATCH:"GraphicGapMatchInteractionController",HOTSPOT:"HotspotInteractionController",INLINECHOICE:"InlineChoiceController",MATCH:"MatchInteractionController",ORDER:"OrderInteractionController",RECORDER:"RecorderInteractionController",TEXTENTRY:"TextEntryController",POSITIONOBJECT:"PositionObjectInteractionController",DRAWING:"DrawingInteractionController",WEBCONTENT:"WebContentInteractionController",RTELITE:"RichTextWidgetInteractionController",CKEDITOR:"CKEditorInteractionController"},itemControllerStatus:{GET_ITEM:2,FETCH:3,FETCH_SUCCESS:4,FINALIZE:5},thisClassName:"ItemController",extraScriptEl:$("#contentExtraScript"),initialize:function(e){d.statusChange(this.thisClassName,this.itemControllerStatus.FINALIZE),_.bindAll(this),$(document).off("perform.itemTimerSave").on("perform.itemTimerSave",this.setTimerState),$(document).off("cleanup.betweenTest",this.cleanBetweenRuns).on("cleanup.betweenTest",this.cleanBetweenRuns),$(document).off("item.reload",this.requestReload).on("item.reload",this.requestReload),r.off("WipeModals"),r.on("WipeModals",this.stop),r.off("CleanUpItemController"),r.on("CleanUpItemController",this.cleanUpFromPreviousItem),TN8.fnOn("tn.endsection.exit tn.navigate.endSection tn.endtest.loaded perform.endSection.cleanUp",this.cleanUpFromPreviousItem),$(document).off("tn.error.fatal focuslost",$.proxy(this.stopListeners,this)).on("tn.error.fatal focuslost",$.proxy(this.stopListeners,this)),this.applicationStatusInit(),this.stateObj={state:{}},this.nextStateObj={state:{}},this.toolState=[],this.nextToolState=[],this.toolLoader=new u,this.dataIdArray=[]},applicationStatusInit:function(){d.registerEvent(d.actionNames.TurnOffModal,"DoTurnOffModal","ErrTurnOffModal",r),r.off("DoTurnOffModal").on("DoTurnOffModal",this.hideModal,this),d.registerEvent(d.actionNames.TurnOnModal,"DoTurnOnModal","ErrTurnOnModal",r),r.off("DoTurnOnModal").on("DoTurnOnModal",this.showModal,this),d.registerEvent(d.actionNames.FetchSuccess,"DoFetchSuccess","ErrFetchSuccess",r),r.off("DoFetchSuccess").on("DoFetchSuccess",this.handler_fetchSuccess,this),r.off("ErrFetchSuccess").on("ErrFetchSuccess",this.fetchSuccessFailed,this),d.subscribeCondition(d.actionNames.SaveItemResponse,this.thisClassName,this.itemControllerStatus.FINALIZE),d.subscribeCondition(d.actionNames.TurnOffModal,this.thisClassName,this.itemControllerStatus.FINALIZE),d.subscribeCondition(d.actionNames.FetchSuccess,this.thisClassName,this.itemControllerStatus.FETCH),d.subscribeCondition(d.actionNames.NavigateNext,this.thisClassName,this.itemControllerStatus.FINALIZE),d.subscribeCondition(d.actionNames.NavigatePrev,this.thisClassName,this.itemControllerStatus.FINALIZE),d.subscribeCondition(d.actionNames.NavigateSubmitTest,this.thisClassName,this.itemControllerStatus.FINALIZE),d.subscribeCondition(d.actionNames.NavigateLoadNextSection,this.thisClassName,this.itemControllerStatus.FINALIZE),d.subscribeCondition(d.actionNames.NavigateTo,this.thisClassName,this.itemControllerStatus.FINALIZE),d.subscribeCondition(d.actionNames.startItemTimer,this.thisClassName,this.itemControllerStatus.FINALIZE),d.subscribeCondition(d.actionNames.resumeItemTimer,this.thisClassName,this.itemControllerStatus.FINALIZE),d.subscribeCondition(d.actionNames.NavigateStartSection,this.thisClassName,this.itemControllerStatus.FINALIZE)},getItem:function(e){$(document).off("ItemResponseChanged",this.setAnswer);TN8.log("ItemController.getItem index = "+e,TN8.IMPORTANT),d.statusChange(this.thisClassName,this.itemControllerStatus.GET_ITEM),this.set("nextItemIndex",e);var t=function(e,t){TN8.throw("Error in getItemResponse("+t+").",TN8.errorType.GET_RESPONSE_ERROR),$(document).trigger("tn.loadingModal.off")};TestEngine.getItemResponse(e,this.initStateObj,this,t)},requestReload:function(e){this.showModal(),this.toolLoader._cleanupTTS(),TN8.Application.DataProvider.getResponses(this.reload)},reload:function(e,t){var n=p.getInstance().getStateJSON({itemJSON:t});this.setNextState(n.savingObject),this.clearDataId(),this.handler_fetchSuccess(this.get("lastItemResponse"),!0)},initStateObj:function(e){return TN8.log("ItemController.initStateObj  ",TN8.IMPORTANT),TN8.Application.error.successCheck(e)?(this.setNextState(e),void this.fetch({success:this.handler_fetchSuccess,error:this.handler_fetchError})):null},setNextState:function(e){var t=i("models/ItemState"),n={};e&&e.state&&(n=e.state.data?e.state.data.data:e.state,this.nextToolState=n.tools),this.nextStateObj=new t(n),this.nextStateObj.set("clientVersion",TN8.Application.clientVersion)},fetch:function(e){TN8.log("ItemController.fetch getItemFlavor from Engine",TN8.IMPORTANT),d.statusChange(this.thisClassName,this.itemControllerStatus.FETCH),TestEngine.getNavigation().getItemFlavor(this.get("nextItemIndex"),$.proxy(this.requestFetchSuccess,this),$.proxy(this.handler_fetchError,this))},requestFetchSuccess:function(e){d.execute(d.actionNames.FetchSuccess,e)},handler_fetchSuccess:function(e,t){if(t||$(document).trigger("inform.flavorFetched"),TN8.log("ItemController.handler_fetchSuccess  ",TN8.IMPORTANT),d.statusChange(this.thisClassName,this.itemControllerStatus.FETCH_SUCCESS),!TN8.Application.error.successCheck(e))return this.handler_fetchError(e),null;this.set("lastItemResponse",e),this.cleanUpFromPreviousItem(),this.set("itemIndex",this.get("nextItemIndex")),this.stateObj=$.extend(!0,{},this.nextStateObj),t||(this.stateObj.set("views",this.stateObj.get("views")+1),this.performItemNavigation()),this._setHasMathFromFlavor(e),this.itemExtraScript=e.itemBodyExtraScript,this.itemApip=e.itemApip&&"{}"!=e.itemApip?JSON.parse(e.itemApip):null;var n=e.itemBodyHtml,i=$("<div>"+n+"</div>");TestEngine.getTestDefine()._sourceJson&&"aw"===TestEngine.getTestDefine()._sourceJson.itemStyles&&(i=$('<div class="aw-wrapper">'+n+"</div>")),this._bindImageLoadEvent(i),this._editDataTarget(i);var o=TestEngine.getNavigation().getCurrentItem().getItemSet(),r=!1;""!==o&&o===this.get("itemSet")&&(r=!0),this.set("itemSet",o);var s=this.get("layoutView");s.content=i,this.itemData=s.render(r),this.setFontSize(),$("#review-screen").css({height:"100px"}),$(window).trigger("resize"),window.scrollTo(0,0),this.itemApip?(TN8.apip.isASL=!!(this.itemApip&&this.itemApip.inclusionOrder&&this.itemApip.inclusionOrder.aslDefaultOrder&&this.itemApip.inclusionOrder.aslDefaultOrder.elementOrders&&this.itemApip.inclusionOrder.aslDefaultOrder.elementOrders.length),!TN8.apip.isASL&&TN8.apip.pnp&&TN8.apip.pnp.assignedSupport===("dynamic-tts"===TN8.apip.pnp.type)||(TN8.apip.apipObject=this.itemApip)):TN8.apip.isASL=!1;var a=$("div.passage-scrolling",this.itemData);if($(".row, .qti-layout-row").hasClass("pane-scrolling")){var l=new h($(".row.pane-scrolling, .qti-layout-row.pane-scrolling"));l.init()}for(var u=0;u<a.length;u++)this.setPassage($(a[u]));c.setExhibits(n);try{var p=JSON.parse(e.itemBodyScriptLibs);c.injectScripts(p,this.runExtraScripts)}catch(e){c.injectFailure(e.message)}this.setItemHeader()},_editDataTarget:function(e){$("[data-toggle=tab]",e).each(function(e,t){$(t).attr("data-target",$(t).attr("href")),$(t).removeAttr("href")})},setItemHeader:function(){var e=TestEngine.getNavigation().getCurrentSection(),t=TestEngine.getNavigation().getCurrentItem(),n=e.getNumberOfQuestionItems(),i=e.getIndexOfQuestionItem(t),o=t.getWc()?t.getTitle():$.i18n.t("header:questionBreadCrumbAria",{questionNumber:i,totalNumber:n});$("#itemCanvasTitle").html(o)},handler_fetchError:function(e){TN8.throw("Error in fetching item partial("+e+").",TN8.errorType.HANDLER_FETCH_ERROR),$(document).trigger("tn.loadingModal.off")},cleanUpFromPreviousItem:function(){TN8.log("ItemController.cleanUpFromPreviousItem  ",TN8.IMPORTANT),r.trigger("ItemController.cleanUpProcessStart"),$(document).trigger("ItemController.cleanUpProcessStart"),$(document).trigger("perform.removeFTListener"),$(document).off("tn.nav.start",this.itemNavAway),this.stateObj={state:{}},this.toolState=[],this.set("itemIndex",0),this.ImageFailed=!1,TN8.apip&&TN8.apip.apipObject&&(TN8.apip.apipObject=null),TN8.CatalogController&&(TN8.CatalogController=null),null!=TN8.exhibits&&(TN8.exhibits.exhibitsWidget("destroy"),TN8.exhibits=null),$('div[id^="ascrail"]').remove(),window.itemBehaviors&&(window.itemBehaviors.removeAll(),window.itemBehaviors.clear(!0)),this.cleanUpImages();var e=this.get("layoutView");e.content=null,l.cleanup();for(var t=this.get("controllers")||[],n=0;n<t.length;n++){var i=t[n];i.cleanUp&&i.cleanUp()}for(this.unset("controllers"),this.set("controllers",[]),a.cleanup(),null!==this.toolLoader&&this.toolLoader.cleanup(),n=0;n<TN8.equationEditors.length;n++)TN8.equationEditors[n].el.finalize();if(TN8.equationEditors.splice(0,TN8.equationEditors.length),qtiCustomInteractionContext.reset(),TN8.VariableFactory.templateVars.reset(),$.nicescroll&&$.nicescroll.length)for(var n=$.nicescroll.length;n--;)$.nicescroll[0]&&$.nicescroll[0].remove&&$.nicescroll[0].remove()},cleanUpItemStyles:function(){var e=TestEngine.getTestDefine()&&TestEngine.getTestDefine()._sourceJson.itemStyles;e&&$("body").removeClass(e)},cleanUpImages:function(){var e=this.get("layoutView");e&&$(e.el).find("img,svg").attr("src","")},runExtraScripts:function(){TN8.log("ItemController.runExtraScripts ",TN8.IMPORTANT);var e=2;TN8&&TN8.apip&&TN8.apip.apipObject&&window.TextToSpeechAPI&&(TN8.apip.valid=TextToSpeechAPI.hasTTSorASL(TN8.apip.apipObject),!TN8.apip.valid||TN8.apip.pnp&&TN8.apip.pnp.assignedSupport===!1&&"dynamic-tts"!==TN8.apip.pnp.type||(TN8.apip.pnp&&(TextToSpeechAPI.ttsPnp=TN8.apip.pnp),e++)),e+=$(this.itemData).find("[data-module=CustomInteraction-equationeditor]").length;var t=0,n=this.itemExtraScript.match(/\.qtip\(/g);TN8.PnpController.checkforOnScreenRegularPopup()!==!1&&(t=n),t=t?t.length:0,t+=$(this.itemData).find(".keyword-translation").length,e+=t;var i="<script type='text/javascript'>$(document).trigger('rsScriptReady')</script>";this.itemExtraScript.indexOf("rsScriptReady")===-1&&(this.itemExtraScript+=i),TN8.fnOne("AllScriptsReady",this.injectComplete);new s({expectedEvents:e,incomingReadyEvents:"rsScriptReady TTSDOMReady JWReady eeEditorReady popupReady",outgoingReadyEvents:"AllScriptsReady"});try{(t||TN8.PnpController.checkforOnScreenRegularPopup()===!1&&n)&&l.init(),this.extraScriptEl.html(this.itemExtraScript),this.extraScriptEl.empty(),TN8.PnpController.checkforOnScreenRegularPopup()===!1&&$(".glossary-term").removeAttr("tabindex"),a.setPlayers(this.itemExtraScript),a.onReady()}catch(e){TN8.log("ItemController.runExtraScripts "+e.message,TN8.CRITICAL),TN8.log("ItemController.runExtraScripts "+this.itemExtraScript,TN8.CRITICAL),TN8.throw("Msg 3011: Unable to load item script.",TN8.errorType.CODE_INJECTION_ERROR)}},initCatalog:function(e){var e=this.itemApip?this.itemApip.catalogInfo:[],t=e?e.length:0;t?TN8.CatalogController=new CatalogAPI.CatalogController(e):$(document).trigger("catalogReady")},injectComplete:function(){TN8.VariableFactory.templateVars.applyGetDataBehaviors(),TN8.log("ItemController.injectComplete   started!",TN8.IMPORTANT),$("body").trigger("tn.setContrast"),this.handler_loadNextModule(),TN8.log("ItemController.injectComplete   end!",TN8.IMPORTANT)},handler_loadNextModule:function(){var e=this,t=$.makeArray($("[data-module]",this.itemData));if(0===t.length){var n="<div data-module='WEBCONTENTINTERACTION' data-identifier='RESPONSE_WC' data-interactionType='WEBCONTENTINTERACTION'></div>";t.push($(n))}TN8.fnOne("AllControllersSetReady",this.loadMathJaxLibrary),TN8.fnOne("LoadMathJaxComplete",this.initCatalog),TN8.fnOne("catalogReady",this.controllersReady);var i=(new s({expectedEvents:t.length+1,incomingReadyEvents:"ControllerSetReady",outgoingReadyEvents:"AllControllersSetReady"}),function(){var n;t.length?(n=$(t.shift()),e.getModuleController(n,i)):(qtiCustomInteractionContext.initialize(),$(document).trigger("ControllerSetReady","AllControllersDoneLoading"))});i()},controllersReady:function(){this.stateObj.clearModules(),TN8.fnOne("inform.loadToolLibsReady",this.displayToolBar),TN8.fnOne("AllToolsLoadedAndReady",this.finalize),this.toolLoader.loadToolLibs(),this.validateForAnyRuntimeErrors()},validateForAnyRuntimeErrors:function(){$(".MathJax_Error").length>0&&(TN8.throw("Mathjax processing error",TN8.errorType.REQUIRE_LOAD_ERROR),$(".MathJax_Error").remove())},displayToolBar:function(){this.toolLoader.displayToolBar()},loadMathJaxLibrary:function(){var e=function(e){var t=document.getElementsByTagName("body")[0];MathJax.Hub.Queue(function(){MathJax.Extension.mml2jax&&MathJax.Extension.mml2jax.PreProcess()}),MathJax.Hub.Queue(function(){MathJax.Extension.tex2jax&&MathJax.Extension.tex2jax.PreProcess()}),MathJax.Hub.Queue(function(){MathJax.Extension.MathEvents&&(MathJax.Extension.MathEvents.Touch.delay=-1)}),MathJax.Hub.Queue(["Process",MathJax.Hub,t,function(){TN8.mathLoaded=!0,TN8.log("ItemController.loadMathJaxLibrary dipatching mathjaxprocesscomplete",TN8.IMPORTANT),TN8.Dispatcher.trigger("MathJaxProcessComplete"),$(document).trigger("LoadMathJaxComplete")}])};this.get("hasMath")?(TN8.log("ItemController.loadMathJaxLibrary hasMath   ",TN8.IMPORTANT),TN8.utils.loadLibraries([TN8.baseUrl+"public/javascripts/mathjax/MathJax.js?config=TeX-MML-AM_CHTML"],e,this.mathjaxFailure)):(TN8.log("ItemController.loadMathJaxLibrary NOT hasMath   ",TN8.IMPORTANT),$(document).trigger("LoadMathJaxComplete"))},mathjaxFailure:function(e){TN8.throw("scriptInjector.injectScripts failed. MathJax failed . Error message : "+JSON.stringify(e),TN8.errorType.INJECTION_SCRIPT_ERROR)},finalize:function(){d.statusChange(this.thisClassName,this.itemControllerStatus.FINALIZE),$(document).trigger("itemTimer.destroy"),this.ImageFailed&&this.ImageEWSHandler(),f.setCurrentItemToVisited(),this.setNavigationBtnsStatus(),TN8.fnOn("ItemResponseChanged",this.setAnswer),this.startTimer(),$(document).trigger("perform.addFTListener"),$(document).one("tn.nav.start",this.itemNavAway),r.trigger("ItemController.ItemLoaded"),$(document).trigger("ItemController.ItemLoaded"),this._fixSafariMathJaxLayout(),d.execute(d.actionNames.TurnOffModal)},_fixSafariMathJaxLayout:function(){var e=$("body").hasClass("safari"),t=$("#itemCanvasBody").find(".MathJax_CHTML").length>0,n=$("#itemCanvasBody").find(".visuallyhidden").length>0;if(e&&t&&n){var i=document.getElementById("itemCanvasBody"),o=i.style.display;i.style.display="none";i.offsetHeight;i.style.display=o}},itemNavAway:function(){$(document).trigger("inform.itemNavAway"),$(document).off("tn.nav.start",this.itemNavAway),$(document).off("ItemResponseChanged",this.setAnswer)},setNavigationBtnsStatus:function(){$(document).trigger("ItemSetAnswer",this.isItemAnswered())},hideModal:function(){$(document).trigger("tn.loadingModal.off")},showModal:function(){$(document).trigger("tn.loadingModal.on")},_setHasMathFromFlavor:function(e){e.hasMath?this.set("hasMath",!0):this.set("hasMath",!1)},setFontSize:function(){var e=TestEngine.getTestDefine()._sourceJson,t="";e&&(t=e.itemStyles,"aw"===t&&$("#itemCanvas").addClass("aw")),"undefined"==typeof TN8.Application.itemCanvasSize&&t&&""!==t&&(TN8.utils.setFont($("body"),t,!1),$(document).trigger("ProgramStylesApplied"))},performItemNavigation:function(){TN8.Application.NavigateEngine(this.get("itemIndex"))},setTimerState:function(e,t){var n=t.time,i=d.getStatus()[this.thisClassName];"item"===TN8.Application.currentContent&&5===i&&n!==-1&&_.isNumber(n)&&this.stateObj.set&&this.stateObj.set(t.key,n)},requestResumeItemTimer:function(){d.execute(d.actionNames.resumeItemTimer)},resumeItemTimer:function(){"item"===TN8.Application.getCurrentContent()&&$(document).trigger("itemTimer.resume")},resumeItemTimerFailed:function(){},requestStartTimer:function(){d.execute(d.actionNames.startItemTimer)},startTimer:function(){if("item"===TN8.Application.getCurrentContent()){var e=this.stateObj.get("time");e=_.isNumber(e)&&e>0?e:0,$(document).trigger("itemTimer.restore",this.stateObj.toJSON())}},startTimerFailed:function(){},setPassage:function(e,t){var n=function(n){var n=new n;n.init(e,t)};return i(["controllers/passageController"],n),null},pushDataId:function(e){this.dataIdArray.push($(e).attr("data-identifier"))},clearDataId:function(){this.dataIdArray=[]},getModuleController:function(e,t){var n=e.attr("data-module");e.next().hasClass("bootstrap-select")&&(n="CUSTOMINTERACTION-RICHINLINE");var o=this,r=this.getModuleControllerName(n);"ChoiceMultipleInteractionController"===r&&(e.hasClass("at2-enable")||e.hasClass("choice-widget"))&&(r="ChoiceMultipleTn8InteractionController"),this.pushDataId(e);var s=function(n){var i=new n,s=o.get("controllers")||[];i.setModuleName(r);try{s.push(i),o.set("controllers",s),i.init(e),o.trigger("change:controllers")}catch(e){TN8.throw(e.message,TN8.errorType.REQUIRE_LOAD_ERROR)}finally{t&&t()}};TN8.log("ItemController.handler_initModuleLoad controller name : "+r,TN8.IMPORTANT),null!==r&&i(["controllers/"+r],s)},getModuleControllerName:function(e){var t="";if(void 0!==e){if(e=e.toUpperCase(),"MATCHINTERACTION-TABLEGRID"===e)t="MatchGridInteractionController";else if(e.indexOf("CUSTOMINTERACTION")>-1){var n=e.substr(17);switch(n){case"-AUDIOCAPTURE":t="RecorderInteractionController";break;case"-PCI":t="PCIController";break;case"-CHART":t="ChartInteractionController";break;case"-EQUATIONEDITOR":t="EquationEditorController";break;case"-RICHTEXT":t="RichTextWidgetInteractionController";break;case"-RICHINLINE":t="RichInlineChoiceInteractionController";break;case"-COMPLEXSLIDER":t="ComplexSliderController";break;case"-SHAPETRANSFORMATION":t="ShapeTransformationController";break;case"-TEXTHIGHLIGHTER":t="TextHighlighterInteractionController";break;case"-TEXTEXTRACTOR":t="TextExtractorInteractionController";break;case"-ZOOMNUMBERLINE":case"-NUMBERLINE":t="ZoomNumberlineInteractionController";break;case"-FRACTIONMODEL":t="FractionModelInteractionController";break;case"-COMPOSITEGRAPH":case"-POINTGRAPH":case"-FUNCTIONGRAPH":t="GraphInteractionController";break;case"-CHOICE":t="ChoiceMultipleInteractionController";break;case"-SBEE":t="SbEquationEditorInteractionController";break;case"-SBGRID":t="SbGridInteractionController";break;case"-SBTABLE":t="SbTableInteractionController";break;case"-CKEDITORINTERACTION":t="CKEditorInteractionController";break;default:t="CustomInteractionController"}}else"TEXTENTRYGRIDDEDRESPONSE"===e?t="GriddedResponseInteractionController":(e.indexOf("INTERACTION")>-1&&(e=e.substring(0,e.length-11)),t=this.controllerMappings[e]);t||TN8.throw("error determining module controller from data-module.")}else t="CustomInteractionController";return t},fetchSuccessFailed:function(){TN8.throw("",TN8.errorType.CONDITIONS_FETCHSUCCESS_FAIL)},setAnswer:function(){this.isItemAnswered()?(f.setCurrentItemToAnswered(),$(document).trigger("ItemSetAnswer",!0)):(f.setCurrentItemToUnanswered(),$(document).trigger("ItemSetAnswer",!1))},getModuleState:function(e){var t,n=this.stateObj.getModules(),i=n.length,o=null;for(t=0;t<i;t++)if(o=n.at(t),e.isEqualTo(o)){n.remove(o);break}return a.setState(TN8.TestStateController.getJwPlayerState()),o},setModuleState:function(e){for(var t=this.stateObj.getModules().models,n=-1,i=0;i<t.length;i++)e.isEqualTo(t[i])&&(n=i);n!==-1?t[n]=e:(t.push(e),n=t.length),this.setAnswer(),TN8.TestStateController.setJwPlayerState(a.getState())},isItemAnswered:function(){for(var e=this.get("controllers"),t=!0,n=0;n<e.length;n++)e[n].isAnswered&&e[n].isAnswered()||(t=!1);return t&&null!==e&&e.length>0},getCurrentItemIsAnswered:function(){return TN8.TestStateController.getItemAnswered()},_bindImageLoadEvent:function(e){function t(){var e=d.getStatus()[i.thisClassName];4===e?i.ImageEWSHandler():i.ImageFailed=!0}function n(){o.off("error",t)}var i=this,o=e.find("img");TestEngine.isNativeComponentActive()&&(o.on("error",t),TN8.fnOne("ItemController.cleanUpProcessStart",n)),o.on("load",function(){$(document).trigger("imagesLoaded")})},ImageEWSHandler:function(){var e=this,t=function(t){e.clearDataId(),e.getItem(t)},n=this.get("itemIndex");TN8.log("ItemController._bindImageLoadEvent  calling ewsCallback 1015",TN8.CRITICAL),TN8.EWSController.ewsCallback({errorMsg:"1015",retryFunction:t,retryFunctionArgs:[n],details:"bindImageLoadEvent"})},stop:function(){TN8.apip&&TN8.apip.ttsObject&&TN8.apip.ttsObject.ttsController&&TN8.apip.ttsObject.ttsController.stop()},getSaveToLocation:function(){return"saveAllModules"},cleanBetweenRuns:function(){d.statusChange(this.thisClassName,this.itemControllerStatus.FINALIZE),this.cleanUpItemStyles()},stopListeners:function(){$(document).off("inform.loadToolLibsReady",this.displayToolBar),$(document).off("AllToolsLoadedAndReady",this.finalize)}});return new g}),define("views/logout",["javascripts/backbone-min","utils","text!tpl/combined.html","util/shortcuts"],function(e,t,n,i){"use strict";var o=e.View.extend({initialize:function(){this.el=document.getElementById("content"),this.$el=$(this.el),this.template=_.template($(n).filter("#logouttemplate").html())},render:function(e){return $(document).trigger("perform.addFTListener"),this.$el.html(this.template()),this.$("#login-link").off("click",this.signinHandler).on("click",this.signinHandler),$(document).trigger("tn.loadingModal.off"),this},signinHandler:function(){$(document).trigger("perform.removeFTListener"),TestEngine._isAppMode()?(window.location.search&&window.history.pushState({},"",window.location.pathname),$(document).trigger("tn.route.to","login"),$(".jGrowl-close")&&$(".jGrowl-close").click()):window.location.href=window.location.protocol+"//"+window.location.host+"/client/index.html"},getSaveToLocation:function(){return""}});return o}),define("views/practiceTest",["javascripts/backbone-min","utils","text!tpl/combined.html"],function(e,t,n){"use strict";var i=e.View.extend({initialize:function(){_.bindAll(this,"setIframeSize","loginWithCreds","practiceErrorGrowl","addListeners","cleanUp"),this.template=_.template($(n).filter("#practicetemplate").html()),this.el=this.template()},render:function(){var e=this;$("#content").html(this.el);var t=(TN8.Application.config,$("#practice-test-iframe"));return this._frameSrc=TN8.Application.config.practiceURL,t[0].onload=function(){e.addListeners()},(TestEngine.isIdevice()||$("body").hasClass("safari"))&&this.checkInternetConnection(),t[0].src=this._frameSrc,this.setIframeSize(),this.removeAndroidHack(),$(document).trigger("perform.addFTListener"),$(document).trigger("navigated.practiceTest"),this},checkInternetConnection:function(){$.ajax({url:document.location.origin,error:this.addListeners})},setIframeSize:function(e){var n=$("#practice-test-iframe");n.css("height",t.getViewPortSize().height-n.offset().top-25);
},loginWithCreds:function(e){e.originalEvent&&e.originalEvent.data&&e.originalEvent.data.user&&e.originalEvent.data.pass&&($(document).trigger("tn.loadingModal.on"),$(document).trigger("tn.login.with.creds",e.originalEvent.data))},goToLogin:function(){$(document).trigger("tn.route.to","login")},practiceErrorGrowl:function(){TN8.throw("",TN8.errorType.PRACTICE_LOGIN_ERROR)},removeAndroidHack:function(){var e=TestEngine.isAndroidOS();e&&$("#androidKeyboardHack").remove()},addListeners:function(){$("#sign-in-btn").off("click",this.goToLogin).on("click",this.goToLogin),$(window).off("message",this.loginWithCreds).on("message",this.loginWithCreds),$(document).off("tn.login.error",this.practiceErrorGrowl).on("tn.login.error",this.practiceErrorGrowl),$(document).off("tn.navigate.login inform.startTestRendering",this.cleanUp).on("tn.navigate.login inform.startTestRendering",this.cleanUp),$(window).off("resize",this.setIframeSize).on("resize",this.setIframeSize),$(document).trigger("tn.loadingModal.off"),this.sendIframeMessage()},cleanUp:function(){$("#sign-in-btn").off("click",this.goToLogin),$(window).off("message",this.loginWithCreds),$(document).off("tn.login.error",this.practiceErrorGrowl),$(document).off("tn.navigate.login inform.startTestRendering",this.cleanUp),$(window).off("resize",this.setIframeSize)},sendIframeMessage:function(){var e,t=this;e="/client/pracTest.html"===this._frameSrc?window.location.protocol+"//"+window.location.hostname+this._frameSrc:window.location.protocol+this._frameSrc;setTimeout(function(){var n;(TestEngine.isChromeApp()||TestEngine.isAndroidApp())&&(n=t.buildKeyEvents()),$("#practice-test-iframe")[0].contentWindow.postMessage({command:"parentInfo",url:window.location.origin,isBrowser:!TestEngine._isAppMode(),keyEvents:n},e)},0)},getAllCombindationsForKey:function(e){var t=new Array;return t.push({ctrlKey:!1,shiftKey:!1,altKey:!1,keyCode:e,which:e}),t.push({ctrlKey:!0,shiftKey:!1,altKey:!1,keyCode:e,which:e}),t.push({ctrlKey:!1,shiftKey:!0,altKey:!1,keyCode:e,which:e}),t.push({ctrlKey:!1,shiftKey:!1,altKey:!0,keyCode:e,which:e}),t.push({ctrlKey:!0,shiftKey:!0,altKey:!1,keyCode:e,which:e}),t.push({ctrlKey:!1,shiftKey:!0,altKey:!0,keyCode:e,which:e}),t.push({ctrlKey:!0,shiftKey:!1,altKey:!0,keyCode:e,which:e}),t.push({ctrlKey:!0,shiftKey:!0,altKey:!0,keyCode:e,which:e}),t},buildKeyEvents:function(){var e={};return e.blockKeys={},e.blockKeys.keydown=[],e.blockKeys.keydown=this.getAllCombindationsForKey(166),e}});return i}),define("models/AppCheckReportFactory",[],function(){return{init:function(){_.bindAll(this,"generateMarkup","generateSuccessMarkup","generateFailureMarkup","generateBlacklistBullets")},generateMarkup:function(e){var t=e.test;return this.keyTypeIsSupported(t)?e.status?this.generateSuccessMarkup(e):this.generateFailureMarkup(e):""},keyTypeIsSupported:function(e){return e.search(/(kioskMode|connectivity|proctorCache|blacklist|blacklistSiri|blacklistGameBar|blacklistDictation|blacklistAirplay|BlacklistDitto|BlacklistClipMate|BlacklistCopyQ|SRFTest|CloudClipboardHistory|CloudClipboardRoaming)/i)!=-1},generateSuccessMarkup:function(e){var t=e.test,n=(/SRFTest/i.test(t)?this.i18nstr(e.type):"")+this.i18nstr(t+"Success");return'<div class="alert alert-success result-appcheck"><i class="icon-ok appCheckIcon"></i><b> '+n+"</b></div>"},generateFailureMarkup:function(e){var t=e.test,n=[];return n.push('<div class="alert alert-danger result-appcheck">'),n.push('<i class="icon-exclamation-sign appCheckIcon"></i>'),n.push("<b> "),/SRFTest/i.test(t)?n.push(this.i18nstr(t+"FailureTitle").replace(/srfreportname/i,this.i18nstr(e.type))):n.push(this.i18nstr(t+"FailureTitle")),n.push("</b>"),n.push(this.i18nstr(t+"FailureMessage")),n.push("</br>"),/SRFTest/i.test(t)||/BlacklistSiri/i.test(t)||/BlacklistGameBar/i.test(t)||/BlacklistDictation/i.test(t)||/BlacklistDitto/i.test(t)||/BlacklistClipMate/i.test(t)||/BlacklistCopyQ/i.test(t)||/BlacklistAirplay/i.test(t)||/CloudClipboardHistory/i.test(t)||/CloudClipboardRoaming/i.test(t)||/BlacklistAppleVncAgent/i.test(t)||/BlacklistScreenSharingAgent/i.test(t)||(n.push('<ul class="appCheckResultBullet">'),/blacklist/i.test(t)&&n.push(this.generateBlacklistBullets(e)),n.push("<li>"+this.i18nstr(t+"FailureBullet")+"</li>"),n.push("</ul>")),n.push("</div>"),n.join("")},generateBlacklistBullets:function(e){var t=function(e){return"<li>"+e+"</li>"},n=e.details.split(",");return n.map(t).join("")},i18nstr:function(e){return $.i18n.t("appCheck:"+e)}}}),define("views/AppCheckResultsView",["javascripts/backbone-min","models/AppCheckReportFactory"],function(e,t){"use strict";var n=e.View.extend({el:"#appCheckResultsContainer",initialize:function(e){_.bindAll(this,"render","cleanUp","createResultsMarkup"),e&&e.length&&this.render(e)},render:function(e){var t=this.generateTitle(e);return this.$el.addClass("well appCheckResultsContainerVisible").append('<div id="appCheckResultsTitle" tabindex="-1">'+$.i18n.t("appCheck:appCheck"+t)+"</div>").append($('<div id="appCheckResults"></div>').html(this.createResultsMarkup(e))),this},generateTitle:function(e){return e.every(function(e){return e.status})?"ReportSuccessTitle":"ReportFailureTitle"},createResultsMarkup:function(e){return t.init(),e.map(t.generateMarkup).join("")},cleanUp:function(){this.$el.empty().removeClass("well appCheckResultsContainerVisible")}});return n}),define("views/appCheckView",["javascripts/backbone-min","text!tpl/combined.html","views/AppCheckResultsView"],function(e,t,n){"use strict";var i=e.View.extend({initialize:function(){_.bindAll(this,"runAppCheck","addListeners","cleanUp","createAppCheckResult","handleAppCheck"),this.template=_.template($(t).filter("#appchecktemplate").html()),this.el=this.template()},render:function(){return $("#content").html(this.el),this.addListeners(),$(document).trigger("perform.addFTListener"),$(document).trigger("appCheck.render"),$(document).trigger("tn.loadingModal.off"),this},goToLogin:function(){$(document).trigger("tn.route.to","login")},handleAppCheck:function(e){var t=e.success,n=e.msgCode,i=$("#configIdentifier").val();switch(t){case"yes":this.createAppCheckResult(e.report);break;case"no":var o=$.i18n.t("errorMessages:"+n);$("#configIdentifier").addClass("configError"),$(".configErrorMsg").html("<b>"+$.i18n.t("appCheck:errorText")+": </b>"+o),TN8.log("APPCHECK: "+e.msg,TN8.CRITICAL),$(".configErrorMsg").focus();break;default:TN8.log("APPCHECK: Incorrect response format from TestEngine.",TN8.IMPORTANT)}$(document).trigger("snitch.sendOut",{event:"AppCheckData",successState:e.success,errorCode:e.msgCode,configId:i}),$(document).trigger("appCheck.off")},createAppCheckResult:function(e){this.resultsView&&this.resultsView.cleanUp(),this.resultsView=new n(e)},shouldRunAppCheck:function(e){"keydown"==e.type&&13===e.which&&$("#runAppCheck").click()},runAppCheck:function(){this.resultsView&&this.resultsView.cleanUp(),this.cleanUpError(),$(document).trigger("appCheck.on");var e=$("#configIdentifier").val();window.TestEngine.appCheck(this.handleAppCheck,e)},addListeners:function(){$("#sign-in-btn").on("click",this.goToLogin),$("#runAppCheck").on("click",this.runAppCheck),$("#configIdentifier").on("keydown",this.shouldRunAppCheck)},cleanUpError:function(){$("#configIdentifier").removeClass("configError"),$(".configErrorMsg").html("")},cleanUp:function(){$("#sign-in-btn").off("click",this.goToLogin),$("#runAppCheck").off("click",this.runAppCheck),$("#configIdentifier").off("keydown",this.shouldRunAppCheck),this.cleanUpError(),this.resultsView&&this.resultsView.cleanUp()}});return i}),define("text!tpl/epatReport.html",[],function(){return'<script type="text/template" id="scorableEpatReportTemplate">\n\t<h1 id="itemCanvasTitle" class="sr-only visuallyhidden" tabindex="-1"><%= $.i18n.t("epat:summaryReport") %></h1>\n\t<form action="" method="POST" target="scorable-epat-iframe">\n\t\t<input type="hidden" name="responseInfo" id="responseInfo" value=\'\' />\n\t\t<input type="hidden" name="formId" id="formId" value="" />\n\t</form>\n\t<div style="width: 70%; margin-left: auto; margin-right: auto;">\n\t\t<% if (isLoginMultiTest) { %>\n\t    <button class="btn btn-primary epat-finish" id="epat-finish" aria-label="<%= $.i18n.t(\'generalWords:continue\')%>"><%= $.i18n.t("generalWords:continue")%></button><br><br>\n\t\t<% } else { %>\n\t\t<button class="btn btn-primary epat-finish" id="epat-finish" aria-label="<%= $.i18n.t(\'generalWords:logout\')%>"><%= $.i18n.t("generalWords:logout")%></button><br><br>\n\t\t<% } %>\n\t</div>\n\t<div id="epatReportContainer">\n        <iframe id="scorable-epat-iframe" name="scorable-epat-iframe" frameBorder="0" scrolling="yes"></iframe>\n        <div class="iframe-shadow shadow-top"></div>\n\t</div>\n</script>'}),define("views/EpatReportView",["javascripts/backbone-min","text!tpl/epatReport.html","utils"],function(e,t,n){"use strict";var i=e.View.extend({template:$(t).html(),initialize:function(){_.bindAll(this)},makeRootData:function(){var e=TestEngine.getTestDefine(),t=TestEngine.getNavigation(),n=TestEngine.getAuthentication(),i={};return i.loginId=n.getLoginId(),i.formId=n.getFormId(),i.formName=n.getCurrentForm()._name,i.formNumber=n.getCurrentForm()._num,i.testName=n.getCurrentForm()._testName,i.formTitle=e._title,i.studentName=TN8.Application.epatStudentName,i.testId=t.getTestId(),i.language=$.i18n.lng(),i.items=[],i},makeAllResponses:function(e){for(var t=0;t<this.testParts.length;t++)for(var n=this.testParts[t].getState().part.sections,i=0;i<n.length;i++)for(var o=n[i].section,r=o.id,s=0;s<o.items.length;s++){var a={},l=o.items[s].itemRef;a.itemRef={},a.itemRef.id=l.id,a.itemRef.externalItemId=this.testParts[t].getItemById(l.id).getItemName(),a.itemRef.sid=r,a.itemRef.wc=l.wc,a.state=null,e.items.push(a)}return e},makeVisitedResponses:function(e){var t=TestEngine.getAllItemResponses();for(var n in t)for(var i=t[n],o=_.keys(i)[0],r=0;r<e.items.length;r++)e.items[r].itemRef.id===o&&(e.items[r].state=i[o].state);return e},makeSectionData:function(e){e.reportId="1",e.parts=[];for(var t=0;t<this.testParts.length;t++){var n=this.testParts[t].getState().part.sections;e.parts[t]={section:[]};for(var i=0;i<n.length;i++){var o={};o.sectionId=n[i].section.id,o.sectionTitle=n[i].section.title,e.parts[t].section.push(o)}}return e},setIframeSize:function(e){var t=$("#scorable-epat-iframe");t.css("height",n.getViewPortSize().height-t.offset().top-25)},render:function(){var e=TestEngine.getAuthentication();this.testDef=TestEngine.getTestDefine(),this.testParts=this.testDef.getTestParts();var t="multi-test"===e.getLoginType()||TN8.Application.DataProvider.isMultiPartUser();$("#content").html(_.template(this.template,{isLoginMultiTest:t}));var n=$("#content").find("form"),i=$(n).find("input#formId"),o=$(n).find("#responseInfo");$(i).val(e.getFormId());var r=this.makeRootData();r=this.makeAllResponses(r),r=this.makeVisitedResponses(r),r=this.makeSectionData(r);var s=JSON.stringify(r);return $(o).val(s),this.setIframeSize(),$("#epatReportContainer").ready(this.callEPATScore),$(document).trigger("tn.epatReport.render",[$.i18n.t("epat:summaryReport")]),this},callEPATScore:function(){var e=$("#content").find("form"),t=TestEngine.getProtocol()+"//"+window.location.hostname+"/epat/8.1/score";$.post(t,$(e).serialize()).done(this.renderIFrame)},renderIFrame:function(e){var t=(new DOMParser).parseFromString(e,"text/html"),n=t.documentElement.getElementsByTagName("head")[0].innerHTML,i=t.documentElement.getElementsByTagName("body")[0].innerHTML;$("#scorable-epat-iframe").contents().find("head").html(n),$("#scorable-epat-iframe").contents().find("body").html(i),this.addListeners(),$(document).trigger("tn.loadingModal.off")},eventRepeater:function(e){$(document).trigger(e)},addListeners:function(){$(window).off("resize",this.setIframeSize).on("resize",this.setIframeSize),$(document).off("tn.nav.start  exitWithoutAsking focuslost",this.removeListeners).on("tn.nav.start  exitWithoutAsking focuslost",this.removeListeners),$("#epat-finish").off("click",this.handler_EpatLogout).on("click",this.handler_EpatLogout),$($("#scorable-epat-iframe")[0].contentDocument).off("mousemove mousedown mouseup click touchstart touchend touchmove keydown keyup keypress",this.eventRepeater).on("mousemove mousedown mouseup click touchstart touchend touchmove keydown keyup keypress",this.eventRepeater)},removeListeners:function(){$($("#scorable-epat-iframe")[0].contentDocument).off("mousemove mousedown mouseup click touchstart touchend touchmove keydown keyup keypress",this.eventRepeater),$(window).off("resize",this.setIframeSize),$(document).off("tn.nav.start exitWithoutAsking focuslost",this.removeListeners),$("#epat-finish").off("click",this.handler_EpatLogout)},handler_EpatLogout:function(){this.removeListeners(),TN8.Application.DataProvider.isMultiPartUser()?$(document).trigger("perform.betweenEpatPartCleanup"):$(document).trigger("tn.finish.test")}});return i}),define("text!tpl/end.tpl",[],function(){return'<div class="row">\n    <div class="span12" id="section-end">\n        <h1 id="itemCanvasTitle" class="visuallyhidden" tabindex="-1"><%= ariaTitle %></h1>\n        <% if (endTest) {%>\n            <div class="label label-default end-test-header"><%= endBanner %></div>\n        <% } %>\n        <div class="testcompletion-container clearfix">\n            <h2 class="text-left section-header"><%= endTitle %></h2>\n            <div class="end-txt"><%= endMessage %></div>\n\n            <!-- unanswered an bookmarks -->\n            <% if (!noReview) { %>\n            <div class="end-label-block clearfix">\n                <div class="end-label <%=answered%>">\n                    <% if(unansweredCount > 0){ %>\n                        <div class="end-count center unselectable" aria-label="<%=unansweredAriaLabel%>"><span><%= unansweredCount %></span></div>\n                        <p class="end-label-text center" aria-hidden="true" role="presentation"><%= unansweredLabel %></p>\n                    <% } else { %> \n                        <div class="end-count center unselectable" role="button" aria-disabled="true" aria-label="<%=unansweredAriaLabel%>"><span><%= unansweredCount %></span></div>\n                        <p class="end-label-text center" aria-hidden="true" role="presentation"><%= unansweredLabel %></p>\n                    <% } %>                \n                </div>\n                <% if(bookmarkCount > 0) { %>\n                    <div class="end-label bookmarked">\n                        <div class="end-count center unselectable" aria-label="<%=bookmarkedAriaLabel%>"><span><%= bookmarkCount %></span></div>\n                        <p class="end-label-text center" aria-hidden="true" role="presentation"><%= $.i18n.t("endSection:bookmarks")%></p>\n                    </div>\n                <% } else { %>\n                    <div class="end-label bookmarked no-bookmarks">\n                        <div class="end-count center unselectable" role="button" aria-disabled="true" aria-label="<%=bookmarkedAriaLabel%>"><span><%= bookmarkCount %></span></div>\n                        <p class="end-label-text center" aria-hidden="true" role="presentation"><%= $.i18n.t("endSection:bookmarks")%></p>\n                    </div>\n                <% } %>\n            </div>\n            <% } %>\n\n            <!-- inline errors and warnings -->\n            <div id="endError" class="alert alert-block alert-error fade in hidden" aria-live="assertive"></div>\n            <% if (mustAnswer) { %>\n                <div class="alert alert-block fade in endWarning" aria-live="assertive">\n                    <i class="icon-exclamation-sign"></i>\n                    <p><%= $.i18n.t("endSection:mustAnswerText")%><%= buttonText %></p>\n                </div>\n            <% } %>\n            <% if (showWarning) { %>\n                <div class="alert alert-block fade in endWarning" aria-live="assertive">\n                    <i class="icon-exclamation-sign"></i>\n                    <p><%= $.i18n.t("endSection:cannotSubmitFinalAnswers")%></p>\n                </div>\n            <% } %>\n\n            <!-- The button -->\n            <div  class="center endTestbtn">\n                <button aria-label="<%=buttonText%>"\n                        class="btn btn-large btn-success ebutton <% if (disabledSubmit) { %>disabled<% } %>"\n                        id="end-submit"><%=buttonText%>\n                        <% if (!endTest) { %>\n                            <i role="presentation" class="icon-chevron-right"></i>\n                            <i role="presentation" class="icon-chevron-right"></i>\n                        <% } %>\n                </button>\n            </div>\n        </div>\n    </div>\n</div>\n<% if (!noReview) { %>\n<!-- Used to attach the deep zoom tool menu -->\n<div id="drawingToolBar"></div>\n<% } %>\n'}),define("views/ExitAlertView",["require"],function(e){return{show:function(e){var t=$(TN8.Application.combinedTpl).filter("#exitalerttemplate").html(),n=_.template(t,{section:e.section});$(n).modal("show").tabRing(),$("#exitAlertModal").on("hidden.bs.modal",$.proxy(this.removeListeners,this)),this.confirm=_.wrap(e.confirm,$.proxy(this.removeModal,this)),this.decline=_.wrap(e.decline||function(){},$.proxy(this.removeModal,this)),$(".continue-yes").click(this.confirm),$(".continue-no").click(this.decline),$(document).one("inform.timeoutModalOn",this.decline),$(document).one("cleanup.betweenTest",this.decline),$(document).one("focuslost",this.decline),$(document).one("tn.ews.on",this.decline),$(document).trigger("deepZoomLayer.setCoupling",{title:$.i18n?$.i18n.t("endSection:testSubmitWarning"):"Test Submit Warning",html:"#exitAlertModal",hideCloseButton:!0,closeButtons:["button.continue-no"]}),$(document).on("deepZoomLevel.enter",this.decline)},removeModal:function(e){this.removeListeners(),$("#exitAlertModal").modal("hide").tabRing("off").remove(),e()},removeListeners:function(){$(document).off("inform.timeoutModalOn",this.decline),$(document).off("cleanup.betweenTest",this.decline),$(document).off("focuslost",this.decline),$(document).off("tn.ews.on",this.decline),$(document).off("deepZoomLevel.enter",this.decline),$("#exitAlertModal").off("hidden.bs.modal",$.proxy(this.removeListeners,this)),$("#exitAlertModal").off("deepZoomLayer.hide",this.decline)}}}),define("views/endtest",["javascripts/backbone-min","text!tpl/end.tpl","util/shortcuts","views/EpatReportView","views/ExitAlertView","controllers/TestStateSaver"],function(e,t,n,i,o,r){"use strict";var s=e.View.extend({template:_.template(t),el:'<div id="end-test" />',deepZoomToolMenu:null,initialize:function(){_.bindAll(this,"handleSubmit","handleFinishTest","cleanup")},render:function(){TN8.Dispatcher.trigger("removeHomeMenu"),TN8.fnOn("tn.finish.test",this.handleFinishTest),TN8.Dispatcher.once("performNavigation",this.cleanup),TN8.Dispatcher.trigger("CleanUpItemController");var e=TN8.Application.DataProvider.getEndData(!0);this.$el.html(this.template(e)),$("#content").html(this.$el);var t=TN8.Application.DataProvider.getOverviewRows();return $(".unanswered > .end-count",this.$el).reviewDropdown({dataSource:t,type:"popup",filter:"unanswered"}),$(".bookmarked > .end-count",this.$el).reviewDropdown({dataSource:t,type:"popup",filter:"bookmarked"}),this.loadDeepZoomToolMenu(),$(document).trigger("tn.endtest.loaded"),$("#end-submit:not(.disabled)",this.$el).on("click touchend",this.handleSubmit),$("#firstTabbable").focus(),$(document).trigger("tn.loadingModal.off"),this},loadDeepZoomToolMenu:function(){TN8.utils.loadLibraries(["javascripts/DeepZoomToolMenu"],$.proxy(this.addDeepZoomToolMenu,this),this.deepZoomToolMenuLoadFail)},addDeepZoomToolMenu:function(){this.deepZoomToolMenu=new DeepZoomToolMenu(TN8.deepZoomLayer)},deepZoomToolMenuLoadFail:function(e){TN8.throw("scriptInjector.injectScripts failed. DeepZoomToolMenu. Error message : "+JSON.stringify(e),TN8.errorType.INJECTION_SCRIPT_ERROR)},getHeaderModelData:function(){return{headerMode:3,renderTrick:Math.random(),btnNextState:"disabled",btnShowFlag:"hide"}},handleSubmit:function(e){return TestEngine.getNavigation().getCurrentSection().getDisableExit()?void $(document).trigger("tn.check.remote.config",{type:"closeSections",success:this.handleFinishTest,failure:this.inlineError.bind(this,$.i18n.t("endSection:sectionEndNotClosed"),TN8.errorType.SECTION_END_NOT_CLOSED),missing:this.inlineError.bind(this,$.i18n.t("endSection:sectionControlConnectivity"),TN8.errorType.SECTION_CONTROL_CONNECTIVITY)}):(TestEngine.getTestDefine()&&TestEngine.getTestDefine()._sourceJson.vsr?$(document).trigger("tn.route.to","epatReport"):TestEngine.getNavigation().getCurrentSection().hideSectionReview()||TN8.utils.isCat()?this.handleFinishTest():o.show({section:!1,backdrop:!0,confirm:this.handleFinishTest}),!1)},handleFinishTest:function(){this.cleanup(),$(document).trigger("navigate.submitTest")},getSaveToLocation:function(){return"saveTestState"},inlineError:function(e,t,n){TN8.throw(e,t),$("#endError").html("<p>"+e+"</p><sub> "+$.i18n.t("errorMessages:msg").toUpperCase()+" "+t+"</sub>").removeClass("hidden")},cleanup:function(){this.deepZoomToolMenu&&(this.deepZoomToolMenu.destroy(),this.deepZoomToolMenu=null),"undefined"!=typeof $(".unanswered > .end-count",this.$el).data("pearsonReviewDropdown")&&$(".unanswered > .end-count",this.$el).reviewDropdown("removeMiniMenus"),this.remove(),TN8.Dispatcher.off("performNavigation",this.cleanup),$(document).off("tn.finish.test",this.handleFinishTest)}});return s}),define("views/EndSectionView",["javascripts/backbone-min","text!tpl/end.tpl","views/SectionExitWarningView"],function(e,t,n){"use strict";return e.View.extend({template:_.template(t),el:'<div id="end-section" />',deepZoomToolMenu:null,render:function(){_.bindAll(this,"handlerNext"),TN8.Dispatcher.trigger("removeHomeMenu"),TN8.Dispatcher.once("performNavigation",this.cleanup,this);var e=TN8.Application.DataProvider.getEndData();this.$el.html(this.template(e)),$("#content").html(this.$el);var t=TN8.Application.DataProvider.getOverviewRows();return $(".unanswered > .end-count",this.$el).reviewDropdown({dataSource:t,type:"popup",filter:"unanswered"}),$(".bookmarked:not(.no-bookmarks) > .end-count",this.$el).reviewDropdown({dataSource:t,type:"popup",filter:"bookmarked"}),$("#end-submit:not(.disabled)",this.$el).off("click",this.handlerNext).on("click",this.handlerNext),this.loadDeepZoomToolMenu(),$(document).trigger("tn.endsection.loaded"),$(document).trigger("perform.addFTListener"),$(document).trigger("tn.loadingModal.off"),this},loadDeepZoomToolMenu:function(){TN8.utils.loadLibraries(["javascripts/DeepZoomToolMenu"],$.proxy(this.addDeepZoomToolMenu,this),this.deepZoomToolMenuLoadFail)},addDeepZoomToolMenu:function(){this.deepZoomToolMenu=new DeepZoomToolMenu(TN8.deepZoomLayer)},deepZoomToolMenuLoadFail:function(e){TN8.throw("scriptInjector.injectScripts failed. DeepZoomToolMenu. Error message : "+JSON.stringify(e),TN8.errorType.INJECTION_SCRIPT_ERROR)},getHeaderModelData:function(){return{headerMode:3,renderTrick:Math.random(),btnNextState:"disabled",btnShowFlag:"hide"}},handlerNext:function(e){TestEngine.getNavigation().getCurrentSection().getDisableExit()?$(document).trigger("tn.check.remote.config",{type:"closeSections",success:function(){$(document).trigger("navigate.loadNextSection")},failure:this.inlineError.bind(this,$.i18n.t("endSection:sectionEndNotClosed"),TN8.errorType.SECTION_END_NOT_CLOSED),missing:this.inlineError.bind(this,$.i18n.t("endSection:sectionControlConnectivity"),TN8.errorType.SECTION_CONTROL_CONNECTIVITY)}):TN8.utils.isLastSection()||TN8.utils.isCat()||TestEngine.getNavigation().getCurrentSection().hideSectionReview()?$(document).trigger("navigate.loadNextSection"):(new n).render()},inlineError:function(e,t,n){TN8.throw(e,t),$("#endError").html("<p>"+e+"</p><sub> "+$.i18n.t("errorMessages:msg").toUpperCase()+" "+t+"</sub>").removeClass("hidden")},getSaveToLocation:function(){return"saveTestState"},cleanup:function(){this.deepZoomToolMenu&&(this.deepZoomToolMenu.destroy(),this.deepZoomToolMenu=null),$(document).trigger("perform.removeFTListener"),"undefined"!=typeof $(".unanswered > .end-count",this.$el).data("pearsonReviewDropdown")&&$(".unanswered > .end-count",this.$el).reviewDropdown("removeMiniMenus"),$("#end-submit:not(.disabled)",this.$el).off("click",this.handlerNext),this.remove(),TN8.Dispatcher.off("performNavigation",this.cleanup)}})}),define("views/StartSectionView",["javascripts/backbone-min","controllers/ApplicationStatusController","text!tpl/combined.html"],function(e,t,n){"use strict";var i=e.View.extend({template:_.template($(n).filter("#startsectiontemplate").html()),el:'<div id="section-start" aria-live="assertive"/>',initialize:function(){_.bindAll(this)},_getSealCodeField:function(){return this.$el.find("#sealCode")},render:function(){return this.model.refreshSectionData(),this.$el.html(this.template(this.model.attributes)),$("#content").html(this.$el),this.bindSealCodeEvents(),this.addRubricListener(),$("#startSectionBtn",this.$el).click(this.handler_StartClick),$(document).trigger("tn.startsection.loaded"),t.execute(t.actionNames.TurnOffModal),$("#firstTabbable").focus(),this},getHeaderModelData:function(){return{headerMode:0,renderTrick:Math.random(),btnNextState:"disabled",btnShowFlag:"hide"}},addRubricListener:function(){var e=TestEngine.getNavigation().getCurrentSection().getRubricblock();e&&$("#skipToInstructions > a").click(function(e){e.preventDefault(),$("#sectionRubric").focus()})},bindSealCodeEvents:function(){var e=this.el;if(this.model.getSealCode()){var t=this._getSealCodeField();this.ie9PHolderHack(t);var n=TestEngine.getNavigation().getCurrentSection().getRemoteSectionControl();if(!n){var i=$("#startSectionBtn",e);i.prop("disabled",!0),t.on("input",function(e){""===t.val()?i.prop("disabled",!0):i.prop("disabled",!1)})}t.keydown(function(t){var n=t.which;13===n?($("#startSectionBtn",e).click(),t.preventDefault()):(n>=96&&n<=111&&(n-=48),[0,8,9,16,35,36,37,38,39,40,46,229].indexOf(n)!==-1||/[A-Za-z0-9]/.test(String.fromCharCode(n))||t.preventDefault())})}},ie9PHolderHack:function(e){"placeholder"in document.createElement("input")||(e.val("Enter Seal Code"),e.focus(function(){"Enter Seal Code"==this.value&&(this.value="")}).blur(function(){this.value||(this.value="Enter Seal Code")}))},handler_StartClick:function(e){if(e&&$(e.target).hasClass("disabled"))return!1;document.activeElement&&$.isIdevice()&&document.activeElement.blur();var t=TestEngine.getNavigation().getCurrentSection().getRemoteSectionControl();t?$(document).trigger("tn.check.remote.config",{type:"sectionControl",success:this.processSealCode,failure:this.inlineError.bind(this,$.i18n.t("startSection:sectionStartNotOpen"),TN8.errorType.SECTION_START_NOT_OPEN),missing:this.inlineError.bind(this,$.i18n.t("startSection:sectionControlConnectivity"),TN8.errorType.SECTION_CONTROL_CONNECTIVITY)}):this.processSealCode()},processSealCode:function(){if(!this.model.getSealCode())return void this.loadNextSection();var e=this._getSealCodeField(),t=this.model.attributes.sealCode;t.toLowerCase()===e.val().toLowerCase()?(TN8.Application.error.closeGrowls(),this.model.setSealCode(!1),this.loadNextSection()):this.inlineError($.i18n.t("startSection:incorrectSealCode"),TN8.errorType.INCORRECT_SEAL_CODE)},loadNextSection:function(e){e=e||{},$(document).trigger("testState.setSectionStartTime",(new Date).toUTCString()),e.data=e.data||{},e.data.section=this.model.get("section"),$(document).trigger("navigate.nextStartSection",e),$(document).trigger("inform.nextStartSection"),this.destroy()},getSaveToLocation:function(){return"saveTestState"},inlineError:function(e,t,n){TN8.throw(e,t),$("#startSectionError").removeClass("hidden").html("<p>"+e+"</p><sub> "+$.i18n.t("errorMessages:msg").toUpperCase()+" "+t+"</sub>")},destroy:function(){$("#startSectionBtn",this.$el).off(),this.model.destroy(),this.unbind(),this.remove()}});return i}),define("models/StartSectionModel",["javascripts/backbone-min","timer/TimerUtils","controllers/SealCodeController","controllers/PnpController"],function(e,t,n,i){"use strict";var o=e.Model.extend({defaults:{section:null,sectionTitle:"",numQuestions:0,totalSectionTime:"0 minutes",sectionRubrick:"",sealCode:""},refreshSectionData:function(){var e=this.get("section"),t=e.getNumberOfQuestionItems(),i=TestEngine.getTestDefine(),o=i&&i.getChrome()&&"aimsweb"===i.getChrome().toLowerCase(),r=TestEngine.getNavigation().getCurrentSection().isLinear(),s=r&&!o,a={sectionTitle:e.getTitle(),isNumQuestions:s,numQuestions:t,totalSectionTime:this.setSectionTime(e),sectionRubrick:e.getRubricblock()};e.getSealCode()?a.sealCode=n.getSealCode(e._identifier):a.sealCode="",this.set(a)},getSealCode:function(){var e=this.get("section");return e.getSealCode()&&""!==this.get("sealCode")},setSealCode:function(e){this.get("section");$(document).trigger("testState.setSectionSealCode",e)},setSectionTime:function(e){return t.isSection()?e.getTimer()?t.buildTimeString(e.getTimer()*i.getTimeMultiplier()*60):$.i18n.t("startSection:notTimed"):""},destroy:function(){this.unbind()}});return o}),define("models/FormModel",["javascripts/backbone-min"],function(e){var t=e.Model.extend({defaults:{}}),n=e.Collection.extend({initialize:function(e,t){},model:t});return n}),define("views/tests/TableView",["javascripts/backbone-min","text!tpl/combined.html","util/secureErrors"],function(e,t,n){"use strict";var i=e.Model.extend({defaults:{testName:null,formId:null,securityLevel:null,formNumber:null,formNumberPartial:null,testStatusInd:null,disable:!1,unlockTest:!0,validSchedule:!1},initialize:function(){this.setFormNumberPartial()},setFormNumberPartial:function(){var e=0,t=this.get("formNumber");t.length>5&&(e=t.length-5);var n=t.substring(e,t.length);this.set("formNumberPartial",n)}}),o=e.Collection.extend({model:i,destroy:function(){this.unbind()}}),r=e.View.extend({tagName:"li",className:"avail-test-row clearfix row-fluid",TestStatus:{READY:"N",ACTIVE:"I",EXIT:"E",RESUME:"R",RESUME_FORCE:"F",COMPLETE:"C"},template:_.template($(t).filter("#teststabletemplate").html()),initialize:function(){_.bindAll(this,"render","updateEnabledForContext"),this.model.bind("change",this.render)},handleSecurityLevel:function(){TN8.fnOne("tn.secureError.found",this.updateEnabledForContext),n.isThereError(this.model.get("securityLevel"),!0)},updateEnabledForContext:function(e,t){e=e||[];var n=!t,i=this.$el.find(".startTest");if(i.length>0){var o=this.model.get("unlockTest")===!1,r=this.model.get("testStatusInd"),s=this.getStartBtnStatus(r,o,this.model.get("validSchedule"),n);""===s?i.removeAttr("aria-disabled tabindex"):i.attr({"aria-disabled":"true",tabindex:"-1"})}$(document).trigger("inform.AvailableRowAdded")},getStartBtnStatus:function(e,t,n,i){var o=["I","E","C"].indexOf(e)>-1;return t||!n||o||!i?"disabled":""},getStartBtnText:function(e){var t,n="";switch(e){case"N":n=$.i18n.t("start");break;case"I":case"E":case"R":case"F":n=$.i18n.t("resume");break;case"C":n=$.i18n.t("complete")}return t=n,"C"!==e?t+='<i class="icon-chevron-right-double right"></i>':t='<i class="icon-ok left"></i>'+n,{text:n,textAndIcon:t}},render:function(){var e=this.model.get("unlockTest")===!1,t=this.model.get("testStatusInd"),n=this.getStartBtnText(t),i="disabled",o=("C"===t?"complete ":"btn-primary ")+"btn startTest",r={name:this.model.get("testName"),testId:this.model.get("formId"),btnClasses:o,disabled:i,title:n.text+" Test",ariaLabel:n.text+" Test Button",btnText:n.textAndIcon,locked:e,lockIconSRText:"locked indicator"};return this.$el.html(this.template(r)),this},destroy:function(){this.unbind()}}),s=e.View.extend({initialize:function(e){_.bindAll(this,"render","addRow","appendItem"),this.rowViews=[],this.testRows=e.testRows,this.collection=new o,this.collection.bind("add",this.appendItem),this.addRows($.extend(!0,[],this.testRows),e)},addRows:function(e,t){if(e.length>0){var n=e.shift();$(document).one("inform.AvailableRowAdded",this.addRows.bind(this,e,t)),
this.addRow({testName:n.testName,formId:n.formId,securityLevel:n.securityLevel,formNumber:n.formNumber,testStatusInd:n.testStatusInd,unlockTest:!!_.isUndefined(n.unlockTest)||n.unlockTest,validSchedule:n.validSchedule})}else $(document).trigger("inform.tableViewRendered")},addRow:function(e){var t=new i(e);this.collection.add(t)},appendItem:function(e){var t=new r({model:e});this.rowViews.push(t),$(this.el).append(t.render().el),t.handleSecurityLevel()},secureLevelChanged:function(){for(var e=0;e<this.rowViews.length;e++)this.rowViews[e].handleSecurityLevel()},destroy:function(){this.unbind(),this.collection.unbind("add"),this.collection.destroy();for(var e=0;e<this.rowViews.length;e++)this.rowViews[e].destroy();this.rowViews=[],this.remove()}});return s}),define("views/tests/availableTests",["javascripts/backbone-min","views/tests/TableView","text!tpl/combined.html"],function(e,t,n){"use strict";var i=e.View.extend({initialize:function(){_.bindAll(this,"render","handleStartTest","refreshAvailableTest","destroy","addStartTestListeners"),this.setElement($("#content")[0]),this.template=_.template($(n).filter("#teststemplate").html()),this.agreementTemplate=_.template($(n).filter("#agreementtemplate").html()),this.testToStart=null,this.tableviews=[],TN8.fnOn("tn.testStart.render cleanup.logout",this.destroy)},render:function(e){return TN8.log("availableTests.render  . ",TN8.HELPFUL),this.$el.html(this.template()),$(document).off("inform.tableViewRendered",this.addStartTestListeners).on("inform.tableViewRendered",this.addStartTestListeners),this.makeTable(this.testCollection.toJSON()),this.$el.find(".refresh-available-tests").off("click").on("click",this.refreshAvailableTest),$(window).trigger("resize"),window.scrollTo(0,0),this.$el.append(this.agreementTemplate()),$("#agreementName",this.el).bind("keyup",function(e){13===e.which&&$("#agreementBtn",this.el).trigger("click")}),$("#agreementBtn",this.$el).on("click",this.handleAgreementBtn),$("#agreementName",this.$el).on("keyup",this.handleAgreementName),$(document).trigger("tn.loadingModal.off"),$("#firstTabbable").focus(),$(document).trigger("navigated.availableTest"),this},addStartTestListeners:function(){this.$el.find(".startTest").off("click").on("click",this.handleStartTest)},refreshAvailableTest:function(){$(document).trigger("navigate.availableTest")},makeTable:function(e){var n="#tableTests";if(e.length>0){var i=new t({testRows:e,el:n});this.tableviews.push(i)}else $(n,this.el).append('<p class="no-test-message">'+$.i18n.t("availableTest:noAvailableTests")+"</p>")},handleStartTest:function(e){var t=$(e.currentTarget);if(t.hasClass("startTest")&&!t.is('[aria-disabled="true"]')){e.preventDefault();var n=t.data("testid"),i=_.findWhere(this.testCollection.toJSON(),{formId:n.toString()});i=i||null,$(document).trigger("nagivate.startTest",i)}},destroy:function(){this.$el.find(".refresh-available-tests").off("click"),this.$el.find(".startTest").off();for(var e=0;e<this.tableviews.length;e++)this.tableviews[e].destroy();$(".available-tests").remove(),this.tableviews=[],this.unbind()},sortTests:function(e){var t=[],n=_.groupBy(e,function(e){var t=parseInt(e.displayOrder);return!isNaN(t<=0?NaN:t)});if(_.isArray(n[!0])){var i=_.groupBy(n[!0],function(e){return parseInt(e.displayOrder)});_.each(i,function(e,n,i){e.length>1&&(e=_.sortBy(e,function(e){return e.testName.toLowerCase()})),t=t.concat(e)})}if(_.isArray(n[!1])){var o=_.sortBy(n[!1],function(e){return e.testName.toLowerCase()});t=t.concat(o)}return t}});return i}),define("views/TermsAndConditions",["text!tpl/combined.html"],function(e){"use strict";var t=function(){$("#declineTerms").click()};return{show:function(n,i){$("#TermModal").length>0&&$("#TermModal").remove();var o=_.template($(e).filter("#termsAndConditions").html());$("body").append(o()),$("#termsCondMain").is(":empty")&&($("#termsCondMain").append(n.tctext1),$("#termsCondFootNote").append(n.tctext2),$("#termsModalCheck .term-check-label").append(n.tctext3)),$("#TermModal").modal("show").tabRing(),$(document).trigger("TandC.toggle",$.i18n.t("termsAndConditions:termsandconditions"));var r=$('#TermModal input[type="checkbox"]'),s=$("#TermModal #acceptTerms"),a=$("#TermModal button.close");r.prop("checked",!1).on("click touchend",function(){$(this).prop("checked")?s.removeAttr("aria-disabled tabindex"):s.attr({"aria-disabled":"true",tabindex:"-1"})}),a.on("click touchend",function(){$("#TermModal").modal("hide").tabRing("off"),$("#TermDialog").remove(),$(document).trigger("TandC.toggle")}),s.attr({"aria-disabled":"true",tabindex:"-1"}).on("click touchend",function(){r.prop("checked")&&($("#TermModal").modal("hide").tabRing("off"),$("#TermDialog").remove(),$(document).trigger("TandC.toggle"),TN8.TestStateController.setTermsConditionAccepted(),i())}),$(document).trigger("deepZoomLayer.setCoupling",{title:$.i18n?$.i18n.t("termsAndConditions:termsandconditions"):"Terms and Conditions",html:"#TermModal"}),$("#TermModal").one("deepZoomLayer.hide",t)}}}),!function(e,t){e.undefined=function(){var e,t,n;!function(i){function o(e,t){return w.call(e,t)}function r(e,t){var n,i,o,r,s,a,l,c,d,u,h=t&&t.split("/"),p=T.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),c=0;c<e.length;c+=1)if("."===(u=e[c]))e.splice(c,1),c-=1;else if(".."===u){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||m)&&p){for(n=e.split("/"),c=n.length;c>0;c-=1){if(i=n.slice(0,c).join("/"),h)for(d=h.length;d>0;d-=1)if((o=p[h.slice(0,d).join("/")])&&(o=o[i])){r=o,s=c;break}if(r)break;!a&&m&&m[i]&&(a=m[i],l=c)}!r&&a&&(r=a,s=l),r&&(n.splice(0,s,r),e=n.join("/"))}return e}function s(e,t){return function(){return p.apply(i,y.call(arguments,0).concat([e,t]))}}function a(e){return function(t){return r(t,e)}}function l(e){return function(t){g[e]=t}}function c(e){if(o(v,e)){var t=v[e];delete v[e],b[e]=!0,h.apply(i,t)}if(!o(g,e)&&!o(b,e))throw new Error("No "+e);return g[e]}function d(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(e){return function(){return T&&T.config&&T.config[e]||{}}}var h,p,m,f,g={},v={},T={},b={},w=Object.prototype.hasOwnProperty,y=[].slice;m=function(e,t){var n,i=d(e),o=i[0];return e=i[1],o&&(o=r(o,t),n=c(o)),o?e=n&&n.normalize?n.normalize(e,a(t)):r(e,t):(e=r(e,t),i=d(e),o=i[0],e=i[1],o&&(n=c(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},f={require:function(e){return s(e)},exports:function(e){var t=g[e];return void 0!==t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:u(e)}}},h=function(e,t,n,r){var a,d,u,h,p,T,w=[];if(r=r||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(h=m(t[p],r),"require"===(d=h.f))w[p]=f.require(e);else if("exports"===d)w[p]=f.exports(e),T=!0;else if("module"===d)a=w[p]=f.module(e);else if(o(g,d)||o(v,d)||o(b,d))w[p]=c(d);else{if(!h.p)throw new Error(e+" missing "+d);h.p.load(h.n,s(r,!0),l(d),{}),w[p]=g[d]}u=n.apply(g[e],w),e&&(a&&a.exports!==i&&a.exports!==g[e]?g[e]=a.exports:u===i&&T||(g[e]=u))}else e&&(g[e]=n)},e=t=p=function(e,t,n,o,r){return"string"==typeof e?f[e]?f[e](t):c(m(e,t).f):(e.splice||(T=e,t.splice?(e=t,t=n,n=null):e=i),t=t||function(){},"function"==typeof n&&(n=o,o=r),o?h(i,e,t,n):setTimeout(function(){h(i,e,t,n)},4),p)},p.config=function(e){return T=e,T.deps&&p(T.deps,T.callback),p},n=function(e,t,n){t.splice||(n=t,t=[]),o(g,e)||o(v,e)||(v[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("worker-functions",[],function(){var e={};return e.getBaseURL=function(){return this.config.baseURL},e.setConfig=function(e){this.config=e},e.oggvorbisEncoder=function(){this.onmessage=function(e){switch(e.data.cmd){case"encode":this.encoder.encode(e.data.buffers);break;case"done":var t=encoder.finish();self.postMessage({blob:t});break;case"init":var n=e.data.baseURL+"public/javascripts/recorder/";importScripts(n+"libvorbis.js"),this.encoder=new OggVorbisEncoder(e.data.originalSampleRate||e.data.encoderSampleRate||48e3,e.data.numberOfChannels||1,e.data.hasOwnProperty("quality")?e.data.quality:0)}},this.log=function(){}},e.oggopusEncoder=function(){this.onmessage=function(t){switch(t.data.cmd){case"encodeAll":this.encoder.encodeAll(t.data.buffers);break;case"encode":this.encoder.encode(t.data.buffers);break;case"done":this.log("done msg received"),this.encoder.encodeFinalFrame(),this.close();break;case"init":var n=t.data.baseURL+"public/javascripts/recorder/";importScripts(n+"libopus.js",n+"resampler.js"),this.encoder=new e(t.data,this)}},this.log=function(){var e=["Opus Worker > "].concat(Array.prototype.slice.call(arguments));e=e.join(""),this.postMessage({cmd:"log",msg:e})};var e=function(e,t){this.worker=t,this.numberOfChannels=e.numberOfChannels||1,this.originalSampleRate=e.originalSampleRate,this.encoderSampleRate=e.encoderSampleRate||48e3,this.maxBuffersPerPage=e.maxBuffersPerPage||40,this.encoderApplication=e.encoderApplication||2048,this.encoderFrameSize=e.encoderFrameSize||20,this.bitRate=e.bitRate,this.resampler=new Resampler({resampledRate:this.encoderSampleRate,originalSampleRate:this.originalSampleRate,numberOfChannels:this.numberOfChannels}),this.pageIndex=0,this.granulePosition=0,this.segmentData=new Uint8Array(65025),this.segmentDataIndex=0,this.segmentTable=new Uint8Array(255),this.segmentTableIndex=0,this.buffersInPage=0,this.initChecksumTable(),this.initCodec(),this.generateIdPage(),this.generateCommentPage(),1===this.numberOfChannels&&(this.interleave=function(e){return e[0]})};e.prototype.encodeAll=function(e){for(var t=0;t<e.length;t++)this.encode([e[t]]);this.encodeFinalFrame(),this.worker.close()},e.prototype.encode=function(e){var t=this.resample(e);t=this.interleave(t);for(var n=0;n<t.length;){var i=Math.min(this.encoderBufferLength-this.encoderBufferIndex,t.length-n);if(this.encoderBuffer.set(t.subarray(n,n+i),this.encoderBufferIndex),n+=i,this.encoderBufferIndex+=i,this.encoderBufferIndex===this.encoderBufferLength){var o=_opus_encode_float(this.encoder,this.encoderBufferPointer,this.encoderSamplesPerChannelPerPacket,this.encoderOutputPointer,this.encoderOutputMaxLength);this.segmentPacket(o),this.encoderBufferIndex=0}}++this.buffersInPage>=this.maxBuffersPerPage&&this.generatePage()},e.prototype.encodeFinalFrame=function(){this.encode([new Float32Array(this.encoderBufferLength-this.encoderBufferIndex)]),this.headerType+=4,this.generatePage()},e.prototype.getChecksum=function(e){for(var t=0,n=0;n<e.length;n++)t=t<<8^this.checksumTable[t>>>24&255^e[n]];return t>>>0},e.prototype.generateCommentPage=function(){var e=new DataView(this.segmentData.buffer);e.setUint32(0,1937076303,!0),e.setUint32(4,1936154964,!0),e.setUint32(8,8,!0),e.setUint32(12,1868784978,!0),e.setUint32(16,1919247474,!0),e.setUint32(20,0,!0),this.segmentTableIndex=1,this.segmentDataIndex=this.segmentTable[0]=24,this.headerType=0,this.generatePage()},e.prototype.generateIdPage=function(){var e=new DataView(this.segmentData.buffer);e.setUint32(0,1937076303,!0),e.setUint32(4,1684104520,!0),e.setUint8(8,1,!0),e.setUint8(9,this.numberOfChannels,!0),e.setUint16(10,3840,!0),e.setUint32(12,this.originalSampleRate,!0),e.setUint16(16,0,!0),e.setUint8(18,0,!0),this.segmentTableIndex=1,this.segmentDataIndex=this.segmentTable[0]=19,this.headerType=2,this.generatePage()},e.prototype.generatePage=function(){var e=this.lastPositiveGranulePosition===this.granulePosition?-1:this.granulePosition,t=new ArrayBuffer(27+this.segmentTableIndex+this.segmentDataIndex),n=new DataView(t),i=new Uint8Array(t);n.setUint32(0,1399285583,!0),n.setUint8(4,0,!0),n.setUint8(5,this.headerType,!0),n.setUint32(6,e,!0),(e>4294967296||e<0)&&n.setUint32(10,Math.floor(e/4294967296),!0),n.setUint32(14,0,!0),n.setUint32(18,this.pageIndex++,!0),n.setUint8(26,this.segmentTableIndex,!0),i.set(this.segmentTable.subarray(0,this.segmentTableIndex),27),i.set(this.segmentData.subarray(0,this.segmentDataIndex),27+this.segmentTableIndex),n.setUint32(22,this.getChecksum(i),!0),this.worker.postMessage(i.buffer),this.segmentTableIndex=0,this.segmentDataIndex=0,this.buffersInPage=0,e>0&&(this.lastPositiveGranulePosition=e)},e.prototype.initChecksumTable=function(){this.checksumTable=[];for(var e=0;e<256;e++){for(var t=e<<24,n=0;n<8;n++)t=0!=(2147483648&t)?t<<1^79764919:t<<1;this.checksumTable[e]=4294967295&t}},e.prototype.initCodec=function(){if(this.encoder=_opus_encoder_create(this.encoderSampleRate,this.numberOfChannels,this.encoderApplication,allocate(4,"i32",ALLOC_STACK)),this.bitRate){var e=_malloc(4);HEAP32[e>>>2]=this.bitRate,_opus_encoder_ctl(this.encoder,4002,e),_free(e)}this.encoderBufferIndex=0,this.encoderSamplesPerChannelPerPacket=this.encoderSampleRate*this.encoderFrameSize/1e3,this.encoderBufferLength=this.encoderSamplesPerChannelPerPacket*this.numberOfChannels,this.encoderBufferPointer=_malloc(4*this.encoderBufferLength),this.encoderBuffer=HEAPF32.subarray(this.encoderBufferPointer>>2,(this.encoderBufferPointer>>2)+this.encoderBufferLength),this.encoderOutputMaxLength=4e3,this.encoderOutputPointer=_malloc(this.encoderOutputMaxLength),this.encoderOutputBuffer=HEAPU8.subarray(this.encoderOutputPointer,this.encoderOutputPointer+this.encoderOutputMaxLength)},e.prototype.interleave=function(e){for(var t=new Float32Array(e[0].length*this.numberOfChannels),n=0;n<e[0].length;n++)for(var i=0;i<this.numberOfChannels;i++)t[n*this.numberOfChannels+i]=e[i][n];return t},e.prototype.resample=function(e){for(var t=[],n=0;n<this.numberOfChannels;n++)t.push(this.resampler.resample(e[n],n));return t},e.prototype.segmentPacket=function(e){for(var t=0;e>=0;){255===this.segmentTableIndex&&(this.generatePage(),this.headerType=1);var n=Math.min(e,255);this.segmentTable[this.segmentTableIndex++]=n,this.segmentData.set(this.encoderOutputBuffer.subarray(t,t+n),this.segmentDataIndex),this.segmentDataIndex+=n,t+=n,e-=255}this.granulePosition+=48*this.encoderFrameSize,255===this.segmentTableIndex&&(this.generatePage(),this.headerType=0)}},e.oggopusDecoder=function(){this.onmessage=function(t){switch(t.data.cmd){case"decode":this.decoder.decode(t.data.pages);break;case"done":this.decoder.sendLastBuffer(),this.close();break;case"init":var n=t.data.baseURL+"public/javascripts/recorder/";importScripts(n+"libopus.js",n+"resampler.js"),this.decoder=new e(t.data,this)}},this.log=function(){var e=Array.prototype.slice.call(arguments);e=e.join(""),this.postMessage({cmd:"log",msg:e})};var e=function(e,t){this.worker=t,this.bufferLength=e.bufferLength||4096,this.decoderSampleRate=e.decoderSampleRate||48e3,this.outputBufferSampleRate=e.outputBufferSampleRate||48e3,this.outputBuffers=[]};e.prototype.decode=function(e){var t=new DataView(e.buffer);this.getPageBoundaries(t).map(function(n){var i=t.getUint8(n+5,!0),o=t.getUint32(n+18,!0);if(2&i&&(this.numberOfChannels=t.getUint8(n+37,!0),this.init()),o>1)for(var r=t.getUint8(n+26,!0),s=n+27+r,a=0;a<r;a++){var l=t.getUint8(n+27+a,!0);if(this.decoderBuffer.set(e.subarray(s,s+=l),this.decoderBufferIndex),this.decoderBufferIndex+=l,l<255){var c=_opus_decode_float(this.decoder,this.decoderBufferPointer,this.decoderBufferIndex,this.decoderOutputPointer,this.decoderOutputMaxLength,0);this.sendToOutputBuffers(this.decoderOutputBuffer.subarray(0,c*this.numberOfChannels)),this.decoderBufferIndex=0}}4&i&&(this.sendLastBuffer(),this.worker.close())},this)},e.prototype.deinterleave=function(e){for(var t=[],n=0,i=0;i<this.numberOfChannels;i++)t.push(new Float32Array(e.length/this.numberOfChannels));for(var i=0;i<e.length;i++){var o=i%this.numberOfChannels;t[o][n]=e[i],n+=o==t.length-1?1:0}return t},e.prototype.getPageBoundaries=function(e){for(var t=[],n=0;n<e.byteLength-32;n++)1399285583==e.getUint32(n,!0)&&t.push(n);return t},e.prototype.init=function(){this.resetOutputBuffers(),this.initCodec(),this.resampler=new Resampler({resampledRate:this.outputBufferSampleRate,originalSampleRate:this.decoderSampleRate,numberOfChannels:this.numberOfChannels}),1===this.numberOfChannels&&(this.deinterleave=function(e){return[e]})},e.prototype.initCodec=function(){this.decoder=_opus_decoder_create(this.decoderSampleRate,this.numberOfChannels,allocate(4,"i32",ALLOC_STACK)),this.decoderBufferMaxLength=4e3,this.decoderBufferPointer=_malloc(this.decoderBufferMaxLength),this.decoderBuffer=HEAPU8.subarray(this.decoderBufferPointer,this.decoderBufferPointer+this.decoderBufferMaxLength),this.decoderBufferIndex=0,this.decoderOutputMaxLength=this.decoderSampleRate*this.numberOfChannels*120/1e3,this.decoderOutputPointer=_malloc(4*this.decoderOutputMaxLength),this.decoderOutputBuffer=HEAPF32.subarray(this.decoderOutputPointer>>2,(this.decoderOutputPointer>>2)+this.decoderOutputMaxLength)},e.prototype.resetOutputBuffers=function(){this.outputBuffers=[],this.outputBufferArrayBuffers=[],this.outputBufferIndex=0;for(var e=0;e<this.numberOfChannels;e++)this.outputBuffers.push(new Float32Array(this.bufferLength)),this.outputBufferArrayBuffers.push(this.outputBuffers[e].buffer)},e.prototype.sendLastBuffer=function(){this.sendToOutputBuffers(new Float32Array((this.bufferLength-this.outputBufferIndex)*this.numberOfChannels),!0)},e.prototype.sendToOutputBuffers=function(e,t){t=t||!1;for(var n=this.deinterleave(e),i=0,o=0;o<n.length;o++)n[o]=this.resampler.resample(n[o],o);for(;i<n[0].length;){for(var r=Math.min(n[0].length-i,this.bufferLength-this.outputBufferIndex),s=0;s<n.length;s++)this.outputBuffers[s].set(n[s].subarray(i,i+r),this.outputBufferIndex);if(this.outputBufferIndex+=r,i+=r,this.outputBufferIndex==this.bufferLength||t){var a={outputBuffer:this.outputBuffers[0].buffer,cmd:t?"decoded":"decode"};this.worker.postMessage(a),this.resetOutputBuffers()}}}},e.wavEncoder=function(){this.onmessage=function(t){switch(t.data.cmd){case"encode":this.encoder.encode(t.data.samples);break;case"close":this.close();break;case"init":this.encoder=new e(t.data,this)}},this.log=function(){var e=Array.prototype.slice.call(arguments);e=e.join(""),this.postMessage({cmd:"log",msg:e})};var e=function(e,t){this.worker=t,this.config=e};e.prototype.encode=function(e){e=this.interleave(e,e);var t=new ArrayBuffer(44+2*e.length),n=this.config.platformInfo.isIdevice?16e3:44100,i=new DataView(t);this.writeString(i,0,"RIFF"),i.setUint32(4,36+2*e.length,!0),this.writeString(i,8,"WAVE"),this.writeString(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,2,!0),i.setUint32(24,n,!0),i.setUint32(28,4*n,!0),i.setUint16(32,4,!0),i.setUint16(34,16,!0),this.writeString(i,36,"data"),i.setUint32(40,2*e.length,!0),this.floatTo16BitPCM(i,44,e),this.worker.postMessage({cmd:"encoded",data:i.buffer})},e.prototype.interleave=function(e,t){for(var n=e.length+t.length,i=new Float32Array(n),o=0,r=0;o<n;)i[o++]=e[r],i[o++]=t[r],r++;return i},e.prototype.floatTo16BitPCM=function(e,t,n){for(var i=0;i<n.length;i++,t+=2){var o=Math.max(-1,Math.min(1,n[i]));e.setInt16(t,o<0?32768*o:32767*o,!0)}},e.prototype.writeString=function(e,t,n){for(var i=0;i<n.length;i++)e.setUint8(t+i,n.charCodeAt(i))}},e.createWorker=function(t,n){n=n||!1;var i,o,r=n?"blob":"loaded .js";try{i=n?URL.createObjectURL(new Blob(["(",e[t].toString(),")()"],{type:"application/javascript"})):this.getBaseURL()+"public/javascripts/recorder/"+t+".js",o=new Worker(i)}catch(e){console.log("ERROR! Worker-Functions >",t," create worker from",r," e:",e),!0===n&&(this.config&&(this.config.useBlob=!1),i=this.getBaseURL()+"public/javascripts/recorder/"+t+".js",o=new Worker(i))}return o},e}),n("encoder",["./worker-functions"],function(e){function t(t,n){function i(){o(),u=null,d=null,h=null}function o(){$.each([d,u,h],function(e,t){t&&t.terminate()})}function r(e,t,n,i,o){switch(e){case"wav":return a(n);case"spx":return encodeSPXB64(n,9);case"opus":return f(n,i,o);case"vorbis":return g(n,i,o);default:console.error("Audio Recorder Encoder > codec:",e,", is unsupported")}}function s(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return window.btoa(t).replace(/\s+/g,"")}function a(t){d=e.createWorker("wavEncoder",n.useBlob);var i=$.Deferred();return d.onmessage=function(e){switch(e.data.cmd){case"close":break;case"encoded":var t=e.data.data;d.terminate(),i.resolve(t)}},d.onerror=function(e){console.error("Audio recorder > wavEncoder error:",e.message)},d.postMessage($.extend({},n,{cmd:"init"})),d.postMessage({cmd:"encode",samples:t,baseURL:c}),i}function l(){var e=["---- Encoder >"].concat(Array.prototype.slice.call(arguments));console.log.apply(console,e)}var c=n.baseURL,d=null,u=null,h=null,p=(n.useBlob,{cmd:"init",bufferLength:n.recordingOptions.bufferSize,monitorGain:0,numberOfChannels:n.recordingOptions.numInputChannels,encoderSampleRate:48e3,stream:!1,maxBuffersPerPage:40,encoderApplication:2048,encoderFrameSize:20,streamOptions:{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}},baseURL:c}),m={cmd:"init",bufferLength:n.recordingOptions.bufferSize,monitorGain:0,numberOfChannels:n.recordingOptions.numInputChannels,encoderSampleRate:48e3,stream:!1,maxBuffersPerPage:40,encoderApplication:2048,encoderFrameSize:20,quality:n.vorbisQuality,streamOptions:{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}},baseURL:c};e.setConfig(n);var f=function(){var t,i=[],o=0;return function(r,a,c){if(!u){i=[],o=0,t=$.Deferred(),u=e.createWorker("oggopusEncoder",n.useBlob);var d=$.extend({},p);d.originalSampleRate=n.recordingOptions.sampleRate,u.postMessage(d);var h=function(e){var n=new Uint8Array(e);if(i.push(n),o+=n.length,4&n[5]){l("final page encoded");for(var r=new Uint8Array(o),a=0,c=0;c<i.length;c++)r.set(i[c],a),a+=i[c].length;var d=s(r);i=[],u.terminate(),u.onmessage=null,u.onerror=null,u=null,t.resolve(d),t=null}};u.onmessage=function(e){var t=e.data;switch(t.cmd){case"log":l(t.msg);break;default:h(t)}}}return a?c?setTimeout(function(){u?(l("done msg sent"),u.postMessage({cmd:"done"})):t&&"pending"===t.state()&&t.reject()},0):u.postMessage({cmd:"encode",buffers:r}):u.postMessage({cmd:"encodeAll",buffers:r}),t}}(),g=function(){var t,i=!1;return function(o,r,a){if(l("encodeVorbis","\n\tprogressive:",r,"\n\tend:",a,"\n\tisDone:",i,"\n\t!!vorbisEncoder:",!!h,"\n\tbuffers:",o),!h){t=$.Deferred(),h=e.createWorker("oggvorbisEncoder",n.useBlob);var c=$.extend({},m);c.originalSampleRate=n.recordingOptions.sampleRate,c.quality=n.hasOwnProperty("vorbisQuality")?n.vorbisQuality:0,i=!1,h.postMessage(c);var d=function(e){var n=new FileReader;n.onload=function(){var e=s(new Uint8Array(this.result));h.terminate(),h.onmessage=null,h.onerror=null,h=null,t.resolve(e),t=null},n.readAsArrayBuffer(e)};window.URL=window.URL||window.webkitURL,h.onmessage=function(e){d(e.data.blob)},h.onerror=function(e){console.error("Audio recorder > vorbisEncoder error:",e.message)}}return a?(i=!0,h.postMessage({cmd:"done"})):i||h.postMessage({cmd:"encode",buffers:o}),t}}();return{encode:r,encodeB64:s,terminateAll:o,finalize:i}}return t}),n("decoder",["./worker-functions"],function(e){function t(t,n){function i(){o(),c=null}function o(){$.each([c],function(e,t){t&&t.terminate()})}function r(e){for(var t=atob(e),n=new Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new Uint8Array(n)}function s(e,t){switch(e){case"spx":return decodeSPXB64(t);case"opus":return a(t);default:console.error("Audio Recorder Encoder > codec:",e,", is unsupported")}}function a(t){var i=[],o=0,s=$.Deferred();c=e.createWorker("oggopusDecoder",n.useBlob);var a={cmd:"init",bufferLength:n.recordingOptions.bufferSize,outputBufferSampleRate:n.recordingOptions.sampleRate,baseURL:d};return c.onmessage=function(e){var t=e.data;switch(t.cmd){case"log":console.log(t.msg);break;case"decode":i.push(new Float32Array(t.outputBuffer)),o+=a.bufferLength;break;case"decoded":i.push(new Float32Array(t.outputBuffer)),o+=a.bufferLength,c.terminate(),samples=l(i,o),s.resolve(samples)}},c.onerror=function(e){e.preventDefault(),console.log("Audio recorder > opusDecoder error:",e)},c.postMessage(a),c.postMessage({cmd:"decode",pages:r(t),baseURL:d}),s}function l(e,t){for(var n=new Float32Array(t),i=0,o=0;o<e.length;o++){var r=e[o];n.set(r,i),i+=r.length}return n}var c=null,d=n.baseURL;return e.setConfig(n),{decode:s,decodeB64:r,finalize:i,terminateAll:o}}return t}),n("webrtc-recorder",[],function(){function e(e,t,n){function i(){y(),!x&&window.TN8&&!window.TN8.MicDeviceId&&window.TN8.AudioNode?s():o()}function o(){window.stream&&window.stream.getTracks().forEach(function(e){e.stop()});var e={audio:!0,video:!1},n=window.TN8&&window.TN8.MicDeviceId;n&&(e={audio:{deviceId:{exact:n}},video:!1}),n&&""!==n||!window.mediaStreamGlobal||t.platformInfo.isChromeOS?navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e).then(f).catch(g):navigator.getUserMedia(e,f,g):f(window.mediaStreamGlobal)}function r(){if(window.TN8=window.TN8||{},!window.TN8.AudioContext){var e=window.AudioContext||window.webkitAudioContext;window.TN8.AudioContext=new e}return window.TN8.AudioContext}function s(){if(e.trigger("audioenabled"),E)try{E.start()}catch(e){TN8&&TN8.Application&&TN8.Application.error.logError(e.name+" "+e.message),n.triggerMicFailureError()}else window.TN8.AudioNode&&(window.TN8.AudioNode.onaudioprocess=m)}function a(){return r().sampleRate}function l(){if(E)try{E.stop(),I=!0}catch(e){if("InvalidStateError"===e.name&&I)return;TN8&&TN8.Application&&TN8.Application.error.logError(e.name+" "+e.message),n.triggerMicFailureError()}else window.TN8.AudioNode&&window.TN8.AudioNode.onaudioprocess===m?window.TN8.AudioNode.onaudioprocess=null:window.TN8.AudioNode||E||e.trigger("audioEncodedToB64")}function c(){return S(C,N)}function d(){return void 0!==C&&"[object Array]"===Object.prototype.toString.call(C)&&C.length>0&&N>0}function u(){return x}function h(){y()}function p(){window.TN8&&window.TN8.AudioNode&&(window.TN8.AudioNode.onaudioprocess=null),C=null,e=null,E&&("recording"!==E.state&&"paused"!==E.state||E.stop(),E=null)}function m(n){if(C){var i=n.inputBuffer.getChannelData(0);C.push(new Float32Array(i)),N+=t.recordingOptions.bufferSize,e.trigger("audioinput",[i])}}function f(e){window.stream=e,x?(T(e),t.platformInfo.isChromeOS||window.mediaStreamGlobal||(window.mediaStreamGlobal=e)):v(e),s()}function g(e){console.log("----- navigator.getUserMedia error:",e)}function v(e){var n=r(),i=t.recordingOptions||{},o=n.createMediaStreamSource(e),s=n.createScriptProcessor(i.bufferSize,i.numInputChannels,i.numOutputChannels);o.connect(s),s.connect(n.destination),window.TN8=window.TN8||{},window.TN8.AudioNode=window.TN8.AudioNode||s,window.mediaStreamGlobal=e,n.resume()}function T(n){window.TN8&&window.TN8.AudioNode&&w();var i=r(),o=i.createMediaStreamSource(n),s=i.createScriptProcessor(),a=b();E=new MediaRecorder(n,{mimeType:a}),o.connect(s),s.connect(i.destination);var l=function(t){if(e){var n=new FileReader;n.readAsDataURL(t.originalEvent.data),$(n).one("loadend",function(){var t=n.result,i=t.split(",")[1];e.trigger("audioEncodedToB64",[i]),I=!1})}},c=function(){t.platformInfo.isChromeOS&&d(),s.onaudioprocess=null,o.disconnect(),s.disconnect(),$(E).off("dataavailable"),$(E).off("stop")},d=function(){n.getTracks().forEach(function(e){e.stop()})},u=function(t){e&&e.trigger("audioinput",[t.inputBuffer.getChannelData(0)])};s.onaudioprocess=u,$(E).on("dataavailable",l),$(E).on("stop",c),$(document).one("micCheck.micSelected",d),i.resume()}function b(){return t.platformInfo.usingFF?"audio/ogg;codecs=opus":"audio/webm;codecs=opus"}function w(){var e=window.TN8&&window.TN8.AudioNode,n=window.mediaStreamGlobal;e&&(e.onaudioprocess=null,e.disconnect(),delete window.TN8.AudioNode),n&&t.platformInfo.isChromeOS&&(n.getTracks().forEach(function(e){e.stop()}),delete window.mediaStreamGlobal)}function y(){C=[],N=0}function S(e,t){for(var n=new Float32Array(t),i=0,o=0;o<e.length;o++){var r=e[o];n.set(r,i),i+=r.length}return n}var C,N,_,E,I,x=MediaRecorder&&(t.platformInfo.isChromeOS||t.platformInfo.isWindowsOS||t.platformInfo.usingFF||t.platformInfo.usingChrome||t.platformInfo.isMacOS&&t.platformInfo.isAppMode);return _=$.Deferred(),_.resolve(),{startRecording:i,stopRecording:l,usingMediaRecorder:u,getRawData:c,hasRawData:d,onAudioRemoved:h,finalize:p,getSampleRate:a,initDeferred:_}}return e}),n("timer",[],function(){return{start:function(e,t,n,i){function o(){if(a++==r)i(r,a);else{var e=(new Date).getTime()-l-a*s,t=window.setTimeout(o,s-e);n(r,a,t)}}var r=e/100*(t/10),s=e/r,a=0,l=(new Date).getTime();return window.setTimeout(o,s)},stop:function(e){window.clearTimeout(e)}}}),function(){"use strict";function e(t){var n,i,o,r=t.length,s="",a=e.a,l=0;if(1<r)for(;l<r-2;){if(n=t.charCodeAt(l),i=t.charCodeAt(l+1),o=t.charCodeAt(l+2),l+=3,255<n||255<i||255<o)throw Error("INVALID_CHARACTER_ERR");s+=a[n>>2&63]+a[i>>4&15|n<<4&63]+a[o>>6&3|i<<2&63]+a[63&o]}if(l<r){if(255<(n=t.charCodeAt(l++)))throw Error("INVALID_CHARACTER_ERR");if(s+=a[n>>2&63],l<r){if(255<(i=t.charCodeAt(l)))throw Error("INVALID_CHARACTER_ERR");s+=a[i>>4&15|n<<4&63]+a[i<<2&63]}else s+=a[n<<4&63]}return n=4*((r+2)/3|0)-s.length,0<n&&(s+=2===n?"==":"="),s}function t(e){for(var n,i,o=0,r=0,s=e.length,a="",l=0,c=t.b,d=t.c;"="===e.charAt(s-1);)--s;if(1==s%4||0<e.length&&0===s)throw Error("INVALID_CHARACTER_ERR");for(;r<s;){if(i=e.charCodeAt(r++),-1===(n=256>i?d[i]:-1))throw Error("INVALID_CHARACTER_ERR");o=(o<<6)+n,l+=6,8<=l&&(l-=8,i=o>>l,a+=c[i],o^=i<<l)}return a}e.a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");var n,i=t,o=Array(256);for(n=0;255>n;++n)o[n]=String.fromCharCode(n);i.b=o;var r,s=t,a=e.a,l=new("undefined"!=typeof Int16Array?Int16Array:Array)(256),c=t.b;for(r=0;255>r;++r)l[r]=a.indexOf(c[r]);s.c=l;var d,u,h=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(64);for(d=0,u=h.length;d<u;++d)h[d]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(d);new("undefined"!=typeof Int16Array?Int16Array:Array)(256);var p;for(h instanceof Array||Array.prototype.slice.call(h),p=0;255>p;++p);void 0===this.atob&&(this.atob=t),void 0===this.btoa&&(this.btoa=e)}.call(this),n("polyfills/base64_polyfill.min",function(){}),function(e){"use strict";function t(e){switch(typeof e){case"undefined":return"undefined";case"boolean":return"boolean";case"number":return"number";case"string":return"string";default:return null===e?"null":"object"}}function n(e){return Object.prototype.toString.call(e).replace(/^\[object *|\]$/g,"")}function i(e){return"function"==typeof e}function o(e){if(null===e||e===x)throw TypeError();return Object(e)}function r(e){return e>>0}function s(e){return e>>>0}function a(e){if(e.length>R)throw RangeError("Array too large for polyfill");var t;for(t=0;t<e.length;t+=1)!function(t){Object.defineProperty(e,t,{get:function(){return e._getter(t)},set:function(n){e._setter(t,n)},enumerable:!0,configurable:!1})}(t)}function l(e,t){var n=32-t;return e<<n>>n}function c(e,t){var n=32-t;return e<<n>>>n}function d(e){return[255&e]}function u(e){return l(e[0],8)}function h(e){return[255&e]}function p(e){return c(e[0],8)}function m(e){return e=F(Number(e)),[e<0?0:e>255?255:255&e]}function f(e){return[e>>8&255,255&e]}function g(e){return l(e[0]<<8|e[1],16)}function v(e){return[e>>8&255,255&e]}function T(e){return c(e[0]<<8|e[1],16)}function b(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}function w(e){return l(e[0]<<24|e[1]<<16|e[2]<<8|e[3],32)}function y(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}function S(e){return c(e[0]<<24|e[1]<<16|e[2]<<8|e[3],32)}function C(e,t,n){function i(e){var t=O(e),n=e-t;return n<.5?t:n>.5?t+1:t%2?t+1:t}var o,r,s,a,l,c,d,u=(1<<t-1)-1;for(e!==e?(r=(1<<t)-1,s=M(2,n-1),o=0):e===1/0||e===-1/0?(r=(1<<t)-1,s=0,o=e<0?1:0):0===e?(r=0,s=0,o=1/e==-1/0?1:0):(o=e<0,e=A(e),e>=M(2,1-u)?(r=D(O(L(e)/k),1023),s=i(e/M(2,r)*M(2,n)),s/M(2,n)>=2&&(r+=1,s=1),r>u?(r=(1<<t)-1,s=0):(r+=u,s-=M(2,n))):(r=0,s=i(e/M(2,1-u-n)))),l=[],a=n;a;a-=1)l.push(s%2?1:0),
s=O(s/2);for(a=t;a;a-=1)l.push(r%2?1:0),r=O(r/2);for(l.push(o?1:0),l.reverse(),c=l.join(""),d=[];c.length;)d.push(parseInt(c.substring(0,8),2)),c=c.substring(8);return d}function N(e,t,n){var i,o,r,s,a,l,c,d,u=[];for(i=e.length;i;i-=1)for(r=e[i-1],o=8;o;o-=1)u.push(r%2?1:0),r>>=1;return u.reverse(),s=u.join(""),a=(1<<t-1)-1,l=parseInt(s.substring(0,1),2)?-1:1,c=parseInt(s.substring(1,1+t),2),d=parseInt(s.substring(1+t),2),c===(1<<t)-1?0!==d?NaN:l*(1/0):c>0?l*M(2,c-a)*(1+d/M(2,n)):0!==d?l*M(2,-(a-1))*(d/M(2,n)):l<0?-0:0}function _(e){return N(e,11,52)}function E(e){return C(e,11,52)}function $(e){return N(e,8,23)}function I(e){return C(e,8,23)}var x=void 0,R=1e5,k=Math.LN2,A=Math.abs,O=Math.floor,L=Math.log,P=Math.max,D=Math.min,M=Math.pow,F=Math.round;!function(){var e=Object.defineProperty,t=!function(){try{return Object.defineProperty({},"x",{})}catch(e){return!1}}();e&&!t||(Object.defineProperty=function(t,n,i){if(e)try{return e(t,n,i)}catch(e){}if(t!==Object(t))throw TypeError("Object.defineProperty called on non-object");return Object.prototype.__defineGetter__&&"get"in i&&Object.prototype.__defineGetter__.call(t,n,i.get),Object.prototype.__defineSetter__&&"set"in i&&Object.prototype.__defineSetter__.call(t,n,i.set),"value"in i&&(t[n]=i.value),t})}(),function(){function l(e){if((e=r(e))<0)throw RangeError("ArrayBuffer size is not a small enough positive integer.");Object.defineProperty(this,"byteLength",{value:e}),Object.defineProperty(this,"_bytes",{value:Array(e)});for(var t=0;t<e;t+=1)this._bytes[t]=0}function c(){if(!arguments.length||"object"!=typeof arguments[0])return function(e){if((e=r(e))<0)throw RangeError("length is not a small enough positive integer.");Object.defineProperty(this,"length",{value:e}),Object.defineProperty(this,"byteLength",{value:e*this.BYTES_PER_ELEMENT}),Object.defineProperty(this,"buffer",{value:new l(this.byteLength)}),Object.defineProperty(this,"byteOffset",{value:0})}.apply(this,arguments);if(arguments.length>=1&&"object"===t(arguments[0])&&arguments[0]instanceof c)return function(e){if(this.constructor!==e.constructor)throw TypeError();var t=e.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new l(t)}),Object.defineProperty(this,"byteLength",{value:t}),Object.defineProperty(this,"byteOffset",{value:0}),Object.defineProperty(this,"length",{value:e.length});for(var n=0;n<this.length;n+=1)this._setter(n,e._getter(n))}.apply(this,arguments);if(arguments.length>=1&&"object"===t(arguments[0])&&!(arguments[0]instanceof c)&&!(arguments[0]instanceof l||"ArrayBuffer"===n(arguments[0])))return function(e){var t=e.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new l(t)}),Object.defineProperty(this,"byteLength",{value:t}),Object.defineProperty(this,"byteOffset",{value:0}),Object.defineProperty(this,"length",{value:e.length});for(var n=0;n<this.length;n+=1){var i=e[n];this._setter(n,Number(i))}}.apply(this,arguments);if(arguments.length>=1&&"object"===t(arguments[0])&&(arguments[0]instanceof l||"ArrayBuffer"===n(arguments[0])))return function(e,t,n){if((t=s(t))>e.byteLength)throw RangeError("byteOffset out of range");if(t%this.BYTES_PER_ELEMENT)throw RangeError("buffer length minus the byteOffset is not a multiple of the element size.");if(n===x){var i=e.byteLength-t;if(i%this.BYTES_PER_ELEMENT)throw RangeError("length of buffer minus byteOffset not a multiple of the element size");n=i/this.BYTES_PER_ELEMENT}else n=s(n),i=n*this.BYTES_PER_ELEMENT;if(t+i>e.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:e}),Object.defineProperty(this,"byteLength",{value:i}),Object.defineProperty(this,"byteOffset",{value:t}),Object.defineProperty(this,"length",{value:n})}.apply(this,arguments);throw TypeError()}function C(e,t,n){var i=function(){Object.defineProperty(this,"constructor",{value:i}),c.apply(this,arguments),a(this)};"__proto__"in i?i.__proto__=c:(i.from=c.from,i.of=c.of),i.BYTES_PER_ELEMENT=e;var o=function(){};return o.prototype=N,i.prototype=new o,Object.defineProperty(i.prototype,"BYTES_PER_ELEMENT",{value:e}),Object.defineProperty(i.prototype,"_pack",{value:t}),Object.defineProperty(i.prototype,"_unpack",{value:n}),i}e.ArrayBuffer=e.ArrayBuffer||l,Object.defineProperty(c,"from",{value:function(e){return new this(e)}}),Object.defineProperty(c,"of",{value:function(){return new this(arguments)}});var N={};c.prototype=N,Object.defineProperty(c.prototype,"_getter",{value:function(e){if(arguments.length<1)throw SyntaxError("Not enough arguments");if((e=s(e))>=this.length)return x;var t,n,i=[];for(t=0,n=this.byteOffset+e*this.BYTES_PER_ELEMENT;t<this.BYTES_PER_ELEMENT;t+=1,n+=1)i.push(this.buffer._bytes[n]);return this._unpack(i)}}),Object.defineProperty(c.prototype,"get",{value:c.prototype._getter}),Object.defineProperty(c.prototype,"_setter",{value:function(e,t){if(arguments.length<2)throw SyntaxError("Not enough arguments");if(!((e=s(e))>=this.length)){var n,i,o=this._pack(t);for(n=0,i=this.byteOffset+e*this.BYTES_PER_ELEMENT;n<this.BYTES_PER_ELEMENT;n+=1,i+=1)this.buffer._bytes[i]=o[n]}}}),Object.defineProperty(c.prototype,"constructor",{value:c}),Object.defineProperty(c.prototype,"copyWithin",{value:function(e,t){var n=arguments[2],i=o(this),a=i.length,l=s(a);l=P(l,0);var c,d=r(e);c=d<0?P(l+d,0):D(d,l);var u,h=r(t);u=h<0?P(l+h,0):D(h,l);var p;p=n===x?l:r(n);var m;m=p<0?P(l+p,0):D(p,l);var f,g=D(m-u,l-c);for(u<c&&c<u+g?(f=-1,u=u+g-1,c=c+g-1):f=1;g>0;)i._setter(c,i._getter(u)),u+=f,c+=f,g-=1;return i}}),Object.defineProperty(c.prototype,"every",{value:function(e){if(this===x||null===this)throw TypeError();var t=Object(this),n=s(t.length);if(!i(e))throw TypeError();for(var o=arguments[1],r=0;r<n;r++)if(!e.call(o,t._getter(r),r,t))return!1;return!0}}),Object.defineProperty(c.prototype,"fill",{value:function(e){var t=arguments[1],n=arguments[2],i=o(this),a=i.length,l=s(a);l=P(l,0);var c,d=r(t);c=d<0?P(l+d,0):D(d,l);var u;u=n===x?l:r(n);var h;for(h=u<0?P(l+u,0):D(u,l);c<h;)i._setter(c,e),c+=1;return i}}),Object.defineProperty(c.prototype,"filter",{value:function(e){if(this===x||null===this)throw TypeError();var t=Object(this),n=s(t.length);if(!i(e))throw TypeError();for(var o=[],r=arguments[1],a=0;a<n;a++){var l=t._getter(a);e.call(r,l,a,t)&&o.push(l)}return new this.constructor(o)}}),Object.defineProperty(c.prototype,"find",{value:function(e){var t=o(this),n=t.length,r=s(n);if(!i(e))throw TypeError();for(var a=arguments.length>1?arguments[1]:x,l=0;l<r;){var c=t._getter(l),d=e.call(a,c,l,t);if(Boolean(d))return c;++l}return x}}),Object.defineProperty(c.prototype,"findIndex",{value:function(e){var t=o(this),n=t.length,r=s(n);if(!i(e))throw TypeError();for(var a=arguments.length>1?arguments[1]:x,l=0;l<r;){var c=t._getter(l),d=e.call(a,c,l,t);if(Boolean(d))return l;++l}return-1}}),Object.defineProperty(c.prototype,"forEach",{value:function(e){if(this===x||null===this)throw TypeError();var t=Object(this),n=s(t.length);if(!i(e))throw TypeError();for(var o=arguments[1],r=0;r<n;r++)e.call(o,t._getter(r),r,t)}}),Object.defineProperty(c.prototype,"indexOf",{value:function(e){if(this===x||null===this)throw TypeError();var t=Object(this),n=s(t.length);if(0===n)return-1;var i=0;if(arguments.length>0&&(i=Number(arguments[1]),i!==i?i=0:0!==i&&i!==1/0&&i!==-1/0&&(i=(i>0||-1)*O(A(i)))),i>=n)return-1;for(var o=i>=0?i:P(n-A(i),0);o<n;o++)if(t._getter(o)===e)return o;return-1}}),Object.defineProperty(c.prototype,"join",{value:function(e){if(this===x||null===this)throw TypeError();for(var t=Object(this),n=s(t.length),i=Array(n),o=0;o<n;++o)i[o]=t._getter(o);return i.join(e===x?",":e)}}),Object.defineProperty(c.prototype,"lastIndexOf",{value:function(e){if(this===x||null===this)throw TypeError();var t=Object(this),n=s(t.length);if(0===n)return-1;var i=n;arguments.length>1&&(i=Number(arguments[1]),i!==i?i=0:0!==i&&i!==1/0&&i!==-1/0&&(i=(i>0||-1)*O(A(i))));for(var o=i>=0?D(i,n-1):n-A(i);o>=0;o--)if(t._getter(o)===e)return o;return-1}}),Object.defineProperty(c.prototype,"map",{value:function(e){if(this===x||null===this)throw TypeError();var t=Object(this),n=s(t.length);if(!i(e))throw TypeError();var o=[];o.length=n;for(var r=arguments[1],a=0;a<n;a++)o[a]=e.call(r,t._getter(a),a,t);return new this.constructor(o)}}),Object.defineProperty(c.prototype,"reduce",{value:function(e){if(this===x||null===this)throw TypeError();var t=Object(this),n=s(t.length);if(!i(e))throw TypeError();if(0===n&&1===arguments.length)throw TypeError();var o,r=0;for(o=arguments.length>=2?arguments[1]:t._getter(r++);r<n;)o=e.call(x,o,t._getter(r),r,t),r++;return o}}),Object.defineProperty(c.prototype,"reduceRight",{value:function(e){if(this===x||null===this)throw TypeError();var t=Object(this),n=s(t.length);if(!i(e))throw TypeError();if(0===n&&1===arguments.length)throw TypeError();var o,r=n-1;for(o=arguments.length>=2?arguments[1]:t._getter(r--);r>=0;)o=e.call(x,o,t._getter(r),r,t),r--;return o}}),Object.defineProperty(c.prototype,"reverse",{value:function(){if(this===x||null===this)throw TypeError();for(var e=Object(this),t=s(e.length),n=O(t/2),i=0,o=t-1;i<n;++i,--o){var r=e._getter(i);e._setter(i,e._getter(o)),e._setter(o,r)}return e}}),Object.defineProperty(c.prototype,"set",{value:function(e,t){if(arguments.length<1)throw SyntaxError("Not enough arguments");var n,i,o,r,a,l,c,d,u,h;if("object"==typeof arguments[0]&&arguments[0].constructor===this.constructor){if(n=arguments[0],(o=s(arguments[1]))+n.length>this.length)throw RangeError("Offset plus length of array is out of range");if(d=this.byteOffset+o*this.BYTES_PER_ELEMENT,u=n.length*this.BYTES_PER_ELEMENT,n.buffer===this.buffer){for(h=[],a=0,l=n.byteOffset;a<u;a+=1,l+=1)h[a]=n.buffer._bytes[l];for(a=0,c=d;a<u;a+=1,c+=1)this.buffer._bytes[c]=h[a]}else for(a=0,l=n.byteOffset,c=d;a<u;a+=1,l+=1,c+=1)this.buffer._bytes[c]=n.buffer._bytes[l]}else{if("object"!=typeof arguments[0]||void 0===arguments[0].length)throw TypeError("Unexpected argument type(s)");if(i=arguments[0],r=s(i.length),(o=s(arguments[1]))+r>this.length)throw RangeError("Offset plus length of array is out of range");for(a=0;a<r;a+=1)l=i[a],this._setter(o+a,Number(l))}}}),Object.defineProperty(c.prototype,"slice",{value:function(e,t){for(var n=o(this),i=n.length,a=s(i),l=r(e),c=l<0?P(a+l,0):D(l,a),d=t===x?a:r(t),u=d<0?P(a+d,0):D(d,a),h=u-c,p=n.constructor,m=new p(h),f=0;c<u;){var g=n._getter(c);m._setter(f,g),++c,++f}return m}}),Object.defineProperty(c.prototype,"some",{value:function(e){if(this===x||null===this)throw TypeError();var t=Object(this),n=s(t.length);if(!i(e))throw TypeError();for(var o=arguments[1],r=0;r<n;r++)if(e.call(o,t._getter(r),r,t))return!0;return!1}}),Object.defineProperty(c.prototype,"sort",{value:function(e){if(this===x||null===this)throw TypeError();for(var t=Object(this),n=s(t.length),i=Array(n),o=0;o<n;++o)i[o]=t._getter(o);for(e?i.sort(e):i.sort(),o=0;o<n;++o)t._setter(o,i[o]);return t}}),Object.defineProperty(c.prototype,"subarray",{value:function(e,t){function n(e,t,n){return e<t?t:e>n?n:e}e=r(e),t=r(t),arguments.length<1&&(e=0),arguments.length<2&&(t=this.length),e<0&&(e=this.length+e),t<0&&(t=this.length+t),e=n(e,0,this.length),t=n(t,0,this.length);var i=t-e;return i<0&&(i=0),new this.constructor(this.buffer,this.byteOffset+e*this.BYTES_PER_ELEMENT,i)}});var R=C(1,d,u),k=C(1,h,p),L=C(1,m,p),M=C(2,f,g),F=C(2,v,T),B=C(4,b,w),U=C(4,y,S),V=C(4,I,$),j=C(8,E,_);e.Int8Array=e.Int8Array||R,e.Uint8Array=e.Uint8Array||k,e.Uint8ClampedArray=e.Uint8ClampedArray||L,e.Int16Array=e.Int16Array||M,e.Uint16Array=e.Uint16Array||F,e.Int32Array=e.Int32Array||B,e.Uint32Array=e.Uint32Array||U,e.Float32Array=e.Float32Array||V,e.Float64Array=e.Float64Array||j}(),function(){function t(e,t){return i(e.get)?e.get(t):e[t]}function o(e,t,i){if(!(e instanceof ArrayBuffer||"ArrayBuffer"===n(e)))throw TypeError();if((t=s(t))>e.byteLength)throw RangeError("byteOffset out of range");if(i=i===x?e.byteLength-t:s(i),t+i>e.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:e}),Object.defineProperty(this,"byteLength",{value:i}),Object.defineProperty(this,"byteOffset",{value:t})}function r(e){return function(n,i){if((n=s(n))+e.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");n+=this.byteOffset;for(var o=new Uint8Array(this.buffer,n,e.BYTES_PER_ELEMENT),r=[],a=0;a<e.BYTES_PER_ELEMENT;a+=1)r.push(t(o,a));return Boolean(i)===Boolean(l)&&r.reverse(),t(new e(new Uint8Array(r).buffer),0)}}function a(e){return function(n,i,o){if((n=s(n))+e.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");var r,a,c=new e([i]),d=new Uint8Array(c.buffer),u=[];for(r=0;r<e.BYTES_PER_ELEMENT;r+=1)u.push(t(d,r));Boolean(o)===Boolean(l)&&u.reverse(),a=new Uint8Array(this.buffer,n,e.BYTES_PER_ELEMENT),a.set(u)}}var l=function(){var e=new Uint16Array([4660]);return 18===t(new Uint8Array(e.buffer),0)}();Object.defineProperty(o.prototype,"getUint8",{value:r(Uint8Array)}),Object.defineProperty(o.prototype,"getInt8",{value:r(Int8Array)}),Object.defineProperty(o.prototype,"getUint16",{value:r(Uint16Array)}),Object.defineProperty(o.prototype,"getInt16",{value:r(Int16Array)}),Object.defineProperty(o.prototype,"getUint32",{value:r(Uint32Array)}),Object.defineProperty(o.prototype,"getInt32",{value:r(Int32Array)}),Object.defineProperty(o.prototype,"getFloat32",{value:r(Float32Array)}),Object.defineProperty(o.prototype,"getFloat64",{value:r(Float64Array)}),Object.defineProperty(o.prototype,"setUint8",{value:a(Uint8Array)}),Object.defineProperty(o.prototype,"setInt8",{value:a(Int8Array)}),Object.defineProperty(o.prototype,"setUint16",{value:a(Uint16Array)}),Object.defineProperty(o.prototype,"setInt16",{value:a(Int16Array)}),Object.defineProperty(o.prototype,"setUint32",{value:a(Uint32Array)}),Object.defineProperty(o.prototype,"setInt32",{value:a(Int32Array)}),Object.defineProperty(o.prototype,"setFloat32",{value:a(Float32Array)}),Object.defineProperty(o.prototype,"setFloat64",{value:a(Float64Array)}),e.DataView=e.DataView||o}()}(this),n("polyfills/typedarray",function(){}),function(e){"use strict";if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{return void new Blob}catch(e){}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},i=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},o=n.prototype,r=i.prototype,s=e.FileReaderSync,a=function(e){this.code=this[this.name=e]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=l.length,d=e.URL||e.webkitURL||e,u=d.createObjectURL,h=d.revokeObjectURL,p=d,m=e.btoa,f=e.atob,g=e.ArrayBuffer,v=e.Uint8Array,T=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(i.fake=r.fake=!0;c--;)a.prototype[l[c]]=c+1;return d.createObjectURL||(p=e.URL=function(e){var t,n=document.createElementNS("http://www.w3.org/1999/xhtml","a");return n.href=e,"origin"in n||("data:"===n.protocol.toLowerCase()?n.origin=null:(t=e.match(T),n.origin=t&&t[1])),n}),p.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof i?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):m?t+";base64,"+m(e.data):t+","+encodeURIComponent(e.data)):u?u.call(d,e):void 0},p.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&h&&h.call(d,e)},o.append=function(e){var n=this.data;if(v&&(e instanceof g||e instanceof v)){for(var o="",r=new v(e),l=0,c=r.length;l<c;l++)o+=String.fromCharCode(r[l]);n.push(o)}else if("Blob"===t(e)||"File"===t(e)){if(!s)throw new a("NOT_READABLE_ERR");var d=new s;n.push(d.readAsBinaryString(e))}else e instanceof i?"base64"===e.encoding&&f?n.push(f(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},o.getBlob=function(e){return arguments.length||(e=null),new i(this.data.join(""),e,"raw")},o.toString=function(){return"[object BlobBuilder]"},r.slice=function(e,t,n){var o=arguments.length;return o<3&&(n=null),new i(this.data.slice(e,o>1?t:this.data.length),n,this.encoding)},r.toString=function(){return"[object Blob]"},r.close=function(){this.size=0,delete this.data},n}(e);e.Blob=function(e,n){var i=n?n.type||"":"",o=new t;if(e)for(var r=0,s=e.length;r<s;r++)o.append(e[r]);return o.getBlob(i)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),n("polyfills/Blob",function(){});var i=function(){function e(){if(!z){try{var e=D.getElementsByTagName("body")[0].appendChild(v("span"));e.parentNode.removeChild(e)}catch(e){return}z=!0;for(var t=B.length,n=0;n<t;n++)B[n]()}}function t(e){z?e():B[B.length]=e}function n(e){if(typeof P.addEventListener!=x)P.addEventListener("load",e,!1);else if(typeof D.addEventListener!=x)D.addEventListener("load",e,!1);else if(typeof P.attachEvent!=x)T(P,"onload",e);else if("function"==typeof P.onload){var t=P.onload;P.onload=function(){t(),e()}}else P.onload=e}function o(){F?r():s()}function r(){var e=D.getElementsByTagName("body")[0],t=v(R);t.setAttribute("type",A);var n=e.appendChild(t);if(n){var i=0;!function(){if(typeof n.GetVariable!=x){var o=n.GetVariable("$version");o&&(o=o.split(" ")[1].split(","),G.pv=[parseInt(o[0],10),parseInt(o[1],10),parseInt(o[2],10)])}else if(i<10)return i++,void setTimeout(arguments.callee,10);e.removeChild(t),n=null,s()}()}else s()}function s(){var e=U.length;if(e>0)for(var t=0;t<e;t++){var n=U[t].id,i=U[t].callbackFn,o={success:!1,id:n};if(G.pv[0]>0){var r=g(n);if(r)if(!b(U[t].swfVersion)||G.wk&&G.wk<312)if(U[t].expressInstall&&l()){var s={};s.data=U[t].expressInstall,s.width=r.getAttribute("width")||"0",s.height=r.getAttribute("height")||"0",r.getAttribute("class")&&(s.styleclass=r.getAttribute("class")),r.getAttribute("align")&&(s.align=r.getAttribute("align"));for(var u={},h=r.getElementsByTagName("param"),p=h.length,m=0;m<p;m++)"movie"!=h[m].getAttribute("name").toLowerCase()&&(u[h[m].getAttribute("name")]=h[m].getAttribute("value"));c(s,u,n,i)}else d(r),i&&i(o);else y(n,!0),i&&(o.success=!0,o.ref=a(n),i(o))}else if(y(n,!0),i){var f=a(n);f&&typeof f.SetVariable!=x&&(o.success=!0,o.ref=f),i(o)}}}function a(e){var t=null,n=g(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=x)t=n;else{var i=n.getElementsByTagName(R)[0];i&&(t=i)}return t}function l(){return!W&&b("6.0.65")&&(G.win||G.mac)&&!(G.wk&&G.wk<312)}function c(e,t,n,i){W=!0,_=i||null,E={success:!1,id:n};var o=g(n);if(o){"OBJECT"==o.nodeName?(C=u(o),N=null):(C=o,N=n),e.id=O,(typeof e.width==x||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==x||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),D.title=D.title.slice(0,47)+" - Flash Player Installation";var r=G.ie&&G.win?"ActiveX":"PlugIn",s="MMredirectURL="+P.location.toString().replace(/&/g,"%26")+"&MMplayerType="+r+"&MMdoctitle="+D.title;if(typeof t.flashvars!=x?t.flashvars+="&"+s:t.flashvars=s,G.ie&&G.win&&4!=o.readyState){var a=v("div");n+="SWFObjectNew",a.setAttribute("id",n),o.parentNode.insertBefore(a,o),o.style.display="none",function(){4==o.readyState?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)}()}h(e,t,n)}}function d(e){if(G.ie&&G.win&&4!=e.readyState){var t=v("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(u(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(u(e),e)}function u(e){var t=v("div");if(G.win&&G.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(R)[0];if(n){var i=n.childNodes;if(i)for(var o=i.length,r=0;r<o;r++)1==i[r].nodeType&&"PARAM"==i[r].nodeName||8==i[r].nodeType||t.appendChild(i[r].cloneNode(!0))}}return t}function h(e,t,n){var i,o=g(n);if(G.wk&&G.wk<312)return i;if(o)if(typeof e.id==x&&(e.id=n),G.ie&&G.win){var r="";for(var s in e)e[s]!=Object.prototype[s]&&("data"==s.toLowerCase()?t.movie=e[s]:"styleclass"==s.toLowerCase()?r+=' class="'+e[s]+'"':"classid"!=s.toLowerCase()&&(r+=" "+s+'="'+e[s]+'"'));var a="";for(var l in t)t[l]!=Object.prototype[l]&&(a+='<param name="'+l+'" value="'+t[l]+'" />');o.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+r+">"+a+"</object>",V[V.length]=e.id,i=g(e.id)}else{var c=v(R);c.setAttribute("type",A);for(var d in e)e[d]!=Object.prototype[d]&&("styleclass"==d.toLowerCase()?c.setAttribute("class",e[d]):"classid"!=d.toLowerCase()&&c.setAttribute(d,e[d]));for(var u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&p(c,u,t[u]);o.parentNode.replaceChild(c,o),i=c}return i}function p(e,t,n){var i=v("param");i.setAttribute("name",t),i.setAttribute("value",n),e.appendChild(i)}function m(e){var t=g(e);t&&"OBJECT"==t.nodeName&&(G.ie&&G.win?(t.style.display="none",function(){4==t.readyState?f(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function f(e){var t=g(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function g(e){var t=null;try{t=D.getElementById(e)}catch(e){}return t}function v(e){return D.createElement(e)}function T(e,t,n){e.attachEvent(t,n),j[j.length]=[e,t,n]}function b(e){var t=G.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]}function w(e,t,n,i){if(!G.ie||!G.mac){var o=D.getElementsByTagName("head")[0];if(o){var r=n&&"string"==typeof n?n:"screen";if(i&&($=null,I=null),!$||I!=r){var s=v("style");s.setAttribute("type","text/css"),s.setAttribute("media",r),$=o.appendChild(s),G.ie&&G.win&&typeof D.styleSheets!=x&&D.styleSheets.length>0&&($=D.styleSheets[D.styleSheets.length-1]),I=r}G.ie&&G.win?$&&typeof $.addRule==R&&$.addRule(e,t):$&&typeof D.createTextNode!=x&&$.appendChild(D.createTextNode(e+" {"+t+"}"))}}}function y(e,t){if(H){var n=t?"visible":"hidden";z&&g(e)?g(e).style.visibility=n:w("#"+e,"visibility:"+n)}}function S(e){return null!=/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!=x?encodeURIComponent(e):e}var C,N,_,E,$,I,x="undefined",R="object",k="Shockwave Flash",A="application/x-shockwave-flash",O="SWFObjectExprInst",L="onreadystatechange",P=window,D=document,M=navigator,F=!1,B=[o],U=[],V=[],j=[],z=!1,W=!1,H=!0,G=function(){var e=typeof D.getElementById!=x&&typeof D.getElementsByTagName!=x&&typeof D.createElement!=x,t=M.userAgent.toLowerCase(),n=M.platform.toLowerCase(),i=/win/.test(n?n:t),o=/mac/.test(n?n:t),r=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),s=!1,a=[0,0,0],l=null;if(typeof M.plugins!=x&&typeof M.plugins[k]==R)!(l=M.plugins[k].description)||typeof M.mimeTypes!=x&&M.mimeTypes[A]&&!M.mimeTypes[A].enabledPlugin||(F=!0,s=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),a[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10),a[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10),a[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof P.ActiveXObject!=x)try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");c&&(l=c.GetVariable("$version"))&&(s=!0,l=l.split(" ")[1].split(","),a=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)])}catch(e){}return{w3:e,pv:a,wk:r,ie:s,win:i,mac:o}}();return function(){G.w3&&((typeof D.readyState!=x&&"complete"==D.readyState||typeof D.readyState==x&&(D.getElementsByTagName("body")[0]||D.body))&&e(),z||(typeof D.addEventListener!=x&&D.addEventListener("DOMContentLoaded",e,!1),G.ie&&G.win&&(D.attachEvent(L,function(){"complete"==D.readyState&&(D.detachEvent(L,arguments.callee),e())}),P==top&&function(){if(!z){try{D.documentElement.doScroll("left")}catch(e){return void setTimeout(arguments.callee,0)}e()}}()),G.wk&&function(){z||(/loaded|complete/.test(D.readyState)?e():setTimeout(arguments.callee,0))}(),n(e)))}(),function(){G.ie&&G.win&&window.attachEvent("onunload",function(){for(var e=j.length,t=0;t<e;t++)j[t][0].detachEvent(j[t][1],j[t][2]);for(var n=V.length,o=0;o<n;o++)m(V[o]);for(var r in G)G[r]=null;G=null;for(var s in i)i[s]=null;i=null})}(),{registerObject:function(e,t,n,i){if(G.w3&&e&&t){var o={};o.id=e,o.swfVersion=t,o.expressInstall=n,o.callbackFn=i,U[U.length]=o,y(e,!1)}else i&&i({success:!1,id:e})},getObjectById:function(e){if(G.w3)return a(e)},embedSWF:function(e,n,i,o,r,s,a,d,u,p){var m={success:!1,id:n};G.w3&&!(G.wk&&G.wk<312)&&e&&n&&i&&o&&r?(y(n,!1),t(function(){i+="",o+="";var t={};if(u&&typeof u===R)for(var f in u)t[f]=u[f];t.data=e,t.width=i,t.height=o;var g={};if(d&&typeof d===R)for(var v in d)g[v]=d[v];if(a&&typeof a===R)for(var T in a)typeof g.flashvars!=x?g.flashvars+="&"+T+"="+a[T]:g.flashvars=T+"="+a[T];if(b(r)){var w=h(t,g,n);t.id==n&&y(n,!0),m.success=!0,m.ref=w}else{if(s&&l())return t.data=s,void c(t,g,n,p);y(n,!0)}p&&p(m)})):p&&p(m)},switchOffAutoHideShow:function(){H=!1},ua:G,getFlashPlayerVersion:function(){return{major:G.pv[0],minor:G.pv[1],release:G.pv[2]}},hasFlashPlayerVersion:b,createSWF:function(e,t,n){return G.w3?h(e,t,n):void 0},showExpressInstall:function(e,t,n,i){G.w3&&l()&&c(e,t,n,i)},removeSWF:function(e){G.w3&&m(e)},createCSS:function(e,t,n,i){G.w3&&w(e,t,n,i)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=D.location.search||D.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return S(t);for(var n=t.split("&"),i=0;i<n.length;i++)if(n[i].substring(0,n[i].indexOf("="))==e)return S(n[i].substring(n[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(W){var e=g(O);e&&C&&(e.parentNode.replaceChild(C,e),N&&(y(N,!0),G.ie&&G.win&&(C.style.display="block")),_&&_(E)),W=!1}}}}();return n("swfobject",function(){}),n("flash-recorder",["./timer","./polyfills/base64_polyfill.min","./polyfills/typedarray","./polyfills/Blob","./swfobject"],function(e){return function(t,n,o){function r(e){n.recorderId===e.recorderId&&t.trigger("audioEncodedToB64",e.data)}function s(e){var t=Array.prototype.slice.call(e);R.setDataForPlayback(t)}function a(){R.record()}function l(){null!==D&&(e.stop(D),D=null),y({state:"stop",recorderId:n.recorderId})}function c(e){return e?L:_(L,P)}function d(){return void 0!==L&&"[object Array]"===Object.prototype.toString.call(L)&&L.length>0&&P>0}function u(){N()}function h(){k&&(k.removeEventListener("flashReady",b),k.removeEventListener("setState",y),k.removeEventListener("micActivityStarted",g),k.removeEventListener("finalAudio",r),k.removeEventListener("receivedInput",T)),R&&R.finalize(),$flash=null,R=null,k=null,z=null}function p(){return R.getSampleRate()}function m(e,t,i){D=i,v({level:R.getMicLevel(),recorderId:n.recorderId})}function f(e,t){D=null}function g(i){n.recorderId===i.recorderId&&(t.trigger("audioenabled"),D=e.start(n.totalRecordingTime+1,20,m,f))}function v(e){n.recorderId===e.recorderId&&t.trigger("micSampleData",e.level)}function T(e){n.recorderId===e.recorderId&&t.trigger("flashReceivedInput")}function b(e){n.recorderId===e.recorderId&&(k.removeEventListener("flashReady",b),0===--k.numRecordersLoading&&$(document).trigger("TN8.FlashRecorderLoadingComplete"))}function w(){z.resolve(R)}function y(e){if(n.recorderId===e.recorderId&&O!==e.state)switch(A=O,O=e.state){case"init":case"denied":case"allowed":case"reset":E(!1);break;case"permission":E(!0);break;case"record":E(!1);break;case"play":break;case"stop":"record"!==A&&"play"!==A||R.stopEither()}}function S(e){e.success?(R=e.ref,x=$(R)):(console.error("Audio recorder > Flash plug-in <object> DOM creation failed"),o.setAsUnsupportedPlatfrom())}function C(){return n.baseURL}function N(){L=[],P=0,R.clearRecording()}function _(e,t){for(var n=new Float32Array(t),i=0,o=0;o<e.length;o++){var r=e[o];n.set(r,i),i+=r.length}return n}function E(e){(e?x.addClass:x.removeClass).call(x,"shown")}function I(){return!1}var x,R,k,A,O,L,P,D,M="public/javascripts/recorder/AudioRecordPlay.swf",F=11025,B=Math.floor(F/1e3),U=!1,V=!1,j=85,z=$.Deferred();return window.TN8=window.TN8||{},window.TN8.flashRecorder=window.TN8.flashRecorder||{types:{},event:function(e){var t=this.types[e.type];if(t)for(var n=0;n<t.length;n++)t[n](e)},addEventListener:function(e,t){this.types[e]||(this.types[e]=[]),this.types[e].push(t)},removeEventListener:function(e,t){if(this.types[e]){var n=this.types[e].indexOf(t);n>=0&&this.types[e].splice(n,1)}}},k=window.TN8.flashRecorder,k.addEventListener("flashReady",b),k.addEventListener("setState",y),k.addEventListener("micActivityStarted",g),k.addEventListener("finalAudio",r),k.addEventListener("receivedInput",T),isNaN(k.numRecordersLoading)?k.numRecordersLoading=1:k.numRecordersLoading++,$(document).one("TN8.FlashRecorderLoadingComplete",w),function(){var e=t.attr("id")+"-swfobject";$('<div id="'+e+'"><p>Flash Audio Recorder</p></div>').appendTo(t);var o={id:e,recorderId:n.recorderId,id:e,rate:B,gain:j,wavsamplerate:F,wavbitrate:n.wavbitrate,sendbuffers:U,wavencodebuffers:V},r={allowscriptaccess:"always",wmode:"transparent"},s={id:e,name:e,class:"recorder-swf"};i.embedSWF(C()+M,e,"215","138","10.3",!1,o,r,s,S)}(),{initDeferred:z,startRecording:a,stopRecording:l,setDataForPlayback:s,getRawData:c,hasRawData:d,onAudioRemoved:u,finalize:h,getSampleRate:p,usingMediaRecorder:I}}}),n("ios-recorder",[],function(){function e(e,t){function n(){T&&T.prepareToRecord(function(e){I&&I.resolve()},function(e){console.log("ERROR > IosRecorder > prepareToRecordFail")})}function i(){console.log(y," > startRecording"),T.record(function(t){e.trigger("audioenabled"),b=!0,v=_,f(),C=window.setInterval(o,N)},function(e){console.log("ERROR > IosRecorder > prepareToRecordFail")})}function o(){T.averagePower(function(t){var n=Math.abs((Math.max(t,-60)- -60)/60);S?S(n):e&&e.length>0&&e.trigger("micSampleData",100*n)},function(e){})}function r(e,t){v==_&&(v=E,f(),T.stop(function(n){e&&a(!!t)},function(e){console.log("ERROR > IosRecorder > stopRecordingFail, result:",e)}))}function s(){var e=$.Deferred();return w=!0,T.getData(function(t){var n=t.indexOf(";base64,")+";base64,".length,i=t.slice(n,t.length);e.resolve(i),e=null,w=!1,b=!1},function(t){console.log("ERROR > IosRecorder > getDataFail"),e.reject(),e=null}),e}function a(e){T&&T.deleteRecording(function(t){t&&(b=!1),e||n()},function(e){console.log("ERROR > IosRecorder > stopRecordingFail, result:",e)})}function l(){T.dispose(function(e){},function(e){})}function c(e,t){f(),e||a(!!t),S=null,I=null,_encodeDeferred=null,l(),T=null}function d(){}function u(e){S=e&&"function"==typeof e?e:null}function h(){return!(!b||w)}function p(){return h()?[1]:[]}function m(){return 16e3}function f(){C&&(window.clearInterval(C),C=null)}function g(){return!1}var v,T,b=!1,w=!1,y=function(e){var t=e;if("string"!=typeof t||t.length<=0){t="";var n,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(n=0;n<8;n++)t+=i.charAt(Math.floor(Math.random()*(0===n?i.length-10:i.length)))}return t}(),S=null,C=null,N=50,_=1,E=3,I=$.Deferred();try{T=new AudioRecorder,function(){T&&T.init(function(e){n()},function(e){console.log("ERROR > IosRecorder > initFail")})}()}catch(e){console.error("error creating AudioRecorder. probably because not in TN8 client"),I.resolve()}return{initDeferred:I,startRecording:i,stopRecording:r,setRecordingCallback:u,deleteRecordedFile:a,getRawData:p,getSampleRate:m,hasRawData:h,onAudioRemoved:d,encodeM4AB64:s,finalize:c,usingMediaRecorder:g}}return e}),n("js-player",[],function(){function e(e,t,n,i,o){function r(){var e=w();return!isNaN(e)&&e>0}function s(){C.off("timeupdate",d),r()?o.animPlaybackMarker("play"):C.on("timeupdate",d),o.onPlaybackStart()}function a(){C.off("timeupdate",d),o.onPlaybackStop()}function l(){C.off("timeupdate",d),o.onPlaybackEnd()}function c(){N.error.code,N.error.message}function d(){r(),N.duration,r()&&(C.off("timeupdate",d),o.animPlaybackMarker("play"))}function u(){C.off("timeupdate",d),N.pause(),N.currentTime=0,
o.onPlaybackStop(),o.setState("stop")}function h(){v()?f():p(!0)}function p(e,r){C.html("");var s=o.getResponseAudioData();if("string"==typeof s&&s.length>0){t.codec;var a="playBase64";switch(t.codec){case"opus":t.platformInfo.isIdevice&&(a="decodeToWav");break;case"vorbis":t.platformInfo.isIdevice&&(a="none")}"decodeToWav"===a||r?(o.setState("pending"),i.decode(t.codec,s).then(function(t){n.encode("wav","data",t).then(function(t){m(t,!!e)})})):"playBase64"===a?m(s,!!e):o.showPlaybackError()}}function m(e,i){var r,s=Object.prototype.toString.call(e);"[object ArrayBuffer]"===s?r=T("wav",n.encodeB64(new Uint8Array(e))):"[object String]"===s?r=T(t.codec,e):console.error("Audio Recorder > JS Player > prepareForPlayback, data type:",s," is not supported"),r&&r.attr("src")?i?f(r):g(r):o.showPlaybackError()}function f(e){e&&g(e),C.one("canplaythrough",function(){"chrome"===t.platformInfo.browser&&N.duration===1/0?(N.currentTime=S+1,$(this).one("durationchange",function(){N.currentTime=0,N.play(),o.setState("play")})):(N.currentTime=0,N.play(),o.setState("play"))}),N.load()}function g(e){e.on("error",function(e){C[0].networkState===C[0].NETWORK_NO_SOURCE&&("audio/ogg"===$(this).attr("type")?p(!1,!0):o.showPlaybackError(e))}),C.html(e),o.setState("stop")}function v(){var e=C.find("source");return e&&e.length>0&&!!e.attr("src")}function T(e,t){var n=$("<source/>");switch(e){case"opus":n="G"===t.charAt(0)?$('<source src="data:audio/webm;base64,'+t+'" type="audio/webm" />'):$('<source src="data:audio/ogg;base64,'+t+'" type="audio/ogg" />');break;case"vorbis":n=$('<source src="data:audio/ogg;base64,'+t+'" type="audio/ogg" />');break;case"wav":n=$('<source src="data:audio/wav;base64,'+t+'" type="audio/wav" />');break;case"m4a":n=$('<source src="data:audio/x-m4a;base64,'+t+'" type="audio/mp4" />');break;default:console.error("ERROR > AudioRecorder > JSPlayer, unknown codec:",e)}return n}function b(){C.html("")}function w(){var e=0;return v()&&N&&N.duration&&(e=N.duration),e}function y(){C.off(),N&&(N.src=""),C.remove(),C=null,N=null}var S=300,C=$('<audio preload="auto"></audio>').appendTo(e).on("playing",s).on("pause",a).on("ended",l).on("error",c),N=C[0];return{play:h,stop:u,finalize:y,getRecordingDuration:w,hasValidRecordingDuration:r,prepareForPlayback:m,onAudioRemoved:b,setPlaybackData:p}}return e}),function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}}(),n("polyfills/performance-now-polyfill",function(){}),n("flash-player",["./polyfills/performance-now-polyfill"],function(){function e(e,t,n,i,o,r){function s(e){t.recorderId===e.recorderId&&u()}function a(e){if(t.recorderId===e.recorderId){var n=Math.round(100*e.progress);o.setDebugValue({decodeProgress:n+"%"}),o.updateDecodeProgress(n)}}function l(e){t.recorderId===e.recorderId&&(C?m():o.setState("stop"),o.setDebugValue({decodeTime:((window.performance.now()-y)/1e3).toFixed(3)+"s"}))}function c(e){t.recorderId===e.recorderId&&o.setDebugValue({base64DecodeTime:e.base64DecodeTime/1e3+"s"})}function d(){r.stopEither(),u()}function u(){o.setState("stop"),o.onPlaybackStop("stop")}function h(){if(r.hasPlaybackSource())w=r.getRecordingDuration(),m();else{var e=o.getResponseAudioData();("vorbis"===t.codec||"wav"===t.codec)&&"string"==typeof e&&e.length>0?(T(e),y=window.performance.now(),o.updateDecodeProgress(0),w=r.setDataForPlayback(e,t.codec)):o.showPlaybackError()}}function p(e){C=!!e;var n=o.getResponseAudioData();("vorbis"===t.codec||"wav"===t.codec)&&"string"==typeof n&&n.length>0?(T(n),y=window.performance.now(),o.updateDecodeProgress(0),w=r.setDataForPlayback(n,t.codec)):o.showPlaybackError()}function m(){C=!1,r.play(),o.setState("play"),o.onPlaybackStart(),o.animPlaybackMarker("play")}function f(){}function g(){var e=0;return r.hasPlaybackSource()&&w&&(e=w),e}function v(){S&&(S.removeEventListener("flashPlaybackComplete",s),S.removeEventListener("flashDecodeProgress",a),S.removeEventListener("flashDecodeComplete",l),S.removeEventListener("flashBase64DecodeComplete",c)),r&&r.finalize(),S=null,r=null}function T(n){if(t.options.flashAudioDebug){var i=e.find("#aud");0===i.length&&(i=$('<audio id="aud" controls style="margin-top:10px;"></audio>').appendTo(e)),i.html(b(t.codec,n)),i[0].load()}}function b(e,t){var n=$("<source/>");switch(e){case"opus":case"vorbis":n=$('<source src="data:audio/ogg;base64,'+t+'" type="audio/ogg" />');break;case"wav":n=$('<source src="data:audio/wav;base64,'+t+'" type="audio/wav" />');break;case"m4a":n=$('<source src="data:audio/x-m4a;base64,'+t+'" type="audio/mp4" />');break;default:console.error("ERROR > AudioRecorder > JSPlayer, unknown codec:",e)}return n}var w=0,y=0,S=window.TN8.flashRecorder,C=!1;return S.addEventListener("flashPlaybackComplete",s),S.addEventListener("flashDecodeProgress",a),S.addEventListener("flashDecodeComplete",l),S.addEventListener("flashBase64DecodeComplete",c),{play:h,stop:d,finalize:v,getRecordingDuration:g,onAudioRemoved:f,setPlaybackData:p}}return e}),n("../utils/platform-utils",[],function(){"use strict";var e=navigator.userAgent.toLowerCase(),t={};return t.isIdevice=function(){return/iphone|ipad|ipod/i.test(navigator.platform)},t.isAndroid=function(){},t.canTouch=function(){return"ontouchstart"in document.documentElement},t.hasMsTouch=function(){return window.navigator.msPointerEnabled||!1},t.usingSafari=function(){return-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&!this.isIdevice()},t.usingFF=function(){return/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)},t.usingChrome=function(){return/Chrome[\/\s](\d+\.\d+)/.test(navigator.userAgent)},t.isRealize=function(){return!!window.TN8&&!!window.TN8.Realize},t.isTestNav=function(){return!!window.TestEngine&&!t.isRealize()},t.isLinuxOS=function(){return-1!==e.indexOf("linux")&&-1===e.indexOf("android")},t.isMacOS=function(){return"mac"===this.getOS()},t.isAndroidOS=function(){return-1!==e.indexOf("android")&&-1===e.indexOf("cros")},t.isChromeOS=function(){return-1===e.indexOf("android")&&-1!==e.indexOf("cros")},t.isIOS=function(){return/iphone|ipad|ipod/i.test(e)||t.isIdevice()},t.isWindowsOS=function(){return"windows"===this.getOS()},t.getOS=function(){var n;return-1!==e.indexOf("windows")?n="windows":-1===e.indexOf("mac os x")||t.isIOS()?t.isLinuxOS()?n="linux":t.isIOS()?n="ios":t.isAndroidOS()?n="android":t.isChromeOS()&&(n="chrome"):n="mac",n},t.using=function(t){return-1!==e.indexOf(t)},t.getBrowserAndVersion=function(){var e={browser:void 0,version:void 0};return t.using("firefox")?(e.browser="firefox",e.version=t.getVersionUsingRegEx(/firefox[\/\s](\d+\.\d+)/)):t.using("msie")?(e.browser="ie",e.version=t.getVersionUsingRegEx(/msie[\s](\d+\.\d+);/)):t.using("trident")?(e.browser="ie",e.version=t.getVersionUsingRegEx(/rv:(\d+\.\d+)/)):t.using("edge")?(e.browser="edge",e.version=t.getVersionUsingRegEx(/edge[\/\s](\d+\.\d+)/)):t.using("chrome")?(e.browser="chrome",e.version=t.getVersionUsingRegEx(/chrome[\/\s](\d+\.\d+)/)):t.using("safari")&&!t.using("android")&&(e.browser="safari",e.version=t.getVersionUsingRegEx(/version[\/\s](\d+\.\d+)/)),e},t.getVersionUsingRegEx=function(t){var n;try{n=parseInt(t.exec(e)[1],10)}catch(e){}return n},t.getOSVersion=function(){var e=-1;switch(this.getOS()){case"windows":e=this.getVersionUsingRegEx(/windows nt (\d+.\d+)/),6===e&&(e+=1)}return e},t.getInfo=function(){var n,i,o,r=t.getBrowserAndVersion(),s=t.isTestNav(),a=s&&TestEngine._isAppMode();return s?(n=TestEngine.isAndroidOS(),i=TestEngine.isIdevice(),o=TestEngine.isChromeOS()):(n=t.isAndroidOS(),i=t.isIOS(),o=t.isChromeOS()),{userAgent:e,platform:navigator.platform.toLowerCase(),os:t.getOS(),osVersion:t.getOSVersion(),browser:r.browser,version:r.version,testNavMode:s?"testNav":"notTestNav",isAppMode:a,isAndroidOS:n,isIdevice:i,isChromeOS:o,isMacOS:t.isMacOS(),isWindowsOS:t.isWindowsOS(),usingFF:t.usingFF(),usingChrome:t.usingChrome(),isDA:s&&a&&!n&&!i&&!o,securityLevel:s&&TestEngine.getTestDefine()?parseInt(TestEngine.getTestDefine().getTestSecurityLevel(),10):3}},t.isSupported=function(){for(var e=!1,n=t.getInfo(),i=t.supportsRecordingTests[n.testNavMode][n.os],o=0;o<i.length&&!1===e;o++)!0===(0,i[o])(n)&&(e=!0);return t.logPlatformInfo(n,"\n\trecording supported:"+e,!1),e},t.logPlatformInfo=function(e,t,n){t=t||"",e.userAgent,e.platform,e.os,e.browser,e.version,e.testNavMode,e.isAppMode,e.isAndroidOS,e.isIdevice,e.isChromeOS,e.isDA,e.securityLevel},t.supportsRecordingTests={testNav:{windows:[function(e){return e.isDA},function(e){return"firefox"===e.browser&&52===e.version},function(e){return 3===e.securityLevel&&"chrome"===e.browser&&e.version>=50},function(e){return 3===e.securityLevel&&"firefox"===e.browser&&e.version>=52}],mac:[function(e){return e.isDA},function(e){return"firefox"===e.browser&&52===e.version},function(e){return 3===e.securityLevel&&"chrome"===e.browser&&e.version>=50},function(e){return 3===e.securityLevel&&"firefox"===e.browser&&e.version>=52},function(e){return 3===e.securityLevel&&"safari"===e.browser&&e.version>=11}],linux:[function(e){return!1}],chrome:[function(e){return e.version>=43}],android:[function(e){return e.isAndroidOS&&e.isAppMode}],ios:[function(e){return e.isIdevice&&e.isAppMode}]},notTestNav:{windows:[function(e){return"ie"===e.browser&&11===e.version},function(e){return"edge"===e.browser},function(e){return"firefox"===e.browser&&e.version>=45},function(e){return"chrome"===e.browser&&e.version>=43}],mac:[function(e){return"safari"===e.browser&&e.version>=8},function(e){return"firefox"===e.browser&&e.version>=45},function(e){return"chrome"===e.browser&&e.version>=43}],linux:[function(e){return!1}],chrome:[function(e){return"chrome"===e.browser&&e.version>=43}],android:[function(e){return!1}],ios:[function(e){return!1}]}},t}),n("recorder",["./encoder","./decoder","./webrtc-recorder","./flash-recorder","./ios-recorder","./js-player","./flash-player","../utils/platform-utils"],function(e,t,n,i,o,r,s,a){function l(l,c){function d(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||null,Dt=window.location.pathname.indexOf("/tei/")>-1,Mt=window.location.pathname.indexOf("/client/")>-1,Ge=a.getInfo(),zt=a.isSupported(Ge),Me=_e(),Fe=we(),Ce(),At||Ot?je=Tt:navigator.getUserMedia?je=vt:Ge.isIdevice?je=bt:Ge.isIdevice||(je=Tt),m(void 0,"fromInit"),Ue=l.attempts,Ht&&(Ve=l.attempts),De={data:"",answered:!1,codec:Ut},Oe={totalRecordingTime:Ne(l.recordingLength)},l.totalRecordingTime=Oe.totalRecordingTime,l.platformInfo=Ge,l.teiRepo=Dt,l.inClient=Mt,l.hasAudioBaseUrl=!1,l.recorderType=je;var e=window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");window.TN8&&window.TN8.hasOwnProperty("audioBaseUrl")?(l.hasAudioBaseUrl=!0,l.baseURL=window.TN8.audioBaseUrl):l.teiRepo?l.baseURL=window.TN8&&window.TN8.hasOwnProperty("baseUrl")&&window.TN8.baseUrl?window.TN8.baseUrl:e+"/tei/":window.TN8?(l.baseURL=window.TN8.baseUrl?window.TN8.baseUrl:e+"/client/",l.useBlob=Mt):console.error("ERROR! in TN8 client and window.TN8 does not exist"),!0===l.useBlob&&-1===l.baseURL.indexOf("http")&&-1===l.baseURL.indexOf("//")&&(l.baseURL=e+l.baseURL),re(),zt?(je===vt?ke=new n(c,l,this):je===Tt?(At=!0,ke=new i(c,l,this)):je===bt?ke=new o(c,l):(console.error("Recorder init failed, platform not supported."),c.trigger("not-supported.VoiceRecorder"),he(dt)),ke&&(u(!0),ae("pending"),ke.initDeferred.done($.proxy(g,this)))):(c.trigger("not-supported.VoiceRecorder"),ue())}function u(e){$(document).off("record-start.VoiceRecorder playback-start.VoiceRecorder",h),e&&$(document).on("record-start.VoiceRecorder playback-start.VoiceRecorder",h)}function h(e,t){Me!==t&&I()}function p(e){l.base64Encoding=e}function m(e,t){t=t||"";var n="testNav"===Ge.testNavMode||Dt?"opus":"vorbis";return e?n=e:Bt&&""!==Bt?n=Bt:je===Tt?n="wav":je===bt&&(n="m4a"),Ut=l.codec=n,Pt="opus"===Ut||"vorbis"===Ut,n}function f(e){he(ut)}function g(n){if(xe=new e(c,l),Re=new t(c,l),l.allowReview&&("ActiveXObject"in window||je===Tt?(Ae=new s(c,l,xe,Re,this,n),Ot=!0):Ae=new r(c,l,xe,Re,this)),ae("init"),$(document).off("tn.ews.on tn.error.fatal timerTimeout",I),$(document).on("tn.ews.on tn.error.fatal timerTimeout",I),$(document).one("tn.nav.start",function(){St=!0}),l.recordingOptions.sampleRate||(l.recordingOptions.sampleRate=ke.getSampleRate()),$(document).on("Used.JWPlayerAudio Used.JWPlayerVideo",$.proxy(Z,this)),_t){var i=$('<div class="debug"><label>Encode Time:<span class="encode"></span></label><label>Decode Time:<span class="decode"></span></label><label>Audio duration:<span class="audio"></span></label><label>Progressive Encode:<span class="progressive"></span></label><label>Quick Playback:<span class="quick-playback"></span></label><label>Flash Record:<span class="flash-record"></span></label><label>Flash Playback:<span class="flash-playback"></span></label></div>').appendTo(c);le("progressive",Pt),le("quick-playback",kt),le("flash-record",At),le("flash-playback",Ot),kt&&Ot&&i.find(".decode").parent().remove()}}function v(){return De.answered}function T(){var e=!1;De&&!0===De.answered?e=!0:ye()&&(oe()||Se())?(Et=!0,k()):oe()?(Et=!0,A()):e=!0;var t=["recorderId","blob"];e&&($.each(t,function(e,t){De.hasOwnProperty(t)&&delete De[t]}),0===l.attempts?(delete De.remainingAttempts,delete De.remainingOverrideAttempts):(De.remainingAttempts=Ue,Ht&&(De.remainingOverrideAttempts=Ve)),De.totalAttemptsUsed=Ct,$(document).trigger("TN8.Application.RecorderResponse",[Fe,De]),Et=!1,It&&"pending"===It.state()&&It.reject())}function b(e){var t=!!e&&e.hasOwnProperty("data")&&e.hasOwnProperty("answered")&&"[object Object]"===Object.prototype.toString.call(e);return t&&(De={data:"",answered:!1,codec:Ut},e.data&&e.data.length>0&&(De.data=e.data,De.answered=!0),e.hasOwnProperty("remainingOverrideAttempts")&&null!==e.remainingOverrideAttempts&&(Ve=e.remainingOverrideAttempts),e.hasOwnProperty("remainingAttempts")&&(Ue=e.remainingAttempts),Ht?rt.text(ht+Ve):rt.text(ht+Ue),e.hasOwnProperty("totalAttemptsUsed")&&(Ct=e.totalAttemptsUsed),e.hasOwnProperty("codec")&&(De.codec=m(e.codec,"fromSetResponse"))),ke&&ke.initDeferred&&"resolved"!==ke.initDeferred.state()?void ke.initDeferred.done($.proxy(w,this,t,e)):void w(t,e)}function w(e,t){var n=l.platformInfo.isIdevice,i=t.codec;I(),zt?t.answered&&(n&&"m4a"!==i||!n&&"m4a"===i)?ue(!0):t.answered&&(te(!0),Ae?(ae("pending"),Ae.setPlaybackData()):(ae("stop"),me("stop"))):ue(e&&t.data.length>0)}function y(e){var t;return ie(e)&&(t="blob"===e?De.blob:De.data),t}function S(){le("audio",$e(!1).toFixed(3)),c.trigger("playback-start.VoiceRecorder",Me)}function C(){ae("stop")}function N(){fe("reset"),c.trigger("playback-stop.VoiceRecorder")}function _(){return je}function E(){z(),window.clearTimeout(We),$(document).off("tn.ews.on tn.error.fatal timerTimeout",I),u(!1),$(document).off("Used.JWPlayerAudio Used.JWPlayerVideo",$.proxy(Z,this)),$.each([ke,xe,Re,Ae],function(e,t){t&&t.finalize&&t.finalize()}),$.each([c,Je,Xe,at,lt],function(e,t){t&&t.off&&"function"==typeof t.off&&t.off()}),It=null,ke=null,xe=null,Re=null,Ae=null,Pe=null,Be=null,l=null}function I(){switch(Vt){case"record":k();break;case"play":F()}}function x(){return ke}function R(){ae("pending"),c.trigger("record-pending.VoiceRecorder",Me),le("encode",""),le("audio",""),te(),l.recordingOptions.hasOwnProperty("sampleRate")||(l.recordingOptions.sampleRate=ke.getSampleRate()),ke.startRecording(),W()}function k(){window.clearTimeout(We),je===bt&&null!==Nt&&window.clearTimeout(Nt),Nt=null,Pe.width=Pe.width,ke.stopRecording(),ve(Pe.getContext("2d")),ae("stop"),c.trigger("record-stop.VoiceRecorder",Me),xt=window.performance.now(),Ae&&je===vt&&!P(Ut)&&(ae("pending"),xe.encode("wav","data",ke.getRawData()).then(function(e){Ae.prepareForPlayback(e,void 0,window.performance.now()),ae("stop")})),oe()?A():Se()?ae("pending"):Ue<0&&0!==l.attempts?H():(ae("reset"),Et&&(T(),Et=!1)),ze&&z()}function A(){switch(je){case vt:case Tt:if(D(Ut)){xe.encode(Ut,"b64",void 0,!0,!0);var e=function(e,t){$t=null,L(e)},t=function(){te(!0),Et?(T(),Et=!1):ae("reset")};$t&&$t.then(e,t)}else xe.encode(l.codec,"b64",[ke.getRawData()]).then(L);break;case bt:It=ke.encodeM4AB64().then(L)}}function O(e,t){t?L(t):(ae("reset"),Et&&(T(),Et=!1))}function L(e){""!==e&&(le("encode",((window.performance.now()-xt)/1e3).toFixed(3)),te(!0),c.trigger("audio-encoded.VoiceRecorder"),De={data:e,answered:!0,codec:l.codec},Et&&(T(),Et=!1),l&&(Ae&&P(Ut)?Ae.prepareForPlayback(e):ae("stop"),ne()))}function P(e){var t=!0;switch(e){case"opus":case"vorbis":Ge.isIdevice&&(t=!1)}return t}function D(e){var t=!1;switch(e){case"opus":case"vorbis":t=!0}return t}function M(){l.recordingOptions.hasOwnProperty("sampleRate")||(l.recordingOptions.sampleRate=ke.getSampleRate()),Ae&&(c.trigger("playback-pending.VoiceRecorder",Me),Ae.play())}function F(){Ae&&Ae.stop()}function B(){c.trigger("record-start.VoiceRecorder",Me),At?c.one("flashReceivedInput",Y):window.setTimeout(Y,1e3),J(),je===bt&&(Nt=window.setTimeout(k,Oe.totalRecordingTime)),ae("record")}function U(e,t){var n=t;if(q(3*Ee(n)),D(Ut)&&!Se()){var i=xe.encode(Ut,"b64",[n],!0,!1);void 0!==i&&($t=i)}}function V(e){ye()&&!He&&0===e?(He=!0,j()):0!==e&&z()}function j(){window.clearTimeout(ze),ze=window.setTimeout(H,3e3)}function z(){window.clearTimeout(ze),He=!1}function W(){window.clearTimeout(We),We=window.setTimeout(H,3e3)}function H(){$(document).trigger("mic-error-fatal.VoiceRecorder",Fe)}function G(e,t){q(t/100)}function q(e){Oe.startTime||(Oe.startTime=window.performance.now(),Oe.intervalTime=Oe.startTime,Oe.micMuteIntervalTime=Oe.startTime),"record"===Vt&&W();var t=window.performance.now()-Oe.intervalTime;t>=17&&(Oe.intervalTime=t+Oe.intervalTime,ge(),Te(Pe.getContext("2d"),e)),wt+=e,yt++;var n=window.performance.now()-Oe.micMuteIntervalTime;n>=50&&(wt/=yt,yt=0,Oe.micMuteIntervalTime=n+Oe.micMuteIntervalTime,wt<1e-5&&(wt=0),V(wt))}function Z(e,t){switch(t.attr){case"buffer":case"play":case"playlistItem":"play"===t.attr&&(Ft=!0),J();break;case"pause":case"idle":Ft&&(Ft=!1,Y())}}function J(){Je.attr({"aria-disabled":!0,tabindex:-1}),Je.off(Wt,K)}function Y(){Je.removeAttr("aria-disabled"),Je.removeAttr("tabindex"),Je.off(Wt),Je.on(Wt,K)}function K(e){if(St)return e.stopPropagation(),void e.preventDefault();switch("touchend"===e.type&&e.preventDefault(),Vt){case"record":k();break;case"play":F();break;case"stop":ae("pending"),M();break;case"init":case"allowed":case"reset":R()}}function X(e){"touchend"===e.type&&e.preventDefault(),de(!0)}function Q(e){e&&"touchend"===e.type&&e.preventDefault(),F(),te(),ae("reset"),de(!1)}function ee(e){"touchend"===e.type&&e.preventDefault(),de(!1)}function te(e){xe&&xe.terminateAll(),Re&&Re.terminateAll(),ke&&ke.onAudioRemoved(),Oe&&Oe.hasOwnProperty("startTime")&&delete Oe.startTime,!0!==e&&(Ae&&Ae.onAudioRemoved&&Ae.onAudioRemoved(),m(void 0,"fromRemoveAudio"),De={data:"",answered:!1,codec:Ut},ne())}function ne(){l.micCheck||$(document).trigger("ItemResponseChanged")}function ie(e){var t=De&&De.hasOwnProperty("data")&&"string"==typeof De.data&&De.data.length>0;return"blob"===e&&(t=t&&De.hasOwnProperty("blob")&&"[object Blob]"===Object.prototype.toString.call(De.blob)),t}function oe(){return!!ke&&ke.hasRawData()}function re(){c.addClass("tn8-recorder"),c.on("audioinput",U).on("audioenabled",B).on("micSampleData",G).on("audioEncodedToB64",O),qe=$('<div class="main"></div>').appendTo(c),Je=$('<button class="control-button btn"><div class="btn-icon"></div></button>').appendTo(qe).on(Wt,K),Ze=$('<div class="spinner"></div>').appendTo(qe),Ye=Je.find(".btn-icon"),nt=$('<div class="status-display"></div>').appendTo(qe),it=$('<div class="speaker-icon"></div>').appendTo(nt).hide(),ot=$('<div class="message">'+ct+"</div>").appendTo(nt).hide(),rt=$('<div class="attempts">'+ht+l.attempts+"</div>").appendTo(nt).hide(),Xe=$('<button class="clear-button btn"><i class="icon-trash" style="line-height:16px"></i></button>').appendTo(qe).hide().on(Wt,X),Ke=$('<canvas class="input-meter" />').appendTo(qe),Pe=Ke[0],Pe.width=28,Pe.height=40,Qe=$('<div class="progress"><div class="bar reset"></div><div class="marker"></div></div>').appendTo(c),et=Qe.find(".bar"),tt=Qe.find(".marker"),st=$('<div class="delete-dialog"><div class="delete-message">'+pt+'</div><div class="button-holder"></div>').appendTo(c).hide();var e=st.find(".button-holder");at=$('<button class="cancel-button btn">'+mt+"</button>").appendTo(e).on(Wt,ee),lt=$('<button class="confirm-button btn">'+ft+"</button>").appendTo(e).on(Wt,Q)}function se(){return Vt}function ae(e){switch(jt=Vt,Vt=e,Je.removeClass("visibily-hidden"),Je.show(),Xe.hide(),Ke.hide(),Ze.hide(),e){case"init":case"denied":case"allowed":case"reset":ce("record"),"reset"===e&&(J(),et.css("width","100%"),et.one("transitionend",function(){Ft||Y(),c.trigger("reset-complete.VoiceRecorder",Me)}.bind(this))),me("reset");break;case"record":Ke.show(),me("play"),ce("stop");break;case"play":ce("stop");break;case"stop":me("stop"),"record"===jt&&0!==l.attempts&&(Ue>0&&Ue--,Ht&&Ve--,Ct++),l.allowReview?(Y(),ce("play"),Xe.toggle(Ue>0||0===l.attempts||Ht&&Ve>0)):Ue>0||0===l.attempts||Ht&&Ve>0?(ce("record"),Je.addClass("visibily-hidden"),Xe.show()):he(ct);break;case"pending":Je.hide(),Ze.show()}ot.hide(),rt.hide(),ye()?(c.addClass("recording"),Je.addClass("btn-inverse")):(c.removeClass("recording"),Je.removeClass("btn-inverse"),De&&(!0===De.answered||oe())&&ot.show(),l.attempts>1&&(rt.show(),Ht?rt.text(ht+Ve):rt.text(ht+Ue))),it.toggle(ye())}function le(e,t){_t&&c.find("."+e).text(t)}function ce(e){Ye.removeClass("play pause record stop").addClass(e)}function de(e){(e?et.addClass:et.removeClass).call(et,"visibily-hidden"),st.toggle(e)}function ue(e){he(e?ut:dt),qe.removeClass("complete"),Je.removeClass("visibily-hidden"),J(),ce(e?"play":"record"),Qe.show(),rt.hide(),Xe.hide()}function he(e){qe.addClass("complete"),Je.addClass("visibily-hidden"),Ze.hide(),c.removeClass("recording"),Qe.hide(),Xe.hide(),rt.hide(),ot.html(e).show(),e===ut&&0!==l.attempts&&(Ue>0||Ht&&Ve>0)&&(Xe.show(),l.attempts>1&&rt.show())}function pe(e){0===e&&(et.removeClass("playing stopped reset decoding"),et.addClass("decoding")),et.css("width",e+"%")}function me(e){switch(et.removeClass("playing stopped reset decoding"),et.css("width",""),e){case"play":et.attr("style",Ie().join(":"+$e(!0)+"s;")).addClass("playing");break;case"stop":et.addClass("stopped");break;case"reset":et.addClass("reset")}}function fe(e){switch(tt.removeClass("playing reset"),e){case"play":var t=Ie().join(":"+$e(!1)+"s;");tt.attr("style",t).addClass("playing");break;case"reset":tt.addClass("reset")}}function ge(){(Le=Oe.intervalTime-Oe.startTime)/Oe.totalRecordingTime*100>=100&&(Le=Oe.totalRecordingTime,k())}function ve(e){e.clearRect(0,0,Pe.width,Pe.height)}function Te(e,t){ye()&&(ve(e),be(e,t))}function be(e,t){t>.05&&(e.fillStyle="#30F07C",e.save(),e.globalAlpha=.4,e.fillRect(0,35,28,3),t>.15&&(e.restore(),e.globalAlpha=.5,e.fillRect(0,30,28,3),t>.25&&(e.restore(),e.globalAlpha=.65,e.fillRect(0,25,28,3),t>.35&&(e.restore(),e.globalAlpha=.85,e.fillRect(0,20,28,3),t>.45&&(e.restore(),e.fillStyle="#30E67C",e.fillRect(0,15,28,3),t>.55&&(e.fillStyle="#FCEE21",e.fillRect(0,10,28,3),t>.65&&(e.fillStyle="#F7931E",e.fillRect(0,5,28,3),t>.85&&(e.fillStyle="#F15A24",e.fillRect(0,0,28,3)))))))))}function we(){var e=c.attr("data-identifier");return void 0===e&&(e=c.attr("responseIdentifier")),e}function ye(){return"record"===Vt}function Se(){return je===vt&&ke.usingMediaRecorder()}function Ce(){var e={attempts:1,recordingLength:120,allowReview:!1,codec:Ut,recorderId:Me,spxQuality:9,vorbisQuality:0,teiRepo:!1,useBlob:!1,wavbitrate:16,recordingOptions:{bufferSize:2048,numInputChannels:1,numOutputChannels:1,encoderSampleRate:48e3},options:{micGain:25,oggPlayback:!0}};l.options=l.options||{},Rt&&$.each(l.options,function(e,t){switch(e){case"quickPlayback":kt=t;break;case"flashRecord":At=t;break;case"flashPlayback":Ot=t;break;case"useFlashEncoding":Lt=t;break;case"progressiveEncode":Pt=t;break;case"codec":Ut=Bt=t}}),l=$.extend(!0,{},e,l)}function Ne(e){var t=parseInt(e);return isNaN(t)&&(t=gt),1e3*Math.min(gt,t)}function _e(){var e=c.attr("id"),t=0;"string"!=typeof e&&e.length<=0&&(e="",t=8);var n,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*(0===n?i.length-10:i.length)));return e}function Ee(e){for(var t=0,n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t/e.length)}function $e(e){var t=Le/1e3;return e?t=Oe.totalRecordingTime/1e3:Ae&&Ae.getRecordingDuration()>0&&(t=Ae.getRecordingDuration()),t}function Ie(){return["-webkit-transition-duration","-moz-transition-duration","-o-transition-duration","transition-duration",""].slice(0)}var xe,Re,ke,Ae,Oe,Le,Pe,De,Me,Fe,Be,Ue,Ve,je,ze,We,He,Ge,qe,Ze,Je,Ye,Ke,Xe,Qe,et,tt,nt,it,ot,rt,st,at,lt,ct=$.i18n?$.i18n.t("audioRecorder:recordingComplete"):"Recording complete.",dt='<i class="icon-warning-sign before-text"></i>'+($.i18n?$.i18n.t("audioRecorder:recordingNotSupported"):"Your device does not support recording audio."),ut='<i class="icon-warning-sign before-text"></i>'+($.i18n?$.i18n.t("audioRecorder:playbackNotSupported"):"Your device does not support audio playback."),ht=($.i18n?$.i18n.t("audioRecorder:remainingAttempts"):"Remaining attempts:")+" ",pt='<i class="icon-warning-sign before-text"></i><span>'+($.i18n?$.i18n.t("audioRecorder:deleteRecording"):"Delete the current recording?")+"</span>",mt='<i class="icon-ban-circle before-text"></i>'+($.i18n?$.i18n.t("cancel"):"Cancel"),ft='<i class="icon-trash before-text"></i>'+($.i18n?$.i18n.t("delete"):"Delete"),gt=300,vt=1,Tt=2,bt=3,wt=0,yt=0,St=!1,Ct=0,Nt=null,_t=!1,Et=!1,$t=null,It=null,xt=0,Rt=!0,kt=!0,At=!1,Ot=!1,Lt=!1,Pt=!0,Dt=!1,Mt=!1,Ft=!1,Bt="",Ut="",Vt=null,jt=null,zt=!1,Wt="touchend click",Ht=TestEngine.getAuthentication().getSession().getUnsubmitted();return{initialize:d,getResponseData:T,setResponseData:b,isAnswered:v,finalize:E,onPlaybackStart:S,onPlaybackStop:N,onPlaybackEnd:C,startRecord:R,stop:I,getState:se,setState:ae,getResponseAudioData:y,getRecorder:x,getRecorderType:_,setDebugValue:le,showPlaybackError:f,animPlaybackMarker:fe,confirmDelete:Q,setBase64Encoding:p,updateDecodeProgress:pe,setAsUnsupportedPlatfrom:ue,triggerMicFailureError:H,WEBRTC:vt,FLASH:Tt,CORDOVA:bt}}return l}),n("jquery.widget.recorder",["./recorder"],function(e){$.widget("pearson.recorder",{_createdTime:null,_startRecordingTime:null,_endRecordingTime:null,_create:function(){this._recorder=new e(this.options,this.element),this.element.on("record-start.VoiceRecorder",$.proxy(this._handleRecordingStart,this)),this.element.on("record-stop.VoiceRecorder",$.proxy(this._handleRecordingStop,this)),this.element.on("not-supported.VoiceRecorder",$.proxy(this._handleNotSupported,this)),this._recorder.initialize(),this._createdTime=Date.now()},getResponseData:function(){this._recorder.getResponseData()},deleteRecording:function(){this._recorder.confirmDelete()},setResponseData:function(e){this._recorder.setResponseData(e)},getAnswered:function(){return this._recorder.isAnswered()},getRecorder:function(){return this._recorder},stop:function(){this._recorder.stop()},setBase64Encoding:function(e){this._recorder.setBase64Encoding(e)},destroy:function(){if(this._stopRecordingTime){var e=(Date.now()-this._stopRecordingTime)/1e3;this._recordAnalytics("PostRecordingTime",e)}this.element.off(".VoiceRecorder"),this._recorder.finalize(),$.Widget.prototype.destroy.call(this)},_handleRecordingStart:function(e){this._startRecordingTime=Date.now();var t=(this._startRecordingTime-this._createdTime)/1e3;this._recordAnalytics("PreRecordingTime",t)},_handleRecordingStop:function(e){this._stopRecordingTime=Date.now();var t=(this._stopRecordingTime-this._startRecordingTime)/1e3;this._recordAnalytics("RecordingTime",t)},_handleNotSupported:function(e){this._recordAnalytics("NotSupported","")},_recordAnalytics:function(e,t){window.ga&&(t=Math.round(t),ga("send","event","VoiceRecorder",e,"",t),console.log("ga analytics: action = "+e+", value = "+t))}})}),t("jquery.widget.recorder")}()}(this),define("javascripts/jquery.widget.recorder.min",function(){}),define("views/MicCheck",["javascripts/backbone-min","utils","require","text!tpl/combined.html","javascripts/jquery.widget.recorder.min"],function(e,t,n,i){"use strict";var o=e.View.extend({initialize:function(e){this.el=document.getElementById("content"),this.$el=$(this.el),this.template=_.template($(i).filter("#micCheckTemplate").html()),this.appended=!1,this.finished=e,this.boundCleanBetweenRuns=this.cleanBetweenRuns.bind(this),$(document).off("cleanup.betweenTest",this.boundCleanBetweenRuns).on("cleanup.betweenTest",this.boundCleanBetweenRuns),window.TN8||(window.TN8={})},render:function(){this.$el.html(this.template());var e=this,t=navigator.userAgent.toLowerCase(),n=TestEngine&&TestEngine._isAppMode(),i=$("body").hasClass("ipad"),o=t.indexOf("linux")!==-1&&t.indexOf("android")===-1,r=i&&$("body").hasClass("safari")&&!n,s=$("body").hasClass("ie11"),a=$("body").hasClass("edge"),l=$("body").hasClass("safari")&&!i&&parseInt(t.match(/Version\/(.*?)\./i)[1])>=12,c=o||s||a||r||l;return $(".tn8-mic-check-reset").click(function(){$(this).hasClass("disabled")||e.reset()}),$(".tn8-mic-check-help").click(function(){$(this).hasClass("disabled")||($(".tn8-mic-check-gethelp").removeClass("hidden"),$(".tn8-mic-check-container").addClass("hidden"))}),$(".tn8-mic-check-goback").click(function(){$(".tn8-mic-check-gethelp").addClass("hidden"),$(".tn8-mic-check-container").removeClass("hidden")}),c?($(".tn8-mic-error-unsupported").removeClass("hidden"),$(".tn8-mic-set-up-btn").addClass("disabled")):$(".tn8-mic-set-up-btn").click(function(){var t=function(t){window.stream=t;var n=$(".tn8-mic-check-mics")[0],o=!1,r=function(){$(".recorder").on("playback-pending.VoiceRecorder",function(){$(".tn8-mic-check-help").addClass("disabled"),$(".tn8-mic-check-reset").addClass("disabled"),i&&($(".tn8-mic-check-yes").addClass("disabled"),$(".tn8-mic-check-no").addClass("disabled"))}),$(".recorder").on("playback-start.VoiceRecorder",function(){$(".tn8-mic-check-btns-container").removeClass("hidden"),$(".tn8-mic-check-prompt.stop").addClass("hidden"),$(".tn8-mic-check-prompt.play").removeClass("hidden"),$(".tn8-mic-check-question-icon").removeClass("hidden"),$(".tn8-mic-check-headphones-icon").addClass("hidden"),$(".tn8-mic-check-yes").removeClass("disabled"),$(".tn8-mic-check-no").removeClass("disabled")}),$(".recorder").on("playback-stop.VoiceRecorder",function(){o||($(".tn8-mic-check-help").removeClass("disabled"),$(".tn8-mic-check-reset").removeClass("disabled"))}),$(".recorder").on("record-pending.VoiceRecorder",function(){$(".tn8-mic-check-help").addClass("disabled"),$(".tn8-mic-check-reset").addClass("disabled")}),$(".recorder").on("record-start.VoiceRecorder",function(){$(n).css("opacity",.75),n.setAttribute("disabled",!0),$(".tn8-mic-check-tryagain").addClass("hidden")}),$(".recorder").on("record-stop.VoiceRecorder",function(){$(".tn8-mic-check-prompt.record").addClass("hidden"),$(".tn8-mic-check-prompt.stop").removeClass("hidden"),$(".tn8-mic-check-headphones-icon").removeClass("hidden"),$(".tn8-mic-check-speak-icon").addClass("hidden"),$(".tn8-mic-check-help").removeClass("disabled"),$(".tn8-mic-check-reset").removeClass("disabled")}),$(".recorder").on("reset-complete.VoiceRecorder",function(){$(".tn8-mic-check-help").removeClass("disabled"),$(".tn8-mic-check-reset").removeClass("disabled"),o=!1})};$(".tn8-mic-check-yes").one("click",function(){$(this).hasClass("disabled")||($(".recorder").recorder("stop"),e.removeDeviceChangeListener(),e.finished())}),$(".tn8-mic-check-no").on("click",function(){
$(this).hasClass("disabled")||(o=!0,$(".tn8-mic-check-help").addClass("disabled"),$(".tn8-mic-check-reset").addClass("disabled"),$(".recorder").recorder("stop"),$(".recorder").recorder("deleteRecording"),n.removeAttribute("disabled"),$(n).css("opacity",1),$(".tn8-mic-check-prompt.record").removeClass("hidden"),$(".tn8-mic-check-prompt.play").addClass("hidden"),$(".tn8-mic-check-prompt.stop").addClass("hidden"),$(".tn8-mic-check-btns-container").addClass("hidden"),$(".tn8-mic-check-tryagain").removeClass("hidden"),$(".tn8-mic-check-question-icon").addClass("hidden"),$(".tn8-mic-check-speak-icon").removeClass("hidden"))}),$(n).on("change",function(){$(document).trigger("micCheck.micSelected"),e.stopStreamTracks(),$(".recorder").recorder("destroy"),$(".recorder").empty(),window.TN8.MicDeviceId=$(this).val(),e.createRecorder(),r()}),$(".tn8-mic-set-up-container").addClass("hidden");var s=0;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?(navigator.mediaDevices.ondevicechange=function(t){e.getMics().then(function(t){e.selectedMicDisconnected(t)&&navigator.mediaDevices.ondevicechange?(e.reset(),$(".tn8-mic-error-dc").removeClass("hidden"),TN8.log("Microphone was disconnected")):e.buildMicDropdown(t)})},e.getMics().then(function(t){s=t.length,s?(e.stopStreamTracks(),TN8.log(t,TN8.IMPORTANT),e.buildMicDropdown(t),window.TN8.MicDeviceId=t[0].deviceId,e.createRecorder(),r(),$("#jGrowl").find(".jGrowl-error").remove(),$(".tn8-mic-check-container").removeClass("hidden")):(TN8.log("MicCheck Error: No mic detected!",TN8.CRITICAL),e.showHelpWithError())})):(e.createRecorder(),r(),$(n).addClass("hidden"),$(".tn8-mic-check-container").removeClass("hidden"),$(".tn8-mic-select-label").addClass("hidden")),$(".tn8-mic-check-diag").removeClass("hidden")},n=function(t){TN8.log("MicCheck Error requesting mic access: "+t,TN8.CRITICAL),e.showHelpWithError()},o={audio:!0,video:!1};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(o).then(t).catch(n):navigator.getUserMedia?navigator.getUserMedia(o,t,n):$("body").hasClass("ipad")&&t()}),$(document).trigger("tn.micCheck.render",[$.i18n.t("micCheck:micCheck")]),this},showHelpWithError:function(){$(".tn8-mic-check-container").addClass("hidden"),$(".tn8-mic-set-up-container").addClass("hidden"),$(".tn8-mic-check-diag").removeClass("hidden"),$(".tn8-mic-check-gethelp").removeClass("hidden"),$(".tn8-mic-check-gethelp .tn8-mic-check-goback").addClass("hidden"),$(".tn8-mic-check-gethelp .tn8-mic-check-reset").removeClass("hidden"),$(".tn8-mic-error-checksys").removeClass("hidden")},getMics:function(){return new Promise(function(e,t){navigator.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"audioinput"===e.kind&&"default"!==e.deviceId&&"communications"!==e.deviceId}),e(t)}).catch(function(e){t(e)})})},selectedMicDisconnected:function(e){for(var t in e)if(TN8.MicDeviceId===e[t].deviceId)return!1;return!0},buildMicDropdown:function(e){var t=$(".tn8-mic-check-mics")[0];t.blur(),$(t).empty(),e.forEach(function(e){var n=t.options.length;t[n]=new Option(e.label,e.deviceId)})},showGrowl:function(e){$("#jGrowl").find(".jGrowl-error").remove(),$.jGrowl(e,{theme:"jGrowl-error"})},createRecorder:function(){var e={id:"tn8-recorder-miccheck",recordingLength:7,attempts:0,allowReview:!0,micCheck:!0};$(".recorder").recorder(e)},stopStreamTracks:function(){window.stream&&window.stream.getTracks().forEach(function(e){e.stop()})},removeDeviceChangeListener:function(){navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=null)},reset:function(){this.removeDeviceChangeListener(),this.stopStreamTracks(),this.template=_.template($(i).filter("#micCheckTemplate").html()),$(".tn8-allow-popup-overlay").remove(),this.appended=!1,$(navigator.mediaDevices).off(),this.render()},cleanBetweenRuns:function(){this.removeDeviceChangeListener(),this.stopStreamTracks(),$(navigator.mediaDevices).off(),this.doLog("cleanBetweenRuns"),$(".tn8-mic-check-reset").off(),$(".tn8-mic-check-help").off(),$(".tn8-mic-check-goback").off(),$(".tn8-mic-set-up-btn").off(),$(".recorder").off(),window.TN8&&window.TN8.MicDeviceId&&delete window.TN8.MicDeviceId},doLog:function(){return}});return o}),define("views/tests/test",["javascripts/backbone-min","text!tpl/combined.html","util/shortcuts","controllers/TestStateController","views/TermsAndConditions","views/MicCheck"],function(e,t,n,i,o,r){"use strict";var s=e.View.extend({introTemplate:_.template($(t).filter("#introtemplate").html()),initialize:function(){_.bindAll(this,"render","epatName","startTest","next","destroy")},render:function(){var e=TN8.Application.DataProvider.getStartTestInfo(),t=TN8.Application.DataProvider.getStartPartInfo(TestEngine.getNavigation().getCurrentTestPart().getIdentifier());t.title=void 0,this.info=$.extend(e,t);var n=this.getTranslatedView(this.info);$("#content").html(this.introTemplate(n)),this.appendRubric(),$(document).trigger("perform.addFTListner"),setTimeout(function(){$(document).trigger("tn.testStart.render",this.info.resumed?$.i18n.t("resumeTest"):$.i18n.t("startTest")),$(document).trigger("navigated.startTest"),$(document).trigger("tn.loadingModal.off")}.bind(this),0),$(window).trigger("resize")[0].scrollTo(0,0),$("#home").remove(),$(document).on("cleanup.betweenTest tn.test.start",this.destroy),$("#backAvailableBtn").on("click",this.handleBackToAvailable),this.createStartHandler()},getTranslatedView:function(e){return TestEngine&&TestEngine.getAuthentication&&(e.welcomeMsg=_.escape($.i18n.t("startTest:welcomeMsg",{name:TestEngine.getAuthentication().getRealName()}))),e.totalQuestions=$.i18n.t("startTest:totalQuestions",{count:e.questions}),e.totalSections=$.i18n.t("startTest:totalSections",{count:e.sections}),e.resumed?(e.startBtnText=$.i18n.t("startTest:resumeTestNow"),e.startText=$.i18n.t("startTest:resumeTest")):(e.startBtnText=$.i18n.t("startTest:startTestNow"),e.startText=$.i18n.t("startTest:startTest")),e},appendRubric:function(){if(this.info.isK2)$("#header_right").addClass("k2-userDropdown"),$("#crumbTrail").remove();else{var e=TestEngine.getTestDefine().getRubricblock(),t=e&&(e.body||e);t?($("#content .span12").append('<div id="rubricBlock" tabindex="-1" class="rubricblock-container clearfix">'+t+"</div>"),$("#skipToInstructions > a").click(function(e){e.preventDefault(),$("#rubricBlock").focus()})):$("#skipToInstructions").remove()}},createStartHandler:function(){var e=this.sequence=[],t=this.next,n=this.getTerms();n&&!TN8.TestStateController.getTermsConditionAccepted()&&e.push(function(){o.show(n,t)}),this.info.vsr&&(e.push(this.epatName),$("#studentName").on("input",function(e){var t=!$(this).val().trim();t&&$(this).val(""),$("#startTestBtn").prop("disabled",t)}),$("#studentName").keypress(function(e){var t=e.keyCode||e.which,n=!$(this).val().trim();13!=t||n||$("#TermModal").is(":visible")||($("#startTestBtn").click(),e.preventDefault())})),TN8.utils.isMicCheckOn()&&e.push(function(){new r(t).render()}),TN8.utils.isDynamicTTSOn()&&!TN8.utils.supportsDynamicTTS()&&TN8.throw("",2022),e.push(this.startTest),$("#startTestBtn").on("click",function(t){!$("#TermModal").is(":visible")&&e[0]()}.bind(this))},next:function(){this.sequence.shift(),"function"==typeof this.sequence[0]&&this.sequence[0]()},getTerms:function(){try{var e=JSON.parse(TestEngine.getTestDefine()._sourceJson.tcinfo);return e.tctext3=e.tctext3||$.i18n.t("termsAndConditions:agreementDefault"),e}catch(e){TN8.log("test.js: Failed to parse Terms and Conditions: "+e.msg,TN8.CRITICAL)}},epatName:function(){var e=($("#studentName").val()||"").trim();e?($("#studentName").off("keypress"),TN8.Application.epatStudentName=e,$(document).trigger("epat.name.entered",e),this.next()):TN8.throw("Name Required",TN8.errorType.VSR_NAME_REQUIRE)},startTest:function(){TN8.log(JSON.stringify({currentFormNumber:TestEngine.getAuthentication().getCurrentForm().getNumber(),testId:TestEngine.getNavigation().getTestId(),partId:TestEngine.getNavigation().getCurrentTestPart().getIdentifier(),useragent:navigator.userAgent,clientVersion:TN8.Application.clientVersion},null,"\t"),TN8.CRITICAL),$(document).trigger("tn.loadingModal.on"),n.block("f11"),n.block("f11",!0),$(document).trigger("tn.test.start"),$(document).trigger("inform.testPartDisplayed"),TN8.Application.NavigationController.beginTest()},getSaveToLocation:function(){return"saveTestState"},handleBackToAvailable:function(){$(document).trigger("navigate.availableTest")},destroy:function(){$(document).trigger("perform.removeFTListener"),$("#startTestBtn").off("click"),$("#studentName").off("input"),$(document).off("cleanup.betweenTest tn.test.start",this.destroy)}});return s}),!function(){var e=function(e){function t(e){var t;return t="function"!=typeof e?_[e]:e,t?C.filter(t):C}function n(e){b(),t(e).forEach(function(e){h(e)})}function i(e){if(e){var t=$(e.el).attr("aria-label")?$(e.el).attr("aria-label")+" current item":"";e.selected=!0,$(e.el).addClass("laser-scroll-item-selected"),""!==t&&$(e.el).attr("aria-label",t)}}function o(e){if(e){var t=$(e.el).attr("aria-label")?$(e.el).attr("aria-label"):"";e.selected=!1,$(e.el).removeClass("laser-scroll-item-selected"),""!==t&&$(e.el).attr("aria-label",t.substring(0,t.indexOf(" current item")))}}function r(){y()&&p(),S.show(),m()}function s(){y()&&($(document).off("touchmove.laserscroll pointermove.laserscroll"),$("body").off("touchstart.laserscroll touchmove.laserscroll pointerdown.laserscroll pointermove.laserscroll"),$("body").css("overflow","")),S.hide()}function a(e){setTimeout(function(){e.focus()},0)}function l(e){e.length>0&&(e.addClass("hovered"),(!TN8.deepZoomLayer||window.innerWidth>480)&&e.attr("tabindex",0))}function c(e){e.length>0&&(e.removeClass("hovered"),(!TN8.deepZoomLayer||window.innerWidth>480)&&e.attr("tabindex",-1))}function d(){$(".laser-scroll-item").off("focus",v),$(".laser-scroll-item:first, .laser-scroll-item:last").off("focusout",T),N.off("keydown"),S.find(".laser-scroll-item").off("touchstart pointerdown mousemove mousedown touchend pointerup click mouseover mouseenter mouseleave"),$(document).off("touchmove.laserscroll pointermove.laserscroll"),$("body").off("touchmove.laserscroll pointermove.laserscroll touchstart.laserscroll pointerdown.laserscroll")}function u(){var e=w();N.addClass("laser-scroll-container"),e.addClass("laser-scroll-items"),e.attr("role","menu"),e.css({height:"100%",overflow:"hidden","overflow-y":"scroll","-webkit-overflow-scrolling":"touch"}),N.html(e),S.append(N),N.on("keydown",f),_pixelSize=window.innerWidth*window.innerHeight}function h(e){var t=e.el=E.call(e);if(!TN8.deepZoomLayer||window.innerWidth>480?t.attr({tabindex:-1,role:"menuitem"}):t.attr({tabindex:0,role:"menuitem"}),t.addClass("laser-scroll-item"),$(".laser-scroll-items",S).append(t),"endsection"===e.id&&t.attr({id:"reviewdropdown-endpage"}),t.hasClass("disabled"))t.attr("aria-disabled","true");else{var n,o;t.on("touchstart pointerdown",function(e){c($(".laser-scroll-item",S)),n=!0,o="pointerdown"!==e.type?e.originalEvent.touches[0].screenY:e.originalEvent.screenY}),t.on("mousemove mousedown",function(e){n=!1}),t.on("touchend pointerup",function(t){var n="pointerup"!==t.type?t.originalEvent.changedTouches[0].screenY:t.originalEvent.screenY,i=n-o;0===i&&(S.trigger("LaserScroll.selected",e),t.preventDefault())}),t.on("click",function(t){return n?(t.preventDefault(),!1):void S.trigger("LaserScroll.selected",e)}),t.hover(function(e){if(!TN8.deepZoomLayer||window.innerWidth>480){if(n)return e.preventDefault(),!1;c($(".laser-scroll-item",S)),"mouseenter"===e.type&&l($(this))}}),e.selected&&i(e)}$(".laser-scroll-item").off("focus",v).on("focus",v),$(".laser-scroll-item:first, .laser-scroll-item:last").off("focusout",T).on("focusout",T)}function p(){var e=".laser-scroll-container";$(document).on("touchmove.laserscroll pointermove.laserscroll",function(e){e.preventDefault()}),$("body").on("touchstart.laserscroll pointerdown.laserscroll",e,function(e){0===e.currentTarget.scrollTop?e.currentTarget.scrollTop=1:e.currentTarget.scrollHeight===e.currentTarget.scrollTop+e.currentTarget.offsetHeight&&(e.currentTarget.scrollTop-=1)}),$("body").on("touchmove.laserscroll pointermove.laserscroll",e,function(e){e.stopPropagation()});var t=/iphone|ipad|ipod|android/i.test(navigator.userAgent.toLowerCase());t&&$("body").css("overflow","hidden")}function m(){var e=t("selected")[0];e||(e=t()[0]),a($(e.el))}function f(e){var t=e.which;switch(t){case 9:TN8.deepZoomLayer&&window.innerWidth<=480&&g(e);break;case 35:case 36:case 38:case 40:g(e);break;case 13:case 32:$(".laser-scroll-item:focus",S).click(),e.preventDefault()}}function g(e){var t;35===e.which?t=$(".laser-scroll-item",S).filter(":last"):36===e.which?t=$(".laser-scroll-item",S).filter(":first"):38===e.which||9===e.which&&e.shiftKey?t=$(".laser-scroll-item:focus",S).prevAll().filter(":first"):40!==e.which&&9!==e.which||(t=$(".laser-scroll-item:focus",S).nextAll().filter(":first")),t.length>0&&!t.hasClass("disabled")&&(c($(".laser-scroll-item",S)),l(t)),9!==e.which&&(a(t),e.preventDefault())}function v(e){"focus"!==e.type||$(e.target).hasClass("hovered")||l($(e.target))}function T(e){"focusout"===e.type&&$(e.target).hasClass("hovered")&&c($(".laser-scroll-item",S))}function b(){$(".laser-scroll-items",S).empty()}function w(){return $("<div>").css({margin:0})}function y(){return!!("ontouchstart"in window||navigator.maxTouchPoints>0)}var S,C,N,_,E,I=function(e){return e.selected};return C=e.dataSource,_=e.dataFilters||{},_.selected=I,E=e.itemRenderer,S=e.container,N=w(),u(),{data:t,show:r,hide:s,focusItem:a,highlight:l,unhighlight:c,render:n,select:i,unselect:o,destroy:d}},t=function(){var e=this.unanswered?"visible":"hidden",t=$("<span class='circle-sprite'/>").css({visibility:e}),n=$("<span class='bookmark-sprite'/>"),i=$("<div class='unselectable'>"+this.title+"</div>"),o=this.title;return this.wc||(this.unanswered?o=$.i18n?$.i18n.t("header:notAnsweredAria",{itemName:o}):o+" not answered":this.answered&&(o=$.i18n?$.i18n.t("header:answeredAria",{itemName:o}):o+" answered")),this.flagged&&(o=$.i18n?$.i18n.t("header:bookmarkedAria",{itemName:o}):o+" bookmarked",i.append(n)),this.blocked?i.addClass("disabled").append('<span><i class="icon-lock" role="presentation"></i></span>'):i.append(t),i.attr("aria-label",o),i},n={_create:function(){var n=($(".btn-tn8-review"),this.reviewDropdownEl=$('<div role="application" tabindex="-1" class="review-dropdown"/>')),i=this;this.closeCheck=this.closeCheck.bind(this),this.focusTarget=$(".btn-tn8-review",this.element),$("#firstTabbable").after(n),this.openedAt=(new Date).getTime();var o=this.LS=e({container:n,itemRenderer:t,dataSource:i.options.dataSource,dataFilters:{unanswered:function(e){return e.unanswered},bookmarked:function(e){return e.flagged},items:function(e){return!e.wc&&"endsection"!==e.id}}}),r=this.element.tnOffset(),s=0;$.each(["html","body"],function(e,t){var n=$(t).scrollTop();n>s&&(s=n)}),n.css({top:r.top+this.element.outerHeight()-s,left:r.left}),n.on("LaserScroll.selected",function(e,t){if(t.isLocked)return!1;var n=o.data("selected")[0];o.unselect(n),o.select(t),t.onSelected&&n!==t&&(t.onSelected(),i.close())}),n.on("keydown",function(e){var t=27===e.which||27===e.keyCode,n=t;if(9===e.which&&e.shiftKey&&!i._inDeepZoom()){var o=$(":tabbable"),r=o.index(i.focusTarget);r>0&&r<o.length&&o.get(r-1).focus(),t=!0}t&&!i._inDeepZoom()&&(i.close(),e.preventDefault(),n&&i.focusTarget.focus())}),"popup"==this.options.type?this.setupPopup():n.append(i.renderTabs(n)),o.hide()},show:function(){var e=/android/i.test(navigator.userAgent.toLowerCase()),t=e?500:0;this.addFocusHandlers(),this.renderList(),this.LS.show(),setTimeout(function(){this.toggleResizeHandler(!0)}.bind(this),t),$(document).trigger("deepZoomLayer.getStatus",$.proxy(this._handleDeepZoomStatus,this))},_handleDeepZoomStatus:function(e){e&&this._doDeepZoomCoupling()},_doDeepZoomCoupling:function(e){var t='<i role="presentation" class="icon-list-ul"></i> '+($.i18n?$.i18n.t("header:testOverview"):"Review");$(document).trigger("deepZoomLayer.setCoupling",{title:t,html:this.reviewDropdownEl,hideCallback:$.proxy(this.close,this)})},close:function(){this.LS.hide(),$(document).trigger("tn.reviewdropdown.close"),this.toggleResizeHandler(!1),this.removeFocusHandlers(),$(document).trigger("magnifier.refresh")},closeCheck:function(e){this._inDeepZoom()||setTimeout(function(){var t=this.reviewDropdownEl[0],n=t.contains(e.target),i=this.element[0]===e.target||this.element.has(e.target).length>0;!t||n||i||this.close()}.bind(this),0)},addFocusHandlers:function(){$(document).off("ItemResponseChanged.reviewdropdown tn.error.fatal do.disableInteraction",$.proxy(this.close,this)).on("ItemResponseChanged.reviewdropdown tn.error.fatal do.disableInteraction",$.proxy(this.close,this)),$(document).off("focusLost",$.proxy(this._handleFocusLost,this)).on("focuslost",$.proxy(this._handleFocusLost,this)),document.addEventListener("mousedown",this.closeCheck,!0),document.addEventListener("touchstart",this.closeCheck,!0),this.reviewDropdownEl.on("escape_key_pressed",function(){var e="block"===this.reviewDropdownEl.css("display");e&&(this.close(),this.focusTarget.focus())}.bind(this)),"undefined"!=typeof TN8&&(TN8.EpatBlocker.on(["mousedown","touchstart"],this.closeCheck,!0),TN8.Dispatcher&&TN8.Dispatcher.on("EWSLaunch",this.close,this))},removeFocusHandlers:function(){$(document).off("focuslost ItemResponseChanged.reviewdropdown tn.error.fatal do.disableInteraction",$.proxy(this.close,this)),document.removeEventListener("mousedown",this.closeCheck,!0),document.removeEventListener("touchstart",this.closeCheck,!0),this.reviewDropdownEl.off("escape_key_pressed"),"undefined"!=typeof TN8&&(TN8.EpatBlocker.off(["mousedown","touchstart"],this.closeCheck,!0),TN8.Dispatcher&&TN8.Dispatcher.off("EWSLaunch",this.close,this))},toggleResizeHandler:function(e,t){var n=this.reviewDropdownEl.is('[class*="bookmarked"]')?"bookmarked":this.reviewDropdownEl.is('[class*="unanswered"]')?"unanswered":"review",i=t?["unanswered","bookmarked","review"]:[n];i.forEach(function(t,n){e?$(window).on("resize."+t,$.proxy(this.resizeHandler,this)):$(window).off("resize."+t,$.proxy(this.resizeHandler,this))}.bind(this))},resizeHandler:function(){var e=(new Date).getTime(),t=e-this.openedAt,n=t>80;n&&!this._inDeepZoom()&&this.close()},renderList:function(e){this.LS.render(e),$(".reivew-dropdown-tab",this.element).attr("tabindex",0)},closeMiniMenu:function(){var e=this.reviewDropdownEl.is(":visible");e&&(this.close(),$(document).off("inform.timeoutModalOn tn.ews.on",this.closeMiniMenu))},setupPopup:function(){$(document).off("cleanup.betweenTest",$.proxy(this.removeMiniMenus,this)).on("cleanup.betweenTest",$.proxy(this.removeMiniMenus,this)),this.closeMiniMenu=this.closeMiniMenu.bind(this),this.focusTarget=this.element,this.reviewDropdownEl.addClass("review-dropdown-popup-"+this.options.filter),this.element.css("position","relative"),this.LS.data(this.options.filter).length&&this.element.css("cursor","pointer").attr({role:"button",tabindex:0}),this.element.on("mousedown touchstart",$.proxy(this.toggleMiniMenu,this)),this.element.on("touchend",function(e){e.preventDefault()}),this.element.on("keydown",function(e){32!==e.which&&13!==e.which||($(this).mousedown(),e.preventDefault())}),this.reviewDropdownEl.on("keydown",function(e){this._inDeepZoom()||9===e.which&&(this.close(),e.shiftKey||this.element.focus())}.bind(this))},toggleMiniMenu:function(e){var t=this.LS.data(this.options.filter),n=this.reviewDropdownEl.is(":visible");if(t.length&&!n){this.openedAt=(new Date).getTime(),$(document).on("inform.timeoutModalOn tn.ews.on",this.closeMiniMenu),this.toggleResizeHandler(!0),this.renderList(this.options.filter),this.LS.show(),this.addFocusHandlers(),t[0].blocked||this.LS.highlight(t[0].el),this.LS.focusItem($(t[0].el));var i=this.element.tnOffset();this.reviewDropdownEl.css({top:i.top-this.reviewDropdownEl.outerHeight(),left:i.left-(this.reviewDropdownEl.width()-this.element.width())/2}),$(document).trigger("deepZoomLayer.getStatus",$.proxy(this._handleDeepZoomStatusPopup,this))}else n&&(this.close(),$(document).off("inform.timeoutModalOn tn.ews.on",this.closeMiniMenu));"touchstart"===e.type&&e.preventDefault()},_handleDeepZoomStatusPopup:function(e){e&&this._doDeepZoomCouplingPopup()},_doDeepZoomCouplingPopup:function(){var e;e=this.reviewDropdownEl.hasClass("review-dropdown-popup-unanswered")?$.i18n?$.i18n.t("header:notAnswered"):"Not Answered":$.i18n?$.i18n.t("header:bookmarks"):"Bookmarks",$(document).trigger("deepZoomLayer.setCoupling",{title:e,html:this.reviewDropdownEl,hideCallback:$.proxy(this.close,this)})},_handleFocusLost:function(){this._inDeepZoom()||this.close()},renderTabs:function(e){var t=$('<div role="tablist" class="review-dropdown-tabs"/>'),n=this.renderTab(this.LS.data("items").length,$.i18n?$.i18n.t("header:allQuestions"):"All Questions","first",""),i=this.renderTab(this.LS.data("unanswered").length,$.i18n?$.i18n.t("header:notAnswered"):"Not Answered","middle","unanswered"),o=this.renderTab(this.LS.data("bookmarked").length,$.i18n?$.i18n.t("header:bookmarks"):"Bookmarks","","bookmarked"),r=this;return t.on("keydown",function(e){var t,n=e.which,i=$(this).children().toArray(),o=i.indexOf($(".review-dropdown-tab:focus",this)[0]),s=39===n||37===n||9===n;if(39===n&&o<i.length-1)t=i[++o],s=!0;else if(37===n&&o>0)t=i[--o];else if(9===n)if(e.shiftKey){var a=$(".laser-scroll-item[tabindex=0]",this.parentElement)[0]||$(".laser-scroll-item-selected",this.parentElement)[0]||$(".laser-scroll-item",this.parentElement)[0];a&&(r.LS.highlight($(a)),r.LS.focusItem(a))}else{r.close();var l=$("#btnOverview").next();l.hasClass("hide")&&(l=l.parent().next().find("button")),l.focus()}t&&($(".review-dropdown-tab",this).attr("tabindex",-1),$(t).attr("tabindex",0),$(t).focus()),s&&(e.preventDefault(),e.stopImmediatePropagation())}),n.addClass("active"),n.attr({"aria-selected":!0,tabindex:0}),t.html(n),t.append(i),t.append(o),t},renderTab:function(e,t,n,i){var o=$.i18n?$.i18n.lng():"en",r=$('<div class="review-dropdown-tab lang'+o+' unselectable"><span class="img-text '+n+'">'+e+'</span><p class="tab-text '+n+" lang"+o+'">'+t+"</p></div>"),s=function(e){$(".review-dropdown-tab",e.parentElement).not(e).removeClass("active"),$(".review-dropdown-tab",e.parentElement).not(e).attr({"aria-selected":!1,tabindex:-1}),$(e).addClass("active"),$(e).attr({"aria-selected":!0,tabindex:0}),$(e).focus()},a=this,l=i;""===l&&(l="total");var c=($.i18n?$.i18n.t("header:reviewTabTitle",{tabName:t}):t)+" "+($.i18n?$.i18n.t("header:reviewTab"+l,{count:e}):e+" "+l+" questions.");return r.attr({role:"tab","aria-selected":!1,"aria-label":c,tabindex:-1}),r.css("-webkit-tap-highlight-color","rgba(0,0,0,0)"),r.on("click touchend",function(e){s(this),a.renderList(i)}),r.on("keydown",function(e){32!==e.which&&13!==e.which||$(this).click()}),r},_inDeepZoom:function(){return!(!TN8.deepZoomLayer||!$.contains($("#deepZoomLayerBody")[0],$(".review-dropdown")[0]))},removeMiniMenus:function(){$('div[class*="review-dropdown-popup"]').remove(),$(document).off("cleanup.betweenTest",$.proxy(this.removeMiniMenus,this))},destroy:function(){this.removeFocusHandlers(),this.toggleResizeHandler(!1,!0),this.LS&&this.LS.destroy(),this.reviewDropdownEl.off("keydown LaserScroll.selected"),this.element.off("click touchstart pointerdown keydown touchend"),this.reviewDropdownEl.find(".review-dropdown-tab").off("click touchend keydown"),this.reviewDropdownEl.find(".review-dropdown-tabs").off("keydown"),$(document).off("inform.timeoutModalOn tn.ews.on",this.closeMiniMenu),$(".review-dropdown").not('div[class*="review-dropdown-popup"]').remove(),$.Widget.prototype.destroy.call(this)}};$.widget("pearson.reviewDropdown",n)}(),define("javascripts/jquery.widget.reviewdropdown",["javascripts/jquery-ui.min"],function(){}),define("controllers/ReviewController",["utils","util/shortcuts","javascripts/jquery.widget.reviewdropdown"],function(e,t){var n=function(){return{init:function(){return _.bindAll(this,"_registerEvents","_destroy","_initDropdown","_createDropdown","_toggleDropdown"),this._registerEvents(),this},_registerEvents:function(){TN8.fnOn("tn.header.render.complete",this._initDropdown),TN8.fnOn("cleanup.betweenTest",this._destroy),TN8.fnOn("tn.ews.on",this._closeDropdown),TN8.fnOn("inform.timeoutModalOn",this._closeDropdown),$(document).on("tn.reviewdropdown.close",$.proxy(this._handleReviewClose,this))},_getJsonReady:function(){return TN8.Application.DataProvider.getOverviewRows()},_initDropdown:function(){var e=this,t=$(".btn-tn8-review");t.keydown(function(t){return 40!==t.which||$(this).hasClass("disabled")?void(9===t.which&&e._closeDropdown()):(e._createDropdown(),$("#btnOverview").reviewDropdown("show"),$(this).addClass("active"),t.preventDefault(),!1)}),t.off("click touchstart touchend"),t.on("click touchstart",this._toggleDropdown),t.on("touchend",this._cancelClick)},_handleReviewClose:function(){$(".btn-tn8-review").removeClass("active"),$("#btnOverview").attr("aria-expanded",!1),t.block("home"),t.block("end")},_toggleDropdown:function(e){$(".btn-tn8-review").hasClass("disabled")||($(".btn-tn8-review").hasClass("active")?this._closeDropdown():($(".btn-tn8-review").addClass("active"),this._createDropdown(),$("#btnOverview").attr("aria-expanded",!0),$("#btnOverview").reviewDropdown("show"),$(document).trigger("do.WindowRepaint"),$(document).trigger("tn.reviewdropdown.open"))),this._isIOS12()&&e.preventDefault()},_isIOS12:function(){var e=$.isIdevice()?navigator.userAgent.toLowerCase().match(/(\d+)_(\d+)_?(\d+)?/).slice(1):"";return""!==e&&12===parseInt(e[0])},_cancelClick:function(e){e.preventDefault()},_createDropdown:function(){"undefined"!=typeof $("#btnOverview").data("pearson-reviewDropdown")&&$("#btnOverview").reviewDropdown("destroy"),$("#btnOverview").reviewDropdown({dataSource:this._getJsonReady()}),e.isMobile&&$(".review-dropdown:not(.review-dropdown-popup)").css("position","absolute"),t.unblock("home"),t.unblock("end"),$(".review-dropdown").off("deepZoomLayer.hide",this._closeDropdown).on("deepZoomLayer.hide",this._closeDropdown)},_unregisterEvents:function(){$(".review-dropdown").off("deepZoomLayer.hide",this._closeDropdown),$(document).off("tn.header.render.complete",this._initDropdown),$(document).off("cleanup.betweenTest",this._destroy),$(document).off("tn.ews.on",this._closeDropdown),$(document).off("inform.timeoutModalOn",this._closeDropdown)},_closeDropdown:function(){"undefined"!=typeof $("#btnOverview").data("pearson-reviewDropdown")&&$("#btnOverview").reviewDropdown("close")},_destroy:function(){$(document).off("tn.reviewdropdown.close",$.proxy(this._handleReviewClose,this)),"undefined"!=typeof $("#btnOverview").data("pearson-reviewDropdown")&&($("#btnOverview").reviewDropdown("destroy"),this._unregisterEvents())}}};return n}),define("controllers/PnpOverride",[],function(){"use strict";return{pnp:{},init:function(e){try{this.pnp=e.pnp?JSON.parse(e.pnp):{}}catch(e){this.pnp={},TN8.log("pnpOverride.init  . pnp is not JSON : "+e,TN8.CRITICAL)}return this},isSpellCheck:function(e){var t,n;try{t=this.pnp.accessForAllUser.content.supportTool,n=t.indexOf("spell checker")!==-1}catch(e){}return n?n:e},cleanUp:function(){this.pnp={}}}}),define("controllers/CheckAnswerController",["text!tpl/combined.html"],function(e){var t=function(){return{responsesHtml:[],userResponses:[],correctTestCasesReceived:null,allCorrect:!0,initWidth:0,isSBAC:!1,init:function(){return _.bindAll(this),this._registerEvents(),this},_registerEvents:function(){TN8.fnOn("tn.header.render.complete",this._initCheckAnswerButton),TN8.fnOn("cleanup.betweenTest perform.exitApplication tn.error.fatal navigate.EmergencyExit",this._destroy),$(document).on("ItemController.ItemLoaded",this._getCorrectResponses),$(document).on("ItemSetAnswer",this._handleItemAnsweredStateChange),TN8.fnOn("tn.ews.on",this._hideFeedback),TN8.fnOn("inform.timeoutModalOn",this._hideFeedback)},_initCheckAnswerButton:function(){$("#btnCheckAnswer").off("click touchstart",this._toggleModal).on("click touchstart",this._toggleModal).off("touchend",this._cancelTouchClick).on("touchend",this._cancelTouchClick)},_handleItemAnsweredStateChange:function(e,t){var n=$("#btnCheckAnswer");if(t){n.removeClass("disabled");var i=n.attr("aria-label");n.attr("data-original-title",i)}else this._hideFeedback(),n.addClass("disabled"),n.attr("data-original-title","")},_cancelTouchClick:function(e){e.preventDefault()},_getCorrectResponses:function(){$(document).trigger("createFeedbackEl"),this.correctTestCasesReceived=null,TestEngine.getCorrectTestCases(this._correctResponseSuccess,this._correctResponseFailure)},_correctResponseSuccess:function(e){var t=TestEngine.getNavigation().getCurrentItem().getItemName(),n=e.msg.testcases&&e.msg.testcases[0],i=!!n&&n.item_identifier===t;this.correctResponses=n?n.mods:null,!i&&n||(this.correctResponses&&this.correctResponses.length>0?(this._cleanModal(),$(document).trigger("getCorrectResponses",{callback:this._addCorrectResponse,responses:this.correctResponses}),this.correctTestCasesReceived=!0,this._buildModal()):this._correctResponseFailure())},_correctResponseFailure:function(){this.correctTestCasesReceived=!1,$(document).trigger("tn.loadingModal.off"),TestEngine._testInProgress&&TN8.throw("",TN8.errorType.FEEDBACK_CORRECT_TESTCASE_ERROR)},_addCorrectResponse:function(e,t){t&&Object.keys(t).forEach(function(n,i){e.css(n,t[n])}),this.responsesHtml.push(e)},_buildModal:function(){this.isSBAC=$("body").hasClass("sbac"),this._modal=_.template($(e).filter("#checkAnswer-template").html()),$("#lastTabbable").before(this._modal);var t=$("#feedbackResizable .checkAnswer-body");this._sortResponsesHtml();var n=this;$.each(this.responsesHtml,function(e,i){var o=$(i);$.each(o.data(),function(e){"style"!=e&&o.removeAttr("data-"+e)}),$("#feedbackDraggable").css("max-height",$(window).height());var r=$("<div/>").attr("id","correctRenderingDiv");$("<div/>",{id:"correctText",text:$.i18n.t("checkAnswer:correctAnswer")}).appendTo(r),o.css("pointer-events","none").on("keydown",n.actionBlock).css("padding-bottom","0px").css("margin-bottom","0px").attr("tabindex","-1").appendTo(r);var s=$("<div/>");s.html(r).attr("id","feedbackDiv").attr("tabindex","0"),e!==n.responsesHtml.length-1&&s.css("border-bottom","2px solid #B0B0B0"),s.appendTo(t)}),$(document).trigger("renderCorrectResponses",{responses:this.correctResponses}),$("#feedbackResizable").resizable(),$("#feedbackDraggable").draggable({scroll:!1,handle:".tn8-draggable-modal-header",drag:this._dragContain,stop:this._dragContain}),this._addFWListeners()},_addFWListeners:function(){$(window).on("resize.feedback",this._resizeContain),$("#feedbackClose").on("click",this._hideFeedback)},_sortResponsesHtml:function(){var e=[];$.each($("[data-module][data-identifier]"),function(t,n){e.push($(n).data("identifier").replace("interaction_",""))});var t=[];$.each(this.responsesHtml,function(n,i){var o=$(i),r=(o.data("identifier")||o.attr("id")||o.find("[data-identifier]").data("identifier")).replace("interaction_","").replace("_feedback",""),s=e.indexOf(r);s>-1&&(t[s]=i)}),this.responsesHtml=t},_setWidth:function(){var e=$("#feedbackResizable");e.css("width","auto");var t=e.width(),n=.7*$(window).width();t>n&&e.css("width",n)},_setHeight:function(){var e=$("#feedbackResizable"),t=this.getViewportSize(),n=.07*t.height,i=.8*t.height-n;allCorrectHeight=75*this.responsesHtml.length+7,e.height(this.allCorrect?allCorrectHeight:""),e.height()>i&&e.height(i)},_toggleModal:function(){var e=$("#feedbackDraggable"),t=$("#btnCheckAnswer");"visible"===e.css("visibility")?this._hideFeedback():t.hasClass("disabled")||($(document).trigger("tn.loadingModal.on"),this._checkIfCorrectTestCasesReceived())},_showFeedback:function(){$(document).trigger("tn.loadingModal.off"),this.$backdrop=$('<div class="feedback-backdrop" />').appendTo(document.body),this.$backdrop.click($.proxy(this._hideFeedback,this)),
$(".checkAnswer-body").scrollTop(0),$("#feedbackDraggable").css("visibility","visible").tabRing(),$("#feedbackDraggable .modal-focus-anchor").focus(),this._checkPosition()},_hideFeedback:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null,$("#feedbackDraggable").css("visibility","hidden").tabRing("off")},_checkPosition:function(){var e=$("#feedbackDraggable"),t=parseInt(e.css("left")),n=e.outerWidth();t+n<100&&e.css("left",100-n)},_resizeContain:function(e,t){var n=$("#feedbackDraggable"),i=$("#feedbackResizable"),o=45,r=this.getViewportSize(),s=parseInt(n.css("left")),a=parseInt(n.css("top")),l=n.outerWidth(),c=n.outerHeight(),d=100,u={left:0,top:0,right:Math.max(0,r.width-l),bottom:Math.max(0,r.height-c)};t&&s<0?(t.size.width=this.normalize(t.size.width,Math.max(300,Math.abs(s)+d),1e4),t.size.height=this.normalize(t.size.height,200,Math.max(200,r.height-a-o))):(n.css("left",this.normalize(s,u.left,u.right)),n.css("top",this.normalize(a,u.top,u.bottom)),i.width(this.normalize(i.width(),300,Math.max(300,r.width))),i.height(this.normalize(i.height(),200,Math.max(200,r.height-a-o))))},_dragContain:function(e,t){var n=$("#feedbackDraggable"),i=this.getViewportSize(),o=n.outerWidth(),r=100,s={left:Math.round(r-o),top:0,right:Math.round(i.width-r),bottom:Math.round(i.height-r)};t?(t.position.left=this.normalize(t.position.left,s.left,s.right),t.position.top=this.normalize(t.position.top,s.top,s.bottom)):(n.css("left",this.normalize(parseInt(n.css("left"),0),s.left,s.right)),n.css("top",this.normalize(parseInt(n.css("top"),0),s.top,s.bottom)))},normalize:function(e,t,n){return Math.round(Math.min(Math.max(e,t),n))},getViewportSize:function(){return{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}},actionBlock:function(e){return 13!==e.keyCode&&32!==e.keyCode},_removeFWListeners:function(){$(window).off("resize.feedback",this._resizeContain),$("#feedbackClose").off("click",this._hideFeedback)},_cleanModal:function(){this.responsesHtml=[],this._removeFWListeners(),$("#feedbackDraggable").remove()},_checkIfCorrectTestCasesReceived:function(){var e=this;this.correctTestCasesReceived?this._scoreResponses():setTimeout(e._checkIfCorrectTestCasesReceived,2e3)},_scoreResponses:function(){$(document).trigger("getFeedbackScore",{callback:this._addScores}),TestEngine.scoreFeedback(this.userResponses,this._scoringSuccess,this._scoringFailure)},_scoringSuccess:function(e){var t=e.msg.scores&&e.msg.scores[0];if(t&&t.outcomes&&"yes"===t.success){var n=this._createScoringPairs(t.outcomes);this._appendScores(n)}else this._scoringFailure()},_scoringFailure:function(){$(document).trigger("tn.loadingModal.off"),this.userResponses=[],TestEngine._testInProgress&&TN8.throw("",TN8.errorType.FEEDBACK_SCORING_ERROR)},_createScoringPairs:function(e){return this.isSBAC?this._createSBACPairs(e):this._createPairs(e)},_createPairs:function(e){var t=[],n=this;return e.forEach(function(i,o){var r=i.key;if("SCORE"!==r&&r.toLowerCase().indexOf("maxscore")===-1&&r.toLowerCase().indexOf("scoresystem")===-1){var s,a,l={};l.score=parseInt(i.value),e.forEach(function(e){e.key===r+"_maxscore"&&(l.maxscore=parseInt(e.value))});var c=r+"(?!\\d)",d=new RegExp(c,"g");$.each(n.responsesHtml,function(e,t){var n=$(t),i=n.attr("id")||t.prevObject.prevObject.prop("id"),o=n.data("identifier")?n.data("identifier").replace("_feedback",""):"",r=i.match(d)||o.match(d);if(r)return s=n,a=r[0],!0}),l.el=s,l.elId=a,l.el&&t.push(l)}}),t},_createSBACPairs:function(e){var t=[],n=0,i=0;e.forEach(function(e,t){var o=e.key;"SCORE"===o?n+=parseInt(e.value):"MAXSCORE"===o&&(i+=parseInt(e.value))});var o=$($("#correctRenderingDiv").children()[1]);return t.push({score:n,maxscore:i,el:o}),t},_appendScores:function(e){this.allCorrect=!0;var t=this;$.each(e,function(e,n){n.el.parent().siblings().remove(),n.score===n.maxscore?t._correctScore(n.el,n.elId):t._incorrectScore(n.el,n.elId)}),this.userResponses=[],this._setWidth(),this._setHeight(),this._showFeedback()},_addScores:function(e){this.userResponses.push(e)},_correctScore:function(e,t){var n='<i id="correctFeedbackIcon" class="icon-ok"></i>',i=$("#"+t+"-title").text(),o=$("<h4/>",{text:i}).prepend(n).css("margin","0 0 3px 0"),r='<div class="correctFeedback">'+$.i18n.t("checkAnswer:correct")+"</div>",s=e.parent().parent();s.prepend(r).prepend(o),e.parent().css("visibility","hidden").css("position","absolute")},_incorrectScore:function(e,t){var n='<i id="incorrectFeedbackIcon" class="icon-remove-sign"></i>',i=$("#"+t+"-title").text(),o=$("<h4/>",{text:i}).prepend(n).css("margin-bottom","3px"),r='<div class="incorrectFeedback">'+$.i18n.t("checkAnswer:incorrect")+"</div>",s=e.parent().parent();s.prepend(r).prepend(o),e.parent().css("visibility","").css("position",""),this.allCorrect=!1},_destroy:function(){this._hideFeedback(),this._cleanModal(),$(document).off("tn.header.render.complete",this._initCheckAnswerButton),$(document).off("cleanup.betweenTest perform.exitApplication tn.error.fatal navigate.EmergencyExit",this._destroy),$(document).off("ItemController.ItemLoaded",this._getCorrectResponses),$(document).off("tn.ews.on",this._hideFeedback),$(document).off("inform.timeoutModalOn",this._hideFeedback),$(window).off("resize.feedback",this._resizeContain),$(document).off("ItemSetAnswer",this._handleItemAnsweredStateChange)}}};return t}),define("util/Saver",["javascripts/backbone-min","util/Dispatcher","utils","util/ItemSaver","controllers/ApplicationStatusController"],function(e,t,n,i,o){var r=e.Model.extend({thisClassName:"Saver",saverStatus:{SAVING:1,IDLE:2},initialize:function(){_.bindAll(this,"handleSendToEngine","resetSaverStatus","doNotSave","doSave"),t.off("sendToEngine",this.handleSendToEngine),t.on("sendToEngine",this.handleSendToEngine),$(document).off("tn.save.success cleanup.logout",this.resetSaverStatus).on("tn.save.success cleanup.logout",this.resetSaverStatus),this.applicationStatusInit()},applicationStatusInit:function(){o.subscribeCondition(o.actionNames.NavigateNext,this.thisClassName,this.saverStatus.IDLE),o.subscribeCondition(o.actionNames.NavigatePrev,this.thisClassName,this.saverStatus.IDLE),o.subscribeCondition(o.actionNames.NavigateTo,this.thisClassName,this.saverStatus.IDLE),o.subscribeCondition(o.actionNames.NavigateSubmitTest,this.thisClassName,this.saverStatus.IDLE),o.subscribeCondition(o.actionNames.NavigateLoadNextSection,this.thisClassName,this.saverStatus.IDLE),o.subscribeCondition(o.actionNames.FetchSuccess,this.thisClassName,this.saverStatus.IDLE),o.subscribeCondition(o.actionNames.SaverSaving,this.thisClassName,this.saverStatus.IDLE),o.subscribeCondition(o.actionNames.NavigateStartSection,this.thisClassName,this.saverStatus.IDLE),o.registerEvent(o.actionNames.SaverSaving,"DoSaverSaving","ErrSaverSaving",t),t.off("DoSaverSaving").on("DoSaverSaving",this.doSave,this),t.off("ErrSaverSaving").on("ErrSaverSaving",this.doNotSave,this),o.statusChange(this.thisClassName,this.saverStatus.IDLE)},handleSendToEngine:function(e){o.execute(o.actionNames.SaverSaving,e)},resetSaverStatus:function(){o.statusChange(this.thisClassName,this.saverStatus.IDLE)},doNotSave:function(){return TN8.log("Saver.doNotSave : Saver is in SAVING status already",TN8.IMPORTANT),!0},doSave:function(e){o.statusChange(this.thisClassName,this.saverStatus.SAVING);var n=TN8.Application.getCurrentContentView(),i=n&&n.getSaveToLocation?n.getSaveToLocation():"";e.overrideSaveTo&&(i=e.overrideSaveTo),TN8.log("Saver.handleSendToEngine  saveTo : "+i,TN8.IMPORTANT),i&&""!==i&&("saveAllModules"===i||e.fullData?e&&e.itemJSON?this.saveAllModules(e):TN8.Application.DataProvider.getResponses(this.sendToItemState.bind(this,e,i)):t.trigger(i,e))},sendToItemState:function(e,t,n,i){e=e||{},e.itemJSON=i,this.saveAllModules(e)},saveAllModules:function(e){TN8.log("Saver.saveAllModules ",TN8.IMPORTANT),$(document).trigger("tn.saveAllModules",e),i.getInstance().saveItem(e)},isSavingItem:function(e){return"saveAllModules"===e},isNotAnswered:function(){return!TN8.Application.itemController.isItemAnswered()},isFinishTest:function(e){return e&&e.isLastCall===!0},isTimerForceMove:function(e){return e&&e.timerForceMove===!0}});return r}),define("timer/TimerRequire",["timer/TimerUtils"],function(e){var t=function(){return{init:function(){_.bindAll(this),$(document).on("perform.timerRequire",this.checkForTimer),$(document).on("cleanup.betweenTest",this.unregisterEvents)},checkForTimer:function(t,n){e.setLevel(),this.callback=n,e.isPart()?this.requirePartTimer():e.isTestTimer()?this.requireTestTimer():e.isSection()?this.requireSectionTimer():(this.callback(),this.callback=null)},requireTestTimer:function(){require(["timer/timerControllers/TestTimerController","timer/timerControllers/untimedOvertimeControllers/UntimedTestOvertimeController","timer/timerControllers/timedOvertimeControllers/TimedTestOvertimeController"],this.requireSuccess,this.requireError)},requirePartTimer:function(){require(["timer/timerControllers/PartTimerController","timer/timerControllers/untimedOvertimeControllers/UntimedPartOvertimeController","timer/timerControllers/timedOvertimeControllers/TimedPartOvertimeController"],this.requireSuccess,this.requireError)},requireSectionTimer:function(){require(["timer/timerControllers/SectionTimerController","timer/timerControllers/untimedOvertimeControllers/UntimedSectionOvertimeController","timer/timerControllers/timedOvertimeControllers/TimedSectionOvertimeController"],this.requireSuccess,this.requireError)},unregisterEvents:function(){$(document).off("perform.timerRequire",this.checkForTimer).off("cleanup.betweenTest",this.unregisterEvents),this.callback=null},requireSuccess:function(e){TN8.log("TimerRequire SUCCESS",TN8.IMPORTANT),this.callback(),this.callback=null},requireError:function(e){TN8.log("TimerRequire ERROR : "+e,TN8.IMPORTANT),TN8.throw("",TN8.errorType.TIMER_REQUIRE_ERROR)}}},n=new t;return n}),define("views/tests/initializer",["javascripts/backbone-min","controllers/TestStateSaver","util/secureErrors","controllers/TestStateController","controllers/ReviewController","controllers/PnpController","controllers/PnpOverride","controllers/CheckAnswerController","util/Saver","util/shortcuts","timer/TimerRequire","models/FeatureUsageTrackerFactory"],function(e,t,n,i,o,r,s,a,l,c,d,u){"use strict";var h=function(){return{requestTest:function(e,t){return null===t||null===e?void TN8.throw("Something went wrong. Form and FormId do not match. formId is "+t+" and form is "+e,TN8.errorType.FORM_NOT_FOUND):(TN8.Application.headerModel.trigger("change"),TN8.log("test.requestTest .",TN8.CRITICAL),TestEngine.addListener(TestEngine.constructor.TEST_SETUP_COMPLETE,this.initTest,this),TestEngine.addListener(TestEngine.constructor.TEST_SETUP_FAILURE,this.handleTestLoadFailure,this),void this.selectTest(e,t))},selectTest:function(e,t){TestEngine.selectTest(t,e),this.form=e},initTest:function(){if($(document).trigger("inform.selectTestDone"),$(document).off("cleanup.betweenTest",this.cleanUp).on("cleanup.betweenTest",this.cleanUp),TestEngine.removeListener(TestEngine.constructor.TEST_SETUP_COMPLETE,this.initTest),TestEngine.removeListener(TestEngine.constructor.TEST_SETUP_FAILURE,this.handleTestLoadFailure),TN8.PnpController=r,r.init(this.form),TN8.utils.doesAccomToolIdExistInTest(11,"Extensions",r.pnp)||r.isExtensionEnabled()){var e=TN8.utils.getExtUnsupportedError();if(e)return void TN8.throw("",e);var t=this.getExtensionsUrl(r.pnp);if(t)return TN8.fnOne("navigate.afterExtension",$.proxy(this.afterExtensionsSet,this)),void TN8.Application.showExtensionsPage(t)}this.afterInitTest()},afterExtensionsSet:function(){$(document).trigger("tn.progressBar.on"),this.afterInitTest()},getExtensionsUrl:function(e){var t=null;return t=TN8.PnpController.getExtensionsUrl(),t||(t=TN8.Application.config.extensionUrl),t},afterInitTest:function(){this.browserAddOnCheck(),d.init(),t.init(),o().init(),TestEngine.getTestDefine().itemFeedback()&&a().init(),this.setPreloadList(),3===TestEngine.getTestDefine()._securityLevel?r.applyPnpSettings():TestEngine.addListener(TestEngine.constructor.INIT_PAR_PRELOADED,this.applyPnp,this),i.init(),TN8.Application.PNPOverride=s.init(this.form),u.init(),this.initItemComponentTimers(),new l},applyPnp:function(){3!==TestEngine.getTestDefine()._securityLevel&&TestEngine.removeListener(TestEngine.constructor.INIT_PAR_PRELOADED,this.applyPnp),r.applyPnpSettings()},setPreloadList:function(){var e=["init.par"];r.pnpToolsEnabled&&e.push("tools_noTi.par"),TestEngine.getTestDefine().isDynamicTTS()&&e.push("dynamic-tts.par"),TestEngine.setInitPreloadList(e)},browserAddOnCheck:function(){return"1"===this.form.securityLevel&&$("body").attr("data-pinterest-extension-installed")?TN8.throw("",TN8.errorType.BROWSER_PINTEREST_DETECTED):"1"===this.form.securityLevel&&$("#dic_bubble").length?TN8.throw("",TN8.errorType.BROWSER_DICTIONARY_DETECTED):void 0},initItemComponentTimers:function(){require(["timer/timerControllers/ItemTimerController"],$.proxy(this.initTimersHandler,this))},initTimersHandler:function(e){this.reviewTimerController=new e({name:"review",startTimerEvents:"tn.reviewdropdown.open",pauseTimerEvents:"tn.reviewdropdown.close tn.reviewdropdown.nav",saveTimerEvents:"tn.reviewdropdown.close tn.reviewdropdown.nav",key:"timeOnReview"}),this.reviewTimerController.init(),this.userDudeTimerController=new e({name:"userDropdown",startTimerEvents:"userDropdown.open",key:"timeOnUserDude",saveTimerEvents:"userDropdown.close",pauseTimerEvents:"userDropdown.close"}),this.userDudeTimerController.init(),this.contrastTimerController=new e({name:"contrast",startTimerEvents:"contrast.modal.open",saveTimerEvents:"contrast.modal.close",pauseTimerEvents:"contrast.modal.close",key:"timeOnContrastDialog"}),this.contrastTimerController.init(),this.jwplayerTimerController=new e({name:"jwplayer",startTimerEvents:"JW.play",saveTimerEvents:"JW.pause JW.idle",pauseTimerEvents:"JW.pause JW.idle",key:"timePlayingJwplayer"}),this.jwplayerTimerController.init(),this.logoutTimerController=new e({name:"logout",startTimerEvents:"tn.exitmodal.show",key:"timeOnLogoutDialog",saveTimerEvents:"exitModal.hide",pauseTimerEvents:"exitModal.hide"}),this.logoutTimerController.init(),this.itemTimerController=new e({name:"item",startTimerEvents:"ItemController.ItemLoaded",key:"time",saveTimerEvents:"tn.prepare.item.response"}),this.itemTimerController.init()},handleTestLoadFailure:function(e){if(TN8.log("test.initTest  . msg : "+e,TN8.CRITICAL),e.getTarget()!=TestEngine.constructor.INVALID_FORCED_SECTION)return e.getTarget()==TestEngine.constructor.PROXY_SETUP_FAILURE?(TestEngine.removeListener(TestEngine.constructor.TEST_SETUP_COMPLETE,this.initTest,this),void TestEngine.removeListener(TestEngine.constructor.TEST_SETUP_FAILURE,this.handleTestLoadFailure,this)):void(e.getTarget()==TestEngine.constructor.DUPLICATE_LOGIN_FAILURE?TN8.throw("",TN8.errorType.DUPLICATE_LOGIN):($(document).trigger("tn.loadingModal.off"),TN8.throw("Failed Connection",TN8.errorType.LOST_CONNECTION_IN_TEST)))},cleanUp:function(){s.cleanUp(),delete TN8.Application.PNPOverride}}};return h}),define("util/SleepDetector",[],function(){"use strict";var e=function(){return{timeSlept:0,init:function(){return _.bindAll(this),this.registerEvents(),this},sendEvent:function(e,t,n){if(200===n.status){var i=this;setTimeout(function(){$(document).trigger("snitch.sendOut",{event:"SleepDetected",sleepTime:i.timeSlept})},5e3)}else this.checkInternetConnection()},createInterval:function(){this.lastTime=(new Date).getTime(),this.detectionInterval=setInterval(this.checkTime,1e3)},checkTime:function(){var e=(new Date).getTime();if(e>this.lastTime+3e4){var t=Math.round((e-this.lastTime)/1e3);this.lastTime=e,this.timeSlept=t,this.checkInternetConnection()}else this.lastTime=e},checkInternetConnection:function(e,t,n){setTimeout(this.pingServer,2e3)},pingServer:function(){$.ajax({url:document.location.origin,error:this.checkInternetConnection,statusCode:{303:this.checkInternetConnection,200:this.sendEvent}})},destroyInterval:function(){clearInterval(this.detectionInterval),this.detectionInterval=this.lastTime=null},registerEvents:function(){$(document).off("tn.test.start",this.createInterval).on("tn.test.start",this.createInterval),$(document).off("cleanup.betweenTest",this.destroyInterval).on("cleanup.betweenTest",this.destroyInterval)}}};return e}),define("util/LogFinder",[],function(){"use strict";var e=function(){var e,t=function(){localStorage&&(e=localStorage.getItem("loginIds"),n(),s())},n=function(){$.ajax({type:"GET",url:"https://lo17ksfcqi.execute-api.us-east-2.amazonaws.com/dev/logHunterGET",success:i})},i=function(t){var n=t.trim().split(" ");n.forEach(function(t){e&&e.indexOf(t)>-1&&$(document).trigger("snitch.sendOut",{event:"logHunter",id:t})})},o=function(){var t=TestEngine.getAuthentication().getLoginId(),n=r(t);e=n?e:e?e+=" "+t:t,localStorage.setItem("loginIds",e)},r=function(t){return!!e&&e.indexOf(t)>-1},s=function(){$(document).off("navigated.startTest",o).on("navigated.startTest",o),$(document).off("tn.navigate.login tn.navigate.logout",n).on("tn.navigate.login tn.navigate.logout",n)};return{init:t}};return e}),define("views/ProgressBarView",["controllers/ApplicationStatusController"],function(e){"use strict";return{maxWeight:null,currentWeight:0,exists:!1,iosHack:!1,initialize:function(){_.bindAll(this),$(document).on("tn.error.modal tn.error.fatal tn.login.error navigate.EmergencyExit tn.error.growl tn.navigate.logout timerTimeout",this.destroy)},turnOnProgressBar:function(){e.execute(e.actionNames.TurnOnProgressModal)},initProgressBar:function(e){this.exists||(this.exists=!0,this.currentWeight=0,this.maxWeight=e+1,$("#progressBar").css("width","1%"),this.iosHack=TestEngine.isIdevice(),this.iosHack&&this.addiOShack(),this.turnOnProgressBar())},updateProgress:function(e,t){if(this.exists){var n={};n.newWeight=e,n.width=this.currentWeight*(100/this.maxWeight),n.endProgress=(n.newWeight+this.currentWeight)/this.maxWeight*100,this.currentWeight+=n.newWeight,this.currentWeight<this.maxWeight?this.createInterval(n):t?this.destroyNow():this.completeBar()}},createInterval:function(e){this.interval&&clearInterval(this.interval),this.interval=setInterval(this.moveBar,10,e)},moveBar:function(e){e.width>=100?(clearInterval(this.interval),this.destroy()):e.width>=e.endProgress?clearInterval(this.interval):(e.width++,$("#progressBar").css("width",e.width+"%"))},completeBar:function(){this.interval&&clearInterval(this.interval),$("#progressBar").css("width","100%"),this.destroy()},destroy:function(){if(this.exists){this.exists=!1;var e=this;setTimeout(function(){$(document).trigger("tn.progressBar.off"),e.iosHack&&e.removeiOShack()},100)}},destroyNow:function(){this.exists&&(this.exists=!1,$(document).trigger("tn.progressBar.off"),this.iosHack&&this.removeiOShack())},addiOShack:function(){$("#progressModal .modal-body").prepend('<img id="hackGif" src="public/images/global/350.gif" style="width: 1px; height: 1px; display: block;"/>')},removeiOShack:function(){$("#hackGif").remove()}}}),define("models/ProgressBarTrackerModel",[],function(){"use strict";var e=function(){this.analytics=[],$(document).off("tn.progressBar.off",$.proxy(this.saveTracker,this)).on("tn.progressBar.off",$.proxy(this.saveTracker,this)),$(document).off("collectEndTestData",$.proxy(this.getEndTestAnalytics,this)).on("collectEndTestData",$.proxy(this.getEndTestAnalytics,this))};return e.prototype.initTracker=function(e){this.currentTracker={type:e,events:[]},this.currentTracker.events.push({PROGRESS_START:(new Date).getTime()})},e.prototype.updateTracker=function(e){if(this.currentTracker){var t={};t[e]=(new Date).getTime(),this.currentTracker.events.push(t)}},e.prototype.saveTracker=function(){this.currentTracker&&("firstItem"!==this.currentTracker.type&&"item"!==this.currentTracker.type||(this.currentTracker.itemId=TestEngine.getNavigation().getCurrentItem()._identifier),this.currentTracker.events.push({PROGRESS_END:(new Date).getTime()}),this.analytics.push(this.currentTracker),this.currentTracker=null)},e.prototype.getAvgTime=function(){var e=0,t=0;return this.analytics.forEach(function(n,i){"item"===n.type&&(t++,e+=n.events[n.events.length-1].PROGRESS_END-n.events[0].PROGRESS_START)}),e/t},e.prototype.getEndTestAnalytics=function(e,t){this.analytics.length&&t(this.analytics,"progressMetrics");var n=this.getAvgTime();n&&t(n,"progressBarAvgTime"),this.analytics=[]},new e}),define("controllers/ProgressBarController",["views/ProgressBarView","models/ProgressBarTrackerModel"],function(e,t){"use strict";var n=function(){return{_view:e,_tracker:t,_createEvents:"inform.startTestRendering inform.navToFirstItem inform.loadFirstItem inform.navToRL inform.navToItem",_updateEvents:"inform.diagnosticsDone inform.authSelectTestSuccess inform.testDefRecieved inform.sessionInit inform.preloadInit inform.testLocked navigated.startTest navigated.settings inform.gotCurResponse inform.gotCatItem inform.itemSaved inform.preloadDone inform.flavorFetched inform.loadToolLibsReady ItemController.ItemLoaded tn.endsection.loaded tn.endsection.exit tn.endtest.loaded inform.availablePartsLoaded",_progressBars:null,_progressUpdates:null,addListeners:function(){_.bindAll(this),this._createProgressEvents(),this._view.initialize(),$(document).on(this._createEvents,this._createProgressBar),$(document).on(this._updateEvents,this._updateProgressBar)},_createProgressEvents:function(){this._progressBars={"inform.startTestRendering":["login",25],"inform.navToFirstItem":["firstItem",12],"inform.loadFirstItem":["firstItem",12],"inform.navToRL":["firstItem",12],"inform.navToItem":["item",15]},this._progressUpdates={"inform.diagnosticsDone":["PROGRESS_DIAGNOSTICS",4],"inform.authSelectTestSuccess":["PROGRESS_AUTH_SELECT",3],"inform.testDefRecieved":["PROGRESS_TESTDEFINE",1],"inform.sessionInit":["PROGRESS_SESSION_INITIALISATION",5],"inform.preloadInit":["PROGRESS_PRELOAD_INIT",2],"inform.testLocked":["PROGRESS_LOCK",10],"navigated.settings":["PROGRESS_TEST_LOADED",26],"navigated.startTest":["PROGRESS_TEST_LOADED",26],"inform.availablePartsLoaded":["PROGRESS_PARTS_LOADED",26],"inform.gotCurResponse":["PROGRESS_GET_CURRENT_RESPONSE",2],"inform.gotCatItem":["PROGRESS_CAT_GET_ITEM",3],"inform.itemSaved":["PROGRESS_SAVE_RESPONSE",3],"inform.preloadDone":["PROGRESS_PRELOAD_ITEM",3],"inform.flavorFetched":["PROGRESS_GET_FLAVOR",3],"inform.loadToolLibsReady":["PROGRESS_LOAD_TOOL_LIBS",1],"ItemController.ItemLoaded":["PROGRESS_ITEM_LOADED",16],"tn.endsection.loaded":["PROGRESS_ENDSECTION_LOADED",16],"tn.endsection.exit":["PROGRESS_ENDSECTION_EXIT",16],"tn.endtest.loaded":["PROGRESS_ENDTEST_LOADED",16]}},_createProgressBar:function(e){var t=this._getReceivedEvent(e),n=this._progressBars[t];this._tracker.initTracker(n[0]),this._view.initProgressBar(n[1])},_updateProgressBar:function(e){var t=this._getReceivedEvent(e),n=this._progressUpdates[t],i=this._determineDestroyImmediately(n);this._tracker.updateTracker(n[0]),this._view.updateProgress(n[1],i)},_getReceivedEvent:function(e){return e.type+"."+e.namespace},_determineDestroyImmediately:function(e){return"PROGRESS_ENDSECTION_EXIT"===e[0]}}},i=n();return i.addListeners(),i}),define("text!tpl/ews/launch.html",[],function(){return'<script id="ewsFrame" type="text/template">\n<div id="frame">\n    <div class="modal-header">\n        <div class="modal-title" aria-hidden="true">\n            <%=$.i18n.t("ews:defTitle")%>\n        </div>\n    </div>\n    <div class="modal-body">\n        <div class="notify-content"></div>\n        <div class="ews-button-container">\n            <button type="button" class="ews-close-button" aria-label="<%=$.i18n.t(\'ews:testProctorBtn\')%>">\n                <%=$.i18n.t("ews:testProctorBtn")%>\n            </button>\n        </div>\n    </div>\n</div>\n</script>\n\n<script id="ewsoptionA" type="text/template">\n<div id="optionA">\n    <div class="ews-message">\n        <h5><%=$.i18n.t("generalWords:message")%> <%= message %></h5>\n    </div>\n    <div class="ews-message clearfix">\n        <div class="pull-left ews-icon">\n            <i class="icon-ok-circle"></i>\n        </div>\n        <div class="ews-icon-label">\n            <%=$.i18n.t("ews:testSaved")%>\n        </div>\n    </div>\n    <div class="ews-message clearfix">\n        <div class="pull-left ews-icon">\n            <i class="icon-warning-sign"></i>\n        </div>\n        <div class="ews-icon-label">\n            <%=$.i18n.t("ews:contactTeacher")%>\n        </div>\n    </div>\n</div>\n</script>\n\n\n<script id="ewsoptionB" type="text/template">\n<div id="optionB">\n    <div class="ews-message">\n        <h5><%=$.i18n.t("generalWords:message")%> <%= message %></h5>\n    </div>\n    <div class="ews-message clearfix">\n        <div class="pull-left ews-icon">\n            <i class="icon-warning-sign"></i>\n        </div>\n        <div class="ews-icon-label">\n             <%=$.i18n.t("ews:notifyTeacher")%>\n        </div>\n    </div>\n</div>\n</script>\n'}),define("views/ews/EWSLaunch",["javascripts/backbone-min","text!tpl/ews/launch.html"],function(e,t){var n=e.View.extend({EWS_WITH_SRF_SAVE:1001,EWS_WITH_SRF_ERROR:1002,template:_.template($(t).filter("#ewsFrame").html()),options:{1001:_.template($(t).filter("#ewsoptionA").html()),1002:_.template($(t).filter("#ewsoptionB").html())},selectedOption:0,initialize:function(e,t){},events:{"click .ews-close-button":"handler_ButtonClick"},render:function(){this.$el.html(this.template({messageNumber:this.selectedOption})),this.$el.find(".notify-content").html(this._getOptionContent()({message:this.selectedOption}))},setOption:function(e){var t;switch(e){case this.EWS_WITH_SRF_ERROR:case this.EWS_WITH_SRF_SAVE:t=e;break;default:t=this.EWS_WITH_SRF_SAVE}this.selectedOption=t},_getOptionContent:function(){return this.options[this.selectedOption]},handler_ButtonClick:function(e){TN8.Dispatcher.trigger("EWSLaunch")}});return n}),define("models/ews/SaveLocationDialog",["javascripts/backbone-min"],function(e){var t=e.Model.extend({defaults:{headerLabel:"",messageNumber:"1003",message:"",instruction:"",showExitButton:!0,showRetryButton:!1},setUnableToSavePreStartAttributes:function(){var e={headerLabel:$.i18n.t("ews:ERR_UNABLE_TO_SAVE_PRE_START"),messageNumber:"1003",message:$.i18n.t("ews:testing_cannot_continue"),instruction:$.i18n.t("ews:exit_test"),showExitButton:!0,showRetryButton:!1};this.set(e)},setUnableToSavePostStartAttributes:function(){var e={headerLabel:$.i18n.t("ews:ERR_UNABLE_TO_SAVE_POST_START"),messageNumber:"1004",message:$.i18n.t("ews:srf_unsaved_server_unavailable"),instruction:$.i18n.t("ews:retry_or_exit"),showExitButton:!0,showRetryButton:!0,retryStatement:!0};this.set(e)}});return t}),define("text!tpl/ews/saveLocation.html",[],function(){return'<div class="modal-header">\n    <div class="modal-title" aria-hidden="true">\n        <%= headerLabel %>\n    </div>\n</div>\n<div class="modal-body">\n<div class="ews-message">\n    <h5><%=$.i18n.t("generalWords:message")%> <%= messageNumber %></h5>\n</div>\n<div class="ews-message">\n    <div>\n        <%= message %>\n    </div>\n</div>\n<% if ( messageNumber === \'1004\' ) {\n%>\n\n<div class="ews-message">\n    <div class="ews-message">\n        <%=$.i18n.t("ews:primaryLocat")%> <%= primaryLocation %>\n    </div>\n    <div class="ews-message">\n        <%=$.i18n.t("ews:altLocation")%> <%= alternateLocation %>\n    </div>\n    <% if ( retryStatement ) {\n    %>\n    <div>\n        <%=$.i18n.t("ews:tryAgain")%>\n    </div>\n    <div>\n        <%=$.i18n.t("ews:saveFileInstruction")%>\n    </div>\n    <div class="ews-button-container">\n       <button type="button" class="ews-retry-button" aria-label="<%=$.i18n.t(\'retry\')%>">\n            <%=$.i18n.t("retry")%>\n       </button>\n        <button type="button" class="ews-save-button" aria-label="<%=$.i18n.t(\'ews:saveFileBtn\')%>">\n            <%=$.i18n.t("ews:saveFileBtn")%>\n        </button>\n    </div>\n    <% } else {\n    %>\n    <div>\n        <%=$.i18n.t("ews:browseToSaveLoc")%>\n    </div>\n    <div class="ews-button-container">\n        <%=$.i18n.t("ews:responseFileLoc")%>\n        <input id="srf-file-input" type=\'text\'  disabled="disabled"  readonly="readonly"/>\n        <button type="button" class="ews-browse-button" aria-label="<%=$.i18n.t(\'browse\')%>">\n            <%=$.i18n.t("browse")%>\n        </button>\n        <button type="button" class="ews-save-exit-button" aria-label="<%=$.i18n.t(\'ews:saveAndExitBtn\')%>" disabled="disabled">\n            <%=$.i18n.t("ews:saveAndExitBtn")%>\n        </button>\n    </div>\n    <% }\n    %>\n</div>\n<% } else {%>\n\n<div class="ews-message">\n    <div>\n        <%= instruction %>\n    </div>\n    <div class="ews-button-container">\n        <button type="button" class="ews-exit-button" aria-label="<%=$.i18n.t(\'ews:extTestBtn\')%>">\n            <%=$.i18n.t("ews:extTestBtn")%>\n        </button>\n    </div>\n</div>\n\n<% } %>\n</div>\n\n'}),define("text!tpl/ews/saveLocation-mobile.html",[],function(){return'<div class="modal-header">\n    <div class="modal-title" aria-hidden="true">\n        <%= headerLabel %>\n    </div>\n</div>\n<div class="modal-body">\n<div class="ews-message">\n    <h5><%=$.i18n.t("generalWords:message")%> <%= messageNumber %></h5>\n</div>\n<div class="ews-message">\n    <div>\n        <%= message %>\n    </div>\n</div>\n<div class="ews-message">\n    <div>\n        <%= instruction %>\n    </div>\n    <div class="ews-button-container">\n        <% if ( showRetryButton ) { \n            %><button type="button" class="ews-retry-button" aria-label="<%=$.i18n.t(\'retry\')%>">\n           <%=$.i18n.t("retry")%>\n            </button><% \n        } %>\n        <button type="button" class="ews-close-button" aria-label="<%=$.i18n.t(\'ews:extTestBtn\')%>">\n            <%=$.i18n.t("ews:extTestBtn")%>\n        </button>\n    </div>\n</div>\n</div>'}),define("views/ews/SaveLocationDialog",["javascripts/backbone-min","models/ews/SaveLocationDialog","text!tpl/ews/saveLocation.html","text!tpl/ews/saveLocation-mobile.html"],function(e,t,n,i){var o=e.View.extend({template:_.template(n),mobileTemplate:_.template(i),model:new t,render:function(){this.options.mobile?this.$el.html(this.mobileTemplate(this.model.attributes)):this.$el.html(this.template(this.model.attributes))},events:{"click .ews-retry-button":"handler_RetryButtonClick","click .ews-browse-button":"handler_BrowseFile","click .ews-save-exit-button":"handler_SaveExitTest","click .ews-save-button":"handler_SaveButtonClick","click .ews-exit-button":"handler_ExitText"},handler_BrowseFile:function(e){TN8.Dispatcher.trigger("OpenFileBrowser","directory"),TN8.Dispatcher.on("SaveLocation",$.proxy(this.handler_SaveLocation,this))},handler_SaveLocation:function(e){TN8.Dispatcher.off("SaveLocation"),$("#srf-file-input").val(e),this.isSrfLocationValid(e)},handler_ExitText:function(e){TN8.Dispatcher.trigger("EWSExitApp")},handler_SaveExitTest:function(e){this.setSrfLocation($("#srf-file-input").val())},handler_RetryButtonClick:function(e){TN8.Dispatcher.trigger("EWSRetry")},handler_SaveButtonClick:function(e){this.model.set("retryStatement",!1),this.render()},isSrfLocationValid:function(e){TN8.EWSController.isSrfLocationValid(e,this.handler_isPathSuccess,this.handler_isPathFailure)},setSrfLocation:function(e){TN8.EWSController.setSrfLocation(e,this.handler_setPathSuccess,this.handler_setPathFailure)},handler_setPathSuccess:function(e){console.log(e),TN8.Dispatcher.trigger("EWSExitApp")},handler_setPathFailure:function(e){console.log(e)},handler_isPathSuccess:function(e){$(".ews-save-exit-button").attr("disabled",!1),console.log(e)},handler_isPathFailure:function(e){$(".ews-save-exit-button").attr("disabled","disabled"),console.log(e)}});return o}),define("models/ews/SrfLocationDialog",["javascripts/backbone-min"],function(e){var t=e.Model.extend({defaults:{headerLabel:"",messageNumber:"1017",
message:"",instruction:""},setUnableToSavePrimaryAttributes:function(e){var t={headerLabel:$.i18n.t("ews:ERR_UNABLE_TO_SAVE_PRE_START"),messageNumber:"1017",message:$.i18n.t("ews:primarySrfFailed"),locationTitle:$.i18n.t("ews:primaryLocat"),failedLocation:e,instruction:$.i18n.t("ews:chooseToContinue")};this.set(t)},setUnableToSaveAlternateAttributes:function(e){var t={headerLabel:$.i18n.t("ews:ERR_UNABLE_TO_SAVE_PRE_START"),messageNumber:"1018",message:$.i18n.t("ews:alternateSrfFailed"),locationTitle:$.i18n.t("ews:altLocation"),failedLocation:e,instruction:$.i18n.t("ews:chooseToContinue")};this.set(t)}});return t}),define("text!tpl/ews/srfLocation.html",[],function(){return'<div class="modal-header">\r\n    <div class="modal-title" aria-hidden="true">\r\n        <%= headerLabel %>\r\n    </div>\r\n</div>\r\n<div class="modal-body">\r\n<div class="ews-message">\r\n    <h5><%=$.i18n.t("message")%> <%= messageNumber %></h5>\r\n</div>\r\n<div class="ews-message">\r\n    <div>\r\n        <%= message %>\r\n    </div>\r\n</div>\r\n\r\n<div class="ews-message">\r\n    <div>\r\n        <%=$.i18n.t("ews:chooseToContinue")%>\r\n    </div>\r\n    <div class="ews-button-container">\r\n        <button type="button" class="ews-continue-button" aria-label="<%=$.i18n.t(\'continue\')%>">\r\n            <%=$.i18n.t("continue")%>\r\n        </button>\r\n        <button type="button" class="ews-exit-button" aria-label="<%=$.i18n.t(\'ews:extTestBtn\')%>">\r\n            <%=$.i18n.t("ews:extTestBtn")%>\r\n        </button>\r\n    </div>\r\n</div>\r\n</div>\r\n\r\n'}),define("views/ews/SrfLocationDialog",["javascripts/backbone-min","models/ews/SrfLocationDialog","text!tpl/ews/srfLocation.html"],function(e,t,n){var i=e.View.extend({template:_.template(n),model:new t,render:function(){this.$el.html(this.template(this.model.attributes)),$(".ews-continue-button").on("click",this.handler_ContinueButtonClick),$(".ews-exit-button").on("click",this.handler_ExitText)},handler_ExitText:function(e){TN8.Dispatcher.trigger("EWSButtonPressed","exit"),TN8.Dispatcher.trigger("EWSExitApp")},handler_ContinueButtonClick:function(e){TN8.Dispatcher.trigger("EWSContinue"),TN8.Dispatcher.trigger("EWSButtonPressed","continue")}});return i}),define("models/ews/BadFileDialog",["javascripts/backbone-min"],function(e){var t=e.Model.extend({defaults:{headerLabel:"",messageNumber:"1006",message:""},setCorruptFileAttributes:function(){var e={headerLabel:$.i18n.t("ews:ERR_RESPONSE_FILE_CORRUPT"),messageNumber:"1006",message:$.i18n.t("ews:srf_unreadable")};this.set(e)},setInvalidFileAttributes:function(){var e={headerLabel:$.i18n.t("ews:ERR_RESPONSE_FILE_INVALID"),messageNumber:"1007",message:$.i18n.t("ews:srf_invalid_token")};this.set(e)}});return t}),define("text!tpl/ews/badFile.html",[],function(){return'<div class="modal-header">\n    <div class="modal-title" aria-hidden="true">\n        <%= headerLabel %>\n    </div>\n</div>\n<div class="modal-body">\n<div class="ews-message">\n    <h5><%=$.i18n.t("generalWords:message")%> <%= messageNumber %></h5>\n</div>\n<div class="ews-message">\n    <div>\n        <%= message %>\n    </div>\n</div>\n<div class="ews-message">\n    <div class="ews-message">\n        <%= $.i18n.t("ews:primaryLocat") %> <%= primaryLocation %>\n    </div>\n    <div class="ews-message">\n        <%= $.i18n.t("ews:altLocation") %> <%= alternateLocation %>\n    </div>\n    <div class="ews-message">\n        <%= $.i18n.t("ews:responseFileName") %> <%= responseFileName %>\n    </div>\n    <div class="ews-message">\n        <%= $.i18n.t("ews:srfInstructions") %>\n    </div>\n    <div  class="ews-message">\n        <%= $.i18n.t("ews:responseFileLoc") %>\n        <input id="srf-file-input" type=\'text\'  disabled="disabled"  readonly="readonly"/>\n        <button type="button" class="ews-browse-button" aria-label="<%= $.i18n.t(\'browse\') %>">\n            <%= $.i18n.t("browse") %>\n        </button>\n        <button type="button" class="ews-Upload-button" aria-label="<%= $.i18n.t(\'ews:uploadResponseFile\') %>">\n            <%= $.i18n.t("ews:uploadResponseFile") %>\n        </button>\n    </div>\n    <div  class="ews-message">\n       <%= $.i18n.t("ews:orSkipUpload")%> <%= $.i18n.t("ews:skipUpload") %>\n    </div>\n    <div class="ews-button-container">\n        <button type="button" class="ews-continue-button" aria-label="<%= $.i18n.t(\'ews:skipUploadBtn\') %>">\n           <%= $.i18n.t("ews:skipUploadBtn") %>\n        </button>\n    </div>\n</div>\n</div>'}),define("text!tpl/ews/badFile-mobile.html",[],function(){return'<div class="modal-header">\n    <div class="modal-title" aria-hidden="true">\n        <%= headerLabel %>\n    </div>\n</div>\n<div class="modal-body">\n<div class="ews-message">\n    <h5><%=$.i18n.t("generalWords:message")%> <%= messageNumber %></h5>\n</div>\n<div class="ews-message">\n    <div>\n        <%= message %>\n    </div>\n</div>\n<div class="ews-message">\n    <div>\n        <%=$.i18n.t("ews:newDevice")%>\n    </div>\n    <div>\n        <%=$.i18n.t("ews:newDeviceExit") %>\n    </div>\n    <div>\n        <%= $.i18n.t("ews:skipUploadMob") %>\n    </div>\n    <div class="ews-button-container">\n        <button type="button" class="ews-close-button" aria-label="<%=$.i18n.t(\'ews:extTestBtn\') %>">\n            <%=$.i18n.t("ews:extTestBtn") %>\n        </button>\n        <button type="button" class="ews-continue-button" aria-label="<%=$.i18n.t(\'ews:skipUploadBtn\') %>">\n            <%=$.i18n.t("ews:skipUploadBtn") %>\n        </button>\n    </div>\n</div>\n</div>'}),define("views/ews/BadFileDialog",["javascripts/backbone-min","models/ews/BadFileDialog","text!tpl/ews/badFile.html","text!tpl/ews/badFile-mobile.html"],function(e,t,n,i){var o=e.View.extend({template:_.template(n),mobileTemplate:_.template(i),model:new t,render:function(){this.options.mobile?this.$el.html(this.mobileTemplate(this.model.attributes)):this.$el.html(this.template(this.model.attributes))},events:{"click .ews-close-button":"handler_ExitButtonClick","click .ews-continue-button":"handler_ContinueButtonClick","click .ews-browse-button":"handler_BrowseFile","click .ews-Upload-button":"handler_UploadSrfFile"},handler_ExitButtonClick:function(e){TN8.Dispatcher.trigger("EWSExitApp")},handler_ContinueButtonClick:function(e){TN8.Dispatcher.trigger("EWSContinue")},handler_UploadSrfFile:function(e){var t=$("#srf-file-input").val();""!==t&&TN8.EWSController.uploadSrf(t,this.uploadSuccess,this.uploadFailure)},handler_BrowseFile:function(e){TN8.Dispatcher.trigger("OpenFileBrowser"),TN8.Dispatcher.on("SetSrfPath",this.handler_SetSrfPath)},handler_SetSrfPath:function(e){TN8.Dispatcher.off("SetSrfPath"),$("#srf-file-input").val(e)},uploadSuccess:function(e){TN8.Dispatcher.trigger("EWSRetry")},uploadFailure:function(e){console.log("fail"),console.log(e),TN8.EWSController.showModal()}});return o}),define("models/ews/FileNotFoundDialog",["javascripts/backbone-min"],function(e){var t=e.Model.extend({defaults:{headerLabel:"",messageNumber:"1005",message:""}});return t}),define("text!tpl/ews/fileNotFound.html",[],function(){return'<div class="modal-header">\n    <div class="modal-title" aria-hidden="true">\n        <%= headerLabel %>\n    </div>\n</div>\n<div class="modal-body">\n<div class="ews-message">\n    <h5><%=$.i18n.t("generalWords:message")%> <%= messageNumber %></h5>\n</div>\n<div class="ews-message">\n    <div>\n        <%= message %>\n    </div>\n</div>\n<div class="ews-message">\n\n    <div class="ews-message">\n        <%=$.i18n.t("ews:browseForFileDesk")%>\n    </div>\n    <div class="ews-message">\n        <%=$.i18n.t("ews:responseFileName")%> <%= responseFileName %>\n    </div>\n\n    <div  class="ews-message">\n        <%=$.i18n.t("ews:responseFileLoc")%>\n        <input id="srf-file-input" type=\'text\'  disabled="disabled"  readonly="readonly"/>\n        <button type="button" class="ews-browse-button" aria-hidden="true">\n            <%=$.i18n.t("generalWords:browse")%>\n        </button>\n        <button type="button" class="ews-Upload-button" aria-hidden="true">\n            <%=$.i18n.t("ews:uploadResponseFile")%>\n        </button>\n    </div>\n    <div  class="ews-message">\n        <%=$.i18n.t("ews:locateSupport")%>\n    </div>\n    <div  class="ews-message">\n        <%=$.i18n.t("ews:skipUploadMob")%>\n    </div>\n    <div class="ews-button-container">\n        <button type="button" class="ews-continue-button" aria-label="<%=$.i18n.t(\'ews:skipUploadBtn\')%>">\n            <%=$.i18n.t("ews:skipUploadBtn")%>\n        </button>\n        <button type="button" class="ews-close-button" aria-label="<%=$.i18n.t(\'ews:extTestBtn\')%>">\n            <%=$.i18n.t("ews:extTestBtn")%>\n        </button>\n    </div>\n</div>\n</div>'}),define("text!tpl/ews/fileNotFound-mobile.html",[],function(){return'<div class="modal-header">\n    <div class="modal-title" aria-hidden="true">\n        <%= headerLabel %>\n    </div>\n</div>\n<div class="modal-body">\n<div class="ews-message">\n    <h5><%=$.i18n.t("generalWords:message")%> <%= messageNumber %></h5>\n</div>\n<div class="ews-message">\n    <div>\n        <%= message %>\n    </div>\n</div>\n<div class="ews-message">\n\n    <div class="ews-message">\n        <%=$.i18n.t("ews:fileNotFoundMob")%>\n    </div>\n    <div class="ews-message">\n        <%=$.i18n.t("ews:exitTestInfoDevice")%>\n    </div>\n\n    <div  class="ews-message">\n        <%=$.i18n.t("ews:skipUploadMob")%>\n    </div>\n    <div class="ews-button-container">\n        <button type="button" class="ews-continue-button" aria-label="<%=$.i18n.t(\'ews:skipUploadBtn\')%>">\n            <%=$.i18n.t("ews:skipUploadBtn")%>\n        </button>\n        <button type="button" class="ews-close-button" aria-label="<%=$.i18n.t(\'ews:extTestBtn\')%>">\n            <%=$.i18n.t("ews:extTestBtn")%>\n        </button>\n    </div>\n</div>\n</div>'}),define("views/ews/FileNotFoundDialog",["javascripts/backbone-min","models/ews/FileNotFoundDialog","text!tpl/ews/fileNotFound.html","text!tpl/ews/fileNotFound-mobile.html"],function(e,t,n,i){var o=e.View.extend({template:_.template(n),mobileTemplate:_.template(i),model:new t,render:function(){this.options.mobile?this.$el.html(this.mobileTemplate(this.model.attributes)):this.$el.html(this.template(this.model.attributes))},events:{"click .ews-close-button":"handler_ExitButtonClick","click .ews-continue-button":"handler_ContinueButtonClick","click .ews-browse-button":"handler_BrowseFile","click .ews-Upload-button":"handler_UploadSrfFile"},handler_ExitButtonClick:function(e){TN8.Dispatcher.trigger("EWSExitApp")},handler_ContinueButtonClick:function(e){TN8.Dispatcher.trigger("EWSContinue")},handler_UploadSrfFile:function(e){var t=$("#srf-file-input").val();TN8.EWSController.uploadSrf(t,this.uploadSuccess,this.uploadFailure)},handler_BrowseFile:function(e){TN8.Dispatcher.trigger("OpenFileBrowser"),TN8.Dispatcher.on("SetSrfPath",this.handler_SetSrfPath)},handler_SetSrfPath:function(e){TN8.Dispatcher.off("SetSrfPath"),$("#srf-file-input").val(e)},uploadSuccess:function(e){TN8.Dispatcher.trigger("EWSRetry")},uploadFailure:function(e){console.log("fail"),console.log(e),TN8.EWSController.showModal()}});return o}),define("models/ews/FailedSendDialog",["javascripts/backbone-min"],function(e){var t=e.Model.extend({defaults:{headerLabel:"",messageNumber:"1008",message:""}});return t}),define("text!tpl/ews/failedSend.html",[],function(){return'<div class="modal-header">\n    <div class="modal-title" aria-hidden="true">\n        <%= headerLabel %>\n    </div>\n</div>\n<div class="modal-body">\n<div class="ews-message">\n    <h5><%=$.i18n.t("generalWords:message")%> <%= messageNumber %></h5>\n</div>\n<div class="ews-message">\n    <div>\n        <%= message %>\n    </div>\n</div>\n<div class="ews-message">\n    <div>\n        <%=$.i18n.t("ews:responsesSavedAll")%>\n    </div>\n    <div class="ews-message">\n        <%=$.i18n.t("ews:primaryLocat")%> <%= primaryLocation %>\n    </div>\n    <div class="ews-message">\n        <%=$.i18n.t("ews:altLocation")%> <%= alternateLocation %>\n    </div>\n    <div class="ews-message">\n        <%=$.i18n.t("ews:responseFileName")%> <%= responseFileName %>\n    </div>\n    <div>\n        <%=$.i18n.t("ews:retryInfo")%>\n    </div>\n    <div>\n        <%=$.i18n.t("ews:exitTestInfoSubmit")%>\n       </div>\n    <div class="ews-button-container">\n        <button type="button" class="ews-retry-button" aria-label="<%=$.i18n.t(\'retry\')%>">\n            <%=$.i18n.t("retry")%>\n        </button>\n        <button type="button" class="ews-close-button" aria-label="<%=$.i18n.t(\'ews:extTestBtn\')%>">\n            <%=$.i18n.t("ews:extTestBtn")%>\n        </button>\n    </div>\n</div>\n</div>'}),define("text!tpl/ews/failedSend-mobile.html",[],function(){return'<div class="modal-header">\n    <div class="modal-title" aria-hidden="true">\n        <%= headerLabel %>\n    </div>\n</div>\n<div class="modal-body">\n<div class="ews-message">\n    <h5><%=$.i18n.t("generalWords:message")%> <%= messageNumber %></h5>\n</div>\n<div class="ews-message">\n    <div>\n        <%= message %>\n    </div>\n</div>\n<div class="ews-message">\n    <div>\n        <%=$.i18n.t("ews:responsesSavedAll")%>\n    </div>\n    <div>\n        <%=$.i18n.t("ews:retryInfo")%>\n    </div>\n    <div>\n        <%=$.i18n.t("ews:exitTestInfoSubmit")%>\n    </div>\n    <div class="ews-button-container">\n        <button type="button" class="ews-retry-button" aria-label="<%=$.i18n.t(\'retry\')%>">\n            <%=$.i18n.t("retry")%>\n        </button>\n        <button type="button" class="ews-close-button" aria-label="<%=$.i18n.t(\'ews:extTestBtn\')%>">\n            <%=$.i18n.t("ews:extTestBtn")%>\n        </button>\n    </div>\n</div>\n</div>'}),define("views/ews/FailedSendDialog",["javascripts/backbone-min","models/ews/FailedSendDialog","text!tpl/ews/failedSend.html","text!tpl/ews/failedSend-mobile.html"],function(e,t,n,i){var o=e.View.extend({template:_.template(n),mobileTemplate:_.template(i),model:new t,render:function(){this.options.mobile?this.$el.html(this.mobileTemplate(this.model.attributes)):this.$el.html(this.template(this.model.attributes))},events:{"click .ews-close-button":"handler_ExitButtonClick","click .ews-retry-button":"handler_RetryButtonClick"},handler_ExitButtonClick:function(e){TN8.Dispatcher.trigger("EWSExitApp")},handler_RetryButtonClick:function(e){TN8.Dispatcher.trigger("EWSRetry")}});return o}),define("models/ews/FailedLoadDialog",["javascripts/backbone-min"],function(e){var t=e.Model.extend({defaults:{headerLabel:"",messageNumber:"1009",message:""}});return t}),define("text!tpl/ews/failedLoad.html",[],function(){return'<div class="modal-header">\n    <div class="modal-title" aria-hidden="true">\n        <%= headerLabel %>\n    </div>\n</div>\n<div class="modal-body">\n<div class="ews-message">\n    <h5><%=$.i18n.t("generalWords:message")%> <%= messageNumber %></h5>\n</div>\n<div class="ews-message">\n    <div>\n        <%= message %>\n    </div>\n</div>\n<div class="ews-message">\n    <div>\n        <%=$.i18n.t("ews:resposnesSavedDesk")%>\n    </div>\n    <div class="ews-message">\n        <%=$.i18n.t("ews:primaryLocat")%> <%= primaryLocation %>\n    </div>\n    <div class="ews-message">\n        <%=$.i18n.t("ews:altLocation")%> <%= alternateLocation %>\n    </div>\n    <div class="ews-message">\n        <%=$.i18n.t("ews:responseFileName")%> <%= responseFileName %>\n    </div>\n\n    <div>\n        <%=$.i18n.t("ews:retryInfo")%>\n    </div>\n    <div>\n        <%=$.i18n.t("ews:exitTestInfoCompleteShort")%>\n     </div>\n    <div class="ews-button-container">\n        <button type="button" class="ews-retry-button" aria-label="<%=$.i18n.t(\'retry\')%>">\n            <%=$.i18n.t("retry")%>\n        </button>\n        <button type="button" class="ews-close-button" aria-label="<%=$.i18n.t(\'ews:extTestBtn\')%>">\n            <%=$.i18n.t("ews:extTestBtn")%>\n        </button>\n    </div>\n</div>\n</div>'}),define("text!tpl/ews/failedLoad-mobile.html",[],function(){return'<div class="modal-header">\n    <div class="modal-title" aria-hidden="true">\n        <%= headerLabel %>\n    </div>\n</div>\n<div class="modal-body">\n<div class="ews-message">\n    <h5><%=$.i18n.t("generalWords:message")%> <%= messageNumber %></h5>\n</div>\n<div class="ews-message">\n    <div>\n        <%= message %>\n    </div>\n</div>\n<div class="ews-message">\n    <div>\n        <%=$.i18n.t("ews:responsesSavedMob")%>\n    </div>\n    <div>\n        <%=$.i18n.t("ews:retryInfo")%>\n    </div>\n    <div>\n        <%=$.i18n.t("ews:exitTestInfoComplete")%>\n    </div>\n    <div class="ews-button-container">\n        <button type="button" class="ews-retry-button" aria-label="<%=$.i18n.t(\'retry\')%>">\n            <%=$.i18n.t("retry")%>\n        </button>\n        <button type="button" class="ews-close-button" aria-label="<%=$.i18n.t(\'ews:extTestBtn\')%>">\n            <%=$.i18n.t("ews:extTestBtn")%>\n        </button>\n    </div>\n</div>\n</div>'}),define("views/ews/FailedLoadDialog",["javascripts/backbone-min","models/ews/FailedLoadDialog","text!tpl/ews/failedLoad.html","text!tpl/ews/failedLoad-mobile.html"],function(e,t,n,i){var o=e.View.extend({template:_.template(n),mobileTemplate:_.template(i),model:new t,render:function(){this.options.mobile?this.$el.html(this.mobileTemplate(this.model.attributes)):this.$el.html(this.template(this.model.attributes))},events:{"click .ews-close-button":"handler_ExitButtonClick","click .ews-retry-button":"handler_RetryButtonClick"},handler_ExitButtonClick:function(e){TN8.Dispatcher.trigger("EWSExitApp")},handler_RetryButtonClick:function(e){TN8.Dispatcher.trigger("EWSRetry")}});return o}),define("text!tpl/ews/default.html",[],function(){return'<div class="modal-header">\n    <div class="modal-title" aria-hidden="true">\n        Unknown EWS Message\n    </div>\n</div>\n<div class="modal-body">\n<div class="ews-message">\n    <h5><%=$.i18n.t("generalWords:message")%> <%= message %></h5>\n</div>\n<div class="ews-message">\n    <%=$.i18n.t("ews:msgNumNotFound")%>\n</div>\n<div class="ews-message">\n    <div class="ews-button-container">\n        <button type="button" class="ews-continue-button" aria-label="<%=$.i18n.t(\'continue\') %>">\n            <%=$.i18n.t("continue") %>\n        </button>\n    </div>\n</div>\n</div>'}),define("views/ews/Default",["javascripts/backbone-min","text!tpl/ews/default.html"],function(e,t){var n=e.View.extend({template:_.template(t),model:{message:"default"},render:function(){this.$el.html(this.template(this.model))},events:{"click .ews-continue-button":"handler_ContinueButtonClick"},handler_ContinueButtonClick:function(e){TN8.Dispatcher.trigger("EWSContinue")}});return n}),define("text!tpl/file-browser.html",[],function(){return'<div id="file-browser-modal" >\n    <div  class="modal-header">\n        <button type="button" class="close close-file-browser" aria-label="<%= $.i18n.t(\'cancel\')%>">Ã—</button>\n        <h3 id="error-label"><%= $.i18n.t("ews:fileBrowser")%></h3>\n    </div>\n    <div class="modal-body">\n        <p class="modal-msg">\n            <div id="file-tree" >\n\n            </div>\n        </p>\n    </div>\n    <div class="modal-footer">\n        <button  class="btn btn-primary close-file-browser" aria-label="<%= $.i18n.t(\'cancel\')%>"><%= $.i18n.t("cancel")%></button>\n        <% if ( directory ) {\n        %>\n        <button  class="btn btn-primary choose-directory" aria-label="<%= $.i18n.t(\'save\')%>"><%= $.i18n.t("save")%></button>\n\n        <% } else {\n        %>\n        <!--<button  class="btn btn-primary open-directory"  aria-hidden="true">Open</button>-->\n\n        <% }\n        %>\n\n    </div>\n</div>'}),define("views/FileBrowserView",["javascripts/backbone-min","text!tpl/file-browser.html"],function(e,t){"use strict";var n=e.View.extend({currentPath:null,selectDirectory:!1,initialize:function(e){this.modalId="#file-browser-modal",this.template=_.template(t),TN8.Dispatcher.on("OpenFileBrowser",$.proxy(this.openFileBrowser,this))},render:function(){if(this.currentPath="",!this.isModalOpen())return $(this.el).append(this.template({directory:this.selectDirectory})),this.getLs(),this.showModal(),this.eventsOn(),this},events:{"dblclick .tree-leaf":"handler_LeafDblClicked","click .close-file-browser":"removeModal","click .choose-directory":"handler_ChooseDirectory","click .open-directory":"handler_OpenDirectory"},openFileBrowser:function(e){"directory"===e?this.selectDirectory=!0:this.selectDirectory=!1,this.render()},getModalWindow:function(){return $(this.modalId,this.el)},getLs:function(e){TN8.log("FileBrowserView.getLs . getFileList() to TestEngine.",TN8.CRITICAL),TestEngine.getNativeComponent().getFileList(e,this.updateModal,this.getFileListFailed)},updateModal:function(e){TN8.log("FileBrowserView.updateModal . ",TN8.CRITICAL);var t=document.createElement("ul");$(t).addClass("tree-ul");for(var n=0;n<e.length;n++){var i=document.createElement("li");$(i).addClass("tree-leaf"),$(i).text(e[n].name),$(i).attr("data-path",e[n].path),$(i).attr("tabindex","0"),$(t).append(i)}$("#file-tree").empty().append(t)},getFileListFailed:function(){TN8.log("FileBrowserView.getFileListFailed . ",TN8.CRITICAL)},showModal:function(){TN8.Dispatcher.trigger("FileBrowserOpen"),this.getModalWindow().show().tabRing()},removeModal:function(){var e=this.getModalWindow();e.hide(),this.undelegateEvents(),this.unbind(),e.tabRing("off").remove(),TN8.Dispatcher.off("SetSrfPath"),TN8.Dispatcher.off("SaveLocation"),TN8.Dispatcher.trigger("FileBrowserClose")},eventsOn:function(){this.delegateEvents(),this.bind()},isSrfFile:function(e){var t=e.text(),n=t.substring(t.length-4,t.length);return".SRF"===n||".srf"===n},isModalOpen:function(){return this.getModalWindow().length>0},sendPathBack:function(e){TN8.Dispatcher.trigger("SetSrfPath",e),this.removeModal()},handler_LeafDblClicked:function(e){var t=e.target;this.handler_GoDownTree(t)},handler_GoDownTree:function(e){var t=$(e).attr("data-path"),n=this.isSrfFile($(e));n&&!this.selectDirectory?this.sendPathBack(t):(this.currentPath=t,this.getLs(this.currentPath))},handler_ChooseDirectory:function(e){var t=this.currentPath;TN8.Dispatcher.trigger("SaveLocation",t),this.removeModal()},handler_OpenDirectory:function(e){var t=document.activeElement;$(t).hasClass("tree-leaf")&&this.handler_GoDownTree(t)}});return n}),define("controllers/EWSController",["javascripts/backbone-min","views/ews/EWSLaunch","views/ews/SaveLocationDialog","views/ews/SrfLocationDialog","views/ews/BadFileDialog","views/ews/FileNotFoundDialog","views/ews/FailedSendDialog","views/ews/FailedLoadDialog","views/ews/Default","views/FileBrowserView","controllers/ApplicationStatusController","views/ProgressBarView","controllers/ActionSubscriber"],function(e,t,n,i,o,r,s,a,l,c,d,u){"use strict";var h=e.Model.extend({ERR_UNABLE_TO_SAVE_PRE_START:1003,ERR_UNABLE_TO_SAVE_POST_START:1004,ERR_RESPONSE_FILE_NOT_FOUND:1005,ERR_RESPONSE_FILE_CORRUPT:1006,ERR_RESPONSE_FILE_INVALID:1007,ERR_UNABLE_TO_SEND_RESPONSE:1008,ERR_UNABLE_TO_LOAD_RESPONSE:1009,DUMMY_EWS:1013,CSS_LINK:1014,IMAGE_LOAD:1015,RELOAD_CSS:1016,PRIMARY_SRF_FAILED:1017,ALTERNATE_SRF_FAILED:1018,CAT_CONNECTION_FAILURE:1019,SECTION_BREAK_CONNECTION_FAILURE:1020,ERR_UNABLE_TO_SEND_RESPONSE_IN_TEST:1021,containerId:"ewsContainer",containerSelector:"#ewsContainer",currentView:null,errorNumber:0,retryFxn:null,retryArgs:null,isActive:!1,isVisible:!1,ewsQueue:[],EWSStatus:{ON:1,OFF:2,WAITING:3},thisClassName:"EWSController",initialize:function(e,t){_.bindAll(this);var n=document.createElement("div");n.id=this.containerId,n.className="modal hide",n.setAttribute("aria-live","assertive"),n.setAttribute("role","dialog"),$("#lastTabbable").before(n),d.subscribeCondition(d.actionNames.TurnOffModal,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.TurnOnModal,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.TurnOnProgressModal,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.TurnOffProgressModal,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.startItemTimer,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.startTimersectiontimer,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.startTimertesttimer,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.resumeItemTimer,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.ShowTimeOutModalsectiontimer,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.ShowTimeOutModaltesttimer,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.ShowTimeOutModaltimedTestOvertime,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.ShowTimeOutModaltimedSectionOvertime,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.ShowTimeOutModaluntimedTestOvertime,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.ShowTimeOutModaluntimedSectionOvertime,this.thisClassName,this.EWSStatus.OFF),d.subscribeCondition(d.actionNames.NavigateTo,this.thisClassName,this.EWSStatus.OFF),d.registerEvent(d.actionNames.EWSShow,"DoEWSShow","ErrEWSShow",$(document)),TN8.clearOn("DoEWSShow",this.showEWS),TN8.clearOn("ErrEWSShow",this.errorShowEWS),TN8.fnOn("cleanup.betweenTest",this._cleanup)},bindEvents:function(){TN8.Dispatcher.off("ClearSlate",this.handler_RefreshOnSuccessfulState),TN8.Dispatcher.off("EWSLaunch",this.handler_AcknowledgeLaunch),TN8.Dispatcher.off("EWSExitApp",this.handler_ExitApp),TN8.Dispatcher.off("EWSRetry",this.handler_Retry),TN8.Dispatcher.off("EWSContinue",this.handler_Continue),TN8.Dispatcher.off("EWSButtonPressed",this.handler_ButtonPressed),TN8.Dispatcher.on("ClearSlate",this.handler_RefreshOnSuccessfulState),TN8.Dispatcher.on("EWSLaunch",this.handler_AcknowledgeLaunch),TN8.Dispatcher.on("EWSExitApp",this.handler_ExitApp),TN8.Dispatcher.on("EWSRetry",this.handler_Retry),TN8.Dispatcher.on("EWSContinue",this.handler_Continue),TN8.Dispatcher.on("EWSButtonPressed",this.handler_ButtonPressed)},destroy:function(){this.currentView.undelegateEvents(),this.currentView.unbind(),TN8.Dispatcher.off(null,null,this)},showEWS:function(e,t){if(this.isVisible)return TN8.log("EWSController.ewsCallback error already visible: "+this.errorNumber+"; new error: "+t.errorMsg,TN8.CRITICAL),void this.ewsQueue.push(t);this.fileBrowser=new c({el:"#ewsContainer"}),this.mobile=TestEngine.isMobileDevice();var n=this.getSrfPath(),i=this.getSrfAltPath(),o=this.getSrfFileName();n=n?n:$.i18n.t("ews:pathUnavailable"),i=i?i:$.i18n.t("ews:pathUnavailable"),o=o&&"undefined.SRF"!==o?o:$.i18n.t("ews:pathUnavailable"),this.allPaths={primaryLocation:n,alternateLocation:i,responseFileName:o},this.failedSrfPath={primaryFailedLocation:this._hideCredentialsInPath(t.srfPrimary),alternateFailedLocation:this._hideCredentialsInPath(t.srfAlternate)},$(document).trigger("tn.ews.on",{num:t.errorMsg,msg:this.buildErrorDetails(t),errtype:"EWS"}),$(document).trigger("tn.pauseTimer"),$(document).trigger("itemTimer.pause"),$(document).trigger("tn.loadingModal.off"),$("#exhibits-modal").hide(),this.errorNumber=parseInt(t.errorMsg),TN8.log("EWSController.ewsCallback error number : "+this.errorNumber,TN8.CRITICAL),t.retryFunction instanceof Function?(this.retryFxn=t.retryFunction,this.retryArgs=t.retryFunctionArgs):(this.retryFxn=null,this.retryArgs=null),this.isVisible||(this.isActive?this.handler_AcknowledgeLaunch():this._showLaunchModal())},buildErrorDetails:function(e){return"1008"===e.errorcode?"Could not save responses for these items to the database: "+JSON.stringify(e.details):e.details},ewsCallback:function(e){d.execute(d.actionNames.EWSShow,e)},showModal:function(){d.statusChange(this.thisClassName,this.EWSStatus.ON),this.isVisible=!0;var e={backdrop:"static",keyboard:!1,show:!0};$(this.containerSelector).modal(e).tabRing();var t=$("#ewsContainer .modal-title").text();$(document).trigger("deepZoomLayer.setCoupling",{title:t,html:"#ewsContainer",specialCare:this.hideDZClose,specialCleanUp:this.showDZClose})},hideDZClose:function(){$("#deepZoomClose").hide()},showDZClose:function(){$("#deepZoomClose").show()},hideModal:function(){this.isVisible=!1,$(this.containerSelector).modal("hide").tabRing("off"),this.destroy(),1009!==this.errorNumber&&1004!==this.errorNumber&&d.statusChange(this.thisClassName,this.EWSStatus.OFF)},_isSRFError:function(){var e;switch(this.errorNumber){case this.ERR_RESPONSE_FILE_NOT_FOUND:case this.ERR_RESPONSE_FILE_CORRUPT:case this.ERR_RESPONSE_FILE_INVALID:case this.ERR_UNABLE_TO_SEND_RESPONSE:case this.ERR_UNABLE_TO_LOAD_RESPONSE:case this.CAT_CONNECTION_FAILURE:case this.SECTION_BREAK_CONNECTION_FAILURE:e=!1;break;case this.ERR_UNABLE_TO_SAVE_PRE_START:case this.ERR_UNABLE_TO_SAVE_POST_START:default:e=!0}return e},_showLaunchModal:function(){this.currentView=new t({el:this.containerSelector});var e=this._isSRFError()?this.currentView.EWS_WITH_SRF_ERROR:this.currentView.EWS_WITH_SRF_SAVE;this.currentView.setOption(e),this.currentView.render(),this.showModal()},_showSaveDialog:function(){this.currentView=new n({el:this.containerSelector,mobile:this.mobile}),this.errorNumber==this.ERR_UNABLE_TO_SAVE_POST_START?(this.currentView.model.setUnableToSavePostStartAttributes(),this.currentView.model.set(this.allPaths)):this.currentView.model.setUnableToSavePreStartAttributes(),this.currentView.render(),this.showModal()},_showFileNotFoundDialog:function(){this.currentView=new r({el:this.containerSelector,mobile:this.mobile});var e={headerLabel:$.i18n.t("ews:ERR_RESPONSE_FILE_NOT_FOUND"),message:$.i18n.t("ews:srf_not_found")},t=$.extend(!0,this.allPaths,e);this.currentView.model.set(t),this.currentView.render(),this.showModal()},_showBadFileDialog:function(){this.currentView=new o({el:this.containerSelector,mobile:this.mobile}),this.errorNumber===this.ERR_RESPONSE_FILE_CORRUPT?(this.currentView.model.setCorruptFileAttributes(),this.currentView.model.set(this.allPaths)):(this.currentView.model.setInvalidFileAttributes(),this.currentView.model.set(this.allPaths)),this.currentView.render(),this.showModal()},_showFailedSendDialog:function(){this.currentView=new s({el:this.containerSelector,mobile:this.mobile});var e=this.errorNumber==this.ERR_UNABLE_TO_SEND_RESPONSE_IN_TEST?$.i18n.t("ews:ERR_UNABLE_TO_SEND_RESPONSE_IN_TEST"):$.i18n.t("ews:ERR_UNABLE_TO_SEND_RESPONSE"),t={headerLabel:e,message:$.i18n.t("ews:server_unavailable"),messageNumber:this.errorNumber},n=$.extend(!0,this.allPaths,t);this.currentView.model.set(n),this.currentView.render(),this.showModal()},_showFailedLoadDialog:function(){this.currentView=new a({el:this.containerSelector,mobile:this.mobile});var e={headerLabel:$.i18n.t("ews:ERR_UNABLE_TO_LOAD_RESPONSE"),message:$.i18n.t("ews:server_unavailable"),messageNumber:this.errorNumber},t=$.extend(!0,this.allPaths,e);this.currentView.model.set(t),this.currentView.render(),this.showModal()},_showConnectionFailedLoadDialog:function(){this.currentView=new a({el:this.containerSelector,mobile:this.mobile});var e={headerLabel:$.i18n.t("ews:CONNECTION_FAILURE"),message:$.i18n.t("ews:server_unavailable"),messageNumber:this.errorNumber},t=$.extend(!0,this.allPaths,e);this.currentView.model.set(t),this.currentView.render(),this.showModal()},_showSrfLocationDialog:function(e){this.currentView=new i({el:this.containerSelector}),this.errorNumber==this.PRIMARY_SRF_FAILED?this.currentView.model.setUnableToSavePrimaryAttributes(e):this.errorNumber==this.ALTERNATE_SRF_FAILED&&this.currentView.model.setUnableToSaveAlternateAttributes(e),this.currentView.render(),this.showModal()},_showDefaultDialog:function(){this.currentView=new l({el:this.containerSelector,model:{message:this.errorNumber}}),this.errorNumber===this.ERR_RESPONSE_FILE_CORRUPT?this.currentView.model.set({headerLabel:$.i18n.t("ews:ERR_RESPONSE_FILE_CORRUPT"),message:$.i18n.t("ews:srf_unreadable")}):this.errorNumber===this.ERR_UNABLE_TO_LOAD_RESPONSE?this.currentView.model.set({
headerLabel:$.i18n.t("ews:ERR_UNABLE_TO_LOAD_RESPONSE"),message:$.i18n.t("ews:server_unavailable")}):this.errorNumber===this.ERR_UNABLE_TO_SEND_RESPONSE?this.currentView.model.set({headerLabel:$.i18n.t("ews:ERR_UNABLE_TO_SEND_RESPONSE"),message:$.i18n.t("ews:server_unavailable")}):this.errorNumber===this.ERR_RESPONSE_FILE_NOT_FOUND?this.currentView.model.set({headerLabel:$.i18n.t("ews:ERR_RESPONSE_FILE_NOT_FOUND"),message:$.i18n.t("ews:srf_not_found")}):this.errorNumber===this.ERR_UNABLE_TO_SAVE_PRE_START&&this.currentView.model.set({headerLabel:$.i18n.t("ews:ERR_UNABLE_TO_SAVE_PRE_START"),message:$.i18n.t("ews:testing_cannot_continue"),instruction:$.i18n.t("ews:exit_test")}),this.currentView.render(),this.showModal()},handler_AcknowledgeLaunch:function(e){switch(this.isActive=!0,this.hideModal(),this.errorNumber){case this.ERR_UNABLE_TO_SAVE_PRE_START:case this.ERR_UNABLE_TO_SAVE_POST_START:this._showSaveDialog();break;case this.ERR_RESPONSE_FILE_NOT_FOUND:this._showFileNotFoundDialog();break;case this.ERR_RESPONSE_FILE_CORRUPT:case this.ERR_RESPONSE_FILE_INVALID:this._showBadFileDialog();break;case this.ERR_UNABLE_TO_SEND_RESPONSE:case this.ERR_UNABLE_TO_SEND_RESPONSE_IN_TEST:this._showFailedSendDialog();break;case this.ERR_UNABLE_TO_LOAD_RESPONSE:case this.DUMMY_EWS:case this.CSS_LINK:case this.IMAGE_LOAD:case this.RELOAD_CSS:this._showFailedLoadDialog();break;case this.CAT_CONNECTION_FAILURE:case this.SECTION_BREAK_CONNECTION_FAILURE:this._showConnectionFailedLoadDialog();break;case this.PRIMARY_SRF_FAILED:this._showSrfLocationDialog(this.failedSrfPath.primaryFailedLocation);break;case this.ALTERNATE_SRF_FAILED:this._showSrfLocationDialog(this.failedSrfPath.alternateFailedLocation);break;default:this._showDefaultDialog()}},handler_ExitApp:function(e){TN8.log("EWSController.handler_ExitApp .",TN8.CRITICAL),d.statusChange(this.thisClassName,this.EWSStatus.OFF),this.hideModal(),$(document).trigger("navigate.EmergencyExit")},handler_Retry:function(e){TN8.log("EWSController.handler_Retry .",TN8.CRITICAL),d.statusChange(this.thisClassName,this.EWSStatus.WAITING),this.hideModal(),this.showLoadingOrProgress(),this.retryFxn instanceof Function&&this.retryFxn.apply(this,this.retryArgs)},ewsRetrySucessfull:function(){if(TN8.log("EWSController.ewsRetrySucessfull "+this.errorNumber,TN8.CRITICAL),this.ewsQueue.length>0){var e=this.ewsQueue.splice(0,1)[0];this.ewsCallback(e)}else d.statusChange(this.thisClassName,this.EWSStatus.OFF),d.execute(d.actionNames.TurnOffModal),d.execute(d.actionNames.TurnOffProgressModal),this.errorNumber=0,$(document).trigger("tn.resumeTimer"),$(document).trigger("itemTimer.resume"),$(document).trigger("tn.ews.off")},handler_Continue:function(e){TN8.log("EWSController.handler_Continue .",TN8.CRITICAL),this.showLoadingOrProgress(),this.retryFxn instanceof Function&&(this.retryArgs?this.retryArgs.push(!0):this.retryArgs=[!0],this.retryFxn.apply(this,this.retryArgs)),this.hideModal()},showLoadingOrProgress:function(){u.exists?$(document).trigger("tn.progressBar.on"):$(document).trigger("tn.loadingModal.on")},handler_ButtonPressed:function(e){$(document).trigger("tn.ews.button",{num:this.errorNumber,msg:e,errtype:"EWS"})},handler_RefreshOnSuccessfulState:function(e){this.isActive=!1},getSrfPath:function(){return TN8.log("EWSController.getSrfPath . getSRFPath() called made to testengine.",TN8.CRITICAL),this._hideCredentialsInPath(TestEngine.getNativeComponent().getSRFPath())},getSrfAltPath:function(){return TN8.log("EWSController.getSrfAltPath . getSrfAltPath() called made to testengine.",TN8.CRITICAL),this._hideCredentialsInPath(TestEngine.getNativeComponent().getSrfAltPath())},_hideCredentialsInPath:function(e){return e||(e=""),this._isSftpUrl(e)&&(e=this._hideSFTPCredentials(e)),e},_hideSFTPCredentials:function(e){var t,n,i,o="sftp://",r=o.length,s=e.indexOf(":",r),a=e.lastIndexOf("@"),l=a!==-1,c=s>r&&s<a;return e.startsWith(o)?l?c?(n="*".repeat(s-r),i="*".repeat(a-s-1),t=o+n+":"+i+e.substring(a,e.length)):t="":t=e:t="",t},_isSftpUrl:function(e){return e.toLowerCase().startsWith("sftp:")},getSrfFileName:function(){return TN8.log("EWSController.getSrfFileName . getSrfFileName() called made to testengine.",TN8.CRITICAL),TestEngine.getNativeComponent().getSrfFileName()},uploadSrf:function(e,t,n){if(TN8.log("EWSController.uploadSrf . uploadSrf() called made to testengine.",TN8.CRITICAL),0!==e.trim().length)return this.showLoadingOrProgress(),TestEngine.getNativeComponent().uploadSrf(e,t,n)},setSrfLocation:function(e,t,n){TN8.log("EWSController.setSrfLocation . setSrfLocation() called made to testengine.",TN8.CRITICAL),TestEngine.getNativeComponent().setSrfLocation(e,t,n)},isSrfLocationValid:function(e,t,n){TN8.log("EWSController.isSrfLocationValid . isSrfLocationValid() called made to testengine.",TN8.CRITICAL),TestEngine.getNativeComponent().isSrfLocationValid(e,t,n)},_cleanup:function(){this.currentView&&this.destroy(),d.statusChange(this.thisClassName,this.EWSStatus.OFF),this.errorNumber=0,this.isVisible=!1,this.retryFxn=null,this.retryArgs=null,this.ewsQueue=[]}});return new h}),define("tools/inactivityTimer",[],function(){var e=function(){return this._curTimeout=0,this._maxTimeout=0,this._timer=null,this._lastTimestamp=null,this._startListening=this._startListening.bind(this),this._handleStartEvents=this._handleStartEvents.bind(this),this._destroy=this._destroy.bind(this),this._resetTimer=this._resetTimer.bind(this),this._updateTimer=this._updateTimer.bind(this),this._doExtraLogging=!1,this._closeWarningGrowlEvents="tn.nav.start  tn.exitmodal.show inform.timeoutModalOn tn.error.fatal tn.ews.on",this._isWarningShown=!1,this._warningSeconds=30,this._activityEvents="mousemove mousedown mouseup click touchstart touchend touchmove keydown keyup keypress",this._startEvents="inform.selectTestDone",this._destroyEvents="cleanup.betweenTest perform.exitApplication navigate.EmergencyExit tn.errorPage",this};return e.prototype.init=function(){this._startListening()},e.prototype._startListening=function(){$(document).off(this._startEvents,this._handleStartEvents).on(this._startEvents,this._handleStartEvents),$(document).off(this._destroyEvents,this._destroy).on(this._destroyEvents,this._destroy)},e.prototype._handleStartEvents=function(){var e=3!==parseInt(TestEngine.getAuthentication().getCurrentForm().getTestSecurityLevel());e&&TN8.Application&&TN8.Application.config&&TN8.Application.config.inactivity_timer&&TN8.Application.config.inactivity_timer>0&&(this._lastTimestamp=Date.now(),this._maxTimeout=this._curTimeout=6e4*TN8.Application.config.inactivity_timer,TN8.log("Inactivity timeout is active. Timeout is "+TN8.Application.config.inactivity_timer+" minutes.",TN8.IMPORTANT),this._createTimer())},e.prototype._createTimer=function(){this._doExtraLogging=window.doInactivityTimerLogging===!0,$(document).on(this._activityEvents,this._resetTimer),$(document).on(this._activityEvents+" "+this._closeWarningGrowlEvents,this._closeWarning),this._updateTimer()},e.prototype._resetTimer=function(e){this._doExtraLogging&&console.log("Inactivity timer reset by: "+e.type),this._curTimeout=this._maxTimeout,this._isWarningShown=!1},e.prototype._updateTimer=function(){var e=Date.now(),t=this._timeBetween(e,this._lastTimestamp);this._curTimeout-=t,this._lastTimestamp=e,this._doExtraLogging&&console.log("#### update inactivity timer: Diff millis between ticks: "+t+", Time left: "+this._curTimeout+" millis"),this._curTimeout>0?this._timer=window.setTimeout(this._updateTimer,1e3):this._timeExpired(),this._curTimeout<1e3*this._warningSeconds&&this._curTimeout>1&&!this._isWarningShown&&this._showWarning()},e.prototype._timeBetween=function(e,t){var n=e-t;return n<0&&(n=0),n},e.prototype._timeExpired=function(){TN8.log("Inactivity Timer: User logged out due to inactivity!",TN8.IMPORTANT),$(document).off(this._activityEvents,this._resetTimer),$(document).off(this._activityEvents+" "+this._closeWarningGrowlEvents,this._closeWarning);var e=$.i18n.t("errorMessages:"+TN8.errorType.INACTIVITY_TIMEOUT);TN8.Application.exitWithoutAskingNotify({message:e,errorType:TN8.errorType.INACTIVITY_TIMEOUT})},e.prototype._showWarning=function(){var e=$.i18n.t("errorMessages:inactivityTimeWarn").replace("__sec__",this._warningSeconds),t={theme:"warning",life:1e3*this._warningSeconds,sticky:!1,group:"inactivitywarn"};$.jGrowl(e,t),this._isWarningShown=!0},e.prototype._closeWarning=function(){$("div.jGrowl").find(".inactivitywarn").trigger("jGrowl.close"),this._isWarningShown=!1},e.prototype._destroy=function(){$(document).off(this._activityEvents,this._resetTimer),$(document).off(this._activityEvents+" "+this._closeWarningGrowlEvents,this._closeWarning),window.clearTimeout(this._timer),this._timer=null,this._isWarningShown=!1},e}),define("views/tests/availableParts",["javascripts/backbone-min","views/tests/availableTests"],function(e,t){"use strict";var n=t.extend({initialize:function(e){t.prototype.initialize.call(this),this.callback=e},render:function(){return TN8.log("availableParts.render  . ",TN8.HELPFUL),this.testCollection={toJSON:function(){return TN8.Application.DataProvider.getStartTestInfo().parts}},t.prototype.render.call(this,arguments),$(document).trigger("inform.availablePartsLoaded"),$(document).trigger("tn.availableParts.render"),this},refreshAvailableTest:function(){this.render()},makeTable:function(e){for(var n=[],i=0;i<e.length;i++){var o;switch(e[i].partStatus){case"N":case"C":case"I":case"R":o=e[i].partStatus;break;case"E":o="R";break;default:o="N"}"C"!==o&&n.push({testName:e[i].id,formId:e[i].id,formNumber:e[i].id,testStatusInd:o,disable:!1,unlockTest:e[i].unlockPart,validSchedule:!0})}t.prototype.makeTable.call(this,n)},handleStartTest:function(e){var t=$(e.currentTarget);if(t.hasClass("startTest")&&!t.is('[aria-disabled="true"]')){e.preventDefault();var n=t.data("testid"),i=TestEngine.getTestDefine().getPartById(n);TestEngine.getNavigation().navigateTestPart(i),$(document).trigger("tn.loadingModal.on"),$(document).trigger("testState.setPartStatus","I"),this.callback({startTest:!0})}}});return n});var DeepZoomController=function(){this._coupling=void 0,this.isActive=!1,this.positionDetails={},this._closeEvents="deepZoomLayer.detachCoupling timerTimeout navigate.EmergencyExit tn.nav.start exitWithoutAsking tn.ews.off contrast.modal.close Inform.fatalError overtimeSpecifiedStart destroyTimedOvertime",this._couplingQueue=[],this.init()};DeepZoomController.prototype.init=function(){if(!$("#deepZoomLayer")[0]){var e=$("<div>",{id:"deepZoomLayer"}).append($("<div>",{id:"deepZoomHeader"}).append($("<span>",{id:"deepZoomTitle"})).append($("<button>",{id:"deepZoomClose",class:"close",tabindex:0}).append($("<i>",{class:"icon-remove"})))).append($("<div>",{id:"deepZoomLayerBody"}));$("body").prepend(e),$("#deepZoomLayer").hide(),this._attachListeners()}this._zoomCheck()},DeepZoomController.prototype._attachListeners=function(){$("#deepZoomClose").on("keydown",$.proxy(this._handleCloseKeydown,this)),$("#deepZoomClose").on("click",$.proxy(this._close,this)),$(document).on(this._closeEvents,$.proxy(this._close,this)),$(document).on("deepZoomLayer.setCoupling",$.proxy(this._setCoupling,this)),$(window).on("resize",$.proxy(this._zoomCheck,this)),$(document).on("ItemController.ItemLoaded",$.proxy(this._notifyStatus,this)),$(document).on("deepZoomLayer.getStatus",$.proxy(this._getStatus,this)),$("#deepZoomLayer").on("scroll",$.proxy(this._adjustHeaderPosition,this)),$("#deepZoomLayer").on("focusout",function(e){e.stopPropagation()})},DeepZoomController.prototype._detachListeners=function(){$("#deepZoomClose").off("keydown",$.proxy(this._handleCloseKeydown,this)),$("#deepZoomClose").off("click",$.proxy(this._close,this)),$(document).off(this._closeEvents,$.proxy(this._close,this)),$(document).off("deepZoomLayer.setCoupling",$.proxy(this._setCoupling,this)),$(window).off("resize",$.proxy(this._zoomCheck,this)),$(document).off("ItemController.ItemLoaded",$.proxy(this._notifyStatus,this)),$(document).off("deepZoomLayer.getStatus",$.proxy(this._getStatus,this)),$("#deepZoomLayer").off("scroll",$.proxy(this._adjustHeaderPosition,this)),$("#deepZoomLayer").off("focusout",function(e){e.stopPropagation()})},DeepZoomController.prototype._notifyStatus=function(){this.isActive&&$(document).trigger("deepZoomLevel.enter")},DeepZoomController.prototype._getStatus=function(e,t){t(this.isActive)},DeepZoomController.prototype._isAboveDeepZoomThreshold=function(){return window.innerWidth>480},DeepZoomController.prototype._zoomCheck=function(){this._isAboveDeepZoomThreshold()?this._disableOnZoomOut():this._enableOnZoomIn()},DeepZoomController.prototype._disableOnZoomOut=function(){this.isActive&&(this.isActive=!1,$(document).trigger("deepZoomLevel.exit")),this._coupling&&(this._removeCloseButtonHandlers(),this._hide(),this._coupling=null)},DeepZoomController.prototype._enableOnZoomIn=function(){this.isActive||(this.isActive=!0,$(document).trigger("deepZoomLevel.enter")),this._coupling&&this._activateCoupling()},DeepZoomController.prototype._makeCouplingObject=function(e){var t={html:e.html,title:e.title,hideCallback:e.hideCallback,hideCloseButton:!!e.hideCloseButton,closeButtons:e.closeButtons,specialCare:e.specialCare,specialCleanUp:e.specialCleanUp,showing:!1};return t},DeepZoomController.prototype._setCoupling=function(e,t){if(this.isActive){var n=this._makeCouplingObject(t);this._coupling?this._couplingQueue.push(n):(this._coupling=n,this._activateCoupling())}},DeepZoomController.prototype._activateCoupling=function(){if(!this._coupling.showing){var e=$("#deepZoomClose");this._coupling.hideCloseButton?e.addClass("hidden"):e.removeClass("hidden"),this._acceptHTML(this._coupling),this._addCloseButtonHandlers(),this._coupling.showing=!0}},DeepZoomController.prototype._addCloseButtonHandlers=function(){var e=this._coupling.closeButtons;if(e)for(var t=0;t<e.length;t++){var n=$("#deepZoomLayerBody").find(e[t]);n.on("click",$.proxy(this._close,this))}},DeepZoomController.prototype._removeCloseButtonHandlers=function(){var e=this._coupling.closeButtons;if(e)for(var t=0;t<e.length;t++){var n=$("#deepZoomLayerBody").find(e[t]);n.off("click",$.proxy(this._close,this))}},DeepZoomController.prototype._acceptHTML=function(e){if(this.isActive){var t=$(e.html);this.positionDetails.parent=$(e.html)[0].parentElement,this.positionDetails.previousSibling=$(e.html)[0].previousSibling,this.positionDetails.nextSibling=$(e.html)[0].nextSibling,$("#deepZoomLayerBody").append(t),$("#deepZoomTitle").empty().append(e.title),this._show()}},DeepZoomController.prototype._show=function(){$("body").css("overflow","hidden"),this._resetHeaderPosition(),$("#deepZoomLayer").show(),"on"===$("#deepZoomLayerBody :first").data("tabRing")&&$("#deepZoomLayerBody :first").tabRing("off"),this._coupling.specialCare&&this._coupling.specialCare(),$("#deepZoomLayer").tabRing(),window.setTimeout(function(){$("#deepZoomLayer")&&$("#deepZoomLayer").scrollTop(0).scrollLeft(0)},20)},DeepZoomController.prototype._hide=function(){$("#deepZoomLayer").tabRing("off"),this._replaceHtml(),$("body").css("overflow",""),$("#deepZoomLayer").hide(),$("#deepZoomLayerBody").empty()},DeepZoomController.prototype._close=function(){if(this._coupling){this._removeCloseButtonHandlers(),this._hide();var e=this._coupling.html;this._coupling.hideCallback&&this._coupling.hideCallback(),this._coupling=void 0,$(e).trigger("deepZoomLayer.hide"),this._couplingQueue.length>0&&(this._coupling=this._couplingQueue.shift(),this._activateCoupling())}},DeepZoomController.prototype._handleCloseKeydown=function(e){13!==e.which&&32!==e.which||(e.preventDefault(),$("#deepZoomClose").click())},DeepZoomController.prototype._replaceHtml=function(){this._coupling.specialCleanUp&&this._coupling.specialCleanUp(),$(".deepZoomHtml").remove();var e=$("#deepZoomLayerBody :first");"off"===e.data("tabRing")&&e.tabRing(),this.positionDetails.previousSibling?$(this.positionDetails.previousSibling).after(e[0]):this.positionDetails.nextSibling?$(this.positionDetails.nextSibling).before(e[0]):$(this.positionDetails.parent).append(e[0]),this.positionDetails={}},DeepZoomController.prototype._adjustHeaderPosition=function(){var e=$("#deepZoomLayer")[0].scrollLeft;this._coupling&&this._coupling.showing&&e+"px"!==$("#deepZoomHeader").css("margin-left")&&$("#deepZoomHeader").css("margin-left",e)},DeepZoomController.prototype._resetHeaderPosition=function(){$("#deepZoomHeader").css("margin-left",0)},DeepZoomController.prototype.destroy=function(){this._detachListeners(),$("#deepZoomLayer").remove()},TN8.deepZoomLayer=new DeepZoomController,define("util/fsDeepZoom",function(){}),define("util/ItemBehaviors",[],function(){window.itemBehaviors={behaviors:[],applied:[],scrolled:!1,load:function(e){this.behaviors.push(e)},clear:function(e){this.behaviors.splice(0,this.behaviors.length),this.scrolled=!1,e&&this.applied.splice(0,this.applied.length)},reapplyAll:function(){this.scrolled=!1,this.applyAll(this.applied)},applyAll:function(e){var t=!1;e||(e=this.behaviors,t=!0);var n;for(var i in e)n=e[i].behavior,t&&this.applied.push(e[i]),this.applied[i].id&&this.applied[i].id.length>0&&("behavior-highlight"===n?this.highlight(e[i].id):"behavior-highlightscroll"===n?this.highlightscroll(e[i].id):"behavior-scroll"===n&&this.doScroll(e[i].id))},removeAll:function(){if(0!==this.applied.length)for(var e in this.applied)this.applied[e].id.length>0&&$("#"+this.applied[e].id).removeClass("highlightColor")},highlight:function(e){$("#"+e).addClass("highlightColor")},highlightscroll:function(e){this.doScroll(e),this.highlight(e)},doScroll:function(e){if(!this.scrolled){this.scrolled=!0;var t,n,i;t=$("div.passage-scrolling"),t.length>0&&(n=$(t).position().top+2,i=$("#"+e).get(0).offsetTop-n-20,$(t).scrollTop(i))}}}});var template=function(e,t){var n,i=/\\|'|\r|\n|\t|\u2028|\u2029/g,o={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},r={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},a=function(e){return null==e?"":(""+e).replace(/[&<>"'\/]/g,function(e){return s[e]})},l=new RegExp([r.escape.source,r.interpolate.source,r.evaluate.source].join("|")+"|$","g"),c=0,d="__p+='";e.replace(l,function(t,n,r,s,a){return d+=e.slice(c,a).replace(i,function(e){return"\\"+o[e]}),n&&(d+="'+\n((__t=("+n+"))==null?'':escapeReplace(__t))+\n'"),r&&(d+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),s&&(d+="';\n"+s+"\n__p+='"),c=a+t.length,t}),d+="';\n",d="with(obj||{}){\n"+d+"}\n",d="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+d+"return __p;\n";try{n=new Function("escapeReplace","obj",d)}catch(e){throw e.source=d,e}var u=t?n(a,t):n(a);return u};define("util/template",function(){}),function(e){e.fn.nativeScroll=function(t){function n(){a.css({overflow:l,"-webkit-overflow-scrolling":"touch"}).attr("tabindex",0)}function i(){l="auto",n()}function o(){l="auto",n()}function r(){}function s(){}var a=e(this),l="auto";return n(),{show:i,hide:o,remove:r,resize:s}}}(jQuery),define("javascripts/jquery.nativescroll",["javascripts/jquery"],function(){}),define("timer/TimerUnit",[],function(){var e=function(e){return _.bindAll(this),this._timerInterval=null,this._isRunning=!1,this.timeLeftSeconds=null,this._isInitialized=!1,this._isTimeout=!1,e&&$.extend(!0,this,_.pick(e,"timeLeftSeconds","onTickCallback","onTimeoutCallback")),this};return e.prototype.initialize=function(){this._isInitialized=!0},e.prototype.setMaxTime=function(e){this.timeLeftSeconds=e},e.prototype.onTick=function(){this.onTickCallback&&this.onTickCallback()},e.prototype.onTimeout=function(){this._isTimeout=!0,this.onTimeoutCallback&&this.onTimeoutCallback()},e.prototype._onInterval=function(){this.onTick(),this._checkTime()},e.prototype._checkTime=function(){null!==this.timeLeftSeconds&&this.getTimeElapsed()>=this.timeLeftSeconds&&(this.onTimeout(),this.pause())},e.prototype.setInterval=function(){this._timerInterval=window.setInterval(this._onInterval,1e3)},e.prototype.getTimeElapsed=function(){},e.prototype.start=function(e){this._isInitialized||this.initialize(),this.setInterval(),this._isRunning=!0},e.prototype.resume=function(){this._isRunning||this._isTimeout||(this.setInterval(),this._isRunning=!0)},e.prototype.pause=function(){this._isRunning&&(clearInterval(this._timerInterval),this._timerInterval=!1,this._isRunning=!1)},e.prototype.destroy=function(){clearInterval(this._timerInterval),this._timerInterval=null,this._isRunning=!1,this.timeLeftSeconds=null,this._isInitialized=!1},e.prototype.isRunning=function(){return this._isRunning},e.prototype.isTimeout=function(){return this._isTimeout},e}),define("timer/TimerIntervalUnit",["timer/TimerUnit"],function(e){var t=function(t){return e.call(this,t),_.bindAll(this),this._secondsElapsed=0,this};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.$super=e.prototype,t.prototype._onInterval=function(){this._changeTime(),this.$super._onInterval.call(this)},t.prototype._changeTime=function(){this._secondsElapsed++},t.prototype.getTimeElapsed=function(){return this._secondsElapsed},t}),define("timer/TimerTimeStampUnit",["timer/TimerUnit"],function(e){var t=function(t){return e.call(this,t),this._pausedTimeStamp=null,this._startTimeStamp=null,this._millisPaused=0,this._millisStartTime=0,this};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.$super=e.prototype,t.prototype.start=function(){this._startTimeStamp=Date.now(),this.$super.start.call(this)},t.prototype.resume=function(){this._isRunning||(this._pausedTimeStamp&&(this._millisPaused+=Date.now()-this._pausedTimeStamp),this._pausedTimeStamp=null,this.$super.resume.call(this))},t.prototype.pause=function(){this._isRunning&&(this._pausedTimeStamp=Date.now(),this.$super.pause.call(this))},t.prototype.getTimeElapsed=function(){var e=this._isRunning?Date.now():this._pausedTimeStamp;return(e-this._startTimeStamp-this._millisPaused)/1e3},t}),define("timer/CountUpTimer",["timer/TimerIntervalUnit","timer/TimerTimeStampUnit","timer/TimerUtils"],function(e,t,n){var i=function(n){var i={isTimeStamp:!1,prevValue:0};return i=$.extend(!0,i,n),{timerUnit:null,init:function(){_.bindAll(this);var n={onTickCallback:i.onTickCallback,onTimeoutCallback:i.onTimeoutCallback};i.isTimeStamp?this.timerUnit=new t(n):this.timerUnit=new e(n)},getTimeElapsed:function(){return this.timerUnit.getTimeElapsed()+i.prevValue},getTimerUnit:function(){return this.timerUnit},destroy:function(){this.timerUnit.destroy(),delete this.timerUnit},getTimerType:function(){return"CountUpTimer"}}};return i}),define("timer/CountDownTimer",["timer/TimerIntervalUnit","timer/TimerTimeStampUnit","timer/TimerUtils"],function(e,t,n){var i=function(n){var i=(require("timer/TimerUtils"),{isTimeStamp:!1,timeLeftSeconds:null,isTimeOut:null});return i=$.extend(!0,i,n),{timerUnit:null,init:function(){_.bindAll(this),this.createTimerUnit()},createTimerUnit:function(){var n={onTickCallback:i.onTickCallback,onTimeoutCallback:i.onTimeoutCallback,timeLeftSeconds:i.timeLeftSeconds};i.isTimeStamp?this.timerUnit=new t(n):this.timerUnit=new e(n)},getTimeElapsed:function(){return i.timeLeftSeconds-this.timerUnit.getTimeElapsed()},getTimerUnit:function(){return this.timerUnit},destroy:function(){this.timerUnit.destroy(),delete this.timerUnit},getTimerType:function(){return"CountDownTimer"}}};return i}),define("timer/TimerFactory",["javascripts/backbone-min","timer/CountUpTimer","timer/CountDownTimer"],function(e,t,n){var i=function(){return{timersBucket:{},init:function(){_.bindAll(this),this._startEndTestListener()},_startEndTestListener:function(){$(document).off("tn.test.start",this._registerEvents).on("tn.test.start",this._registerEvents)},_registerEvents:function(){$(document).off("timerStart",this.createTimer).on("timerStart",this.createTimer),$(document).off("timerPause",this.pauseTimer).on("timerPause",this.pauseTimer),$(document).off("timerResume",this.resumeTimer).on("timerResume",this.resumeTimer),$(document).off("timerGet",this.getTime).on("timerGet",this.getTime),$(document).off("timerDestroy",this.destroyHandler).on("timerDestroy",this.destroyHandler)},_unregisterEvents:function(){$(document).off("timerStart",this.createTimer),$(document).off("timerPause",this.pauseTimer),$(document).off("timerResume",this.resumeTimer),$(document).off("timerGet",this.getTime),$(document).off("timerDestroy",this.destroyHandler)},createTimer:function(e,t){"countdown"===t.timerType?this.createCountDownTimer(t):this.createCountUpTimer(t)},createCountDownTimer:function(e){var t=e.timerName,i=this.isExist(t);if(i&&e.destroyOnStart)this.destroyTimer(t);else if(i&&!e.destroyOnStart)return;var o={isTimeStamp:this.isTimeStamp()};$.extend(!0,o,_.pick(e,"onTimeoutCallback","onTickCallback","timeLeftSeconds")),this.setTimer(t,new n(o));var r=this.getTimer(t);r.init(),r.getTimerUnit().start()},createCountUpTimer:function(e){var n=e.timerName,i=this.isExist(n);if(i&&e.destroyOnStart)this.destroyTimer(n);else if(i&&!e.destroyOnStart)return;var o={isTimeStamp:this.isTimeStamp()};$.extend(!0,o,_.pick(e,"onTimeoutCallback","onTickCallback","timeLeftSeconds","prevValue")),this.setTimer(n,new t(o));var r=this.getTimer(n);r.init(),r.getTimerUnit().start()},pauseTimer:function(e,t){var n=t.timerName,i=this.getTimer(n);i&&i.getTimerUnit().pause()},resumeTimer:function(e,t){var n=t.timerName,i=this.getTimer(n);i&&i.getTimerUnit().resume()},getTime:function(e,t){var n=t.timerName,i=t.callback;this.isExist(n)&&i&&i(this.getTimer(n).getTimeElapsed())},getTimer:function(e){return this.timersBucket[e]},setTimer:function(e,t){this.timersBucket[e]=t},isExist:function(e){return"object"==typeof this.getTimer(e)},destroyHandler:function(e,t){this.destroyTimer(t.timerName)},destroyTimer:function(e){var t=this.getTimer(e);t&&t.destroy(),delete this.timersBucket[e]},isTimeStamp:function(){return!1}}};return timerFactory=new i,timerFactory.init(),timerFactory}),define("timer/timerControllers/ItemTimerController",["timer/TimerFactory","util/Dispatcher","controllers/ApplicationStatusController"],function(e,t,n){"use strict";var i=function(i){return{name:i.name,timerName:i.name+"Timer",restoreTimerEvents:"itemTimer.restore",startTimerEvents:i.name+"Timer.start",resumeTimerEvents:i.name+"Timer.resume",pauseTimerEvents:i.name+"Timer.pause inform.timeoutModalOn",saveTimerEvents:i.name+"Timer.save",destroyTimerEvents:i.name+"Timer.destroy",TimerControllerStatus:{TIMER_RUNNING:1,TIMER_PAUSED:2},thisClassName:i.name+"TimerController",startActionName:"start"+i.name+"Timer",resumeActionName:"resume"+i.name+"Timer",key:"",time:0,init:function(){_.bindAll(this),i&&$.extend(!0,this,_.pick(i,"timerName","startTimerEvents","saveTimerEvents","destroyTimerEvents","pauseTimerEvents","resumeTimerEvents","key")),this._startEndTestListener(),this._setGlobals()},_setGlobals:function(){this.thisClassName=this.name+"TimerController",this.startActionName="start"+this.name+"Timer",this.resumeActionName="resume"+this.name+"Timer"},_startEndTestListener:function(){$(document).off("tn.test.start",this._registerEvents).on("tn.test.start",this._registerEvents),$(document).off("cleanup.betweenTest",this._unregisterEvents).on("cleanup.betweenTest",this._unregisterEvents)},_registerEvents:function(){this.applicationStatusInit(),$(document).off(this.startTimerEvents,this.requestCreateTimer).on(this.startTimerEvents,this.requestCreateTimer),$(document).off(this.restoreTimerEvents,this.restoreTimerValue).on(this.restoreTimerEvents,this.restoreTimerValue),$(document).off(this.resumeTimerEvents,this.requestResumeTimer).on(this.resumeTimerEvents,this.requestResumeTimer),$(document).off(this.pauseTimerEvents,this.pauseTimer).on(this.pauseTimerEvents,this.pauseTimer),$(document).off(this.saveTimerEvents,this.saveTime).on(this.saveTimerEvents,this.saveTime),$(document).off(this.destroyTimerEvents,this.destroyTimer).on(this.destroyTimerEvents,this.destroyTimer)},_unregisterEvents:function(){this.destroyTimer(),$(document).off("tn.test.start",this._registerEvents),$(document).off(this.startTimerEvents,this.requestCreateTimer),$(document).off(this.restoreTimerEvents,this.restoreTimerValue),$(document).off(this.resumeTimerEvents,this.requestResumeTimer),$(document).off(this.pauseTimerEvents,this.pauseTimer),$(document).off(this.saveTimerEvents,this.saveTime),$(document).off(this.destroyTimerEvents,this.destroyTimer)},applicationStatusInit:function(){n.registerEvent(this.startActionName,"DoStart"+this.name+"Timer","ErrStart"+this.name+"Timer",t),t.off("DoStart"+this.name+"Timer").on("DoStart"+this.name+"Timer",this.createTimer,this),t.off("ErrStart"+this.name+"Timer").on("ErrStart"+this.name+"Timer",this.handlerCreateTimerFailed,this),n.registerEvent(this.resumeActionName,"DoResume"+this.name+"Timer","ErrResume"+this.name+"Timer",t),t.off("DoResume"+this.name+"Timer").on("DoResume"+this.name+"Timer",this.resumeTimer,this),t.off("ErrResume"+this.name+"Timer").on("ErrResume"+this.name+"Timer",this.handlerResumeTimerFailed,this),n.subscribeCondition(this.startActionName,this.thisClassName,this.TimerControllerStatus.TIMER_PAUSED),n.subscribeCondition(this.resumeActionName,this.thisClassName,this.TimerControllerStatus.TIMER_PAUSED)},requestCreateTimer:function(e,t){n.execute(this.startActionName,t)},requestResumeTimer:function(){e.isExist(this.timerName)?n.execute(this.resumeActionName):this.requestCreateTimer(null,0)},restoreTimerValue:function(e,t){this.time=t[this.key]},handlerCreateTimerFailed:function(){},handlerResumeTimerFailed:function(){},createTimer:function(){n.statusChange(this.thisClassName,this.TimerControllerStatus.TIMER_RUNNING),$(document).trigger("timerStart",{timerName:this.timerName,prevValue:this.time,destroyOnStart:!0})},pauseTimer:function(){n.statusChange(this.thisClassName,this.TimerControllerStatus.TIMER_PAUSED),$(document).trigger("timerPause",{timerName:this.timerName})},resumeTimer:function(){n.statusChange(this.thisClassName,this.TimerControllerStatus.TIMER_RUNNING),$(document).trigger("timerResume",{timerName:this.timerName})},destroyTimer:function(){n.statusChange(this.thisClassName,this.TimerControllerStatus.TIMER_PAUSED),this.time=0,$(document).trigger("timerDestroy",{timerName:this.timerName})},saveTime:function(){$(document).trigger("timerGet",{timerName:this.timerName,callback:this.saveItemTime})},saveItemTime:function(t){this.time=e.isTimeStamp()?Math.floor(t):t,$(document).trigger("perform.itemTimerSave",{time:this.time,key:this.key})}}};return i}),function(e){function t(e,t){e.preventDefault();var n=e.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}if(e.support.touch=!!("ontouchend"in document||navigator.maxTouchPoints),e.support.touch){var n,i,o,r,s=e.ui.mouse.prototype,a=s._mouseInit,l=s._mouseDestroy;s._touchStart=function(e){var s=this;!o&&s._mouseCapture(e.originalEvent.changedTouches[0])&&(o=!0,r=!1,n=e.originalEvent.touches[0].screenX,i=e.originalEvent.touches[0].screenY,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},s._touchMove=function(e){if(o&&!(e.originalEvent.touches.length>1)){var s=e.originalEvent.touches[0].screenX,a=e.originalEvent.touches[0].screenY;if(n>=s-2&&n<=s+2&&i>=a-2&&i<=a+2)return void(r=!1);r=!0,t(e,"mousemove")}},s._touchEnd=function(e){o&&(t(e,"mouseup"),t(e,"mouseout"),r||t(e,"click"),o=!1)},s._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),a.call(t)},s._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),l.call(t)}}}(jQuery),define("javascripts/jquery.ui.touch-punch.min",["javascripts/jquery-ui.min"],function(){}),define("views/timerView/BaseTimerView",["javascripts/backbone-min","utils"],function(e,t){
"use strict";var n=e.View.extend({timerDivId:"timerDiv",timerDivSelector:"#timerDiv",initialize:function(){_.bindAll(this),this._registerEvents(),this.$timerDiv=this.createTimerDiv()},_registerEvents:function(){$(document).off("inform.timerMessageChange",this.messageChanged).on("inform.timerMessageChange",this.messageChanged),$(document).off("inform.timerTimeChange",this.timeChanged).on("inform.timerTimeChange",this.timeChanged),$(document).off("overtimeSpecifiedStart",this.checkForRender).on("overtimeSpecifiedStart",this.checkForRender)},_unregisterEvents:function(){$(document).off("inform.timerMessageChange",this.messageChanged),$(document).off("inform.timerTimeChange",this.timeChanged),$(document).off("overtimeSpecifiedStart",this.checkForRender)},render:function(){return this.isHideTimer()&&this.hideTimer(),this},checkForRender:function(){this.isHideTimer()&&!this.$timerDiv.hasClass("hidden")&&this.render()},createTimerDiv:function(){var e={isK2:this.isK2()},t=_.template($(TN8.Application.combinedTpl).filter(this.timerDivSelector).html())(e),n=$(t);return this.isK2()&&n.addClass("k2-timer"),n},messageChanged:function(e,t){this.showTimer(),this.setTimerValue(t)},timeChanged:function(e,t){this.isHideTimer()||(this.showTimer(),this.setTimerValue(t))},hideTimer:function(){this.$timerDiv.attr("aria-hidden","true"),this.$timerDiv.addClass("hidden")},showTimer:function(){this.$timerDiv.removeAttr("aria-hidden"),this.$timerDiv.removeClass("hidden")},isHideTimer:function(){return TestEngine.getTestDefine().hideTimer()},isK2:function(){return t.isK2()},destroy:function(){this._unregisterEvents()}});return n}),define("views/timerView/StandardTimerView",["javascripts/backbone-min","views/timerView/BaseTimerView"],function(e,t){"use strict";var n=t.extend({testTimerSelector:"#testTimer",render:function(){return t.prototype.render.apply(this),this.renderStandardTimer()},renderStandardTimer:function(){return $(this.$timerDiv).html(_.template($(TN8.Application.combinedTpl).filter("#header_standardTimer").html())),this.$timerDiv},setTimerValue:function(e){$(this.testTimerSelector).text(e)},destroy:function(){t.prototype.destroy.apply(this)}});return n}),define("views/timerView/ToggleTimerView",["javascripts/backbone-min","views/timerView/BaseTimerView"],function(e,t){"use strict";var n=t.extend({toggleTimerButton:".toggleTimerButton",timerApparatus:".timerApparatus",testTimerSelector:"#testTimer",isFirstItem:!1,isClosed:!1,initialize:function(){t.prototype.initialize.apply(this),this.isClosed=this.options.isClosed},_registerEvents:function(){$(document).off("tn.section.next",this.nextSectionHandler).on("tn.section.next",this.nextSectionHandler),t.prototype._registerEvents.apply(this)},_unregisterEvents:function(){$(document).off("tn.section.next",this.nextSectionHandler),$(this.toggleTimerButton,this.$timerDiv).off("click",this.toggleClicked),t.prototype._unregisterEvents.apply(this)},render:function(){return t.prototype.render.apply(this),this.renderToggleTimer()},messageChanged:function(e,n){t.prototype.messageChanged.apply(this,[e,n]),this.openTimerView(),$(this.timerApparatus).removeClass("fixed-width")},timeChanged:function(e,n){t.prototype.timeChanged.apply(this,[e,n]),$(this.timerApparatus).addClass("fixed-width")},renderToggleTimer:function(){return $(this.$timerDiv).addClass("toggle-timer"),$(this.$timerDiv).html(_.template($(TN8.Application.combinedTpl).filter("#header_toggleTimer").html())),this.toggleTimerView(),$(this.toggleTimerButton,this.$timerDiv).off("click",this.toggleClicked).on("click",this.toggleClicked),this.$timerDiv},toggleTimerView:function(){this.isClosed===!0?this.closeTimerView():(this.openTimerView(),$("#testTimer").eq(0).focus()),this.isFirstItem=!this.isFirstItem&&this.isFirstItem},updateToggleTooltip:function(){$(this.toggleTimerButton,this.$timerDiv).attr("title",$.i18n.t("header:"+(this.isClosed?"showTimer":"hideTimer"))),$(this.toggleTimerButton).tooltip("fixTitle")},tooltip:function(e){$(this.toggleTimerButton).tooltip(e)},toggleClicked:function(e){var t=!(!e.originalEvent||!e.originalEvent.mozInputSource||5!=e.originalEvent.mozInputSource),n=!!(e.originalEvent&&e.originalEvent.sourceCapabilities&&e.originalEvent.sourceCapabilities.firesTouchEvents),i=window.browserDetection.isIdevice();this.isClosed=!this.isClosed,this.toggleTimerView(),i||t||n||this.tooltip("show")},nextSectionHandler:function(){this.isClosed=!0},setTimerValue:function(e){$(this.testTimerSelector).text(e)},getToggleStatus:function(){return this.isClosed},openTimerView:function(){$(this.timerApparatus,this.$timerDiv).removeClass("button-only"),$(this.toggleTimerButton,this.$timerDiv).attr("aria-expanded","true"),$(this.toggleTimerButton,this.$timerDiv).attr("aria-label",$.i18n.t("header:hideTimer")),this.isClosed=!1,this.updateToggleTooltip()},closeTimerView:function(){$(this.timerApparatus,this.$timerDiv).addClass("button-only"),$(this.toggleTimerButton,this.$timerDiv).attr("aria-expanded","false"),$(this.toggleTimerButton,this.$timerDiv).attr("aria-label",$.i18n.t("header:showTimer")),this.isClosed=!0,this.updateToggleTooltip()},destroy:function(){t.prototype.destroy.apply(this),$(this.toggleTimerButton,this.$timerDiv).off("click",this.toggleClicked)}});return n}),define("views/timerView/TimerView",["javascripts/backbone-min","views/timerView/StandardTimerView","views/timerView/ToggleTimerView"],function(e,t,n){"use strict";var i=e.View.extend({initialize:function(){_.bindAll(this),this._startEndTestListener(),this._testStarted()},_startEndTestListener:function(){TN8.fnOn("cleanup.betweenTest",this._testFinished)},_testStarted:function(){this.setTestDefVals()},_testFinished:function(){this.destroy(),this.unsetTestDefVals()},render:function(){var e=!this.toggleTimerView||this.toggleTimerView.getToggleStatus();return this.isToggleTimer?(this.toggleTimerView=new n({isClosed:e}),this.toggleTimerView.render()):(this.standardTimerView=new t,this.standardTimerView.render())},setTestDefVals:function(){this.isToggleTimer=this.getStudentToggleTimer()},unsetTestDefVals:function(){delete this.isToggleTimer},getStudentToggleTimer:function(){return this.getTestDef().getStudentToggleTimer()},getTestDef:function(){return TestEngine.getTestDefine()},destroy:function(){this.destroySubViews(),delete this.toggleTimerView,delete this.standardTimerView},destroySubViews:function(){this.toggleTimerView&&this.toggleTimerView.destroy(),this.standardTimerView&&this.standardTimerView.destroy()}});return i}),!function(e,t){e.answerMaskingAPI=t()}(this,function(){var e,t,n;return function(i){function o(e,t){return w.call(e,t)}function r(e,t){var n,i,o,r,s,a,l,c,d,u,h=t&&t.split("/"),p=T.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),c=0;c<e.length;c+=1)if(u=e[c],"."===u)e.splice(c,1),c-=1;else if(".."===u){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||m)&&p){for(n=e.split("/"),c=n.length;c>0;c-=1){if(i=n.slice(0,c).join("/"),h)for(d=h.length;d>0;d-=1)if(o=p[h.slice(0,d).join("/")],o&&(o=o[i])){r=o,s=c;break}if(r)break;!a&&m&&m[i]&&(a=m[i],l=c)}!r&&a&&(r=a,s=l),r&&(n.splice(0,s,r),e=n.join("/"))}return e}function s(e,t){return function(){return p.apply(i,y.call(arguments,0).concat([e,t]))}}function a(e){return function(t){return r(t,e)}}function l(e){return function(t){g[e]=t}}function c(e){if(o(v,e)){var t=v[e];delete v[e],b[e]=!0,h.apply(i,t)}if(!o(g,e)&&!o(b,e))throw new Error("No "+e);return g[e]}function d(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(e){return function(){return T&&T.config&&T.config[e]||{}}}var h,p,m,f,g={},v={},T={},b={},w=Object.prototype.hasOwnProperty,y=[].slice;m=function(e,t){var n,i=d(e),o=i[0];return e=i[1],o&&(o=r(o,t),n=c(o)),o?e=n&&n.normalize?n.normalize(e,a(t)):r(e,t):(e=r(e,t),i=d(e),o=i[0],e=i[1],o&&(n=c(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},f={require:function(e){return s(e)},exports:function(e){var t=g[e];return"undefined"!=typeof t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:u(e)}}},h=function(e,t,n,r){var a,d,u,h,p,T,w=[];if(r=r||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(h=m(t[p],r),d=h.f,"require"===d)w[p]=f.require(e);else if("exports"===d)w[p]=f.exports(e),T=!0;else if("module"===d)a=w[p]=f.module(e);else if(o(g,d)||o(v,d)||o(b,d))w[p]=c(d);else{if(!h.p)throw new Error(e+" missing "+d);h.p.load(h.n,s(r,!0),l(d),{}),w[p]=g[d]}u=n.apply(g[e],w),e&&(a&&a.exports!==i&&a.exports!==g[e]?g[e]=a.exports:u===i&&T||(g[e]=u))}else e&&(g[e]=n)},e=t=p=function(e,t,n,o,r){return"string"==typeof e?f[e]?f[e](t):c(m(e,t).f):(e.splice||(T=e,t.splice?(e=t,t=n,n=null):e=i),t=t||function(){},"function"==typeof n&&(n=o,o=r),o?h(i,e,t,n):setTimeout(function(){h(i,e,t,n)},4),p)},p.config=function(e){return T=e,T.deps&&p(T.deps,T.callback),p},n=function(e,t,n){t.splice||(n=t,t=[]),o(g,e)||o(v,e)||(v[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("AnswerMasker",[],function(){"use strict";function e(e,t,n){function i(){for(var e=0;e<y.length;e++)S.push(!0);l(),p()}function o(){var e,t={};for(t.c=[],e=0;e<S.length;e++)S[e]===!1&&t.c.push(e);return t}function r(e){var t=e.c;if(t.length>0)for(var n=0;n<t.length;n++)S[t[n]]=!1;p()}function s(e){b&&(c(),u(d()))}function a(e){e?$(".acc-ansmask-disabled").addClass("acc-ansmask-enabled").removeClass("acc-ansmask-disabled"):$(".acc-ansmask-enabled").addClass("acc-ansmask-disabled").removeClass("acc-ansmask-enabled"),b=e,p()}function l(){function e(){s(),$(this).off("load",e)}var t=$(y),n="<div class='acc-ansmask-mask acc-ansmask-disabled acc-ansmask-masked' aria-hidden='true' role='presentation'></div>",i="<div class='acc-ansmask-maskControls acc-ansmask-disabled' aria-hidden='true' role='presentation'><div class='icon'><i class='icon-eye-close icon-black' style='font-size:14px;'></i></div></div>";y.append(n).addClass("acc-ansmask-maskedLi2"),y.append(i),y.find(".acc-ansmask-maskControls .icon").click(m);var o=t.find("img");o.length>0&&o.each(function(t){$(this).off("load",e).on("load",e)}),b&&(u(d()),h())}function c(){y.css("width",""),y.find(".int-choice-desc").css({width:"",overflow:""})}function d(){var e,t,n,i=0,o=$(y[0]).css("display"),r=$(y[0]).outerWidth(),s=$(y[0]).children("input").outerWidth();if("inline-block"===o||"inline-flex"===o)i=r;else{for(var a=0;a<y.length;a++)e=$(y[a]).children("label"),t=e.position(),n=w?Math.ceil(e.find(".int-choice-desc").outerWidth()+t.left+s):e.outerWidth()+t.left,n>i&&(i=n);i+=N,i>r&&(i=r)}return i}function u(e){for(var t,n,i,o,r=0;r<y.length;r++){if(t=$(y[r]).find(".int-choice-desc"),n=$(y[r]).children(".acc-ansmask-maskControls"),i=t.position(),o=t.outerWidth(),o+i.left>e-53){o=Math.floor(e-i.left-53),w&&(o-=14),0===t.find(".jwplayer").length&&t.css({width:o,overflow:"hidden"});var s=t.find(".MathJax_CHTML");if(s.length>0){var a=s[0].getBoundingClientRect().height,l=s.parent();l.css("line-height",a+"px")}$(document).trigger("tn.descResized")}$("body").hasClass("ie")&&"fieldset"!==$(y[r]).parent().prop("tagName").toLowerCase()&&$(y[r]).find(".acc-ansmask-mask").css({width:e-8,"margin-left":8})}y.css("width",e)}function h(){if(S&&S.length>0)for(var e=0;e<S.length;e++){var t=$(y[e]),n=$(y[e]).find(".acc-ansmask-maskControls i");f(S[e],t,n)}}function p(){c(),b&&(u(d()),h());for(var e=0;e<y.length;e++)g(S[e],$(y[e]),C)}function m(e){var t=$(this),n=t.parent().parent(),i=t.children("i"),o=i.hasClass("icon-eye-close");f(!o,n,i),g(!o,n,C),v(),$(document).trigger("Used.AnswerMasking")}function f(e,t,n){var i=e?"icon-eye-open":"icon-eye-close",o=e?"icon-eye-close":"icon-eye-open";n.removeClass(i).addClass(o),e?t.children(".acc-ansmask-mask").addClass("acc-ansmask-masked"):t.children(".acc-ansmask-mask").removeClass("acc-ansmask-masked")}function g(e,t,n){t.find(".jwplayer").each(function(t,i){var o=i.id,r=n(o),s=$("#"+o),a=s.hasClass("eliminated"),l=!b||!e;a||r.enable(l)})}function v(){S=[];for(var e=$(".acc-ansmask-mask",y),t=0;t<e.length;t++)S[t]=$(e[t]).hasClass("acc-ansmask-masked")===!0}function T(){y=[],S=[],$(window).off("resize",s)}var b=!1,w=t,y=e,S=[],C=n,N=57;return{init:i,setEnabled:a,onSizeChange:s,getState:o,setState:r,destroy:T,testing:{updateJWPlayers:g}}}return e}),n("AnswerMaskingController",["./AnswerMasker"],function(e){"use strict";function t(e){y=e}function n(){$(document).off("ChoiceInteractionCreated",i).one("ChoiceInteractionCreated",i),$(document).off("CustomInteractionReady",o).on("CustomInteractionReady",o)}function i(e){var t=y.find('.int-choice-list[data-module="ChoiceInteraction"]');$.each(t,function(e,t){p($(t).children("li"),!1),$(S).parent().css("display","list-item")})}function o(e){var t=y.find('.int-choice-list.at-enable[data-module="CustomInteraction-Choice"]:not(.ansmask-complete)');$.each(t,function(e,t){var n=$(t).find("fieldset").children("div");0!==n.length&&($(t).addClass("ansmask-complete"),p(n,!0),$(S).parent().css("display","list-item"))})}function r(e){x=e}function s(){return x}function a(e){h()||$(e).css("display","none")}function l(){return C}function c(e){return C=e,u(),C}function d(e){for(var t=0;t<N.length;t++)N[t].setEnabled(e);$(document).trigger("tn.descResized")}function u(){C?I||($(window).on("resize",g),y.on("MathJaxProcessComplete",g),y.on("ChoiceInteractionImageLoaded",g),$(document).on("LoadMathJaxComplete",g),I=!0):($(window).off("resize",g),y.off("MathJaxProcessComplete",g),y.off("ChoiceInteractionImageLoaded",g),$(document).off("LoadMathJaxComplete",g),I=!1)}function h(){return N.length>0}function p(t,n){var i=new e(t,n,window.jwplayer);i.init(),N.push(i),u(),b(),i.setEnabled(C)}function m(e){c(e.enabled)?(d(!0),$(document).trigger("Used.AnswerMasking")):d(!1)}function f(){for(var e=0;e<N.length;e++)N[e].setVisible(!1)}function g(){for(var e=0;e<N.length;e++)N[e].onSizeChange(null)}function v(){if(x){var e={};e.id=_;var t={};t.i=[];for(var n=0;n<N.length;n++)t.i.push(N[n].getState());return e.s=t,e}}function T(e){E=e.s.i,R&&b(),$(document).trigger("AccommodationSetStateDone","AnswerMaskerStateSuccess")}function b(){if(R=!0,x){var e,t;for(e=0;e<E.length;e++)t=N[e],null!==t&&"undefined"!=typeof t&&t.setState(E[e])}}function w(){E=[],I=!1,$(window).off("resize",g),y.off("MathJaxProcessComplete",g),y.off("ChoiceInteractionImageLoaded",g),$(document).off("LoadMathJaxComplete",g);for(var e=0;e<N.length;e++)N[e].destroy();N=[],R=!1}var y,S="#dropdown_ansmask",C=!1,N=[],_=1007,E=[],I=!1,x=!1,R=!1,k={setContentContainer:t,init:n,disable:a,getState:v,setState:T,setEnabled:c,getEnabled:l,setVisible:f,handleToggle:m,hasMaskers:h,makeMasker:p,resize:g,setAvailable:r,isAvailable:s,destroy:w};return k}),n("main",["./AnswerMaskingController"],function(e){"use strict";var t={toolbox:void 0};return t.createToolbox=function(n){e.setContentContainer(n);var i={answerMaskingController:e};return t.toolbox=i,i},t}),t("main")}),define("javascripts/tools/answermasking-lib",function(){}),!function(e,t){e.ContrastControllerAPI=function(){var e,t,n;return function(i){function o(e,t){return w.call(e,t)}function r(e,t){var n,i,o,r,s,a,l,c,d,u,h=t&&t.split("/"),p=T.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),c=0;c<e.length;c+=1)if("."===(u=e[c]))e.splice(c,1),c-=1;else if(".."===u){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||m)&&p){for(n=e.split("/"),c=n.length;c>0;c-=1){if(i=n.slice(0,c).join("/"),h)for(d=h.length;d>0;d-=1)if((o=p[h.slice(0,d).join("/")])&&(o=o[i])){r=o,s=c;break}if(r)break;!a&&m&&m[i]&&(a=m[i],l=c)}!r&&a&&(r=a,s=l),r&&(n.splice(0,s,r),e=n.join("/"))}return e}function s(e,t){return function(){return p.apply(i,y.call(arguments,0).concat([e,t]))}}function a(e){return function(t){return r(t,e)}}function l(e){return function(t){g[e]=t}}function c(e){if(o(v,e)){var t=v[e];delete v[e],b[e]=!0,h.apply(i,t)}if(!o(g,e)&&!o(b,e))throw new Error("No "+e);return g[e]}function d(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(e){return function(){return T&&T.config&&T.config[e]||{}}}var h,p,m,f,g={},v={},T={},b={},w=Object.prototype.hasOwnProperty,y=[].slice;m=function(e,t){var n,i=d(e),o=i[0];return e=i[1],o&&(o=r(o,t),n=c(o)),o?e=n&&n.normalize?n.normalize(e,a(t)):r(e,t):(e=r(e,t),i=d(e),o=i[0],e=i[1],o&&(n=c(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},f={require:function(e){return s(e)},exports:function(e){var t=g[e];return void 0!==t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:u(e)}}},h=function(e,t,n,r){var a,d,u,h,p,T,w=[];if(r=r||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(h=m(t[p],r),"require"===(d=h.f))w[p]=f.require(e);else if("exports"===d)w[p]=f.exports(e),T=!0;else if("module"===d)a=w[p]=f.module(e);else if(o(g,d)||o(v,d)||o(b,d))w[p]=c(d);else{if(!h.p)throw new Error(e+" missing "+d);h.p.load(h.n,s(r,!0),l(d),{}),w[p]=g[d]}u=n.apply(g[e],w),e&&(a&&a.exports!==i&&a.exports!==g[e]?g[e]=a.exports:u===i&&T||(g[e]=u))}else e&&(g[e]=n)},e=t=p=function(e,t,n,o,r){return"string"==typeof e?f[e]?f[e](t):c(m(e,t).f):(e.splice||(T=e,t.splice?(e=t,t=n,n=null):e=i),t=t||function(){},"function"==typeof n&&(n=o,o=r),o?h(i,e,t,n):setTimeout(function(){h(i,e,t,n)},4),p)},p.config=function(e){return T=e,T.deps&&p(T.deps,T.callback),p},n=function(e,t,n){t.splice||(n=t,t=[]),o(g,e)||o(v,e)||(v[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("ContrastController",[],function(){"use strict";var e=function(e){this._handleContrastSettingsPNP=this._handleContrastSettingsPNP.bind(this),this._$el=e.$container,this._modalId="contrastSettingsModal",this.contrastColor="",this._inDeepZoom=!1,this._buildModal()};return e.prototype._handleContrastSettingsPNP=function(e,t){e.stopPropagation(),this.handleContrastSettings(t)},e.prototype.handleContrastSettings=function(e){this.contrastColor=e&&"none"!==e?e+"-bgc":"",this._triggerContrastChangeEvent()},e.prototype._triggerContrastChangeEvent=function(){var e="",t=this.contrastColor,n={white:"#FFFFFF",black:"#000000",cream:"#FFFACD",blue:"#0000CC",lblue:"#ADD8E6",lmagenta:"#EE82EE",pgreen:"#A3AD9E",dgray:"#6E6E6E",yellow:"#F5E727",rose:"#ffd0ff"},i=t.split("-"),o=i[0],r=i[1];if(""===this.contrastColor||!n.hasOwnProperty(o)||!n.hasOwnProperty(r)){$("#contrastCss").remove(),this.contrastColor="black",$("#contrast_no_adjustment").prop("checked",!0);var s=$.Event("tn.accessibility.contrastColorChange");return s.colorForeground="#000000",s.colorBackground="#FFFFFF",void $("body").trigger(s)}TN8&&TN8.fnOne("tn.navigate.logout",$.proxy(this._reset,this)),TN8&&TN8.fnOne("navigate.submitTest",$.proxy(this._reset,this));var a=$.Event("tn.accessibility.contrastColorChange");a.colorForeground=n[o],a.colorBackground=n[r],$("#contrastCss").remove(),"white"!==r&&("undefined"!=typeof TN8&&void 0!==TN8.baseUrl&&(e=TN8.baseUrl),void 0===window.TestEngine&&(e=window.location.origin+"/"),$("head").append('<link id="contrastCss" rel="stylesheet" type="text/css" href="'+e+"public/stylesheets/contrasts/"+r+'.css">')),$("body").trigger(a)},e.prototype._buildModal=function(){this.$container=this._buildModalContainer(),this.$container.append(this._buildModalHeader()),this.$container.append(this._buildModalBody()),this.$container.append(this._buildModalFooter()),$("#contrast-settings-ul input",this.$container).off("change").on("change",this,$.proxy(this._handleContrastSettingsUl,this)),$("body").off("tn.setContrast").on("tn.setContrast",this,$.proxy(this._triggerContrastChangeEvent,this)),$(document).on("perform.contrastChange",this._handleContrastSettingsPNP),this.$container.off("hidden").on("hidden",function(){var e=$("#contrastSettingsModal");e.tabRing&&e.tabRing("off"),$(document).trigger("contrast.modal.close"),$("#contrastSettingsModal").off("deepZoomLayer.hide",$.proxy(this.hideModal,this))}),$(document).on("deepZoomLevel.enter deepZoomLevel.exit",$.proxy(this._handleDeepZoomStatusChange,this)),this._$el.append(this.$container)},e.prototype._handleDeepZoomStatusChange=function(e){"enter"===e.namespace?($("#"+this._modalId).modal("hide"),this._inDeepZoom=!0):"exit"===e.namespace&&(this._inDeepZoom=!1)},e.prototype.updateLabelsForLocalization=function(){this.updateLangClass(this.$container),this.updateLabels(this.$container.find(".modal-header"),[{selector:"#agreementModalLabel",titleKey:"contrastWindow:contrastTitle",defaultTitle:"Contrast Settings"}]),this.updateLabels(this.$container.find(".modal-body"),[{selector:".default-bgc",titleKey:"contrastWindow:blackOnWhite",defaultTitle:"Black on White (Default)"},{selector:".black-cream-bgc",titleKey:"contrastWindow:blackOnCream",defaultTitle:"Black on Cream"},{selector:".black-lblue-bgc",titleKey:"contrastWindow:blackOnLightBlue",defaultTitle:"Black on Light Blue"},{selector:".black-lmagenta-bgc",titleKey:"contrastWindow:blackOnLightMagenta",defaultTitle:"Black on Light Magenta"},{selector:".black-rose-bgc",titleKey:"contrastWindow:blackOnRose",defaultTitle:"Black on Rose"},{selector:".white-black-bgc",titleKey:"contrastWindow:whiteOnBlack",defaultTitle:"White on Black"},{selector:".yellow-blue-bgc",titleKey:"contrastWindow:yellowOnBlue",defaultTitle:"Yellow on Blue"},{selector:".dgray-pgreen-bgc",titleKey:"contrastWindow:grayOnGreen",defaultTitle:"Gray on Green"}],"radio"),this.updateLangClass(this.$container.find(".modal-footer > button")),this.updateLangClass(this.$container.find(".modal-footer > button > span")),this.updateLabels(this.$container.find(".modal-footer"),[{selector:"#contrastGo",titleKey:"generalWords:continue",defaultTitle:"Continue"}],"button")},e.prototype.updateLabels=function(e,t,n){n=n||"default",t.forEach(function(t){var i=$.i18n?$.i18n.t(t.titleKey):t.defaultTitle,o=e.find(t.selector);switch(n){case"radio":o.parent().contents().last().replaceWith(i);break;case"button":o.contents().first().replaceWith(i);break;default:o.text(i)}})},e.prototype.updateLangClass=function(e){var t=e.attr("class").split(" ").filter(function(e){return-1===e.indexOf("lang")});t.push("lang"+($.i18n?$.i18n.lng():"en")),e.removeClass().addClass(t.join(" "))},e.prototype.showModal=function(){$(document).trigger("contrast.modal.open"),$(document).trigger("Used.ContrastSettings"),this.contrastColor?$("input."+this.contrastColor,this.$container).prop("checked",!0):$("input",this.$container).eq(0).prop("checked",!0);var e=$("#"+this._modalId);if(this.updateLabelsForLocalization(),this.adjustProgramOptions(),e.modal("show"),e.tabRing&&e.tabRing(),this._inDeepZoom){var t=$.i18n?$.i18n.t("contrastWindow:contrastTitle"):"Contrast Settings";$(document).trigger("deepZoomLayer.setCoupling",{title:t,html:"#contrastSettingsModal"})}$("#contrastSettingsModal").off("deepZoomLayer.hide",$.proxy(this.hideModal,this)).on("deepZoomLayer.hide",$.proxy(this.hideModal,this))},e.prototype.adjustProgramOptions=function(){var e=$("body").hasClass("sbac");$("#contrastSettingsModal li").removeClass("hidden"),$("#contrastSettingsModal li input").removeAttr("disabled"),e?($("#contrastSettingsModal li.black-lmagenta").addClass("hidden"),$("#contrastSettingsModal li.black-lmagenta input").attr("disabled","disabled")):($("#contrastSettingsModal li.black-rose").addClass("hidden"),$("#contrastSettingsModal li.black-rose input").attr("disabled","disabled"))},e.prototype.hideModal=function(e){var t=e.which;"click"!=e.type&&"deepZoomLayer"!=e.type&&("keydown"!=e.type||13!=t&&32!=t)||($("#"+this._modalId),$("#"+this._modalId).modal("hide"))},e.prototype._buildModalContainer=function(){var e=$("<div>");e.attr("id",this._modalId),e.attr("data-backdrop","true"),e.attr("role","dialog"),e.attr("aria-labelledby","agreementModalLabel");var t="lang";return t+=$.i18n?$.i18n.lng():"en",e.addClass(t),e.addClass("unselectable modal tn8-fixed-modal hide"),e},e.prototype._buildModalHeader=function(){var e=$("<h2>");e.attr("id","agreementModalLabel"),e.addClass("modal-title"),e.text($.i18n?$.i18n.t("contrastWindow:contrastTitle"):"Contrast Settings");var t=$('<button class="close" tabindex="0" role="button"><i class="icon-remove" /></button>');t.attr("aria-label",$.i18n?$.i18n.t("generalWords:close"):"Close"),t.on("click",$.proxy(this.hideModal,this)),t.on("keydown",$.proxy(this.hideModal,this));var n=$("<div>");return n.addClass("modal-header"),n.append(t),n.append(e),n},e.prototype._buildModalBody=function(){var e=$("<ul>");e.attr("id","contrast-settings-ul"),e.attr("tabindex","-1"),e.append(this._buildNoAdjustmentModalListItem());var t={label:$.i18n?$.i18n.t("contrastWindow:blackOnCream"):"Black on Cream",color:"black-cream",border:"1px solid black"},n={label:$.i18n?$.i18n.t("contrastWindow:blackOnLightBlue"):"Black on Light Blue",color:"black-lblue",border:"1px solid black"},i={label:$.i18n?$.i18n.t("contrastWindow:blackOnLightMagenta"):"Black on Light Magenta",color:"black-lmagenta",border:"1px solid black"},o={label:$.i18n?$.i18n.t("contrastWindow:whiteOnBlack"):"White on Black",color:"white-black",border:"1px solid black"},r={label:$.i18n?$.i18n.t("contrastWindow:yellowOnBlue"):"Yellow on Blue",color:"yellow-blue",border:"1px solid black"},s={label:$.i18n?$.i18n.t("contrastWindow:grayOnGreen"):"Gray on Green",color:"dgray-pgreen",border:"1px solid #6e6e6e"},a={label:$.i18n?$.i18n.t("contrastWindow:blackOnRose"):"Black on Rose",color:"black-rose",border:"1px solid black"},l=[t,n,i,a,o,r,s],c=this;$.each(l,function(t,n){e.append(c._buildModalListItem(n))}),$("<span>").addClass("icon-arrow-right");var d=$("<div>");return d.addClass("modal-body"),d.append(e),d},e.prototype._buildModalListItem=function(e){var t=$("<span>");t.addClass("contrast-sample "+e.color+"-bgc"),t.css({border:e.border}),t.text("abc"),t.attr("aria-hidden",!0);var n=$("<input>");n.attr("id","contrast_"+e.color),n.attr("type","radio"),n.attr("name","contrast_colors"),n.attr("value",e.color),n.addClass(e.color+"-bgc");var i=$("<label>");i.addClass("radio"),i.append(n,t,e.label);var o=$("<li>");return o.addClass(e.color),o.append(i),o},e.prototype._buildNoAdjustmentModalListItem=function(){var e=$("<input>");e.attr("id","contrast_no_adjustment"),e.attr("type","radio"),e.attr("name","contrast_colors"),e.attr("value","none"),e.text();var t=$("<label>");t.addClass("radio");var n="<span style='border: 1px solid black;' aria-hidden='true' class='contrast-sample default-bgc'>abc</span>";n+=$.i18n?$.i18n.t("contrastWindow:blackOnWhite"):"Black on White (Default)",t.append(e,n);var i=$("<li>");return i.append(t),i},e.prototype._buildModalFooter=function(){var e=$("<span>"),t="lang";t+=$.i18n?$.i18n.lng():"en",e.addClass(t),e.addClass("icon-arrow-right");var n=$("<button>");n.attr("id","contrastGo"),n.attr("data-dismiss","modal"),n.attr("aria-label",$.i18n?$.i18n.t("generalWords:continue"):"Continue"),n.addClass("btn btn-primary btn-large");var t="lang";t+=$.i18n?$.i18n.lng():"en",n.addClass(t),n.append($.i18n?$.i18n.t("generalWords:continue"):"Continue ",e),n.on("click",$.proxy(this.hideModal,this));var i=$("<div>");return i.addClass("modal-footer"),i.append(n),i},e.prototype._reset=function(){$("#contrastCss").length&&$("#contrastCss").remove(),this.contrastColor="",$(document).off("tn.navigate.logout",$.proxy(this._reset,this)),$(document).off("navigate.submitTest",$.proxy(this._reset,this))},e.prototype._handleContrastSettingsUl=function(e){e.stopPropagation();var t=$(e.target).val();this.handleContrastSettings(t),$(document).trigger("contrast.colorSetFromUI",[t])},e}),n("main",["./ContrastController"],function(e){"use strict";var t={};return t.createToolbox=function(t){return{contrastController:new e(t)}},t}),t("main")}()}(this),define("javascripts/tools/contrastcontroller-lib",function(){}),!function(e,t){e.lineReaderAPI=function(){var e,t,n;return function(i){function o(e,t){return w.call(e,t)}function r(e,t){var n,i,o,r,s,a,l,c,d,u,h=t&&t.split("/"),p=T.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),c=0;c<e.length;c+=1)if("."===(u=e[c]))e.splice(c,1),c-=1;else if(".."===u){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||m)&&p){for(n=e.split("/"),c=n.length;c>0;c-=1){if(i=n.slice(0,c).join("/"),h)for(d=h.length;d>0;d-=1)if((o=p[h.slice(0,d).join("/")])&&(o=o[i])){r=o,s=c;break}if(r)break;!a&&m&&m[i]&&(a=m[i],l=c)}!r&&a&&(r=a,s=l),r&&(n.splice(0,s,r),e=n.join("/"))}return e}function s(e,t){return function(){return p.apply(i,y.call(arguments,0).concat([e,t]))}}function a(e){return function(t){return r(t,e)}}function l(e){return function(t){g[e]=t}}function c(e){if(o(v,e)){var t=v[e];delete v[e],b[e]=!0,h.apply(i,t)}if(!o(g,e)&&!o(b,e))throw new Error("No "+e);return g[e]}function d(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(e){return function(){return T&&T.config&&T.config[e]||{}}}var h,p,m,f,g={},v={},T={},b={},w=Object.prototype.hasOwnProperty,y=[].slice;m=function(e,t){var n,i=d(e),o=i[0];return e=i[1],o&&(o=r(o,t),n=c(o)),o?e=n&&n.normalize?n.normalize(e,a(t)):r(e,t):(e=r(e,t),i=d(e),o=i[0],e=i[1],o&&(n=c(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},f={require:function(e){return s(e)},exports:function(e){var t=g[e];return void 0!==t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:u(e)}}},h=function(e,t,n,r){var a,d,u,h,p,T,w=[];if(r=r||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(h=m(t[p],r),"require"===(d=h.f))w[p]=f.require(e);else if("exports"===d)w[p]=f.exports(e),T=!0;else if("module"===d)a=w[p]=f.module(e);else if(o(g,d)||o(v,d)||o(b,d))w[p]=c(d);else{if(!h.p)throw new Error(e+" missing "+d);h.p.load(h.n,s(r,!0),l(d),{}),w[p]=g[d]}u=n.apply(g[e],w),e&&(a&&a.exports!==i&&a.exports!==g[e]?g[e]=a.exports:u===i&&T||(g[e]=u))}else e&&(g[e]=n)},e=t=p=function(e,t,n,o,r){return"string"==typeof e?f[e]?f[e](t):c(m(e,t).f):(e.splice||(T=e,t.splice?(e=t,t=n,n=null):e=i),t=t||function(){},"function"==typeof n&&(n=o,o=r),o?h(i,e,t,n):setTimeout(function(){h(i,e,t,n)},4),p)},p.config=function(e){return T=e,T.deps&&p(T.deps,T.callback),p},n=function(e,t,n){t.splice||(n=t,t=[]),o(g,e)||o(v,e)||(v[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("LineReader",[],function(){"use strict";function e(){function e(e){he=void 0!==window.PointerEvent,ue=!he&&"ontouchend"in document,re=[],se={},ae=[0,0,0,0],le=[0,0,0,0],H=e.find("#itemCanvas"),ne=$('<div class="acc-lineReader-topBar"></div>'),ie=$('<div class="acc-lineReader-sideBar acc-lineReader-leftBar">'),X=$('<div class="acc-lineReader-viewport-control"><span></span><i class="acc-lineReader-viewDrag icon-move"></i></div>'),te=$('<i class="acc-lineReader-viewResize tn8-icon-resize"></i>').appendTo(X),oe=$('</div><div class="acc-lineReader-sideBar acc-lineReader-rightBar"></div>'),Q=$('<div class="acc-lineReader-bottomBar"></div>'),ee=$('<i class="acc-lineReader-resizeButton tn8-icon-resize"></i>').appendTo(Q),e.append(ne,ie,X,oe,Q),[ne,ie,oe,Q].forEach(function(e){e.on(D("mousedown"),b)}),ve.on(D("mousemove"),w),ve.on(D("mouseup")+" tn.nav.start do.stopInteracting",y),ee.on(D("mousedown"),m),ve.on(D("mousemove"),f),ve.on(D("mouseup")+" tn.nav.start do.stopInteracting",g),X.on(D("mousedown"),d),ve.on(D("mousemove"),u),ve.on(D("mouseup")+" tn.nav.start do.stopInteracting",h),te.on(D("mousedown"),r),ve.on(D("mousemove"),s),ve.on(D("mouseup")+" tn.nav.start do.stopInteracting",a),ce=W(L,250),de=W(P,250),$(window).on("resize.lineReader",ce).on("scroll.lineReader",de),pe=!0}function t(e){me=e;var t=me?"block":"none";if(Ee=$("#main_panel").hasClass("selectable-panel"),n(t),me&&fe){fe=!1,k(),be.min.width=ye.min.width+we.min.width+Se.min.width,be.min.height=Ne.min.height+we.min.height+Ce.min.height,be.borderWidth=parseInt(ne.css("border-top-width"),10);
var i={top:8,left:8,width:15},o=_e.height-se.top,r=se.width/2+i.width,s=z(.35*o,be.min.height,o),a=ye.min.width,l=Ne.min.height,c=r-2*a,d=z(we.start.height,we.min.height,s-(l+Ce.min.height));C({width:r,height:s,top:se.top-i.top,left:se.left-i.left},{width:c,height:d,top:l,left:a})}}function n(e){e=e||!1,[ne,ie,X,oe,Q].forEach(function(t){t&&("block"===e||e?t.show():t.hide())})}function i(){return me}function o(){pe=!1,$(window).off("resize",ce).off("scroll",de),ve.off(D("mousemove"),s).off(D("mousemove"),u).off(D("mousemove"),w).off(D("mousemove"),f).off(D("mouseup")+" tn.nav.start do.stopInteracting",y).off(D("mouseup")+" tn.nav.start do.stopInteracting",h).off(D("mouseup")+" tn.nav.start do.stopInteracting",g).off(D("mouseup")+" tn.nav.start do.stopInteracting",a),[ne,ie,X,oe,Q,te,ee].forEach(function(e){e.remove()}),ce=null,de=null,re=null,se=null,ae=null,le=null,H=null,Q=null,X=null,ne=null,ie=null,oe=null,ee=null,te=null}function r(e){M(e),G=e.pageX,q=e.pageY,K=!0,ge&&Ee&&$("#main_panel").removeClass("selectable-panel")}function s(e){if(K){M(e);var t=e.pageX-G,n=e.pageY-q,i=!1;0!==t&&(l(t,!0),i=!0),0!==n&&(c(n,!0),i=!0),i&&(G+=t,q+=n,C()),e.preventDefault()}}function a(e){K=!1,ge&&Ee&&$("#main_panel").addClass("selectable-panel")}function l(e,t){we.width=z(we.width+e,we.min.width,be.width-(we.left+Se.min.width))}function c(e,t){we.height=z(we.height+e,we.min.height,be.height-(we.top+Ce.min.height))}function d(e){M(e),G=e.pageX,q=e.pageY,(J=X[0]===e.target||X.find(".icon-move")[0]===e.target)&&ge&&Ee&&$("#main_panel").removeClass("selectable-panel")}function u(e){if(J){M(e);var t=e.pageX-G,n=e.pageY-q;0===t&&0===n||p(t,n,!0),e.preventDefault()}}function h(){J=!1,ge&&Ee&&$("#main_panel").addClass("selectable-panel")}function p(e,t,n,i){n=!!n,i=!!i,we.left=z(we.left+e,le[0],le[2]),we.top=z(we.top+t,le[1],le[3]),i||C(),n&&(G+=e,q+=t)}function m(e){M(e),G=e.pageX,q=e.pageY,Y=!0,ge&&Ee&&$("#main_panel").removeClass("selectable-panel")}function f(e){if(Y){M(e);var t=e.pageX-G,n=e.pageY-q;0===t&&0===n||T(t,n,!0),e.preventDefault()}}function g(e){Y=!1,R(),ge&&Ee&&$("#main_panel").addClass("selectable-panel")}function v(e,t,n,i){if(n<0&&N(e)){var o=we.width-we.min.width,r=n+Math.max(o,0);o>0&&l(n),r<0&&p(r,0,!1,!0)}if(i<0&&_(t)){var s=we.height-we.min.height,a=i+Math.max(s,0);s>0&&c(i),a<0&&p(0,a,!1,!0)}}function T(e,t,n){var i=z(be.width+e,be.min.width,Math.abs(_e.width-be.left)),o=z(be.height+t,be.min.height,Math.abs(_e.height-be.top));v(i,o,i-be.width,o-be.height),C({width:i,height:o}),n&&(G+=e,q+=t)}function b(e){return M(e),!!$(e.target).is(".acc-lineReader-resizeButton")||(G=e.pageX,q=e.pageY,Z=!0,ge&&Ee&&$("#main_panel").removeClass("selectable-panel"),void 0)}function w(e){if(Z){M(e);var t=e.pageX-G,n=e.pageY-q;0===t&&0===n||S(t,n,!0),e.preventDefault()}}function y(e){Z=!1,x(),ge&&Ee&&$("#main_panel").addClass("selectable-panel")}function S(e,t,n){n=n||!1,be.left=z(be.left+e,ae[0],ae[2]),be.top=z(be.top+t,ae[1],ae[3]),C(),!0===n&&(G+=e,q+=t)}function C(e,t){t=F(t),e=B(e),ne.css({top:e.top,left:e.left,width:e.width,height:t.top}),ie.css({top:e.top+t.top-1,left:e.left,width:t.left,height:t.height+2}),X.css({top:e.top+t.top+t.height-Te.height,left:e.left+t.left,width:t.width,height:Te.height}),oe.css({top:e.top+t.top-1,left:e.left+t.left+t.width,width:e.width-(t.left+t.width),height:t.height+2}),Q.css({top:e.top+t.top+t.height,left:e.left,width:e.width,height:e.height-(t.top+t.height)}),O()}function N(e){return E(e)<0}function _(e){return I(e)<0}function E(e){return e-(we.left+we.width+Se.min.width)}function I(e){return e-(we.top+we.height+Ce.min.height)}function x(){O();var e=(j(),z(be.left,ae[0],ae[2])),t=z(be.top,ae[1],ae[3]),n=!1;e!==be.left&&(be.left=e,n=!0),t!==be.top&&(be.top=t,n=!0),n&&C()}function R(){v(be.width,be.height,E(be.width),I(be.height))}function k(){H=$("#itemCanvas");var e=Math.round(H.outerWidth()),t=Math.round(H.outerHeight());se=H.offset(),se.width=e,se.height=t,V()}function A(){le=[ye.min.width,Ne.min.height,Math.round(be.width-(we.width+Se.min.width)),Math.round(be.height-(we.height+Ce.min.height))]}function O(){H=$("#itemCanvas");var e=(H.outerWidth(),H.outerHeight(),be.width),t=be.height;V();var n=(parseInt($("body").css("padding-top")),parseInt($("#itemCanvas").css("margin-top")),j(),e-50),i=t-50,o=Math.round(0-n),r=Math.round(U()-i),s=Math.round(Math.max(_e.width-e+n,0)),a=Math.round(Math.max(_e.height-t+i,0));ae=[o,r,s,a],A()}function L(){if(pe){var e=$.extend({},se);ae.slice(),k(),O();var t=se.left-e.left,n=se.width-e.width,i=n/e.width;0!==i&&T(be.width*i,0,!1,!0),0!==t&&S(t,0,!1),x()}}function P(e){pe&&O()}function D(e){return{mousedown:{pointer:"pointerdown",touch:"touchstart mousedown",mouse:"mousedown"},mousemove:{pointer:"pointermove",touch:"touchmove mousemove",mouse:"mousemove"},mouseup:{pointer:"pointerup",touch:"touchend mouseup",mouse:"mouseup"}}[e][he?"pointer":ue?"touch":"mouse"]}function M(e){var t=e.originalEvent;e.type.indexOf("touch")>-1&&(t=t.touches[0]),e.pageX=t.pageX,e.pageY=t.pageY}function F(e){return e=e||{},["top","left","width","height"].forEach(function(t){e[t]=e[t]||we[t],we[t]=Math.round(e[t])}),we}function B(e){return e=e||{},["top","left","width","height"].forEach(function(t){e[t]=e[t]||be[t],be[t]=Math.round(e[t])}),be}function U(){return"fixed"===$("#header").css("position")||"absolute"===$("#header").css("position")?$("#header").outerHeight():0}function V(){_e.width=Math.round(Math.max(document.documentElement.clientWidth,window.innerWidth||0)),_e.height=Math.round(Math.max(document.documentElement.clientHeight,window.innerHeight||0))}function j(){var e=0;return $.each(["html","body"],function(t,n){var i=$(n).scrollTop();i>e&&(e=i)}),e}function z(e,t,n){return n<=t?t:Math.round(Math.min(Math.max(e,t),n))}function W(e,t,n){var i;return function(){var o=this,r=arguments,s=function(){i=null,n||e.apply(o,r)},a=n&&!i;clearTimeout(i),i=setTimeout(s,t),a&&e.apply(o,r)}}var H,G,q,Z,J,Y,K,X,Q,ee,te,ne,ie,oe,re,se,ae,le,ce,de,ue,he,pe=!1,me=!1,fe=!0,ge=$("body").hasClass("safari"),ve=-1!==navigator.userAgent.toLowerCase().indexOf("ipad")?$("#main_panel"):$(document),Te={height:25},be={borderWidth:0,width:0,height:0,top:0,left:0,min:{width:null,height:null}},we={width:0,height:0,left:0,top:0,start:{height:25+Te.height},min:{height:25+Te.height,width:100},startDrag:{left:0}},ye={min:{width:20}},Se={min:{width:20}},Ce={min:{height:30}},Ne={min:{height:20}},_e={width:0,height:0},Ee=!1;return{initialize:e,setEnabled:t,getEnabled:i,destroy:o}}return e}),n("LineReaderController",["./LineReader"],function(e){"use strict";function t(e){s=e}function n(e){a=e||null}function i(t){c=t,d||(d=new e,d.initialize(s)),d.setEnabled(t),c&&!l&&a?($(document).on(a,r),l=!0):!c&&l&&($(document).off(a,r),l=!1)}function o(e){return e.enabled?(i(!0),$(document).trigger("Used.LineReader")):r(),!0}function r(){i(!1),d&&(d.destroy(),d=null),$(document).trigger("LineReaderCloseEvent")}var s,a,l,c=!1,d=null;return{setContentContainer:t,init:n,setEnabled:i,getEnabled:function(){return c},handleToggle:o,destroy:r}}),n("main",["./LineReaderController"],function(e){"use strict";var t={toolbox:void 0};return t.createToolbox=function(n){e.setContentContainer(n);var i={lineReaderController:e};return t.toolbox=i,i},t}),t("main")}()}(this),define("javascripts/tools/linereader-lib",function(){}),$.widget("testnav.modalize",{_minHeight:100,_minWidth:100,_defaultHeight:300,_defaultWidth:300,_centerOnShow:!1,_$el:null,_create:function(){this._$el=$(this.element);var e='<div class="tn8-draggable-modal-header"><button class="close" tabindex="0" aria-label="Close">x</button><h2 class="langen">'+this.options.title+'</h2></div><div class="tn8-draggable-modal-body">'+this.options.content+"</div>";this._$el.addClass("modal tn8-draggable-modal dialog-hidden").attr("role","dialog").html(e);this._$el.draggable({scroll:!1,handle:".tn8-draggable-modal-header",drag:$.proxy(this._dragContain,this),stop:$.proxy(this._dragContain,this)}),this.options.cssProperties&&this._$el.css(this.options.cssProperties),this.recenter(),$(window).off("resize",$.proxy(this.recenter,this)).on("resize",$.proxy(this.recenter,this)),this.options.isResizable&&($(this.element).append('<div id="se-handle" class="ui-resizable-se ui-resizable-handle tn8-icon-resize"></div>'),this._$el.resizable({minHeight:this._minHeight,minWidth:this._minWidth,handles:{se:"#se-handle"}}),this._$el.off("resize",$.proxy(this.handleResize,this)).on("resize",$.proxy(this.handleResize,this))),$(document).off("cleanup.betweenTest",this.cleanup.bind(this)).on("cleanup.betweenTest",this.cleanup.bind(this)),$(document).off("cleanup.logout",this.cleanup.bind(this)).on("cleanup.logout",this.cleanup.bind(this))},handleResize:function(e){e.stopPropagation()},cleanup:function(){$(this.element).empty(),$(this.element).removeClass("modal fade"),$(this.element).removeAttr("role"),$(document).off("cleanup.betweenTest",this.cleanup),$(document).off("cleanup.logout",this.cleanup),this._$el.off("resize",$.proxy(this.handleResize,this)),$(window).off("resize",$.proxy(this.recenter,this))},hide:function(){$(this.element).addClass("dialog-hidden"),$(this.element).trigger("modalize.hidden")},show:function(){$(this.element).removeClass("dialog-hidden"),this._centerOnShow&&this.recenter(),$(this.element).trigger("modalize.shown")},recenter:function(){var e=this._$el.width(),t=this._$el.height();0==e&&(this._centerOnShow=!0);var n=$(window).width(),i=$(window).height(),o=Math.max(Math.floor((n-e)/2),0),r=Math.max(Math.floor((i-t)/2),0);$(this.element).css({top:r,left:o,position:"fixed"})},_dragContain:function(e,t){var n=this._$el,i=this.getViewportSize(),o=n.outerWidth(),r=100,s={left:Math.round(r-o),top:0,right:Math.round(i.width-r),bottom:Math.round(i.height-r)};t.position.left=this.normalize(t.position.left,s.left,s.right),t.position.top=this.normalize(t.position.top,s.top,s.bottom)},normalize:function(e,t,n){return Math.round(Math.min(Math.max(e,t),n))},getViewportSize:function(){return{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}}}),define("util/modalize",["javascripts/jquery-ui.min"],function(){}),define("util/modalUtils",[],function(){"use strict";!function(e){var t=e.fn.modal;e.fn.modal=function(){if((_.contains(arguments,"show")||"object"==typeof arguments[0]&&arguments[0].show===!0)&&this){var n=this,i=_.reject(e(".modal"),function(e){return e===n[0]});_.each(i,function(t){e(t).modal&&"none"!==e(t).css("display")&&e(t).modal("hide")})}if(e(this).one("shown",function(t){t.target===this&&e(this).find(".modal-focus-anchor").focus()}),this.find(".modal-document").length||"#TermModal"===this.selector||e(".modal-header, .modal-body, .modal-footer",this).wrapAll("<div class='modal-document' role='document'></div>"),!this.find(".modal-focus-anchor").length){var o=this.find(".modal-title"),r=o.length?o.text().trim():"",s=this.hasClass("modal-document")?this:this.find(".modal-document");s.prepend("<div class='modal-focus-anchor visuallyhidden' tabindex='-1' aria-label='"+r+"'></div>"),o.length&&o.attr("aria-hidden",!0)}if(_.contains(arguments,"hide")){var a=["TermModal","ewsContainer"];a.indexOf(this.attr("id"))!==-1&&e(document).trigger("deepZoomLayer.detachCoupling")}return t.apply(this,arguments)}}($)}),!function(e,t){e.magnifierAPI=function(){var e,t,n;return function(i){function o(e,t){return w.call(e,t)}function r(e,t){var n,i,o,r,s,a,l,c,d,u,h=t&&t.split("/"),p=T.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),c=0;c<e.length;c+=1)if("."===(u=e[c]))e.splice(c,1),c-=1;else if(".."===u){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||m)&&p){for(n=e.split("/"),c=n.length;c>0;c-=1){if(i=n.slice(0,c).join("/"),h)for(d=h.length;d>0;d-=1)if((o=p[h.slice(0,d).join("/")])&&(o=o[i])){r=o,s=c;break}if(r)break;!a&&m&&m[i]&&(a=m[i],l=c)}!r&&a&&(r=a,s=l),r&&(n.splice(0,s,r),e=n.join("/"))}return e}function s(e,t){return function(){return p.apply(i,y.call(arguments,0).concat([e,t]))}}function a(e){return function(t){return r(t,e)}}function l(e){return function(t){g[e]=t}}function c(e){if(o(v,e)){var t=v[e];delete v[e],b[e]=!0,h.apply(i,t)}if(!o(g,e)&&!o(b,e))throw new Error("No "+e);return g[e]}function d(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(e){return function(){return T&&T.config&&T.config[e]||{}}}var h,p,m,f,g={},v={},T={},b={},w=Object.prototype.hasOwnProperty,y=[].slice;m=function(e,t){var n,i=d(e),o=i[0];return e=i[1],o&&(o=r(o,t),n=c(o)),o?e=n&&n.normalize?n.normalize(e,a(t)):r(e,t):(e=r(e,t),i=d(e),o=i[0],e=i[1],o&&(n=c(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},f={require:function(e){return s(e)},exports:function(e){var t=g[e];return void 0!==t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:u(e)}}},h=function(e,t,n,r){var a,d,u,h,p,T,w=[];if(r=r||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(h=m(t[p],r),"require"===(d=h.f))w[p]=f.require(e);else if("exports"===d)w[p]=f.exports(e),T=!0;else if("module"===d)a=w[p]=f.module(e);else if(o(g,d)||o(v,d)||o(b,d))w[p]=c(d);else{if(!h.p)throw new Error(e+" missing "+d);h.p.load(h.n,s(r,!0),l(d),{}),w[p]=g[d]}u=n.apply(g[e],w),e&&(a&&a.exports!==i&&a.exports!==g[e]?g[e]=a.exports:u===i&&T||(g[e]=u))}else e&&(g[e]=n)},e=t=p=function(e,t,n,o,r){return"string"==typeof e?f[e]?f[e](t):c(m(e,t).f):(e.splice||(T=e,t.splice?(e=t,t=n,n=null):e=i),t=t||function(){},"function"==typeof n&&(n=o,o=r),o?h(i,e,t,n):setTimeout(function(){h(i,e,t,n)},4),p)},p.config=function(e){return T=e,T.deps&&p(T.deps,T.callback),p},n=function(e,t,n){t.splice||(n=t,t=[]),o(g,e)||o(v,e)||(v[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("MagnifierController",[],function(){"use strict";function e(){return $("#loading:visible").length>0}function t(e){R=e}function n(e){$(".magnifying_glass").length>0||(L=e||null,O=$(window).width(),A=$(window).height(),P=$('<div class="magnifying_glass"></div>'),z&&P.css("border-radius","0"),D=$('<div class="magnifying_lens"></div>'),M=$('<div id="magContent" class="magnified_content magnified_content_zoom'+V+'"></div>'),$(document).one("ItemController.cleanUpProcessStart",function(){$(document).off("tn.error.modal.on contrast.modal.open tn.ews.on tn.loadingModal.on settings.modal.open",i)}),$(document).on("tn.error.modal.on contrast.modal.open tn.ews.on tn.loadingModal.on settings.modal.open",i))}function i(e){"loadingModal.on"===e.namespace?(S(),$("#loading").one("hidden",function(){$(".magnifying_glass").css("z-index",1060)})):(S(),TN8&&TN8.Dispatcher.trigger("enableMenuItem",{id:"dropdown_magnifier",enabled:!1}))}function o(e){var t=e.originalEvent;return t.touches&&t.touches.length>0&&(e.pageY=t.touches[0].pageY,e.pageX=t.touches[0].pageX),e}function r(){if(O=$(window).width(),A=$(window).height(),$(".row").hasClass("pane-scrolling")){var e=$("#itemCanvas");M.css({width:e.width(),height:e.height()})}else M.css({width:O,height:A})}function s(e){N()}function a(){P.css({left:O/2-P.width()/2,top:150}),M.css({left:-(O/2-P.width()/2)*V,top:-(P.height()/2+$(document).scrollTop())*V-100})}function l(t,n){return!e()&&(O=$(document).width(),A=$(document).height(),t=o(t),b(),$("body.ie").length?(F=t.offsetX,B=t.offsetY):(F=t.pageX-n.offset.left,B=t.pageY-n.offset.top),$(document).on("keydown.magnifierTabBlock",function(e){9===e.keyCode&&(e.stopImmediatePropagation(),e.preventDefault())}),void 0)}function c(t,n){return!e()&&(t=o(t),void M.css({left:-(t.pageX-F)*V,top:-(t.pageY-B)*V}))}function d(e,t){$(document).off("keydown.magnifierTabBlock")}function u(e){for(var t,n=[],i=R.children().not(".magnifying_glass").find(e),o=0;o<i.length;o++)t={},t.top=$(i[o]).scrollTop(),t.left=$(i[o]).scrollLeft(),n.push(t);return n}function h(e,t){var n=$("#magContent > body").find(e);if(n.length===t.length)for(var i=0;i<n.length;i++)$(n[i]).scrollTop(t[i].top).scrollLeft(t[i].left)}function p(){for(var e=window.TestEngine&&window.TestEngine.isJXBrowserApp()?R.find("select,input[type=text]"):R.find("select,input[type=text], textarea"),t=M.find("select,input[type=text], textarea"),n=0;n<e.length;n++)$(t[n]).val($(e[n]).val());var i=$(".magnified_content").children().find("#calculatorResult");i.length>0&&(i[0].value=$("#calculatorResult").val())}function m(){for(var e=R.find(":radio, :checkbox"),t=M.find(":radio, :checkbox"),n=0;n<e.length;n++)$(t[n]).attr("checked",$(e[n]).is(":checked"))}function f(e){var t=".magnifying_glass,#tn8applet,script,#error-modal,.modal-backdrop,.visuallyhidden,#calculatorDiv";return $("body").hasClass("ie")&&(t+=",#divCalculator"),e.find(t).remove(),e}function g(e){if(void 0!==e)for(var t=0;t<e.length;t++)$(e[t]).attr("checked","checked")}function v(e){for(var t=R.find("iframe, .jwplayer"),n=e.find("iframe, .jwplayer"),i=0;i<n.length;i++){var o=$(t[i]),r='<div style="height:'+o.height()+"px;width:"+o.width()+'px;"></div>';$(n[i]).replaceWith(r)}}function T(e){setTimeout(function(){b()},100)}function b(){var e=".left-pane,.right-pane,.jwplaylistcontainer,.int-pp-passageContent,input[type=text],.passage-scrolling,.ee-input-panel,.tab-scrolling,#notepad,.int-extended-text,.rte-editbox,.tab-pane";try{var t=$("#content").find(":radio").filter("input[checked=checked]"),n=$(document.body).clone();n.addClass("tn8-magnified-body"),n.find("*").attr("tabindex",-1).removeAttr("name").removeAttr("data-module"),g(t),f(n),n.find("video").each(function(e,t){t.src="",t.load()}).remove(),n.find("audio").remove(),v(n),$(n).find("span , [data-style], svg *").removeAttr("id data-identifier"),$(n).find(".modal").removeClass("modal").addClass("modal-inside-magnifier"),$(n).find(".selectable-panel").removeClass("selectable-panel"),$(n).find(".hopscotch-bubble").removeClass("animated").addClass("animated-magnified"),M.empty(),M.append(n);var i=$("#header.navbar",M),o=$("#header.navbar",document).height();if(i.css({height:o}),$("body.ie").length){M.find('#tn8-sidebar,#jGrowl,#exhibits-modal,.navbar,.calcDiv,.calculatorDiv,.measureTool,#notepadContainer,div[class*="acc-lineReader-"],.hopscotch-bubble').css({position:"absolute"}),"static"===$("#header").css("position")&&M.find("#main_panel").css("margin-top",20*V+"px");var r=$("#header.navbar",M);r.css("top",+r.css("top").slice(0,-2)+$(document).scrollTop());var s=M.find("#calculatorDiv");s.length&&s.attr("style",s.attr("style").replace("z-index: 1040;",""))}window.TestEngine&&window.TestEngine.isJXBrowserApp()&&M.find("textarea").each(function(e){var t=$(this).val().replace(/</g,"&lt;").replace(/>/g,"&gt;"),n=$("<div>"+t+"</div>");n.attr({id:$(this).attr("id"),class:$(this).attr("class"),contentEditable:!0}),n.attr("style",$(this).attr("style"));var i={border:"1px solid #000","border-radius":"4px","padding-left":"12px","white-space":"pre-wrap","overflow-x":"hidden","overflow-y":"auto","font-size":"14px"};$(this).attr("class")&&-1===$(this).attr("class").indexOf("int-extended-text")&&(i.border="1px solid #CCC"),n.css(i),$(this).replaceWith(n)}),$("#jGrowl",M).attr("id",""),$(".magnified_content").find("body").css("padding-top","0px"),$("html.pane-scrolling").length>0&&w(),y(),p(),h(e,u(e)),m(),$(n).find("img").off("load").on("load",function(){h(e,u(e))})}catch(e){console.log(e)}}function w(){M.css("padding","0");var e=$("body",M),t=$("html.pane-scrolling body").not(e).outerHeight(),n=$("html.pane-scrolling body").not(e).outerWidth(),i=$("html.pane-scrolling body").not(e).css("padding-top");M.css({height:t,width:n}),e.css("padding-top",i);var o=$("html.pane-scrolling #main_panel > .container").css("margin");$("html.pane-scrolling .magnifying_glass #main_panel > .container").css("margin",o)}function y(e){e||$("*",M).each(function(){("fixed"===$(this).css("position")||$("body.ie").length&&"absolute"===$(this).css("position"))&&"none"!==$(this).css("display")&&$(this).css("top",+$(this).css("top").slice(0,-2)+$(document).scrollTop())})}function S(e,t){P.remove(),D.remove(),!0!==t&&$(document).trigger("MagnifierCloseEvent"),$(window).off("resize",s).off("scroll",y),M.off("keydown"),$(document).off("magnifier.refresh",T),$(document).off("magnifier.reappend",C),$(document).off("do.disableInteraction",E),$(document).off("do.enableInteraction",I),$(document).off("tn.errorPage",S),k=!1,_()}function C(){P.remove(),D.remove(),k=!1,_(),P.append(M),P.append(D),$(document.body).append(P),b(),k=!0,_()}function N(){S(null,!0),P.append(M),P.append(D),$(document.body).append(P),b(),$(document).on("magnifier.refresh",T),$(document).on("magnifier.reappend",C),$(document).on("tn.errorPage",S),r(),a(),$(window).on("resize",s).on("scroll",y),k=!0,_()}function _(){if(k){var e={start:l,drag:c,stop:d};$("body.ie.surface").length||(e.containment="document"),P.draggable(e),!U&&L&&($(document).on(L,S),U=!0,$(document).off("do.disableInteraction",E).on("do.disableInteraction",E),$(document).off("do.enableInteraction",I).on("do.enableInteraction",I))}else U&&($(document).off(L,S),U=!1,$(document).off("do.disableInteraction",E),$(document).off("do.enableInteraction",I))}function E(){P.draggable("disable")}function I(){P.draggable("enable")}function x(e){e.enabled?(N(),$(document).trigger("Used.Magnifier")):S()}var R,k,A,O,L,P,D,M,F,B,U=!1,V=2,j=navigator.userAgent.toLowerCase(),z=-1!==j.indexOf("safari")&&-1!==j.indexOf("version/5.1");return{init:n,setContentContainer:t,handleToggle:x,getEnabled:function(){return k},destroy:S}}),n("main",["MagnifierController"],function(e){"use strict";var t={toolbox:void 0};return t.createToolbox=function(n){e.setContentContainer(n);var i={magnifierController:e};return t.toolbox=i,i},t}),t("main")}()}(this),define("javascripts/tools/magnifier-lib",function(){}),define("secondPriorityLibs",["controllers/TestStateController","util/InteractiveObjectRegister","util/SupportMediaForm","controllers/CommandCenter","controllers/ScoreController","controllers/globalController","controllers/NavigationController","controllers/ItemController","views/logout","views/practiceTest","views/appCheckView","views/EpatReportView","views/endtest","views/EndSectionView","views/StartSectionView","models/StartSectionModel","models/FormModel","views/tests/availableTests","views/tests/test","views/tests/initializer","util/SleepDetector","util/LogFinder","controllers/AuthenticationController","controllers/ProgressBarController","controllers/DataProvider","controllers/EWSController","text!tpl/combined.html","util/TestDefProperties","tools/inactivityTimer","views/tests/availableParts","models/SettingsModel","views/SettingsView","util/fsDeepZoom","util/ItemBehaviors","util/template","javascripts/jquery.nativescroll","timer/timerControllers/ItemTimerController","javascripts/jquery-ui.min","javascripts/jquery.ui.touch-punch.min","views/timerView/TimerView","javascripts/tools/answermasking-lib","javascripts/tools/contrastcontroller-lib","javascripts/tools/linereader-lib","util/modalize","util/modalUtils","javascripts/tools/magnifier-lib"],function(){return{TestStateController:arguments[0],InteractiveObjectRegister:arguments[1],SupportMediaForm:arguments[2],CommandCenter:arguments[3],ScoreController:arguments[4],VariableFactory:arguments[5],NavigationController:arguments[6],ItemController:arguments[7],LogoutView:arguments[8],PracticeTestView:arguments[9],AppCheckView:arguments[10],EpatReportView:arguments[11],EndTestView:arguments[12],EndSectionView:arguments[13],StartSectionView:arguments[14],StartSectionModel:arguments[15],FormModel:arguments[16],TestsView:arguments[17],TestView:arguments[18],Initializer:arguments[19],SleepDetector:arguments[20],LogFinder:arguments[21],AuthenticationController:arguments[22],ProgressBarController:arguments[23],DataProvider:arguments[24],EWSController:arguments[25],combinedTpl:arguments[26],TestDefProperties:arguments[27],InactivityTimer:arguments[28],PartsView:arguments[29],SettingsModel:arguments[30],SettingsView:arguments[31],fsDeepZoom:arguments[32]}});
